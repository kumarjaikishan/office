import{r,a as V,f as H,b as f,y as o,j as t,an as W,A as M,ao as q,P as G,Q as J,I as K}from"./index-CTh4XINP.js";import{u as X}from"./imageresizer-D4I-KFLq.js";import{a as Y}from"./index-tdGVyr3O.js";import{T as $}from"./TextField-DZ2WNkho.js";import{I as Z}from"./InputAdornment-B8s20t01.js";import{B as N}from"./Button-Gf5sSqIk.js";import{I as ee}from"./IconButton-xdrQIKPO.js";import{d as te}from"./Select-CrBcKFAw.js";import{M as b}from"./MenuItem-Cy-BF1ws.js";import{D as ae,a as se,b as re}from"./DialogContent-qFcbVjz-.js";import{D as ne}from"./DialogTitle-D8zBG8Jc.js";import"./createSimplePaletteValueFilter-B4rI7VpO.js";import"./Typography-22Vbjyg4.js";import"./ButtonBase-DRT54j5u.js";import"./useSlotProps-DkXkGTp2.js";const Ne=()=>{const[i,A]=r.useState([]),[d,x]=r.useState([]),[c,F]=r.useState(""),O=V(),{ledger:z}=H(e=>e.user),[m,v]=r.useState(null),[j,w]=r.useState(""),[P,g]=r.useState(!1),[l,L]=r.useState(null),{handleImage:B}=X(),[R,C]=r.useState(!1),p={Authorization:`Bearer ${localStorage.getItem("emstoken")}`},[I,S]=r.useState(null),T=!!I,U=e=>{e.stopPropagation(),S(e.currentTarget)},u=e=>{e==null||e.stopPropagation(),S(null)};r.useEffect(()=>{y()},[z]),r.useEffect(()=>{if(!(i.length<1))if(c.trim()==="")x(i);else{const e=c.toLowerCase();x(i.filter(a=>a.name.toLowerCase().includes(e)))}},[c,i]);const y=async()=>{var e,a;try{const s=await f.get("/api/ledger",{headers:p});console.log(s.data),A(s.data.ledgers),x(s.data.ledgers)}catch(s){console.log(s.response),o.warning(((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch ledgers")}},E=(e=null)=>{e?(w(e.name),v(e._id),L(e.profileImage||null)):(w(""),v(null),L(null)),g(!0)},Q=async()=>{var s,n;const e=j.trim();if(!e)return o.warn("Ledger name can't be empty");if(e.length<3)return o.warn("Ledger name must be at least 3 characters");const a=new FormData;if(a.append("name",e),l instanceof File){let h=await B(200,l);a.append("image",h)}try{C(!0),m?(await f.put(`/api/ledger/${m}`,a,{headers:{...p,"Content-Type":"multipart/form-data"}}),o.success("Ledger updated")):(await f.post("/api/ledger",a,{headers:{...p,"Content-Type":"multipart/form-data"}}),o.success("Ledger created")),g(!1),y()}catch(h){console.error(h),o.warning(((n=(s=h.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to save ledger")}finally{C(!1)}},_=async e=>{swal({title:`Are you sure to Delete ${e.name}'s Ledger?`,icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{await f.delete(`/api/ledger/${e._id}`,{headers:p}),o.success("Ledger deleted"),y()}catch(s){console.log(s),o.error("Failed to delete ledger")}})},k=e=>{if(e){let a=`./${e._id}?name=${encodeURIComponent(e.name)}`;return e.profileImage&&(a+=`&profileimage=${encodeURIComponent(e.profileImage)}`),O(a)}},D=r.useRef(null);return t.jsxs("div",{className:"w-full bg-white rounded",children:[t.jsxs("div",{className:"p-1 md:p-4 py-4 mb-4",children:[t.jsxs("div",{className:"flex mb-4 gap-2 flex-wrap justify-between",children:[t.jsx($,{size:"small",label:"Search Ledger",className:"w-full md:w-[200px]",value:c,onChange:e=>F(e.target.value),InputProps:{startAdornment:t.jsx(Z,{position:"start",children:t.jsx(W,{className:"text-gray-500"})})}}),t.jsx(N,{className:"w-full md:w-[200px]",variant:"contained",onClick:()=>E(),children:"Add Ledger"})]}),t.jsx("div",{className:"w-full p-1 md:p-3",children:t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4",children:[d.map((e,a)=>{var s;return t.jsxs("div",{onClick:()=>k(e),className:"relative cursor-pointer overflow-hidden rounded-xl shadow-md hover:shadow-lg transition-all pl-3 pr-1 py-3 bg-gray-50",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex gap-1 items-center",children:[t.jsx(M,{sx:{width:35,height:35},alt:e.name,src:e.profileImage}),t.jsx("div",{className:"text-[14px] md:text-[16px] font-semibold text-gray-800 mb-2 capitalize",children:e.name})]}),t.jsx(ee,{onClick:U,size:"small",children:t.jsx(Y,{className:"text-gray-700"})}),t.jsxs(te,{anchorEl:I,open:T,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[t.jsxs(b,{onClick:n=>{n.stopPropagation(),u(),k(e)},children:[t.jsx(q,{className:"text-blue-600 mr-2"})," See"]}),t.jsxs(b,{onClick:n=>{n.stopPropagation(),u(),E(e)},children:[t.jsx(G,{className:"text-teal-600 mr-2"})," Edit"]}),t.jsxs(b,{onClick:n=>{n.stopPropagation(),u(),_(e)},children:[t.jsx(J,{className:"text-red-600 mr-2"})," Delete"]})]})]}),t.jsxs("p",{className:`text-[16px] md:text-lg mr-1 text-end font-medium ${e.netBalance>=0?"text-green-600":"text-red-600"}`,children:["â‚¹ ",(s=e==null?void 0:e.netBalance)==null?void 0:s.toLocaleString()]}),t.jsx("span",{className:"w-[4px] h-full absolute left-0 top-0 bg-teal-700"})]},a)}),(d==null?void 0:d.length)<1&&t.jsx("div",{className:"w-full text-center ",children:"No Ledger found"})]})})]}),t.jsxs(ae,{open:P,onClose:()=>g(!1),children:[t.jsx(ne,{children:m?"Edit Ledger":"Add Ledger"}),t.jsxs(se,{children:[t.jsx($,{autoFocus:!0,fullWidth:!0,margin:"dense",label:"Ledger Name",value:j,onChange:e=>w(e.target.value)}),t.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[t.jsx("input",{style:{display:"none"},type:"file",onChange:e=>L(e.target.files[0]),ref:D,accept:"image/*",id:"fileInput"}),t.jsx(M,{sx:{width:80,height:80},alt:j,src:l?l instanceof File?URL.createObjectURL(l):l:""}),t.jsx("span",{onClick:()=>D.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:t.jsx(K,{size:18})})]})]}),t.jsxs(re,{children:[t.jsx(N,{onClick:()=>g(!1),children:"Cancel"}),t.jsx(N,{disabled:R,variant:"contained",onClick:Q,children:m?"Update":"Create"})]})]})]})};export{Ne as default};
