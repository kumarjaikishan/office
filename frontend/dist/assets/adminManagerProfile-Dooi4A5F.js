import{r as d,f as I,u as P,j as e,G as g,A as R,K as C,x as M,X as z,Q as A,y as l,b as j,v as U,L as D}from"./index-BnPnHAWO.js";import{u as O}from"./imageresizer-D4I-KFLq.js";import{B}from"./Button-Bcz6Kzi9.js";import"./createSimplePaletteValueFilter-CV2aCUyM.js";import"./ButtonBase-lQW-ETfK.js";const f={1:"Read",2:"Write",3:"Update",4:"Delete"},T=()=>{const[b,F]=d.useState(!1),[m,y]=d.useState(!1),{profile:t}=I(a=>a.user),[s,p]=d.useState(null),[N,x]=d.useState(!1),{handleImage:w}=O(),v=P(),u=d.useRef(null);d.useEffect(()=>{t&&p(t)},[t]);const k=async a=>{var n,c;const r=a.target.files[0];if(!r)return;const i=URL.createObjectURL(r);p(o=>({...o,profileImage:i}));try{const o=localStorage.getItem("emstoken"),h=new FormData;let L=await w(200,r);h.append("profileImage",L),l.loading("Uploading image...");const E=await j.post("/api/profile-image",h,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}});l.dismiss(),l.success(E.data.message),v(U())}catch(o){l.dismiss(),l.error(((c=(n=o.response)==null?void 0:n.data)==null?void 0:c.message)||"Upload failed"),console.error(o)}},S=async()=>{var r,i;let a;try{x(!0),a=l.loading("Please wait...");const n=localStorage.getItem("emstoken"),c=await j.get("/api/resetrequest",{headers:{Authorization:`Bearer ${n}`}});x(!1),D({title:c.data.extramessage,icon:"success"}),l.update(a,{render:c.data.message,type:"success",isLoading:!1,autoClose:2100})}catch(n){x(!1),l.update(a,{render:((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.message)||n.message,type:"warn",isLoading:!1,autoClose:2200})}};return e.jsx("div",{className:"p-0 md:p-4",children:b?e.jsxs("div",{className:"w-full h-[300px] flex gap-5 flex-col justify-center items-center overflow-auto bg-white",children:[e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"animate-spin",style:{animationDuration:"2.5s"},size:50,color:"teal"}),e.jsx(g,{className:"absolute -bottom-4 left-0 animate-spin",style:{animationDuration:"3s"},size:20,color:"teal"})]}),e.jsx("p",{className:"text-teal-600",children:"loading..."})]}):e.jsxs("div",{className:"w-full mx-auto bg-white overflow-auto shadow rounded-lg p-1 py-2 md:p-4",children:[e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{sx:{width:72,height:72},alt:s==null?void 0:s.name,src:s==null?void 0:s.profileImage}),e.jsx("input",{type:"file",ref:u,style:{display:"none"},onChange:k,accept:"image/*"}),e.jsx("span",{onClick:()=>u.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:e.jsx(C,{size:18})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl capitalize font-bold text-gray-800 break-words",children:s==null?void 0:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s==null?void 0:s.role}),e.jsx("div",{className:"mt-3 space-y-1 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2 break-words",children:[e.jsx(M,{className:"text-gray-500"}),(s==null?void 0:s.email)||"N/A"]})})]})]}),(t==null?void 0:t.role)!=="superadmin"&&(t==null?void 0:t.role)!=="developer"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 md:py-2 rounded-md",onClick:()=>y(!m),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:m?"Hide Permissions":"View Permissions"}),m?e.jsx(z,{className:"text-xl"}):e.jsx(A,{className:"text-xl"})]}),m&&e.jsxs("div",{className:"text-sm mt-3 overflow-x-auto",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(f).map(a=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:a},a))]})}),e.jsx("tbody",{children:Object.entries((s==null?void 0:s.permissions)||{}).map(([a,r])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:a}),Object.keys(f).map(i=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:r.includes(Number(i))?"âœ…":"-"},i))]},a))})]})]})]}),(t==null?void 0:t.role)==="superadmin"&&e.jsx("div",{className:"my-2",children:e.jsx(B,{onClick:S,disabled:N,title:"Send Password Reset Link",variant:"contained",className:"splbtn",children:"Send Password Reset Link"})})]})})};export{T as default};
