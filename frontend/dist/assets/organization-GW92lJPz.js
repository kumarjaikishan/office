import{r as x,a5 as Ce,a6 as ke,a7 as ne,a8 as Se,a9 as Te,T as Q,j as e,aa as Me,ab as Ae,ac as X,ad as he,u as te,g as de,b,F as V,I as Z,S as J,M as _,A as ee,l as ye,O as se,V as ie,B as I,c as $,y as C,m as F,R as ce,W as Ie,i as Ee,C as De,a0 as be,a1 as ae,ae as ze,U as Be,af as Pe,a2 as q,a3 as U,k as Oe}from"./index-DBKpBzGg.js";import{C as Y}from"./Checkbox-B7zxLVti.js";import{F as $e}from"./FormControlLabel-jkGCcnqf.js";import{I as pe}from"./index-BVG7apjh.js";import{u as je}from"./attandencehelper-Cwq7A8Tb.js";import{A as ve,a as Le}from"./index-ZEQGb_Gi.js";import{u as we}from"./imageresizer-D4I-KFLq.js";const We=l=>{const{classes:p,inset:w,primary:c,secondary:o,dense:v}=l;return Me({root:["root",w&&"inset",v&&"dense",c&&o&&"multiline"],primary:["primary"],secondary:["secondary"]},Ae,p)},Fe=Se("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(l,p)=>{const{ownerState:w}=l;return[{[`& .${X.primary}`]:p.primary},{[`& .${X.secondary}`]:p.secondary},p.root,w.inset&&p.inset,w.primary&&w.secondary&&p.multiline,w.dense&&p.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${he.root}:where(& .${X.primary})`]:{display:"block"},[`.${he.root}:where(& .${X.secondary})`]:{display:"block"},variants:[{props:({ownerState:l})=>l.primary&&l.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:l})=>l.inset,style:{paddingLeft:56}}]}),K=x.forwardRef(function(p,w){const c=Ce({props:p,name:"MuiListItemText"}),{children:o,className:v,disableTypography:d=!1,inset:j=!1,primary:E,primaryTypographyProps:k,secondary:h,secondaryTypographyProps:n,slots:g={},slotProps:z={},...P}=c,{dense:S}=x.useContext(ke);let A=E??o,f=h;const a={...c,disableTypography:d,inset:j,primary:!!A,secondary:!!f,dense:S},i=We(a),u={slots:g,slotProps:{primary:k,secondary:n,...z}},[M,B]=ne("root",{className:Te(i.root,v),elementType:Fe,externalForwardedProps:{...u,...P},ownerState:a,ref:w}),[O,s]=ne("primary",{className:i.primary,elementType:Q,externalForwardedProps:u,ownerState:a}),[y,m]=ne("secondary",{className:i.secondary,elementType:Q,externalForwardedProps:u,ownerState:a});return A!=null&&A.type!==Q&&!d&&(A=e.jsx(O,{variant:S?"body2":"body1",component:s!=null&&s.variant?void 0:"span",...s,children:A})),f!=null&&f.type!==Q&&!d&&(f=e.jsx(y,{variant:"body2",color:"textSecondary",...m,children:f})),e.jsxs(M,{...B,children:[A,f]})}),xe=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Re=({setopenviewmodal:l,employee:p,company:w,editbranch:c,editbranchdata:o})=>{const v={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[d,j]=x.useState(v),E=te(),{adminManager:k}=de(a=>a.user),[h,n]=x.useState([]),g=localStorage.getItem("emstoken");x.useEffect(()=>{j(a=>({...a,companyId:w._id})),c&&j(a=>({...a,...o}))},[w,c]),x.useEffect(()=>{(k==null?void 0:k.length)>0&&n(k.filter(a=>a.role==="manager"))},[k]);const z=()=>{l(!1),j(v)},P=(a,i)=>{j(u=>({...u,[a]:i}))},S=(a,i,u)=>{j(M=>({...M,setting:{...M.setting,[a]:{...M.setting[a],[i]:u}}}))},A=async()=>{var a,i;try{const u=await $.post("/api/addBranch",d,{headers:{Authorization:`Bearer ${g}`}});C.success(u.data.message),l(!1),E(F()),z()}catch(u){console.error(u),C.error(((i=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:i.message)||"Error adding branch")}},f=async()=>{var a,i;try{const u=await $.post("/api/editBranch",d,{headers:{Authorization:`Bearer ${g}`}});C.success(u.data.message),E(F()),l(!1),z()}catch(u){console.error(u),C.error(((i=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:i.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:c?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(b,{label:"Branch Name",fullWidth:!0,size:"small",value:d.name,onChange:a=>P("name",a.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(b,{label:"Location",fullWidth:!0,size:"small",value:d.location,onChange:a=>P("location",a.target.value),helperText:"City, State or Address"}),e.jsxs(V,{size:"small",fullWidth:!0,children:[e.jsx(Z,{children:"Managers"}),e.jsx(J,{multiple:!0,value:(d==null?void 0:d.managerIds)||[],onChange:a=>P("managerIds",a.target.value),input:e.jsx(se,{label:"Managers"}),renderValue:a=>a.map(i=>{var u;return((u=h.find(M=>M._id===i))==null?void 0:u.name)||"Unknown"}).join(", "),children:h&&h.length>0?h.map(a=>{var i;return e.jsxs(_,{value:a._id,children:[e.jsx(Y,{checked:(i=d==null?void 0:d.managerIds)==null?void 0:i.includes(a._id)}),e.jsx(ee,{src:a==null?void 0:a.profileImage,alt:a==null?void 0:a.name,children:!(a!=null&&a.profileImage)&&e.jsx(ye,{})}),e.jsx(K,{className:"ml-2 capitalize",primary:a==null?void 0:a.name})]},a._id)}):e.jsx(_,{disabled:!0,value:"",children:e.jsx(K,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx($e,{control:e.jsx(Y,{checked:!d.defaultsetting,onChange:a=>j(i=>({...i,defaultsetting:!a.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!d.defaultsetting&&e.jsx("div",{className:"border-primary border-2 border-dashed rounded mt-3 py-3 px-1",children:e.jsxs(ie,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(b,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:a=>S("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(b,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:a=>S("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(b,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.officeTime.breakMinutes,onChange:a=>S("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(b,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.fullDay,onChange:a=>S("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(b,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.halfDay,onChange:a=>S("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(b,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.shortDayThreshold,onChange:a=>S("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(b,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.overtimeAfterMinutes,onChange:a=>S("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(V,{size:"small",fullWidth:!0,children:[e.jsx(Z,{children:"Weekly Offs"}),e.jsx(J,{multiple:!0,value:d.setting.weeklyOffs,onChange:a=>j(i=>({...i,setting:{...i.setting,weeklyOffs:a.target.value}})),input:e.jsx(se,{label:"Weekly Offs"}),renderValue:a=>a.map(i=>{var u;return(u=xe.find(M=>M.value===i))==null?void 0:u.label}).join(", "),children:xe.map(a=>e.jsxs(_,{value:a.value,children:[e.jsx(Y,{checked:d.setting.weeklyOffs.includes(a.value)}),e.jsx(K,{primary:a.label})]},a.value))})]}),Object.entries(d.setting.attendanceRules).map(([a,i])=>{const u=a.replace(/([A-Z])/g," $1").replace(/^./,B=>B.toUpperCase()),M={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(b,{fullWidth:!0,size:"small",label:u,type:"time",value:i,onChange:B=>j(O=>({...O,setting:{...O.setting,attendanceRules:{...O.setting.attendanceRules,[a]:B.target.value}}})),helperText:M[a]},a)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:z,children:"Cancel"}),c?e.jsx(I,{variant:"contained",onClick:f,children:"Save"}):e.jsx(I,{variant:"contained",onClick:A,children:"Add Branch"})]})]})},_e=async({companyinp:l,setisload:p})=>{const w=localStorage.getItem("emstoken");p(!0);try{const c=await $.post("/api/addcompany",{name:l.name,industry:l.industry},{headers:{Authorization:`Bearer ${w}`}});console.log("Query:",c),C.success(c.data.message,{autoClose:1200})}catch(c){console.log(c),c.response?C.warn(c.response.data.message,{autoClose:1200}):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{p(!1)}},qe=[{name:"S.no",selector:l=>l.sno,width:"40px"},{name:"Branch",selector:l=>l.branch},{name:"Department",selector:l=>l.dep_name},{name:"Action",selector:l=>l.action,width:"80px"}],Ue=async({inp:l,setisload:p,setInp:w,setopenmodal:c,init:o,dispatch:v})=>{console.log(l);const{branchId:d,department:j,description:E}=l;if(!j){alert("Please fill in both fields");return}const k=localStorage.getItem("emstoken");p(!0);try{const h=await $.post("/api/adddepartment",{department:j,branchId:d,description:E},{headers:{Authorization:`Bearer ${k}`}});v(F()),C.success(h.data.message,{autoClose:1200}),w(o),c(!1)}catch(h){console.log(h),h.response?C.warn(h.response.data.message,{autoClose:1200}):h.request?console.error("No response from server:",h.request):console.error("Error:",h.message)}finally{p(!1)}},He=async({inp:l,setisload:p,setInp:w,setopenmodal:c,init:o,dispatch:v})=>{const{departmentId:d,department:j,description:E}=l;if(!j||!d){alert("All fileds are Required");return}const k=localStorage.getItem("emstoken");p(!0);try{const h=await $.post("/api/updatedepartment",{departmentId:d,department:j,description:E},{headers:{Authorization:`Bearer ${k}`}});v(F()),C.success(h.data.message,{autoClose:1200}),w(o),c(!1)}catch(h){console.log(h),h.response?C.warn(h.response.data.message,{autoClose:1200}):h.request?console.error("No response from server:",h.request):console.error("Error:",h.message)}finally{p(!1)}},Ve=async({departmentId:l,setisload:p,dispatch:w})=>{if(!l){alert("All fileds are Required");return}const c=localStorage.getItem("emstoken");p(!0);try{const o=await $.post("/api/deletedepartment",{departmentId:l},{headers:{Authorization:`Bearer ${c}`}});w(F()),C.success(o.data.message,{autoClose:1200})}catch(o){console.log(o),o.response?C.warn(o.response.data.message,{autoClose:1200}):o.request?console.error("No response from server:",o.request):console.error("Error:",o.message)}finally{p(!1)}},Ze=()=>{const[l,p]=x.useState(!1),[w,c]=x.useState(!1),[o,v]=x.useState([]),[d,j]=x.useState(!1),[E,k]=x.useState([]),{branch:h,department:n}=de(s=>s.user),[g,z]=x.useState({branch:"all",department:" "}),P=g.branch!=="all"||g.department.trim()!=="",S=te();x.useEffect(()=>{if(!o||o.length===0)return;const s=o.filter(y=>{var D;const m=g.branch==="all"||y.branchid===g.branch,T=g.department.trim()===""||((D=y.dep_name)==null?void 0:D.toLowerCase().includes(g.department.trim().toLowerCase()));return m&&T});k(s)},[g,o]);const A={departmentId:"",branchId:"",department:"",description:""},[f,a]=x.useState(A);x.useEffect(()=>{if(n.length>0){let s=1;const y=n.map(m=>{var T,D;return{id:m._id,sno:s++,branchid:(T=m==null?void 0:m.branchId)==null?void 0:T._id,branch:(D=m==null?void 0:m.branchId)==null?void 0:D.name,dep_name:m==null?void 0:m.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>M(m),children:e.jsx(ce,{})}),e.jsx("span",{className:"delete",onClick:()=>B(m._id),children:e.jsx(ve,{})})]})}});v(y)}},[n]);const i=(s,y)=>{a({...f,[y]:s.target.value})},u=s=>{s.preventDefault(),Ue({inp:f,setisload:c,setInp:a,setopenmodal:p,init:A,dispatch:S})},M=s=>{console.log("edit",s),j(!0),a({branchId:s.branchId._id,departmentId:s._id,department:s.department,description:s.description}),p(!0)},B=s=>{console.log("delete",s),Ie({title:"Are you sure?",text:"Once deleted, All empoyee of this department deleted",icon:"warning",buttons:!0,dangerMode:!0}).then(async y=>{y&&Ve({departmentId:s,setisload:c,dispatch:S})})},O=()=>{He({inp:f,setisload:c,setInp:a,setopenmodal:p,init:A,dispatch:S})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(V,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(Z,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(J,{value:g.branch,onChange:s=>z({...g,branch:s.target.value}),input:e.jsx(se,{startAdornment:e.jsx(Ee,{position:"start",children:e.jsx(De,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(_,{selected:!0,value:"all",children:"All"}),h==null?void 0:h.map(s=>e.jsx(_,{value:s._id,children:s.name},s._id))]})]}),e.jsx(b,{size:"small",id:"outlined-basic",value:g.department,onChange:s=>z({...g,department:s.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(I,{className:"w-full md:w-auto",variant:"contained",onClick:()=>p(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(be,{customStyles:je(),columns:qe,data:P?E:o,pagination:!0,highlightOnHover:!0})}),e.jsx(ae,{open:l,onClose:()=>p(!1),children:e.jsx("div",{className:"membermodal w-[650px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Add Department"}),e.jsx("form",{onSubmit:u,children:e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs(V,{sx:{width:"98%"},size:"small",children:[e.jsx(Z,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(J,{value:f.branchId,label:"branch",onChange:s=>i(s,"branchId"),children:h==null?void 0:h.map(s=>e.jsx(_,{value:s._id,children:s.name},s._id))})]}),e.jsx(b,{sx:{width:"98%"},required:!0,value:f.department,onChange:s=>i(s,"department"),label:"Department",size:"small"}),e.jsx(b,{multiline:!0,rows:4,onChange:s=>i(s,"description"),value:f.description,sx:{width:"98%"},label:"Description",size:"small"})]})})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{size:"small",onClick:()=>{p(!1),j(!1),a(A)},variant:"outlined",children:" cancel"}),!d&&e.jsx(I,{sx:{mr:2},loading:w,loadingPosition:"end",endIcon:e.jsx(pe,{}),onClick:u,variant:"contained",type:"submit",children:"Add"}),d&&e.jsx(I,{sx:{mr:2},loading:w,loadingPosition:"end",endIcon:e.jsx(pe,{}),variant:"contained",onClick:O,children:"Update"})]})]})})})]})},G={1:"Read",2:"Create",3:"Update",4:"Delete"},fe=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],oe={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},Je={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function Qe(){const[l,p]=x.useState([]),[w,c]=x.useState([]),[o,v]=x.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...oe}}),d=te();x.useEffect(()=>{s()},[]);const j=x.useRef(null),{handleImage:E}=we(),[k,h]=x.useState(null),[n,g]=x.useState(!1),[z,P]=x.useState(""),[S,A]=x.useState(!1),[f,a]=x.useState(null),i=t=>{a(r=>r===t?null:t)},u=()=>{v({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...oe}}),P(""),h(null),g(!1)},[M,B]=x.useState({userid:"",pass:""}),O=async()=>{const t={...o},r=new FormData;c(!0);try{const N=t.profileImage?await E(240,t.profileImage):null;N&&r.append("photo",N),r.append("name",t.name),r.append("email",t.email),r.append("role",t.role),r.append("password",t.password),r.append("permissions",JSON.stringify(t.permissions));const L=localStorage.getItem("emstoken");c(!0);const W=k!==null?`/api/editAdmin/${l[k]._id}`:"/api/addAdmin",H=await $["post"](W,r,{headers:{Authorization:`Bearer ${L}`,"Content-Type":"multipart/form-data"}});C.success(H.data.message,{autoClose:1200}),u(),s(),d(F())}catch(N){console.error(N),N.response?C.warn(N.response.data.message,{autoClose:1200}):C.error("Something went wrong",{autoClose:1200})}finally{c(!1)}},s=async()=>{try{const t=localStorage.getItem("emstoken");c(!0);const r=await $.get("/api/getAdmin",{headers:{Authorization:`Bearer ${t}`}});p(r.data)}catch(t){console.error(t),t.response?C.warn(t.response.data.message,{autoClose:1200}):C.error("Something went wrong",{autoClose:1200})}finally{c(!1)}},y=t=>{const r=l[t];console.log(r),v({...r,profilePreview:r.profileImage||"",profileImage:null}),h(t),g(!0)},m=async t=>{t.preventDefault();try{const r=localStorage.getItem("emstoken"),N=await $.post("/api/updatepassword",{pass:M},{headers:{Authorization:`Bearer ${r}`}});B({userid:"",pass:""}),A(!1),C.success(N.data.message,{autoClose:1200})}catch(r){console.log(r),r.response?C.warn(r.response.data.message,{autoClose:1200}):r.request?console.error("No response from server:",r.request):console.error("Error:",r.message)}},T=async t=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async r=>{var N,L;if(r){let W;try{const R=localStorage.getItem("emstoken");c(!0),W=C.loading("Deleting...");const H=await $.delete(`/api/deleteAdmin/${t}`,{headers:{Authorization:`Bearer ${R}`}});C.update(W,{render:H.data.message,type:"success",isLoading:!1,autoClose:1800}),s(),d(F())}catch(R){console.error(R),C.update(W,{render:((L=(N=R.response)==null?void 0:N.data)==null?void 0:L.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{c(!1)}}})},D=(t,r)=>{v(N=>{const L=N.permissions[t]||[],R=L.includes(r)?L.filter(H=>H!==r):[...L,r].sort();return{...N,permissions:{...N.permissions,[t]:R}}})},me=t=>{const r=t==="admin"?{...oe}:{...Je};v({...o,role:t,permissions:r})},le=t=>{const r=t.target.files[0];r&&v(N=>({...N,profileImage:r,profilePreview:URL.createObjectURL(r)}))},re=()=>{z&&(v(t=>({...t,permissions:{...t.permissions,[z]:[]}})),P(""))},ue=Array.from(new Set([...o.role==="admin"?fe:Object.keys(o.permissions),...Object.keys(o.permissions)])),Ne=fe.filter(t=>!ue.includes(t));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:" shadow-md rounded-lg",children:[e.jsx("div",{className:"flex justify-between flex-wrap items-center mb-4",children:e.jsx(I,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{u(),g(!0)},children:"Add Admin/ Manager"})}),l.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:l.map((t,r)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{sx:{width:60,height:60},alt:t.name,src:t==null?void 0:t.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[t.name," (",t.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:t.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{title:"Edit",className:"p-2 border rounded hover:bg-gray-100",onClick:()=>y(r),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx("button",{title:"Password Reset",className:"p-2 border rounded hover:bg-gray-100 text-green-500",onClick:()=>{B({...M,userid:t._id}),A(!0)},children:e.jsx(Be,{className:"h-4 w-4 "})}),e.jsx("button",{title:"Delete",className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>T(t._id),children:e.jsx(Pe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>i(r),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",f===r?"Hide Permissions":"View Permissions "]}),f===r?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),f===r&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(G).map(N=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:N},N))]})}),e.jsx("tbody",{children:Object.entries(t.permissions).map(([N,L])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:N}),Object.keys(G).map(W=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:L.includes(Number(W))?"✅":"-"},W))]},N))})]})]})]})]},r))})]}),e.jsx(ae,{open:n,onClose:()=>g(!1),children:e.jsx("div",{className:"membermodal w-[660px]",children:e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"modalhead",children:[" ",k!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-full",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:le,ref:j,accept:"image/*",name:"",id:"fileInput"}),e.jsx(ee,{sx:{width:70,height:70},alt:o.name,src:o.profilePreview}),e.jsx("span",{onClick:()=>j.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(ce,{size:18})})]}),e.jsx(b,{fullWidth:!0,required:!0,value:o.name,onChange:t=>v({...o,name:t.target.value}),label:"Name",size:"small"}),e.jsx(b,{fullWidth:!0,required:!0,value:o.email,onChange:t=>v({...o,email:t.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),k==null&&e.jsxs(e.Fragment,{children:[e.jsx(b,{fullWidth:!0,required:!0,value:o.password,type:"password",onChange:t=>v({...o,password:t.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:o.role,onChange:t=>me(t.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]})]}),o.role==="manager"&&e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border p-2 flex-3 rounded ",value:z,onChange:t=>P(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),Ne.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(I,{variant:"contained",onClick:re,className:"flex-1",children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(G).map(([t,r])=>e.jsx("th",{className:"border p-2 text-center",children:r},t))]})}),e.jsx("tbody",{children:ue.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:t}),Object.keys(G).map(r=>{var N;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((N=o.permissions[t])==null?void 0:N.includes(Number(r)))||!1,onChange:()=>D(t,Number(r))})},r)})]},t))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:u,children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:O,loading:w,children:k!==null?"Update":"Create"})]})]})})}),e.jsx(ae,{open:S,onClose:()=>{A(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:m,children:[e.jsx("h2",{children:"Reset Passowrd"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(b,{fullWidth:!0,inputProps:{minLength:3,maxLength:10},required:!0,value:M.pass,onChange:t=>B({...M,pass:t.target.value}),label:"Passowrd",size:"small"}),e.jsx(I,{variant:"contained",sx:{mr:2},type:"submit",children:"Reset Password"})]})]})})})]})}const ge=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function ts(){const[l,p]=x.useState(null),[w,c]=x.useState(!1),[o,v]=x.useState(!1),[d,j]=x.useState(!1),{handleImage:E}=we(),[k,h]=x.useState(null),[n,g]=x.useState({name:"",address:"",contact:"",fullname:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),z=te(),{employee:P,company:S,branch:A,profile:f}=de(s=>s.user),a=s=>{p(y=>y===s?null:s)};x.useEffect(()=>{S&&g(S)},[S]);const i=(s,y,m)=>{g(T=>({...T,[s]:{...T[s],[y]:m}}))},u=async()=>{try{j(!0);const s=localStorage.getItem("emstoken"),y=await $.post("/api/updateCompany",{...n},{headers:{Authorization:`Bearer ${s}`}});z(F()),C.success(y.data.message,{autoClose:1800})}catch(s){console.log(s),s.response?C.warn(s.response.data.message,{autoClose:2700}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{j(!1)}},M=()=>{},B=s=>{var m;c(!0);const y={...s,managerIds:(m=s==null?void 0:s.managerIds)==null?void 0:m.map(T=>T._id)};h(y),v(!0)},O=je();return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(f==null?void 0:f.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>a("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),l==="company"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsx("div",{className:` 
                          rounded overflow-hidden transition-all duration-300 
                          ${l==="company"?"max-h-fit p-0 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsxs("div",{className:"p-1 md:p-4 rounded  flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[n!=null&&n.logo?e.jsx("img",{src:Oe(n.logo,{format:"webp",width:200,height:200})||employepic,alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Le,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async s=>{const y=s.target.files[0];if(!y)return;const m=await E(240,y),T=new FormData;T.append("_id",n._id),T.append("logo",m);try{console.log("api calling"),j(!0);const D=localStorage.getItem("emstoken"),le=(await $.post("/api/updateCompany",T,{headers:{Authorization:`Bearer ${D}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;g(re=>({...re,logo:le})),C.success("Logo uploaded successfully!")}catch(D){console.error(D),C.error("Failed to upload logo.")}finally{j(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(b,{label:"Company Name",size:"small",variant:"standard",fullWidth:!0,value:(n==null?void 0:n.name)||"",onChange:s=>g({...n,name:s.target.value})})}),e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(b,{label:"Contact",type:"tel",variant:"standard",size:"small",fullWidth:!0,value:(n==null?void 0:n.contact)||"",inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},onChange:s=>g({...n,contact:s.target.value.replace(/\D/g,"")})})})]}),e.jsx("div",{children:e.jsx(b,{label:"Company Full Name",variant:"standard",fullWidth:!0,size:"small",value:(n==null?void 0:n.fullname)||"",onChange:s=>g({...n,fullname:s.target.value})})}),e.jsx("div",{children:e.jsx(b,{label:"Address",fullWidth:!0,multiline:!0,size:"small",minRows:2,value:(n==null?void 0:n.address)||"",onChange:s=>g({...n,address:s.target.value})})}),S?e.jsx(I,{variant:"contained",loading:d,onClick:u,children:"Save Changes"}):e.jsx(I,{loading:d,variant:"contained",onClick:()=>_e({companyinp:n,setisload:j}),children:"+ Create Company"})]})]})})]}),((f==null?void 0:f.role)=="superadmin"||(f==null?void 0:f.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>a("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),l==="branches"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded space-y-1 overflow-hidden transition-all duration-300
                          ${l==="branches"?"max-h-fit p-1 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(I,{variant:"contained",onClick:()=>v(!0),children:"+ Add Branch"})}),e.jsx(be,{customStyles:O,columns:[{name:"Name",selector:s=>s.name,sortable:!0},{name:"Location",selector:s=>s.location,sortable:!0},{name:"Manager(s)",cell:s=>{var y;return e.jsx("div",{className:"flex flex-col gap-2",children:(y=s==null?void 0:s.managerIds)==null?void 0:y.map((m,T)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>M(m.userid),children:[e.jsx(ee,{src:m==null?void 0:m.profileImage,alt:m.name,children:!(m!=null&&m.profileImage)&&e.jsx(ye,{})}),e.jsx("span",{children:m.name})]},T))})}},{name:"Actions",width:"120px",cell:s=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>B(s),children:e.jsx(ce,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>B(s),children:e.jsx(ve,{})})]})}],data:A||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>a("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),l==="department"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${l==="department"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(Ze,{})})]}),(f==null?void 0:f.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>a("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),l==="admin"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${l==="admin"?"max-h-fit md:p-2 p-1 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(Qe,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>a("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),l==="attendance"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${l==="attendance"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs(ie,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(b,{label:"Office Time In",fullWidth:!0,type:"time",value:n.officeTime.in,onChange:s=>i("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(b,{label:"Office Time Out",fullWidth:!0,type:"time",value:n.officeTime.out,onChange:s=>i("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(b,{label:"Break Minutes",fullWidth:!0,type:"number",value:n.officeTime.breakMinutes,onChange:s=>i("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(b,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:n.workingMinutes.fullDay,onChange:s=>i("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(b,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:n.workingMinutes.halfDay,onChange:s=>i("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(b,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:n.workingMinutes.shortDayThreshold,onChange:s=>i("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(b,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:n.workingMinutes.overtimeAfterMinutes,onChange:s=>i("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(V,{fullWidth:!0,children:[e.jsx(Z,{children:"Weekly Offs"}),e.jsx(J,{multiple:!0,value:n.weeklyOffs,onChange:s=>g({...n,weeklyOffs:s.target.value}),input:e.jsx(se,{label:"Weekly Offs"}),renderValue:s=>s.map(y=>{var m;return(m=ge.find(T=>T.value===y))==null?void 0:m.label}).join(", "),children:ge.map(s=>e.jsxs(_,{value:s.value,children:[e.jsx(Y,{checked:n.weeklyOffs.includes(s.value)}),e.jsx(K,{primary:s.label})]},s.value))})]}),Object.entries(n.attendanceRules).map(([s,y])=>{const m=s.replace(/([A-Z])/g," $1").replace(/^./,D=>D.toUpperCase()),T={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(b,{fullWidth:!0,label:m,type:"time",value:y,onChange:D=>i("attendanceRules",s,D.target.value),helperText:T[s]},s)})]}),e.jsx(ie,{sx:{mt:4,textAlign:"right"},children:e.jsx(I,{variant:"contained",onClick:u,children:"Update Settings"})})]})]}),e.jsx(ae,{open:o,onClose:()=>{v(!1),h(null),c(!1)},children:e.jsx("div",{className:"membermodal w-[680px]",children:e.jsx(Re,{setopenviewmodal:v,editbranchdata:k,editbranch:w,company:S,employee:P})})})]})}export{ts as default};
