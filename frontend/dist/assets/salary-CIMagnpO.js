import{c as C,j as e,ai as R,aj as T,y as v,r as m,b as x,B as b,a0 as U,a3 as X,F as k,I as q,S as z,M as w,al as N}from"./index-CbDftOS7.js";import{I as A}from"./index-DcEnExWm.js";const G=[{name:"S.no",selector:t=>t.sno},{name:"Employee",selector:t=>t.employeeId},{name:"Department",selector:t=>t.department},{name:"Salary",selector:t=>t.netSalary},{name:"Pay date",selector:t=>t.payDate},{name:"Action",selector:t=>t.action}],J=async({setisload:t})=>{const r=localStorage.getItem("emstoken");t(!0);try{return(await C.get("/api/employeelist",{headers:{Authorization:`Bearer ${r}`}})).data.list}catch(l){console.log(l),l.response?v.warn(l.response.data.message,{autoClose:1200}):l.request?console.error("No response from server:",l.request):console.error("Error:",l.message)}finally{t(!1)}},K=async({setisload:t,deletee:r,edite:l})=>{const p=localStorage.getItem("emstoken");t(!0);try{const s=await C.get("/api/salaryfetch",{headers:{Authorization:`Bearer ${p}`}});console.log(s.data);let g=1;return await s.data.salary.map(o=>({id:o._id,sno:g++,employeeId:o.employeeId.employeename,department:o.employeeId.department.department,netSalary:o.netSalary,payDate:o.payDate,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>l(o),children:e.jsx(R,{})}),e.jsx("span",{className:"delete",onClick:()=>r(o._id),children:e.jsx(T,{})})]})}))}catch(s){console.log(s),s.response?v.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{t(!1)}},Q=async({inp:t,setisload:r})=>{const l=localStorage.getItem("emstoken");r(!0);const{employeeId:p,basicSalary:s,allowance:g,deductions:u,netSalary:o,payDate:j,department:I,description:S}=t;try{const i=await C.post("/api/addsalary",{employeeId:p,basicSalary:s,allowance:g,deductions:u,netSalary:o,payDate:j,department:I,description:S},{headers:{Authorization:`Bearer ${l}`}});return console.log(i),v.success(i.data.message,{autoClose:1200}),r(!1),!0}catch(i){console.log(i),i.response?v.warn(i.response.data.message,{autoClose:1200}):i.request?console.error("No response from server:",i.request):console.error("Error:",i.message)}finally{r(!1)}},Y=()=>{const[t,r]=m.useState(!1),[l,p]=m.useState(!1),[s,g]=m.useState(!1),[u,o]=m.useState([]),[j,I]=m.useState(""),[S,i]=m.useState([]),[F,M]=m.useState([]),D={employeeId:"",basicSalary:"",allowance:"",deductions:"",netSalary:0,payDate:"",description:"",department:""},[d,E]=m.useState(D);m.useEffect(()=>{$(),_()},[]);const _=async()=>{let a=await K({setisload:r,edite:P,deletee:H});console.log(a),M(a)},$=async()=>{const a=await J({setisload:r});let c=[];a.forEach(n=>{let y=c.find(f=>f.departmentid===n.department._id);if(y)y.employee.push({id:n._id,name:n.employeename});else{let f={departmentid:n.department._id,departmentname:n.department.department,employee:[{id:n._id,name:n.employeename}]};c.push(f)}}),o(c)};m.useEffect(()=>{if(j){let a=u.find(c=>c.departmentid==j);i(a.employee)}},[j,u]);const B=async a=>{a.preventDefault(),console.log(d),await Q({inp:d,setisload:r})&&p(!1)},P=a=>{console.log("eplyee edit",a)},H=a=>console.log("delete",a),h=(a,c)=>{const n=a.target.value,y={...d,[c]:n},f=parseFloat(c==="basicSalary"?n:y.basicSalary)||0,L=parseFloat(c==="allowance"?n:y.allowance)||0,O=parseFloat(c==="deductions"?n:y.deductions)||0;y.netSalary=(f+L-O).toFixed(2),E(y)};return e.jsxs("div",{className:"salary",children:[e.jsx("h2",{children:"Salary Management"}),e.jsxs("div",{className:"head",children:[e.jsx(x,{size:"small",id:"outlined-basic",label:"Search Department",variant:"standard"}),e.jsx(b,{variant:"contained",onClick:()=>p(!0),children:"Add Salary"})]}),e.jsx("div",{className:"list",children:e.jsx(U,{columns:G,data:F,pagination:!0,highlightOnHover:!0})}),e.jsx(X,{open:l,onClose:()=>p(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:B,children:[e.jsx("h2",{children:"Add Salary"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(k,{sx:{width:"98%"},required:!0,size:"small",children:[e.jsx(q,{id:"department-label",children:"Department"}),e.jsxs(z,{labelId:"department-label",id:"department-select",value:d.department,name:"Department",label:"Department",onChange:a=>{h(a,"department"),I(a.target.value)},children:[e.jsx(w,{disabled:!0,value:"",children:"Select Department"},""),u==null?void 0:u.map(a=>e.jsx(w,{value:a.departmentid,children:a.departmentname},a.departmentid))]})]}),e.jsxs(k,{sx:{width:"98%"},required:!0,size:"small",children:[e.jsx(q,{id:"employee-label",children:"Employee"}),e.jsxs(z,{labelId:"employee-label",id:"employee-select",value:d.employeeId,name:"Employee",label:"Employee",onChange:a=>h(a,"employeeId"),children:[e.jsx(w,{disabled:!0,value:"",children:"Select Employee"},""),S==null?void 0:S.map(a=>e.jsx(w,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(N,{direction:"row",spacing:2,sx:{width:"98%"},children:[e.jsx(x,{sx:{width:"50%"},required:!0,value:d.basicSalary,type:"number",onChange:a=>h(a,"basicSalary"),label:"basicSalary",size:"small"}),e.jsx(x,{sx:{width:"50%"},required:!0,value:d.allowance,type:"number",onChange:a=>h(a,"allowance"),label:"allowance",size:"small"})]}),e.jsxs(N,{direction:"row",spacing:2,sx:{width:"98%"},children:[e.jsx(x,{sx:{width:"50%"},required:!0,value:d.deductions,type:"number",onChange:a=>h(a,"deductions"),label:"deductions",size:"small"}),e.jsx(x,{sx:{width:"50%"},required:!0,value:d.netSalary,label:"netSalary",size:"small"})]}),e.jsx(x,{sx:{width:"98%"},required:!0,value:d.payDate,onChange:a=>h(a,"payDate"),label:"payDate",size:"small"}),e.jsx(x,{multiline:!0,rows:4,onChange:a=>h(a,"description"),value:d.description,sx:{width:"98%"},label:"Description",size:"small"}),e.jsxs("div",{children:[!s&&e.jsx(b,{sx:{mr:2},loading:t,loadingPosition:"end",endIcon:e.jsx(A,{}),variant:"contained",type:"submit",children:"Add"}),s&&e.jsx(b,{sx:{mr:2},loading:t,loadingPosition:"end",endIcon:e.jsx(A,{}),variant:"contained",onClick:updatee,children:"Update"}),e.jsx(b,{size:"small",onClick:()=>{p(!1),g(!1),E(D)},variant:"outlined",children:" cancel"})]})]})]})})})]})};export{Y as default};
