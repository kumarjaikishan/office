import{h as v,j as e,aj as oe,ak as de,aM as ce,bk as me,a as ue,r as o,g as xe,c as F,y as m,A as pe,k as he,B as j,F as $,I as T,S as U,M as P,O as _,i as V,C as H,b as C,bl as ge,aa as be,ab as fe}from"./index-CcdprHkT.js";import{b as je,u as ve}from"./attandencehelper-C5i45-b4.js";import{L as we}from"./loader-daLodSO5.js";import"./index-yKSfn35U.js";const ye=(u,x,b,A)=>[{name:"S.No",selector:(a,f)=>f+1,width:"50px"},{name:"Date",selector:a=>v(a.date).format("DD MMM, YYYY"),sortable:!0,width:"110px"},{name:"Particular",selector:a=>a.particular},{name:"Debit",selector:a=>parseFloat(a.debit)===0?"":a.debit,width:"90px"},{name:"Credit",selector:a=>parseFloat(a.credit)===0?"":a.credit,width:"90px"},{name:"Balance",selector:a=>a.balance,width:"90px"},{name:"Actions",cell:a=>a.source==="advance"?e.jsx("span",{className:"text-blue-600 text-sm cursor-pointer underline",onClick:()=>{const f=b.find(p=>(p==null?void 0:p.ledgerId)===a.ledgerId);f&&A(`/dashboard/advance?employeeId=${f._id}`,{replace:!0})},children:"View Advance"}):a.source==="salary"?"From salary":e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"edit text-[18px] text-blue-500 cursor-pointer mr-2",title:"Edit Entry",onClick:()=>u(a)}),e.jsx(de,{className:"delete text-[18px] text-red-500 cursor-pointer",title:"Delete Entry",onClick:()=>x(a._id)})]}),width:"120px"}],R=({label:u,value:x})=>{const b=parseFloat(x)<0;return e.jsxs("div",{className:"bg-teal-50 border border-teal-300 border-dashed rounded-md px-4 py-2 min-w-[150px] text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:u}),e.jsx("hr",{className:"my-2 border-teal-200"}),e.jsxs("p",{className:`text-lg font-semibold ${b?"text-red-600":"text-black"}`,children:[x," â‚¹"]})]})},Ee=()=>{const{id:u}=ce(),[x]=me(),b=ue(),[A,a]=o.useState(!1),{employee:f}=xe(t=>t.user),p=x.get("name"),W=decodeURIComponent(x.get("profileimage")),[N,X]=o.useState([]),[S,q]=o.useState([]),[D,z]=o.useState("all"),[M,B]=o.useState("all"),[E,O]=o.useState(""),[G,J]=o.useState(0),[K,Q]=o.useState(0),[Z,ee]=o.useState(0),Y={date:v().format("YYYY-MM-DD"),particular:"",debit:"",credit:""},[n,h]=o.useState(Y),[te,w]=o.useState(!1),[k,y]=o.useState(null),I={Authorization:`Bearer ${localStorage.getItem("emstoken")}`};o.useEffect(()=>{L()},[u]),o.useEffect(()=>{if(!N)return;const t=N.filter(s=>{const i=v(s.date),r=D!=="all"?i.year()===Number(D):!0,g=M!=="all"?i.month()+1===Number(M):!0,ie=E?i.isSame(E,"day"):!0;return r&&g&&ie});q(t);const l=t.reduce((s,i)=>s+(i.debit||0),0),d=t.reduce((s,i)=>s+(i.credit||0),0),c=l-d;J(l),Q(d),ee(c)},[N,D,M,E]);const L=async()=>{var t;a(!0);try{const l=await F.get(`/api/entries/${u}`,{headers:I});X((t=l.data)==null?void 0:t.entries)}catch(l){console.log(l),m.error(l.response.data.message)}finally{a(!1)}},ae=()=>{z("all"),B("all"),O("")},se=async t=>{swal({title:"Are you sure to Delete this entry?",text:"Once deleted, you will not be able to recover this",icon:"warning",buttons:!0,dangerMode:!0}).then(async l=>{var d,c;if(l)try{let s=await F.delete(`/api/ledgerentry/${t}`,{headers:I});m.success(s.data.message),L()}catch(s){console.log(s),m.warning(((c=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:c.message)||(s==null?void 0:s.message)||"Error deleting entry")}})},le=()=>{const t=["S.No","Date","Particular","Debit","Credit","Balance"],l=S.map((r,g)=>[g+1,v(r.date).format("YYYY-MM-DD"),r.particular,r.debit,r.credit,r.balance]),d=[t,...l].map(r=>r.join(",")).join(`
`),c=new Blob([d],{type:"text/csv"}),s=URL.createObjectURL(c),i=document.createElement("a");i.href=s,i.download=`${p}_ledger.csv`,i.click(),URL.revokeObjectURL(s)},re=async()=>{var s,i;if(!n.particular||n.particular.trim()===""){m.warn("Particular field can't be blank");return}const t=(s=n.debit)==null?void 0:s.toString().trim(),l=(i=n.credit)==null?void 0:i.toString().trim();if(t===""&&l===""){m.warn("At least one value needed: Debit or Credit");return}const d=parseFloat(t||0),c=parseFloat(l||0);if(d&&c){m.warn("Only one of Debit or Credit is allowed");return}try{const r={...n,date:new Date(n.date),ledgerId:u,debit:d||0,credit:c||0};let g;k!==null?(g=await F.put(`/api/ledgerentry/${k}`,r,{headers:I}),y(null)):g=await F.post("/api/ledgerentry",r,{headers:I}),m.success(g.data.message),w(!1),h(Y),L()}catch(r){console.log(r),m.warning(r.response.data.message)}},ne=t=>{var d,c;const l=new Date(t.date).toISOString().split("T")[0];h({date:l,particular:t.particular,debit:((d=t.debit)==null?void 0:d.toString())||"",credit:((c=t.credit)==null?void 0:c.toString())||""}),y(t._id),w(!0)};return e.jsxs("div",{className:"bg-white rounded shadow-md p-1 md:p-5 relative max-w-6xl mx-auto ",children:[e.jsxs("div",{className:"border border-teal-600 border-dashed rounded-md p-3 md:p-5 mb-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-start md:items-center",children:[e.jsxs("div",{className:"flex items-start md:items-center  gap-3",children:[e.jsx(pe,{sx:{width:55,height:55},alt:p,src:he(W,{format:"webp",width:100,height:100})}),e.jsx("h2",{className:"text-2xl font-semibold text-teal-700 capitalize",children:p})]}),e.jsx(j,{className:" w-full md:w-auto",onClick:()=>b(-1),variant:"contained",children:"Ledger Page"})]}),A?e.jsx(we,{}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"Total Debit",value:G}),e.jsx(R,{label:"Total Credit",value:K}),e.jsx(R,{label:"Net Balance",value:Z.toFixed(2)})]})]}),e.jsxs("div",{className:"flex  flex-wrap items-center gap-3 mb-4",children:[e.jsxs("div",{className:"p-1 md:p-2 rounded shadow mb-4 md:mb-0 grid grid-cols-2 md:grid-cols-none md:flex gap-3 md:gap-2 mt-1 w-full  md:w-fit",children:[e.jsxs($,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx(T,{children:"Year"}),e.jsxs(U,{value:D,input:e.jsx(_,{startAdornment:e.jsx(V,{position:"start",children:e.jsx(H,{fontSize:"small"})}),label:"Year"}),onChange:t=>z(t.target.value),children:[e.jsx(P,{value:"all",children:"All"}),[...new Set(N.map(t=>v(t.date).year()))].map(t=>e.jsx(P,{value:t,children:t},t))]})]}),e.jsxs($,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx(T,{children:"Month"}),e.jsxs(U,{value:M,input:e.jsx(_,{startAdornment:e.jsx(V,{position:"start",children:e.jsx(H,{fontSize:"small"})}),label:"Month"}),onChange:t=>B(t.target.value),children:[e.jsx(P,{value:"all",children:"All"}),Array.from({length:12},(t,l)=>e.jsx(P,{value:l+1,children:v().month(l).format("MMMM")},l))]})]}),e.jsx(C,{size:"small",type:"date",className:"col-span-1  md:w-[160px]",value:E,onChange:t=>O(t.target.value),label:"Date",InputLabelProps:{shrink:!0}}),e.jsx(j,{className:"col-span-1  md:w-[120px]",variant:"outlined",color:"secondary",title:"Reset",startIcon:e.jsx(ge,{}),onClick:ae,children:"Reset"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 ml-auto",children:[e.jsx(j,{variant:"contained",onClick:()=>{w(!0),y(null)},children:"Add Entry"}),e.jsx(j,{variant:"outlined",onClick:le,startIcon:e.jsx(je,{}),children:"Export CSV"})]})]}),e.jsx("div",{className:" overflow-x-auto",children:e.jsx(be,{columns:ye(ne,se,f,b),data:S||[],pagination:!0,customStyles:ve(),highlightOnHover:!0,noDataComponent:"No entries found",paginationPerPage:10,paginationRowsPerPageOptions:[10,25,50,100,S.length>100?S.length:null].filter(Boolean),paginationComponentOptions:{rowsPerPageText:"Rows per page:"}})}),e.jsx(fe,{open:te,onClose:()=>{w(!1),y(null)},children:e.jsx("div",{className:"membermodal w-[310px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:k!==null?"Edit Entry":"Add Entry"}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"flex  w-full flex-col gap-3",children:[e.jsx(C,{fullWidth:!0,type:"date",label:"Date",size:"small",InputLabelProps:{shrink:!0},value:n.date||"",onChange:t=>h({...n,date:t.target.value})}),e.jsx(C,{multiline:!0,minRows:2,label:"Particular",size:"small",value:n.particular||"",onChange:t=>h({...n,particular:t.target.value})}),e.jsx(C,{type:"number",label:"Debit",size:"small",value:n.debit||"",onChange:t=>h({...n,debit:t.target.value,credit:""})}),e.jsx(C,{type:"number",label:"Credit",size:"small",value:n.credit||"",onChange:t=>h({...n,credit:t.target.value,debit:""})})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(j,{variant:"outlined",onClick:()=>{w(!1),h(Y),y(null)},children:"Cancel"}),e.jsx(j,{variant:"contained",onClick:re,children:k!==null?"Update":"Add"})]})]})})})]})};export{Ee as default};
