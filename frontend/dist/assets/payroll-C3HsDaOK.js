import{j as e,h as T,A as $,k as F,V as D,T as O,B as y,aO as _,r as p,a as L,g as Y,c as B,y as j,b as R,i as E,Z as V,F as q,I as U,S as H,M as A,O as X,C as Z,a0 as G}from"./index-DBKpBzGg.js";import{u as J}from"./attandencehelper-Cwq7A8Tb.js";import{c as K,d as Q,e as W,a as ee}from"./index-DIU8Fm62.js";import{S as ae}from"./Stack-DjTDhvke.js";import"./index-BVG7apjh.js";import"./index-ZEQGb_Gi.js";import"./useThemeProps-C5zzq0EP.js";const se=(v,b,d)=>[{name:"S.no",selector:(a,i)=>i+1,width:"60px"},{name:"Employee",selector:a=>{var i,f,c,m,u,r,h;return e.jsxs("div",{className:"flex items-center capitalize gap-3 ",children:[e.jsx($,{src:F((i=a==null?void 0:a.employeeId)==null?void 0:i.profileimage,{format:"webp",width:100,height:100})||employepic,alt:(c=(f=a==null?void 0:a.employeeId)==null?void 0:f.userid)==null?void 0:c.name,children:!((m=a==null?void 0:a.employeeId)!=null&&m.profileimage)&&employepic}),e.jsxs(D,{children:[e.jsx(O,{variant:"body2",children:(r=(u=a==null?void 0:a.employeeId)==null?void 0:u.userid)==null?void 0:r.name}),e.jsxs("p",{className:"t text-[10px] text-gray-600",children:["(",(h=a==null?void 0:a.employeeId)==null?void 0:h.designation,")"]})]})]})},sortable:!0},{name:"Month",selector:a=>T(`${a.year}-${a.month}-01`).format("MM-YYYY")},{name:"Department",selector:a=>a.department,width:"120px"},{name:"Status",selector:a=>a.status,width:"120px"},{name:"Actions",cell:a=>e.jsxs(ae,{direction:"row",spacing:1,children:[e.jsx(y,{size:"small",variant:"outlined",startIcon:e.jsx(K,{}),onClick:()=>v(a),children:"View"}),e.jsx(y,{size:"small",variant:"outlined",color:"primary",startIcon:e.jsx(Q,{}),onClick:()=>b(a),children:"Edit"}),e.jsx(y,{size:"small",variant:"outlined",color:"error",startIcon:e.jsx(W,{}),onClick:()=>d(a._id),children:"Delete"})]}),width:"300px"}];function pe(){const{employeeId:v}=_(),[b,d]=p.useState(!0),[a,i]=p.useState(null),[f,c]=p.useState(null);let m=L();const u=J(),[r,h]=p.useState({searchText:"",branch:"all",department:"all"}),{employee:P,leaveBalance:te,branch:g,department:le}=Y(s=>s.user);p.useEffect(()=>{I()},[]);const I=async()=>{var s,o,n;try{d(!0),c(null);const t=localStorage.getItem("emstoken"),l=await B.get("/api/payroll",{headers:{Authorization:`Bearer ${t}`}});i((s=l==null?void 0:l.data)==null?void 0:s.payrolls)}catch(t){console.log(t),t.response?(c(((n=(o=t.response)==null?void 0:o.data)==null?void 0:n.message)||"Failed to create payroll"),j.warn(t.response.data.message,{autoClose:1200})):t.request?console.error("No response from server:",t.request):console.error("Error:",t.message)}finally{d(!1)}},k=s=>{m(`/dashboard/payroll/print/${s._id}`)},w=s=>{m(`/dashboard/payroll/edit/${s._id}`)},S=(s,o)=>{h(n=>({...n,[s]:o}))},z=a==null?void 0:a.filter(s=>{var x,C,N;const o=((N=(C=(x=s.employeeId)==null?void 0:x.userid)==null?void 0:C.name)==null?void 0:N.toLowerCase())||"",n=s.branchId||"",t=r.searchText.trim()===""||o.includes(r.searchText.toLowerCase()),l=r.branch==="all"||n===r.branch;return t&&l}),M=async s=>{swal({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async o=>{var n,t;if(o)try{d(!0),c(null);const l=localStorage.getItem("emstoken"),x=await B.delete(`/api/payroll/${s}`,{headers:{Authorization:`Bearer ${l}`}});j.success(x.data.message||"Successfull deleted"),I()}catch(l){console.error(l),c(((t=(n=l.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to fetch payroll"),j.warn("Using dummy payroll data for testing",{autoClose:1500}),i(P)}finally{d(!1)}})};return a?e.jsxs("div",{className:"w-full mx-auto p-1 md:p-4",children:[e.jsxs("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[e.jsx(R,{size:"small",className:"w-[100%] md:w-[160px]",value:r.searchText,onChange:s=>S("searchText",s.target.value),InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(V,{})})},label:"Search Employee"}),e.jsxs(q,{size:"small",className:"w-[47%] md:w-[160px]",children:[e.jsx(U,{children:"Branch"}),e.jsxs(H,{label:"Branch",value:r.branch,input:e.jsx(X,{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Z,{fontSize:"small"})}),label:"Branch"}),onChange:s=>S("branch",s.target.value),children:[e.jsx(A,{value:"all",children:"All"}),g==null?void 0:g.map(s=>e.jsx(A,{value:s._id,children:s.name},s._id))]})]})]}),e.jsx("div",{className:"w-full md:w-fit",children:e.jsx(y,{size:"small",className:"w-full md:w-fit",onClick:()=>{m("/dashboard/payroll/add")},variant:"contained",children:" Add Payroll"})})]}),e.jsx("div",{children:e.jsx(G,{columns:se(k,w,M),data:z,pagination:!0,customStyles:u,highlightOnHover:!0,paginationPerPage:20,paginationRowsPerPageOptions:[20,50,100,300],noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(ee,{className:"text-xl"})," No Employee records found."]})})})]}):e.jsx("p",{className:"p-4 text-gray-500",children:"No payroll data found"})}export{pe as default};
