import{j as e,b as D,y as h,r as u,f as O,g as b,K as L,A as P,F as U}from"./index-BnPnHAWO.js";import{X}from"./index.es-D0Cu--to.js";import{A as q}from"./index-BtHQLl0c.js";import{M as H}from"./Modalbox-C6mxA1ov.js";import{I as K}from"./index-lZ454AWK.js";import{B as S}from"./Box-CXp9Rmoo.js";import{T as p}from"./TextField-DicE64Wz.js";import{F as G,I as J,S as Q}from"./Select-B4fkvyty.js";import{M as k}from"./MenuItem-BwsEWOD5.js";import{B as N}from"./Button-Bcz6Kzi9.js";import{u as V}from"./attandencehelper-DbcSdLjK.js";import{C as B}from"./CheckPermission-CHaiHNix.js";import{T as E}from"./Typography-BZIt85P4.js";import"./useSlotProps-BT0rsFT6.js";import"./createSimplePaletteValueFilter-CV2aCUyM.js";import"./ButtonBase-lQW-ETfK.js";const Z=({firstfetch:o,inp:a,openmodal:w,isload:x,handleChange:f,setopenmodal:j,setInp:g,init:i})=>{const y=async l=>{l.preventDefault();const d=localStorage.getItem("emstoken");try{const m=await D.post("/api/leavehandle",{...a},{headers:{Authorization:`Bearer ${d}`}});o(),j(!1),g(i),h.success(m.data.message,{autoClose:2e3})}catch(m){m.response&&h.warning(m.response.data.message,{autoClose:3e3}),console.error(m)}};return e.jsx(H,{open:w,onClose:()=>{j(!1),g(i)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:y,children:[e.jsx("h2",{children:"Leave Management"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsxs(S,{sx:{width:"100%",gap:2},children:[e.jsx(p,{fullWidth:!0,value:a.branch,label:"Branch",size:"small"}),e.jsx(p,{fullWidth:!0,value:a.employeename,label:"Name",size:"small"})]}),e.jsxs(S,{sx:{width:"100%",gap:2},children:[e.jsx(p,{fullWidth:!0,value:a.showfrom,label:"From",size:"small"}),e.jsx(p,{fullWidth:!0,value:a.showto,label:"To",size:"small"})]}),e.jsx(p,{fullWidth:!0,multiline:!0,minRows:2,value:a.reason,onChange:l=>f(l,"reason"),label:"Reason",size:"small"}),e.jsxs(G,{fullWidth:!0,required:!0,size:"small",children:[e.jsx(J,{children:"Status"}),e.jsxs(Q,{value:a.status,label:"Status",onChange:l=>f(l,"status"),children:[e.jsx(k,{value:"approved",children:"Approve"}),e.jsx(k,{value:"rejected",children:"Reject"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(N,{sx:{mr:2},loading:x,loadingPosition:"end",endIcon:e.jsx(K,{}),variant:"contained",type:"submit",children:"Update"}),e.jsx(N,{size:"small",onClick:()=>{j(!1),g(i)},variant:"outlined",children:"Cancel"})]})]})]})})})},je=()=>{const[o,a]=u.useState([]),[w,x]=u.useState(!1),[f,j]=u.useState(!1),{department:g,branch:i}=O(s=>s.user),y={leaveid:"",branch:"",employeename:"",from:"",showfrom:"",to:"",showto:"",reason:"",status:""},[l,d]=u.useState(y),m=B("leave",3),$=B("leave",4);u.useEffect(()=>{M()},[]);const F=(s,n)=>{d({...l,[n]:s.target.value})},M=async()=>{var n,c;const s=localStorage.getItem("emstoken");try{const r=await D.get("/api/fetchleave",{headers:{Authorization:`Bearer ${s}`}});let T=1;const _=await r.data.leave.map(t=>{var I,Y,v,C,A,z;return{id:t._id,sno:T++,name:e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx(P,{src:(I=t==null?void 0:t.employeeId)==null?void 0:I.profileimage,alt:(Y=t==null?void 0:t.employeeId)==null?void 0:Y.employeename,children:!((v=t.employeeId)!=null&&v.profileimage)&&e.jsx(U,{})}),e.jsxs(S,{children:[e.jsx(E,{variant:"body2",children:(C=t.employeeId)==null?void 0:C.employeename}),e.jsx(E,{variant:"body2",children:(z=(A=t.employeeId)==null?void 0:A.userid)==null?void 0:z.email})]})]}),from:b(t.fromDate).format("DD MMM, YYYY"),to:b(t.toDate).format("DD MMM, YYYY"),reason:t.reason,status:e.jsx("span",{className:`${t.status=="approved"?"bg-green-100 text-green-800":t.status=="rejected"?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800"} px-3 py-1 rounded capitalize`,children:t.status}),action:e.jsxs("div",{className:"flex gap-2",children:[m&&e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>W(t),children:e.jsx(L,{})}),$&&e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>R(t._id),children:e.jsx(q,{})})]})}});a(_)}catch(r){console.error(r),h.warning(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Error")}},R=async s=>{console.log(s),swal({title:"Are you sure you want to Delete this record?",icon:"warning",buttons:!0,dangerMode:!0}).then(async n=>{if(n){const c=localStorage.getItem("emstoken");try{const r=await D.delete(`/api/leavehandle/${s}`,{headers:{Authorization:`Bearer ${c}`}});M(),h.success(r.data.message,{autoClose:2e3})}catch(r){r.response&&h.warning(r.response.data.message,{autoClose:3e3}),console.error(r)}}})},W=s=>{var n,c;d({leaveid:s._id,branch:i==null?void 0:i.filter(r=>r._id==(s==null?void 0:s.branchId))[0].name,employeename:(c=(n=s==null?void 0:s.employeeId)==null?void 0:n.userid)==null?void 0:c.name,from:s.fromDate,to:s.toDate,showfrom:b(s.fromDate).format("DD MMM, YYYY"),showto:b(s.toDate).format("DD MMM, YYYY"),reason:s==null?void 0:s.reason,status:s==null?void 0:s.status}),x(!0)};return e.jsxs("div",{children:[e.jsx(X,{customStyles:V(),columns:ee,data:o,pagination:!0,highlightOnHover:!0}),e.jsx(Z,{firstfetch:M,handleChange:F,inp:l,isload:f,init:y,setInp:d,openmodal:w,setopenmodal:x})]})},ee=[{name:"S.no",selector:o=>o.sno,width:"60px"},{name:"Employee",selector:o=>o.name},{name:"from",selector:o=>o.from,width:"120px"},{name:"to",selector:o=>o.to,width:"120px"},{name:"Reason",selector:o=>o.reason},{name:"Status",selector:o=>o.status,width:"120px"},{name:"Action",selector:o=>o.action,width:"90px"}];export{ee as columns,je as default};
