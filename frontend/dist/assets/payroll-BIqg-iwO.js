import{aU as Y,r as u,a as V,u as H,g as X,c as A,b0 as q,y as m,j as a,b as K,i as $,a7 as Q,F as v,I,S as C,M as x,O as W,C as Z,aa as ee,A as ae,k as te,a3 as se,T as ne,B as f}from"./index-C57jq0m3.js";import{u as le}from"./attandencehelper-CvlcVrMu.js";import{a as re,c as k,d as oe,e as ie}from"./index-DN5nYlZf.js";import{C as j}from"./CheckPermission-CvyoeBNa.js";import"./index-CubVUzzM.js";function ge(){var E;const{employeeId:ce}=Y(),[de,y]=u.useState(!0),[i,S]=u.useState([]),[me,P]=u.useState(null),b=V(),w=le(),z=H(),[n,B]=u.useState({searchText:"",branch:"all",month:new Date().getMonth()+1,year:new Date().getFullYear()}),{employee:h,branch:c,profile:d}=X(e=>e.user);u.useEffect(()=>{N()},[]);const N=async()=>{var e,t,s,l;try{y(!0);const o=localStorage.getItem("emstoken"),r=await A.get("/api/payroll",{headers:{Authorization:`Bearer ${o}`}});S(((e=r==null?void 0:r.data)==null?void 0:e.payrolls)||[]),z(q(((t=r==null?void 0:r.data)==null?void 0:t.payrolls)||[]))}catch(o){console.error(o),m.warn(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch payroll",{autoClose:1200})}finally{y(!1)}},p=(e,t)=>{B(s=>({...s,[e]:t}))},M=h==null?void 0:h.filter(e=>{var r,g;const t=((g=(r=e.userid)==null?void 0:r.name)==null?void 0:g.toLowerCase())||"",s=e.branchId||"",l=n.searchText.trim()===""||t.includes(n.searchText.toLowerCase()),o=n.branch==="all"||s===n.branch;return l&&o}),_={};i==null||i.forEach(e=>{var s;const t=`${(s=e.employeeId)==null?void 0:s._id}-${e.month}-${e.year}`;_[t]=!0});const D=e=>{b("/dashboard/payroll/add",{state:{employeee:e,month:n.month,year:n.year}})},F=e=>{const t=i.find(s=>{var l;return((l=s.employeeId)==null?void 0:l._id)===e._id&&s.month===n.month&&s.year===n.year});if(!t)return m.info("Payroll not generated yet for this period");b(`/dashboard/payroll/print/${t._id}`)},T=e=>{const t=i.find(s=>{var l;return((l=s.employeeId)==null?void 0:l._id)===e._id&&s.month===n.month&&s.year===n.year});if(!t)return m.info("Payroll not generated yet for this period");b(`/dashboard/payroll/edit/${t._id}`)},G=async e=>{const t=i.find(s=>{var l;return((l=s.employeeId)==null?void 0:l._id)===e&&s.month===n.month&&s.year===n.year});if(!t)return m.info("No payroll to delete for this period");swal({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async s=>{var l,o;if(s)try{y(!0),P(null);const r=localStorage.getItem("emstoken"),g=await A.delete(`/api/payroll/${t._id}`,{headers:{Authorization:`Bearer ${r}`}});m.success(g.data.message||"Successfull deleted"),N()}catch(r){console.error(r),P(((o=(l=r.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to fetch payroll"),m.warn("Using dummy payroll data for testing",{autoClose:1500}),S(h)}finally{y(!1)}})},O=j("salary",2);j("salary",1);const L=j("salary",3),J=j("salary",4),R=["January","February","March","April","May","June","July","August","September","October","November","December"];if(!h)return a.jsx("p",{className:"p-4 text-gray-500",children:"No employee data found"});const U=[{name:"S.no",selector:(e,t)=>t+1,width:"60px"},{name:"Employee",selector:e=>{var t,s;return a.jsxs("div",{className:"flex items-center capitalize gap-3",children:[a.jsx(ae,{src:te(e==null?void 0:e.profileimage,{format:"webp",width:100,height:100}),alt:(t=e==null?void 0:e.userid)==null?void 0:t.name}),a.jsxs(se,{children:[a.jsx(ne,{variant:"body2",children:(s=e==null?void 0:e.userid)==null?void 0:s.name}),a.jsxs("p",{className:"text-[10px] text-gray-600",children:["(",(e==null?void 0:e.designation)||"-",")"]})]})]})},sortable:!0},{name:"Email",selector:e=>{var t;return(t=e.userid)==null?void 0:t.email},width:"180px"},{name:"Department",selector:e=>{var t;return((t=e.department)==null?void 0:t.department)||"-"},width:"120px"},{name:"Actions",width:"450px",cell:e=>{const t=`${e._id}-${n.month}-${n.year}`,s=_[t];return a.jsxs("div",{className:"flex gap-2",children:[O&&a.jsx(f,{size:"small",variant:"contained",startIcon:a.jsx(k,{}),disabled:s,title:s?"Already Generated":"Generate Payroll",onClick:()=>D(e),children:"Generate"}),a.jsx(f,{size:"small",disabled:!s,variant:"outlined",startIcon:a.jsx(k,{}),onClick:()=>F(e),children:"View"}),L&&a.jsx(f,{size:"small",disabled:!s,variant:"outlined",startIcon:a.jsx(oe,{}),onClick:()=>T(e),children:"Edit"}),J&&a.jsx(f,{size:"small",disabled:!s,color:"error",variant:"outlined",startIcon:a.jsx(ie,{}),onClick:()=>G(e._id),children:"Delete"})]})}}];return a.jsxs("div",{className:"w-full max-w-7xl  mx-auto p-1 md:p-4",children:[a.jsx("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:a.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[a.jsx(K,{size:"small",className:"w-[100%] md:w-[160px]",value:n.searchText,onChange:e=>p("searchText",e.target.value),InputProps:{startAdornment:a.jsx($,{position:"start",children:a.jsx(Q,{})})},label:"Search Employee"}),a.jsxs(v,{size:"small",className:"w-[47%] md:w-[160px]",children:[a.jsx(I,{children:"Branch"}),a.jsxs(C,{label:"Branch",value:n.branch,input:a.jsx(W,{startAdornment:a.jsx($,{position:"start",children:a.jsx(Z,{fontSize:"small"})}),label:"Branch"}),onChange:e=>p("branch",e.target.value),children:[a.jsx(x,{value:"all",children:"All"}),(d==null?void 0:d.role)==="manager"?(E=c==null?void 0:c.filter(e=>{var t;return(t=d==null?void 0:d.branchIds)==null?void 0:t.includes(e._id)}))==null?void 0:E.map(e=>a.jsx(x,{value:e._id,children:e.name},e._id)):c==null?void 0:c.map(e=>a.jsx(x,{value:e._id,children:e.name},e._id))]})]}),a.jsxs(v,{size:"small",children:[a.jsx(I,{children:"Month"}),a.jsx(C,{label:"Month",value:n.month,onChange:e=>p("month",e.target.value),children:R.map((e,t)=>a.jsx(x,{value:t+1,children:e},t))})]}),a.jsxs(v,{size:"small",children:[a.jsx(I,{children:"Year"}),a.jsx(C,{label:"Year",value:n.year,onChange:e=>p("year",e.target.value),children:["2024","2025","2026"].map(e=>a.jsx(x,{value:e,children:e},e))})]})]})}),a.jsx(ee,{columns:U,data:M,pagination:!0,customStyles:w,highlightOnHover:!0,paginationPerPage:20,paginationRowsPerPageOptions:[20,50,100,300],noDataComponent:a.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[a.jsx(re,{className:"text-xl"})," No Employee records found."]})})]})}export{ge as default};
