import{r as i,g as z,u as O,j as e,G as v,A as y,o as A,a2 as D,a3 as B,B as u,a1 as U,b as $,R as G,y as o,c as w,W,m as T}from"./index-DBKpBzGg.js";import{u as q}from"./imageresizer-D4I-KFLq.js";const S={1:"Read",2:"Write",3:"Update",4:"Delete"},J=()=>{const[k,H]=i.useState(!1),[c,C]=i.useState(!1),{profile:t}=z(a=>a.user),[s,h]=i.useState(null),[p,d]=i.useState(!1),{handleImage:E}=q(),P=O(),[L,m]=i.useState(!1),[j,g]=i.useState(""),[f,N]=i.useState(null),b=i.useRef(null);i.useEffect(()=>{t&&h(t)},[t]);const R=a=>{const n=a.target.files[0];if(!n)return;N(n);const l=URL.createObjectURL(n);h(r=>({...r,profileImage:l}))},F=async()=>{var n,l;let a;try{d(!0),a=o.loading("Please wait...");const r=localStorage.getItem("emstoken"),x=await w.get("/api/resetrequest",{headers:{Authorization:`Bearer ${r}`}});d(!1),W({title:x.data.extramessage,icon:"success"}),o.update(a,{render:x.data.message,type:"success",isLoading:!1,autoClose:2100})}catch(r){d(!1),o.update(a,{render:((l=(n=r.response)==null?void 0:n.data)==null?void 0:l.message)||r.message,type:"warn",isLoading:!1,autoClose:2200})}},I=async()=>{var a,n;try{d(!0);const l=localStorage.getItem("emstoken"),r=new FormData;if(r.append("name",j),f){const M=await E(200,f);r.append("profileImage",M)}const x=await w.post("/api/update-profile",r,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});o.success(x.data.message),P(T()),N(null),m(!1)}catch(l){o.error(((n=(a=l.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to update profile"),console.error(l)}finally{d(!1)}};return e.jsxs("div",{className:"p-0 md:p-4",children:[k?e.jsxs("div",{className:"w-full h-[300px] flex gap-5 flex-col justify-center items-center overflow-auto bg-white",children:[e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"animate-spin",style:{animationDuration:"2.5s"},size:50,color:"teal"}),e.jsx(v,{className:"absolute -bottom-4 left-0 animate-spin",style:{animationDuration:"3s"},size:20,color:"teal"})]}),e.jsx("p",{className:"text-teal-600",children:"loading..."})]}):e.jsxs("div",{className:"w-full mx-auto bg-white overflow-auto shadow rounded-lg p-1 py-2 md:p-4",children:[e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"relative",children:e.jsx(y,{sx:{width:72,height:72},alt:s==null?void 0:s.name,src:s==null?void 0:s.profileImage})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl capitalize font-bold text-gray-800 break-words",children:s==null?void 0:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s==null?void 0:s.role}),e.jsx("div",{className:"mt-3 space-y-1 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2 break-words",children:[e.jsx(A,{className:"text-gray-500"}),(s==null?void 0:s.email)||"N/A"]})})]})]}),(t==null?void 0:t.role)!=="superadmin"&&(t==null?void 0:t.role)!=="developer"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 md:py-2 rounded-md",onClick:()=>C(!c),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:c?"Hide Permissions":"View Permissions"}),c?e.jsx(D,{className:"text-xl"}):e.jsx(B,{className:"text-xl"})]}),c&&e.jsxs("div",{className:"text-sm mt-3 overflow-x-auto",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(S).map(a=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:a},a))]})}),e.jsx("tbody",{children:Object.entries((s==null?void 0:s.permissions)||{}).map(([a,n])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:a}),Object.keys(S).map(l=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:n.includes(Number(l))?"âœ…":"-"},l))]},a))})]})]})]}),(t==null?void 0:t.role)==="superadmin"&&e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(u,{onClick:()=>{g(s==null?void 0:s.name),m(!0)},disabled:p,title:"Send Password Reset Link",variant:"contained",className:"w-full md:w-fit",children:"Edit profile"}),e.jsx(u,{onClick:F,disabled:p,title:"Send Password Reset Link",variant:"outlined",className:"w-full md:w-fit",children:"Send Password Reset Link"})]})]}),e.jsx(U,{open:L,onClose:()=>{m(!1)},children:e.jsx("div",{className:"membermodal w-[300px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Edit Profile"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx($,{autoFocus:!0,size:"small",fullWidth:!0,margin:"dense",label:"Profile Name",value:j,onChange:a=>g(a.target.value)}),e.jsx("div",{className:" flex justify-center",children:e.jsxs("div",{className:"relative ",children:[e.jsx(y,{sx:{width:72,height:72},alt:s==null?void 0:s.name,src:s==null?void 0:s.profileImage}),e.jsx("input",{type:"file",ref:b,style:{display:"none"},onChange:R,accept:"image/*"}),e.jsx("span",{onClick:()=>b.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:e.jsx(G,{size:18})})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(u,{variant:"outlined",onClick:()=>m(!1),children:"Cancel"}),e.jsx(u,{variant:"contained",onClick:I,children:"Save Changes"})]})]})})})]})};export{J as default};
