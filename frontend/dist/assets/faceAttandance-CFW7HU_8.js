import{ar as Ee,aa as Me,r as n,ad as ke,a7 as q,j as o,ac as Z,as as qe,a9 as Fe,a$ as Ge,at as Pe,am as Je,aD as wt,b0 as Qe,b1 as Ze,aI as et,aF as Se,ae as St,ap as Ne,ag as te,b2 as yt,u as Ct,g as tt,h as xe,y as P,c as Re,m as jt,W as It,V as Bt}from"./index-C0uMPCF7.js";function Nt(t){return Me("MuiTab",t)}const W=Ee("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper","icon"]),Tt=t=>{const{classes:e,textColor:r,fullWidth:i,wrapped:d,icon:u,label:S,selected:j,disabled:g}=t,M={root:["root",u&&S&&"labelIcon",`textColor${qe(r)}`,i&&"fullWidth",d&&"wrapped",j&&"selected",g&&"disabled"],icon:["iconWrapper","icon"]};return Fe(M,Nt,e)},Rt=Z(Ge,{name:"MuiTab",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.label&&r.icon&&e.labelIcon,e[`textColor${qe(r.textColor)}`],r.fullWidth&&e.fullWidth,r.wrapped&&e.wrapped,{[`& .${W.iconWrapper}`]:e.iconWrapper},{[`& .${W.icon}`]:e.icon}]}})(Pe(({theme:t})=>({...t.typography.button,maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center",lineHeight:1.25,variants:[{props:({ownerState:e})=>e.label&&(e.iconPosition==="top"||e.iconPosition==="bottom"),style:{flexDirection:"column"}},{props:({ownerState:e})=>e.label&&e.iconPosition!=="top"&&e.iconPosition!=="bottom",style:{flexDirection:"row"}},{props:({ownerState:e})=>e.icon&&e.label,style:{minHeight:72,paddingTop:9,paddingBottom:9}},{props:({ownerState:e,iconPosition:r})=>e.icon&&e.label&&r==="top",style:{[`& > .${W.icon}`]:{marginBottom:6}}},{props:({ownerState:e,iconPosition:r})=>e.icon&&e.label&&r==="bottom",style:{[`& > .${W.icon}`]:{marginTop:6}}},{props:({ownerState:e,iconPosition:r})=>e.icon&&e.label&&r==="start",style:{[`& > .${W.icon}`]:{marginRight:t.spacing(1)}}},{props:({ownerState:e,iconPosition:r})=>e.icon&&e.label&&r==="end",style:{[`& > .${W.icon}`]:{marginLeft:t.spacing(1)}}},{props:{textColor:"inherit"},style:{color:"inherit",opacity:.6,[`&.${W.selected}`]:{opacity:1},[`&.${W.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}}},{props:{textColor:"primary"},style:{color:(t.vars||t).palette.text.secondary,[`&.${W.selected}`]:{color:(t.vars||t).palette.primary.main},[`&.${W.disabled}`]:{color:(t.vars||t).palette.text.disabled}}},{props:{textColor:"secondary"},style:{color:(t.vars||t).palette.text.secondary,[`&.${W.selected}`]:{color:(t.vars||t).palette.secondary.main},[`&.${W.disabled}`]:{color:(t.vars||t).palette.text.disabled}}},{props:({ownerState:e})=>e.fullWidth,style:{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"}},{props:({ownerState:e})=>e.wrapped,style:{fontSize:t.typography.pxToRem(12)}}]}))),Xe=n.forwardRef(function(e,r){const i=ke({props:e,name:"MuiTab"}),{className:d,disabled:u=!1,disableFocusRipple:S=!1,fullWidth:j,icon:g,iconPosition:M="top",indicator:N,label:b,onChange:y,onClick:k,onFocus:F,selected:T,selectionFollowsFocus:R,textColor:X="inherit",value:E,wrapped:O=!1,...$}=i,A={...i,disabled:u,disableFocusRipple:S,selected:T,icon:!!g,iconPosition:M,label:!!b,fullWidth:j,textColor:X,wrapped:O},U=Tt(A),c=g&&b&&n.isValidElement(g)?n.cloneElement(g,{className:q(U.icon,g.props.className)}):g,m=v=>{!T&&y&&y(v,E),k&&k(v)},w=v=>{R&&!T&&y&&y(v,E),F&&F(v)};return o.jsxs(Rt,{focusRipple:!S,className:q(U.root,d),ref:r,role:"tab","aria-selected":T,disabled:u,onClick:m,onFocus:w,ownerState:A,tabIndex:T?0:-1,...$,children:[M==="top"||M==="start"?o.jsxs(n.Fragment,{children:[c,b]}):o.jsxs(n.Fragment,{children:[b,c]}),N]})}),Et=Je(o.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})),Mt=Je(o.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}));function kt(t){return(1+Math.sin(Math.PI*t-Math.PI/2))/2}function Ft(t,e,r,i={},d=()=>{}){const{ease:u=kt,duration:S=300}=i;let j=null;const g=e[t];let M=!1;const N=()=>{M=!0},b=y=>{if(M){d(new Error("Animation cancelled"));return}j===null&&(j=y);const k=Math.min(1,(y-j)/S);if(e[t]=u(k)*(r-g)+g,k>=1){requestAnimationFrame(()=>{d(null)});return}requestAnimationFrame(b)};return g===r?(d(new Error("Element already at target position")),N):(requestAnimationFrame(b),N)}const Pt={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function Dt(t){const{onChange:e,...r}=t,i=n.useRef(),d=n.useRef(null),u=()=>{i.current=d.current.offsetHeight-d.current.clientHeight};return wt(()=>{const S=Qe(()=>{const g=i.current;u(),g!==i.current&&e(i.current)}),j=Ze(d.current);return j.addEventListener("resize",S),()=>{S.clear(),j.removeEventListener("resize",S)}},[e]),n.useEffect(()=>{u(),e(i.current)},[e]),o.jsx("div",{style:Pt,...r,ref:d})}function $t(t){return Me("MuiTabScrollButton",t)}const At=Ee("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),zt=t=>{const{classes:e,orientation:r,disabled:i}=t;return Fe({root:["root",r,i&&"disabled"]},$t,e)},Lt=Z(Ge,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.orientation&&e[r.orientation]]}})({width:40,flexShrink:0,opacity:.8,[`&.${At.disabled}`]:{opacity:0},variants:[{props:{orientation:"vertical"},style:{width:"100%",height:40,"& svg":{transform:"var(--TabScrollButton-svgRotate)"}}}]}),Wt=n.forwardRef(function(e,r){const i=ke({props:e,name:"MuiTabScrollButton"}),{className:d,slots:u={},slotProps:S={},direction:j,orientation:g,disabled:M,...N}=i,b=et(),y={isRtl:b,...i},k=zt(y),F=u.StartScrollButtonIcon??Et,T=u.EndScrollButtonIcon??Mt,R=Se({elementType:F,externalSlotProps:S.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:y}),X=Se({elementType:T,externalSlotProps:S.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:y});return o.jsx(Lt,{component:"div",className:q(k.root,d),ref:r,role:null,ownerState:y,tabIndex:null,...N,style:{...N.style,...g==="vertical"&&{"--TabScrollButton-svgRotate":`rotate(${b?-90:90}deg)`}},children:j==="left"?o.jsx(F,{...R}):o.jsx(T,{...X})})});function Ot(t){return Me("MuiTabs",t)}const Te=Ee("MuiTabs",["root","vertical","list","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),Ye=(t,e)=>t===e?t.firstChild:e&&e.nextElementSibling?e.nextElementSibling:t.firstChild,Ke=(t,e)=>t===e?t.lastChild:e&&e.previousElementSibling?e.previousElementSibling:t.lastChild,ve=(t,e,r)=>{let i=!1,d=r(t,e);for(;d;){if(d===t.firstChild){if(i)return;i=!0}const u=d.disabled||d.getAttribute("aria-disabled")==="true";if(!d.hasAttribute("tabindex")||u)d=r(t,d);else{d.focus();return}}},Ut=t=>{const{vertical:e,fixed:r,hideScrollbar:i,scrollableX:d,scrollableY:u,centered:S,scrollButtonsHideMobile:j,classes:g}=t;return Fe({root:["root",e&&"vertical"],scroller:["scroller",r&&"fixed",i&&"hideScrollbar",d&&"scrollableX",u&&"scrollableY"],list:["list","flexContainer",e&&"flexContainerVertical",e&&"vertical",S&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",j&&"scrollButtonsHideMobile"],scrollableX:[d&&"scrollableX"],hideScrollbar:[i&&"hideScrollbar"]},Ot,g)},Ht=Z("div",{name:"MuiTabs",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${Te.scrollButtons}`]:e.scrollButtons},{[`& .${Te.scrollButtons}`]:r.scrollButtonsHideMobile&&e.scrollButtonsHideMobile},e.root,r.vertical&&e.vertical]}})(Pe(({theme:t})=>({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex",variants:[{props:({ownerState:e})=>e.vertical,style:{flexDirection:"column"}},{props:({ownerState:e})=>e.scrollButtonsHideMobile,style:{[`& .${Te.scrollButtons}`]:{[t.breakpoints.down("sm")]:{display:"none"}}}}]}))),Xt=Z("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.scroller,r.fixed&&e.fixed,r.hideScrollbar&&e.hideScrollbar,r.scrollableX&&e.scrollableX,r.scrollableY&&e.scrollableY]}})({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap",variants:[{props:({ownerState:t})=>t.fixed,style:{overflowX:"hidden",width:"100%"}},{props:({ownerState:t})=>t.hideScrollbar,style:{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}},{props:({ownerState:t})=>t.scrollableX,style:{overflowX:"auto",overflowY:"hidden"}},{props:({ownerState:t})=>t.scrollableY,style:{overflowY:"auto",overflowX:"hidden"}}]}),Yt=Z("div",{name:"MuiTabs",slot:"List",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.list,e.flexContainer,r.vertical&&e.flexContainerVertical,r.centered&&e.centered]}})({display:"flex",variants:[{props:({ownerState:t})=>t.vertical,style:{flexDirection:"column"}},{props:({ownerState:t})=>t.centered,style:{justifyContent:"center"}}]}),Kt=Z("span",{name:"MuiTabs",slot:"Indicator"})(Pe(({theme:t})=>({position:"absolute",height:2,bottom:0,width:"100%",transition:t.transitions.create(),variants:[{props:{indicatorColor:"primary"},style:{backgroundColor:(t.vars||t).palette.primary.main}},{props:{indicatorColor:"secondary"},style:{backgroundColor:(t.vars||t).palette.secondary.main}},{props:({ownerState:e})=>e.vertical,style:{height:"100%",width:2,right:0}}]}))),Vt=Z(Dt)({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),Ve={},_t=n.forwardRef(function(e,r){const i=ke({props:e,name:"MuiTabs"}),d=St(),u=et(),{"aria-label":S,"aria-labelledby":j,action:g,centered:M=!1,children:N,className:b,component:y="div",allowScrollButtonsMobile:k=!1,indicatorColor:F="primary",onChange:T,orientation:R="horizontal",ScrollButtonComponent:X,scrollButtons:E="auto",selectionFollowsFocus:O,slots:$={},slotProps:A={},TabIndicatorProps:U={},TabScrollButtonProps:c={},textColor:m="primary",value:w,variant:v="standard",visibleScrollbar:I=!1,...ye}=i,z=v==="scrollable",L=R==="vertical",_=L?"scrollTop":"scrollLeft",oe=L?"top":"left",l=L?"bottom":"right",x=L?"clientHeight":"clientWidth",h=L?"height":"width",B={...i,component:y,allowScrollButtonsMobile:k,indicatorColor:F,orientation:R,vertical:L,scrollButtons:E,textColor:m,variant:v,visibleScrollbar:I,fixed:!z,hideScrollbar:z&&!I,scrollableX:z&&!L,scrollableY:z&&L,centered:M&&!z,scrollButtonsHideMobile:!k},D=Ut(B),Y=Se({elementType:$.StartScrollButtonIcon,externalSlotProps:A.startScrollButtonIcon,ownerState:B}),re=Se({elementType:$.EndScrollButtonIcon,externalSlotProps:A.endScrollButtonIcon,ownerState:B}),[se,Ce]=n.useState(!1),[K,ue]=n.useState(Ve),[G,pe]=n.useState(!1),[ne,ae]=n.useState(!1),[le,ce]=n.useState(!1),[fe,rt]=n.useState({overflow:"hidden",scrollbarWidth:0}),De=new Map,V=n.useRef(null),J=n.useRef(null),ee={slots:$,slotProps:{indicator:U,scrollButton:c,...A}},$e=()=>{const s=V.current;let a;if(s){const f=s.getBoundingClientRect();a={clientWidth:s.clientWidth,scrollLeft:s.scrollLeft,scrollTop:s.scrollTop,scrollWidth:s.scrollWidth,top:f.top,bottom:f.bottom,left:f.left,right:f.right}}let p;if(s&&w!==!1){const f=J.current.children;if(f.length>0){const C=f[De.get(w)];p=C?C.getBoundingClientRect():null}}return{tabsMeta:a,tabMeta:p}},ie=Ne(()=>{const{tabsMeta:s,tabMeta:a}=$e();let p=0,f;L?(f="top",a&&s&&(p=a.top-s.top+s.scrollTop)):(f=u?"right":"left",a&&s&&(p=(u?-1:1)*(a[f]-s[f]+s.scrollLeft)));const C={[f]:p,[h]:a?a[h]:0};if(typeof K[f]!="number"||typeof K[h]!="number")ue(C);else{const H=Math.abs(K[f]-C[f]),Q=Math.abs(K[h]-C[h]);(H>=1||Q>=1)&&ue(C)}}),je=(s,{animation:a=!0}={})=>{a?Ft(_,V.current,s,{duration:d.transitions.duration.standard}):V.current[_]=s},Ae=s=>{let a=V.current[_];L?a+=s:a+=s*(u?-1:1),je(a)},ze=()=>{const s=V.current[x];let a=0;const p=Array.from(J.current.children);for(let f=0;f<p.length;f+=1){const C=p[f];if(a+C[x]>s){f===0&&(a=s);break}a+=C[x]}return a},st=()=>{Ae(-1*ze())},nt=()=>{Ae(ze())},[at,{onChange:me,...lt}]=te("scrollbar",{className:q(D.scrollableX,D.hideScrollbar),elementType:Vt,shouldForwardComponentProp:!0,externalForwardedProps:ee,ownerState:B}),ct=n.useCallback(s=>{me==null||me(s),rt({overflow:null,scrollbarWidth:s})},[me]),[Le,We]=te("scrollButtons",{className:q(D.scrollButtons,c.className),elementType:Wt,externalForwardedProps:ee,ownerState:B,additionalProps:{orientation:R,slots:{StartScrollButtonIcon:$.startScrollButtonIcon||$.StartScrollButtonIcon,EndScrollButtonIcon:$.endScrollButtonIcon||$.EndScrollButtonIcon},slotProps:{startScrollButtonIcon:Y,endScrollButtonIcon:re}}}),it=()=>{const s={};s.scrollbarSizeListener=z?o.jsx(at,{...lt,onChange:ct}):null;const p=z&&(E==="auto"&&(G||ne)||E===!0);return s.scrollButtonStart=p?o.jsx(Le,{direction:u?"right":"left",onClick:st,disabled:!G,...We}):null,s.scrollButtonEnd=p?o.jsx(Le,{direction:u?"left":"right",onClick:nt,disabled:!ne,...We}):null,s},Oe=Ne(s=>{const{tabsMeta:a,tabMeta:p}=$e();if(!(!p||!a)){if(p[oe]<a[oe]){const f=a[_]+(p[oe]-a[oe]);je(f,{animation:s})}else if(p[l]>a[l]){const f=a[_]+(p[l]-a[l]);je(f,{animation:s})}}}),he=Ne(()=>{z&&E!==!1&&ce(!le)});n.useEffect(()=>{const s=Qe(()=>{V.current&&ie()});let a;const p=H=>{H.forEach(Q=>{Q.removedNodes.forEach(de=>{a==null||a.unobserve(de)}),Q.addedNodes.forEach(de=>{a==null||a.observe(de)})}),s(),he()},f=Ze(V.current);f.addEventListener("resize",s);let C;return typeof ResizeObserver<"u"&&(a=new ResizeObserver(s),Array.from(J.current.children).forEach(H=>{a.observe(H)})),typeof MutationObserver<"u"&&(C=new MutationObserver(p),C.observe(J.current,{childList:!0})),()=>{s.clear(),f.removeEventListener("resize",s),C==null||C.disconnect(),a==null||a.disconnect()}},[ie,he]),n.useEffect(()=>{const s=Array.from(J.current.children),a=s.length;if(typeof IntersectionObserver<"u"&&a>0&&z&&E!==!1){const p=s[0],f=s[a-1],C={root:V.current,threshold:.99},H=Be=>{pe(!Be[0].isIntersecting)},Q=new IntersectionObserver(H,C);Q.observe(p);const de=Be=>{ae(!Be[0].isIntersecting)},He=new IntersectionObserver(de,C);return He.observe(f),()=>{Q.disconnect(),He.disconnect()}}},[z,E,le,N==null?void 0:N.length]),n.useEffect(()=>{Ce(!0)},[]),n.useEffect(()=>{ie()}),n.useEffect(()=>{Oe(Ve!==K)},[Oe,K]),n.useImperativeHandle(g,()=>({updateIndicator:ie,updateScrollButtons:he}),[ie,he]);const[dt,ut]=te("indicator",{className:q(D.indicator,U.className),elementType:Kt,externalForwardedProps:ee,ownerState:B,additionalProps:{style:K}}),Ue=o.jsx(dt,{...ut});let be=0;const pt=n.Children.map(N,s=>{if(!n.isValidElement(s))return null;const a=s.props.value===void 0?be:s.props.value;De.set(a,be);const p=a===w;return be+=1,n.cloneElement(s,{fullWidth:v==="fullWidth",indicator:p&&!se&&Ue,selected:p,selectionFollowsFocus:O,onChange:T,textColor:m,value:a,...be===1&&w===!1&&!s.props.tabIndex?{tabIndex:0}:{}})}),ft=s=>{if(s.altKey||s.shiftKey||s.ctrlKey||s.metaKey)return;const a=J.current,p=yt(a).activeElement;if(p.getAttribute("role")!=="tab")return;let C=R==="horizontal"?"ArrowLeft":"ArrowUp",H=R==="horizontal"?"ArrowRight":"ArrowDown";switch(R==="horizontal"&&u&&(C="ArrowRight",H="ArrowLeft"),s.key){case C:s.preventDefault(),ve(a,p,Ke);break;case H:s.preventDefault(),ve(a,p,Ye);break;case"Home":s.preventDefault(),ve(a,null,Ye);break;case"End":s.preventDefault(),ve(a,null,Ke);break}},Ie=it(),[mt,ht]=te("root",{ref:r,className:q(D.root,b),elementType:Ht,externalForwardedProps:{...ee,...ye,component:y},ownerState:B}),[bt,xt]=te("scroller",{ref:V,className:D.scroller,elementType:Xt,externalForwardedProps:ee,ownerState:B,additionalProps:{style:{overflow:fe.overflow,[L?`margin${u?"Left":"Right"}`:"marginBottom"]:I?void 0:-fe.scrollbarWidth}}}),[vt,gt]=te("list",{ref:J,className:q(D.list,D.flexContainer),elementType:Yt,externalForwardedProps:ee,ownerState:B,getSlotProps:s=>({...s,onKeyDown:a=>{var p;ft(a),(p=s.onKeyDown)==null||p.call(s,a)}})});return o.jsxs(mt,{...ht,children:[Ie.scrollButtonStart,Ie.scrollbarSizeListener,o.jsxs(bt,{...xt,children:[o.jsx(vt,{"aria-label":S,"aria-labelledby":j,"aria-orientation":R==="vertical"?"vertical":null,role:"tablist",...gt,children:pt}),se&&Ue]}),Ie.scrollButtonEnd]})});let _e=!1;const ot=async()=>{window.faceapi||await qt(),_e||(await Gt(),_e=!0)},qt=()=>new Promise((t,e)=>{if(document.querySelector('script[src*="face-api.js"]'))return t();const i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js",i.async=!0,i.onload=t,i.onerror=e,document.body.appendChild(i)}),Gt=async()=>{await Promise.all([window.faceapi.nets.tinyFaceDetector.loadFromUri("/models"),window.faceapi.nets.faceLandmark68Net.loadFromUri("/models"),window.faceapi.nets.faceRecognitionNet.loadFromUri("/models")])},ge={width:350,height:350},Jt=()=>{const t=n.useRef(null),e=n.useRef(null),r=n.useRef(null),i=n.useRef(!1),d=n.useRef(null),u=n.useRef(null),S=Ct(),[j,g]=n.useState(null),[M,N]=n.useState(!1),[b,y]=n.useState(null),[k,F]=n.useState([]),[T,R]=n.useState(null),[X,E]=n.useState(!1),{employee:O}=tt(l=>l.user),$=n.useRef([]),A=n.useRef(null),U=n.useRef({});n.useRef(!1);const c=l=>(l==null?void 0:l.includes("webcam"))||(l==null?void 0:l.includes("front"));n.useEffect(()=>{const l=localStorage.getItem("selectedCameraId"),x=localStorage.getItem("mirror");l&&R(l),x!==null&&E(x==="true")},[]),n.useEffect(()=>{var h;if(!T||!k.length)return;const l=(h=k.find(B=>B.deviceId===T))==null?void 0:h.label.toLowerCase(),x=c(l);E(x),localStorage.setItem("mirror",x)},[T,k]),n.useEffect(()=>((async()=>{try{await ot(),m()}catch(x){P.error("Failed to load face-api models."),console.error(x)}})(),()=>I()),[]);const m=()=>{const l={},x=O==null?void 0:O.filter(h=>{var B;return((B=h.faceDescriptor)==null?void 0:B.length)===128}).map(h=>(l[h.userid.name]=h._id,new window.faceapi.LabeledFaceDescriptors(h.userid.name,[new Float32Array(h.faceDescriptor)])));$.current=x,U.current=l,A.current=x.length?new window.faceapi.FaceMatcher(x,.6):null,A.current||P.warn("No face data available for comparison. Please enroll first.")},w=async()=>{try{return(await navigator.permissions.query({name:"camera"})).state!=="denied"}catch{return!0}},v=async()=>{var l;N(!0);try{const h=(await navigator.mediaDevices.enumerateDevices()).filter(Y=>Y.kind==="videoinput");F(h);const B=T||((l=h[0])==null?void 0:l.deviceId),D=await navigator.mediaDevices.getUserMedia({video:{deviceId:B?{exact:B}:void 0,...ge}});t.current&&(t.current.srcObject=D,t.current.onloadedmetadata=()=>ye())}catch{P.error("Unable to access the camera. Check permissions."),N(!1)}},I=()=>{var x;clearInterval(d.current);const l=(x=t.current)==null?void 0:x.srcObject;l==null||l.getTracks().forEach(h=>h.stop()),t.current&&(t.current.srcObject=null),N(!1),i.current=!1},ye=()=>{d.current=setInterval(()=>L(),600)},z=l=>{if(!l)return;const x=new SpeechSynthesisUtterance(l);x.lang="en-US",x.rate=1,x.pitch=1,window.speechSynthesis.speak(x)},L=async()=>{var l,x;if(!(i.current||!t.current)){i.current=!0;try{const h=await window.faceapi.detectSingleFace(t.current,new window.faceapi.TinyFaceDetectorOptions({inputSize:320,scoreThreshold:.7})).withFaceLandmarks().withFaceDescriptor();if(!h){i.current=!1;return}if(!A.current){P.warn("Matcher not initialized. Try again later."),i.current=!1;return}const B=A.current.findBestMatch(h.descriptor);if(B.label==="unknown"){P.error("Face not recognized"),i.current=!1;return}const D=U.current[B.label],Y=O.find(ce=>ce._id===D);if(!D||!Y){P.error("Employee not found"),i.current=!1;return}const re=window.faceapi.createCanvasFromMedia(t.current),se={width:ge.width,height:ge.height},Ce=window.faceapi.resizeResults(h,se);e.current&&(e.current.innerHTML="",e.current.appendChild(re),window.faceapi.matchDimensions(re,se),window.faceapi.draw.drawDetections(re,Ce));const K=localStorage.getItem("emstoken"),ue=`/api/${u.current==="punch-in"?"facecheckin":"facecheckout"}`,G=await Re.post(ue,{employeeId:D},{headers:{Authorization:`Bearer ${K}`}}),{punchIn:pe,punchOut:ne,workingMinutes:ae}=G.data.attendance;let le=null;if(ae){const ce=Math.floor(ae/60),fe=ae%60;le=`${ce}h ${fe}m`}y({name:Y.userid.name,profile:Y.profileimage,designation:Y.designation,department:Y.department.department,punchIn:pe?xe(pe).format("hh:mm A"):"-- : --",punchOut:ne?xe(ne).format("hh:mm A"):"-- : --",workinghour:le??"-- : --"}),G.status===206?(z(`you have already ${u.current}`),P.warn(G.data.message||`Successfully punched ${u.current}`,{autoClose:2100})):(S(jt()),z(`Thank You for ${u.current}`),P.success(G.data.message||`Successfully punched ${u.current}`)),I()}catch(h){console.error(h),P.warn(((x=(l=h==null?void 0:h.response)==null?void 0:l.data)==null?void 0:x.message)||"Error during recognition"),I()}finally{i.current=!1}}},_=async l=>{clearTimeout(r.current),y(null),g(l),u.current=l,await w()?v():P.warn("Camera permission is required for face recognition.")};return o.jsxs("div",{className:"p-2 md:p-6",children:[o.jsx("h2",{className:"text-xl font-bold mb-2",children:"Face Attendance"}),o.jsxs("div",{className:"flex items-center justify-center flex-col p-0",children:[o.jsxs("div",{className:"flex w-full gap-4 mb-2",children:[o.jsx("button",{onClick:()=>_("punch-in"),className:"bg-blue-500 w-xl text-white px-4 py-2 rounded",children:"Punch In"}),o.jsx("button",{onClick:()=>_("punch-out"),className:"bg-red-500 w-xl text-white px-4 py-2 rounded",children:"Punch Out"})]}),k.length>0&&o.jsxs("div",{className:"mb-2",children:[o.jsx("label",{className:"block text-sm font-semibold",children:"Select Camera:"}),o.jsx("select",{value:T||"",onChange:l=>{localStorage.setItem("selectedCameraId",l.target.value),R(l.target.value)},className:"border rounded px-2 py-1",children:k.map(l=>o.jsx("option",{value:l.deviceId,children:l.label||`Camera ${l.deviceId}`},l.deviceId))}),o.jsx("button",{onClick:()=>E(!X),className:"bg-teal-600 ml-2 text-white px-4 py-1 rounded mt-2",children:"Mirror"})]}),b&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex flex-col md:flex-row items-center bg-white shadow-lg rounded-2xl p-4 w-full md:w-[450px] gap-6",children:[o.jsx("img",{src:b.profile||"https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",alt:"Profile",className:"w-38 h-38 rounded-full object-cover border-2 border-teal-500 border-dashed p-1"}),o.jsxs("div",{className:"text-sm w-full space-y-1",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-semibold text-gray-600",children:"Name"}),o.jsx("span",{children:b.name})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-semibold text-gray-600",children:"Designation"}),o.jsx("span",{children:b.designation})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-semibold text-gray-600",children:"Department"}),o.jsx("span",{children:b.department})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-semibold text-gray-600",children:"Punch In"}),o.jsx("span",{children:b.punchIn})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-semibold text-gray-600",children:"Punch Out"}),o.jsx("span",{children:b.punchOut})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-semibold text-gray-600",children:"Working Hour"}),o.jsx("span",{children:b.workinghour})]})]})]}),o.jsx("div",{className:"text-center font-semibold text-gray-700 mb-2",children:b.punchIn&&b.punchOut==="-- : --"?o.jsxs("div",{className:"text-[14px]",children:[o.jsxs("p",{children:["👋 Good ",xe().hour()<12?"Morning":xe().hour()<17?"Afternoon":"Evening",", ",b.name,"!"]}),"  ",o.jsx("p",{children:" You have punched in successfully."})]}):o.jsxs("p",{children:["✅ Great job today, ",b.name,"! You’ve successfully punched out."]})})]}),M&&o.jsxs("div",{className:"relative text-center",children:[o.jsx("video",{ref:t,autoPlay:!0,muted:!0,...ge,className:`rounded-full border-2 border-teal-500 border-dashed p-1 my-4 ${X?"-scale-x-100":""}`}),o.jsx("div",{ref:e,className:"absolute top-0 left-0"}),o.jsxs("div",{className:"flex gap-2 justify-center",children:[o.jsx("button",{className:"bg-teal-600 text-white px-4 py-1 rounded mt-2",children:"Scanning ..."}),o.jsx("button",{onClick:I,className:"bg-gray-600 text-white px-4 py-1 rounded mt-2",children:"Cancel"})]})]})]})]})},we={width:350,height:350},Qt=()=>{var U;const t=n.useRef(null),e=n.useRef(null),[r,i]=n.useState(null),[d,u]=n.useState(null),[S,j]=n.useState(!1),[g,M]=n.useState(!1),[N,b]=n.useState(!1),[y,k]=n.useState([]),[F,T]=n.useState(localStorage.getItem("lastUsedCameraId")||null),{employee:R}=tt(c=>c.user);n.useEffect(()=>((async()=>{try{await ot()}catch(m){console.error("Failed to load face-api.js or models",m),P.error("Face recognition models failed to load")}})(),E),[]),n.useEffect(()=>{F&&localStorage.setItem("lastUsedCameraId",F)},[F]),n.useEffect(()=>{var m;if(!F||!S)return;const c=(m=y.find(w=>w.deviceId===F))==null?void 0:m.label.toLowerCase();b((c==null?void 0:c.includes("webcam"))||(c==null?void 0:c.includes("front")))},[F,y]);const X=async()=>{j(!0);try{const m=(await navigator.mediaDevices.enumerateDevices()).filter(I=>I.kind==="videoinput");k(m);const w=m.find(I=>I.deviceId===F)||m[0];T(w.deviceId);const v=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:w.deviceId},width:we.width,height:we.height}});t.current&&(t.current.srcObject=v,t.current.onloadeddata=()=>{O()})}catch(c){console.error("Camera access error:",c),P.error("Unable to access the camera. Please check permissions."),j(!1)}},E=()=>{var c;j(!1),M(!1),(c=t.current)!=null&&c.srcObject&&(t.current.srcObject.getTracks().forEach(m=>m.stop()),t.current.srcObject=null),e.current&&(clearInterval(e.current),e.current=null)},O=()=>{t.current&&(M(!0),e.current&&clearInterval(e.current),e.current=setInterval(async()=>{var c;try{const m=await window.faceapi.detectSingleFace(t.current,new window.faceapi.TinyFaceDetectorOptions({inputSize:416,scoreThreshold:.6})).withFaceLandmarks().withFaceDescriptor();if(m){let w=((c=m.detection)==null?void 0:c.score)||0;if(w<.85){console.warn(`Low face detection confidence: ${w}`);return}clearInterval(e.current),e.current=null;const v=Array.from(m.descriptor);u(v),M(!1),E(),It({title:"Face Captured Successfully",text:`Score : ${w.toFixed(2)*10}, Proceed to Face Enrollment?`,icon:"success",buttons:{cancel:{text:"Cancel",value:!1,className:"bg-gray-300 text-black px-4 py-1 rounded"},confirm:{text:"Proceed Now",value:!0,className:"bg-teal-500 text-white px-4 py-1 rounded"}}}).then(async I=>{I&&await A(v)})}}catch(m){console.error("Face detection error:",m)}},500))},$=async()=>{var m,w;const c=localStorage.getItem("emstoken");try{const v=await Re.post("/api/deletefaceenroll",{employeeId:r._id},{headers:{Authorization:`Bearer ${c}`}});P.success(v.data.message,{autoClose:1200})}catch(v){console.error(v),P.warn(((w=(m=v==null?void 0:v.response)==null?void 0:m.data)==null?void 0:w.message)||"Unexpected error occurred.",{autoClose:1200})}},A=async(c=d)=>{var w,v;if(!r||!c||c.length!==128)return P.warn("Invalid face data. Please try capturing again.");const m=localStorage.getItem("emstoken");try{const I=await Re.post("/api/enrollFace",{employeeId:r._id,descriptor:c},{headers:{Authorization:`Bearer ${m}`}});P.success(I.data.message,{autoClose:1200}),E(),u(null)}catch(I){console.error(I),P.warn(((v=(w=I==null?void 0:I.response)==null?void 0:w.data)==null?void 0:v.message)||"Unexpected error occurred.",{autoClose:1200})}};return o.jsxs("div",{className:"p-2 md:p-6",children:[o.jsx("h2",{className:"text-xl font-bold mb-4",children:"Face Enrollment"}),o.jsxs("select",{className:"border p-2 mb-4 w-full",onChange:c=>{const m=R.find(w=>w._id===c.target.value);i(m),u(null),E()},defaultValue:"",children:[o.jsx("option",{value:"",disabled:!0,children:"Select Employee"}),R==null?void 0:R.map(c=>o.jsxs("option",{value:c._id,children:[c.userid.name," ",c.faceDescriptor?"✅":"❌"]},c._id))]}),r&&o.jsxs("div",{className:"mb-4",children:[o.jsx("img",{src:r.profileimage,alt:"Profile",className:"w-24 h-24 object-cover rounded-full mb-2"}),o.jsx("p",{className:"text-sm",children:(U=r==null?void 0:r.userid)==null?void 0:U.email}),!S&&(r==null?void 0:r.faceDescriptor)&&o.jsx("button",{onClick:$,className:"bg-red-500 mr-2 text-white px-4 py-1 rounded mt-4",children:"Delete Enroll"}),!S&&o.jsx("button",{onClick:X,className:"bg-blue-500 text-white px-4 py-1 rounded mt-4",children:r!=null&&r.faceDescriptor?" Re-Enroll":"Start Enroll"})]}),y.length>1&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Choose Camera:"}),o.jsx("select",{className:"border p-2",value:F||"",onChange:c=>T(c.target.value),children:y.map(c=>o.jsx("option",{value:c.deviceId,children:c.label||`Camera ${c.deviceId.slice(-4)}`},c.deviceId))}),o.jsx("button",{onClick:()=>b(!N),className:"bg-teal-600 ml-2 text-white px-4 py-1 rounded mt-2",children:"Mirror"})]}),S&&o.jsxs("div",{children:[o.jsx("video",{ref:t,autoPlay:!0,muted:!0,width:we.width,height:we.height,className:`rounded-full border-2 border-teal-500 ${N?"-scale-x-100":""} border-dashed p-1 my-4`}),o.jsxs("div",{className:"flex gap-4 mt-2 items-center",children:[o.jsx("button",{onClick:O,className:"bg-yellow-500 text-white px-4 py-1 rounded",disabled:g,children:g?"Detecting...":"Capture Face"}),o.jsx("button",{onClick:E,className:"bg-red-500 text-white px-4 py-1 rounded",children:"Cancel"})]})]})]})},eo=()=>{const[t,e]=n.useState(0),r=(i,d)=>{e(d)};return o.jsxs("div",{className:"m-2 bg-white rounded",children:[o.jsx(Bt,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:o.jsxs(_t,{value:t,onChange:r,"aria-label":"Face Tabs",children:[o.jsx(Xe,{label:"Face Attendance"}),o.jsx(Xe,{label:"Face Enrollment"})]})}),t===0&&o.jsx(Jt,{}),t===1&&o.jsx(Qt,{})]})};export{eo as default};
