import{r as u,j as a,o as L,Y as $,Z as P,_ as X,$ as H,a0 as W,p as Y,h as Z,S as J,a1 as A,n as K,k as Q,b as B,V as ee,W as ae,y as I}from"./index-Be_QPdDA.js";import{I as T}from"./index-BvCueg8_.js";import{M as te}from"./Modalbox-Cd-_oGWY.js";import{X as se}from"./index.es-Bwtc4Ut-.js";import{T as S}from"./TextField-Bwsdogxn.js";import{B as w}from"./Button-BIzmkch7.js";import{F as V,I as _,S as R}from"./Select-wtP9BYgZ.js";import{M as D}from"./MenuItem-BJd3KrCW.js";import{s as ne}from"./styled-BPf55n0O.js";import{e as oe}from"./useSlotProps-CjQPci2g.js";import{u as re}from"./useThemeProps-qeC2oJeJ.js";import"./createSimplePaletteValueFilter-DkxTn1m9.js";import"./ButtonBase-BuAZY-7T.js";const le=J(),ie=ne("div",{name:"MuiStack",slot:"Root"});function ce(e){return re({props:e,name:"MuiStack",defaultTheme:le})}function de(e,n){const s=u.Children.toArray(e).filter(Boolean);return s.reduce((r,o,i)=>(r.push(o),i<s.length-1&&r.push(u.cloneElement(n,{key:`separator-${i}`})),r),[])}const me=e=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[e],pe=({ownerState:e,theme:n})=>{let s={display:"flex",flexDirection:"column",...$({theme:n},P({values:e.direction,breakpoints:n.breakpoints.values}),r=>({flexDirection:r}))};if(e.spacing){const r=X(n),o=Object.keys(n.breakpoints.values).reduce((l,c)=>((typeof e.spacing=="object"&&e.spacing[c]!=null||typeof e.direction=="object"&&e.direction[c]!=null)&&(l[c]=!0),l),{}),i=P({values:e.direction,base:o}),h=P({values:e.spacing,base:o});typeof i=="object"&&Object.keys(i).forEach((l,c,x)=>{if(!i[l]){const b=c>0?i[x[c-1]]:"column";i[l]=b}}),s=H(s,$({theme:n},h,(l,c)=>e.useFlexGap?{gap:A(r,l)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${me(c?i[c]:e.direction)}`]:A(r,l)}}))}return s=W(n.breakpoints,s),s};function ue(e={}){const{createStyledComponent:n=ie,useThemeProps:s=ce,componentName:r="MuiStack"}=e,o=()=>Y({root:["root"]},l=>Z(r,l),{}),i=n(pe);return u.forwardRef(function(l,c){const x=s(l),m=oe(x),{component:b="div",direction:E="column",spacing:C=0,divider:p,children:v,className:q,useFlexGap:z=!1,...F}=m,M={direction:E,spacing:C,useFlexGap:z},N=o();return a.jsx(i,{as:b,ownerState:M,ref:c,className:L(N.root,q),...F,children:p?de(v,p):v})})}const O=ue({createStyledComponent:K("div",{name:"MuiStack",slot:"Root"}),useThemeProps:e=>Q({props:e,name:"MuiStack"})}),ye=[{name:"S.no",selector:e=>e.sno},{name:"Employee",selector:e=>e.employeeId},{name:"Department",selector:e=>e.department},{name:"Salary",selector:e=>e.netSalary},{name:"Pay date",selector:e=>e.payDate},{name:"Action",selector:e=>e.action}],he=async({setisload:e})=>{const n=localStorage.getItem("emstoken");e(!0);try{return(await B.get("/api/employeelist",{headers:{Authorization:`Bearer ${n}`}})).data.list}catch(s){console.log(s),s.response?I.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{e(!1)}},fe=async({setisload:e,deletee:n,edite:s})=>{const r=localStorage.getItem("emstoken");e(!0);try{const o=await B.get("/api/salaryfetch",{headers:{Authorization:`Bearer ${r}`}});console.log(o.data);let i=1;return await o.data.salary.map(d=>({id:d._id,sno:i++,employeeId:d.employeeId.employeename,department:d.employeeId.department.department,netSalary:d.netSalary,payDate:d.payDate,action:a.jsxs("div",{className:"action",children:[a.jsx("span",{className:"edit",title:"Edit",onClick:()=>s(d),children:a.jsx(ee,{})}),a.jsx("span",{className:"delete",onClick:()=>n(d._id),children:a.jsx(ae,{})})]})}))}catch(o){console.log(o),o.response?I.warn(o.response.data.message,{autoClose:1200}):o.request?console.error("No response from server:",o.request):console.error("Error:",o.message)}finally{e(!1)}},xe=async({inp:e,setisload:n})=>{const s=localStorage.getItem("emstoken");n(!0);const{employeeId:r,basicSalary:o,allowance:i,deductions:h,netSalary:d,payDate:l,department:c,description:x}=e;try{const m=await B.post("/api/addsalary",{employeeId:r,basicSalary:o,allowance:i,deductions:h,netSalary:d,payDate:l,department:c,description:x},{headers:{Authorization:`Bearer ${s}`}});return console.log(m),I.success(m.data.message,{autoClose:1200}),n(!1),!0}catch(m){console.log(m),m.response?I.warn(m.response.data.message,{autoClose:1200}):m.request?console.error("No response from server:",m.request):console.error("Error:",m.message)}finally{n(!1)}},Fe=()=>{const[e,n]=u.useState(!1),[s,r]=u.useState(!1),[o,i]=u.useState(!1),[h,d]=u.useState([]),[l,c]=u.useState(""),[x,m]=u.useState([]),[b,E]=u.useState([]),C={employeeId:"",basicSalary:"",allowance:"",deductions:"",netSalary:0,payDate:"",description:"",department:""},[p,v]=u.useState(C);u.useEffect(()=>{z(),q()},[]);const q=async()=>{let t=await fe({setisload:n,edite:M,deletee:N});console.log(t),E(t)},z=async()=>{const t=await he({setisload:n});let f=[];t.forEach(y=>{let g=f.find(k=>k.departmentid===y.department._id);if(g)g.employee.push({id:y._id,name:y.employeename});else{let k={departmentid:y.department._id,departmentname:y.department.department,employee:[{id:y._id,name:y.employeename}]};f.push(k)}}),d(f)};u.useEffect(()=>{if(l){let t=h.find(f=>f.departmentid==l);m(t.employee)}},[l,h]);const F=async t=>{t.preventDefault(),console.log(p),await xe({inp:p,setisload:n})&&r(!1)},M=t=>{console.log("eplyee edit",t)},N=t=>console.log("delete",t),j=(t,f)=>{const y=t.target.value,g={...p,[f]:y},k=parseFloat(f==="basicSalary"?y:g.basicSalary)||0,U=parseFloat(f==="allowance"?y:g.allowance)||0,G=parseFloat(f==="deductions"?y:g.deductions)||0;g.netSalary=(k+U-G).toFixed(2),v(g)};return a.jsxs("div",{className:"salary",children:[a.jsx("h2",{children:"Salary Management"}),a.jsxs("div",{className:"head",children:[a.jsx(S,{size:"small",id:"outlined-basic",label:"Search Department",variant:"standard"}),a.jsx(w,{variant:"contained",onClick:()=>r(!0),children:"Add Salary"})]}),a.jsx("div",{className:"list",children:a.jsx(se,{columns:ye,data:b,pagination:!0,highlightOnHover:!0})}),a.jsx(te,{open:s,onClose:()=>r(!1),children:a.jsx("div",{className:"membermodal",children:a.jsxs("form",{onSubmit:F,children:[a.jsx("h2",{children:"Add Salary"}),a.jsxs("span",{className:"modalcontent",children:[a.jsxs(V,{sx:{width:"98%"},required:!0,size:"small",children:[a.jsx(_,{id:"department-label",children:"Department"}),a.jsxs(R,{labelId:"department-label",id:"department-select",value:p.department,name:"Department",label:"Department",onChange:t=>{j(t,"department"),c(t.target.value)},children:[a.jsx(D,{disabled:!0,value:"",children:"Select Department"},""),h==null?void 0:h.map(t=>a.jsx(D,{value:t.departmentid,children:t.departmentname},t.departmentid))]})]}),a.jsxs(V,{sx:{width:"98%"},required:!0,size:"small",children:[a.jsx(_,{id:"employee-label",children:"Employee"}),a.jsxs(R,{labelId:"employee-label",id:"employee-select",value:p.employeeId,name:"Employee",label:"Employee",onChange:t=>j(t,"employeeId"),children:[a.jsx(D,{disabled:!0,value:"",children:"Select Employee"},""),x==null?void 0:x.map(t=>a.jsx(D,{value:t.id,children:t.name},t.id))]})]}),a.jsxs(O,{direction:"row",spacing:2,sx:{width:"98%"},children:[a.jsx(S,{sx:{width:"50%"},required:!0,value:p.basicSalary,type:"number",onChange:t=>j(t,"basicSalary"),label:"basicSalary",size:"small"}),a.jsx(S,{sx:{width:"50%"},required:!0,value:p.allowance,type:"number",onChange:t=>j(t,"allowance"),label:"allowance",size:"small"})]}),a.jsxs(O,{direction:"row",spacing:2,sx:{width:"98%"},children:[a.jsx(S,{sx:{width:"50%"},required:!0,value:p.deductions,type:"number",onChange:t=>j(t,"deductions"),label:"deductions",size:"small"}),a.jsx(S,{sx:{width:"50%"},required:!0,value:p.netSalary,label:"netSalary",size:"small"})]}),a.jsx(S,{sx:{width:"98%"},required:!0,value:p.payDate,onChange:t=>j(t,"payDate"),label:"payDate",size:"small"}),a.jsx(S,{multiline:!0,rows:4,onChange:t=>j(t,"description"),value:p.description,sx:{width:"98%"},label:"Description",size:"small"}),a.jsxs("div",{children:[!o&&a.jsx(w,{sx:{mr:2},loading:e,loadingPosition:"end",endIcon:a.jsx(T,{}),variant:"contained",type:"submit",children:"Add"}),o&&a.jsx(w,{sx:{mr:2},loading:e,loadingPosition:"end",endIcon:a.jsx(T,{}),variant:"contained",onClick:updatee,children:"Update"}),a.jsx(w,{size:"small",onClick:()=>{r(!1),i(!1),v(C)},variant:"outlined",children:" cancel"})]})]})]})})})]})};export{Fe as default};
