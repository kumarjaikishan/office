import{r as d,j as e,a1 as T,X as R,$ as ee,a0 as _,b as E,y as c}from"./index-BcCf33nC.js";import{M as se}from"./Modalbox-Bw9Q2ggC.js";import{T as O}from"./TextField-BzriM_mM.js";import{B as m}from"./Button-Ca_2FZ2Y.js";import{I as z}from"./IconButton-C3jytAMy.js";import{M as A}from"./MenuItem-CsPX8TLz.js";import"./Select-CePOuoRo.js";import"./createSimplePaletteValueFilter-6n7mCABr.js";import"./useSlotProps-V7hcBR52.js";import"./ButtonBase-CC5f2wl3.js";const me=()=>{const[v,D]=d.useState([]),[V,p]=d.useState(!1),[b,W]=d.useState(null),[w,M]=d.useState(null),[i,f]=d.useState({roleid:"",modules:{}}),[u,$]=d.useState(""),[x,g]=d.useState(null),[y,I]=d.useState(""),[B,L]=d.useState(null),[C,S]=d.useState(""),l=x,N={1:"Read",2:"Create",3:"Update",4:"Delete"},U=["teal","blue","yellow","red"],k=async()=>{var s,t,r,a;try{const o=localStorage.getItem("emstoken"),n=await E.get("/api/permission",{headers:{Authorization:`Bearer ${o}`}});D((s=n.data)==null?void 0:s.permission),g((t=n.data.permissionnames)==null?void 0:t.AllPermissionNames)}catch(o){console.log(o),c.warn(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.message)||"Error",{autoClose:3e3})}};d.useEffect(()=>{k()},[]);const F=s=>{W(t=>t===s?null:s)},X=s=>{M(s);const t=Object.fromEntries(Object.entries(s.modules||{}).filter(([r])=>l==null?void 0:l.includes(r)));f({roleid:s._id,modules:{...t}}),p(!0)},q=(s,t)=>{f(r=>{const a=r.modules[s]||[],n=a.includes(t)?a.filter(j=>j!==t):[...a,t].sort();return{...r,modules:{...r.modules,[s]:n}}})},h=l==null?void 0:l.filter(s=>!Object.prototype.hasOwnProperty.call(i.modules,s)),G=()=>{if(!u){c.warn("Please select a module to add");return}if(!(l!=null&&l.includes(u))){c.warn("Invalid module (not allowed)");return}if(i.modules[u]){c.warn("Module already exists");return}f(s=>({...s,modules:{...s.modules,[u]:[]}})),$("")},H=s=>{const t={...i.modules};delete t[s],f(r=>({...r,modules:t}))},J=async()=>{var s,t;try{const r=Object.fromEntries(Object.entries(i.modules).filter(([n,j])=>(l==null?void 0:l.includes(n))&&j.length>0).map(([n,j])=>[n,[...new Set(j)].sort()])),a=localStorage.getItem("emstoken"),o=await E.put(`/api/permission/${i.roleid}`,{modules:r},{headers:{Authorization:`Bearer ${a}`}});c.success(o.data.message||"Updated successfully",{autoClose:2e3}),p(!1),M(null),k()}catch(r){console.log(r),c.warn(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Update failed",{autoClose:3e3})}},Q=()=>{p(!1),M(null)},Y=()=>{if(y.trim()){if(x.includes(y))return alert("Already exists!");g([...x,y.trim()]),I("")}},Z=s=>{const t=[...x];t.splice(s,1),g(t)},K=s=>{if(!C.trim())return;const t=[...x];t[s]=C.trim(),g(t),L(null),S("")},P=async()=>{var s,t;try{const r=localStorage.getItem("emstoken"),a=await E.put("/api/saveModule",{modules:x},{headers:{Authorization:`Bearer ${r}`}});c.success(a.data.message||"Updated successfully",{autoClose:2e3}),k()}catch(r){console.log(r),c.warn(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Update failed",{autoClose:3e3})}};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full my-2 justify-between items-center cursor-pointer border border-amber-400 bg-amber-100 px-4 py-2 rounded-md",onClick:()=>F("module"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Permission Modules"}),b==="module"?e.jsx(T,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),b==="module"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(O,{size:"small",label:"New Module",value:y,onChange:s=>I(s.target.value)}),e.jsx(m,{variant:"contained",onClick:Y,children:"Add"}),e.jsx(m,{variant:"contained",onClick:P,children:"Save Module"})]}),e.jsxs("table",{className:"min-w-full border text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),e.jsx("th",{className:"border p-2 text-center",children:"Action"})]})}),e.jsx("tbody",{children:x.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-1 capitalize",children:B===t?e.jsx(O,{size:"small",value:C,onChange:r=>S(r.target.value)}):s}),e.jsx("td",{className:"border p-1 text-center",children:B===t?e.jsx(m,{variant:"contained",size:"small",onClick:()=>K(t),children:"Save"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{color:"primary",onClick:()=>{L(t),S(s)},children:e.jsx(ee,{})}),e.jsx(z,{color:"error",onClick:()=>Z(t),children:e.jsx(_,{})})]})})]},t))})]})]})]}),e.jsx("div",{className:"flex flex-col",children:v==null?void 0:v.map((s,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:`flex w-full my-2 justify-between items-center cursor-pointer border-dashed border border-${U[t]}-600 bg-${U[t]}-100 px-4 py-2 rounded-md`,onClick:()=>F(s.role),children:[e.jsx("span",{className:"font-semibold capitalize text-[16px] md:text-lg text-left",children:s.role}),b===`${s.role}`?e.jsx(T,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),b===`${s.role}`&&e.jsxs("div",{className:"p-1 rounded border-teal-300 border-2 border-dashed mt-2",children:[e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(m,{variant:"contained",onClick:()=>X(s),sx:{mr:2},children:"Edit"})}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(N).map(r=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:r},r))]})}),e.jsx("tbody",{children:Object.entries(s.modules).map(([r,a])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:r}),Object.keys(N).map(o=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:a.includes(Number(o))?"âœ…":"-"},o))]},r))})]})]})]},s._id))}),e.jsx(se,{open:V,onClose:()=>p(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{action:"",children:[e.jsxs("h2",{className:"font-bold text-lg mb-3",children:["Edit Permission - ",w==null?void 0:w.role]}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex gap-2 mb-3 items-center",children:[e.jsx(O,{select:!0,size:"small",label:"Add Module",value:u,onChange:s=>$(s.target.value),sx:{minWidth:200},children:(h==null?void 0:h.length)===0?e.jsx(A,{disabled:!0,value:"",children:"No modules available"}):h==null?void 0:h.map(s=>e.jsx(A,{value:s,className:"capitalize",children:s},s))}),e.jsx(m,{variant:"contained",onClick:G,disabled:!u,children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(N).map(([s,t])=>e.jsx("th",{className:"border p-2 text-center",children:t},s)),e.jsx("th",{className:"border p-2 text-center",children:"Action"})]})}),e.jsx("tbody",{children:Object.keys(i.modules).sort((s,t)=>(l==null?void 0:l.indexOf(s))-(l==null?void 0:l.indexOf(t))).map(s=>{const t=i.modules[s]||[];return e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:s}),Object.keys(N).map(r=>e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:"h-3 w-3 md:h-5 md:w-5 cursor-pointer",type:"checkbox",checked:t.includes(Number(r)),onChange:()=>q(s,Number(r))})},r)),e.jsx("td",{className:"border text-center",children:e.jsx(z,{color:"error",size:"small",onClick:()=>H(s),children:e.jsx(_,{})})})]},s)})})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(m,{variant:"outlined",onClick:Q,children:"Cancel"}),e.jsx(m,{variant:"contained",onClick:J,children:"Save"})]})]})]})})})]})};export{me as default};
