import{r as o,j as e,K as Fe,aK as Ce,aL as Ye,aM as Be,aN as Pe,aO as ze,aP as He,aQ as We,aR as $e,aS as _e,aT as Ke,g as Qe,a as Ue,h as t,F as S,I as B,S as P,M as f,b as ue,B as Xe,aa as qe,c as Ge,y as Je}from"./index-HcCGk6ri.js";import{i as Ve}from"./isSameOrBefore-C0cNBi1r.js";import{a as Ze}from"./index-C1m3vriY.js";import{P as ea,R as aa}from"./PieChart-CZcTHvGG.js";import{u as sa,a as xe}from"./attandencehelper-BYTMbRmi.js";import{T as ta}from"./Tooltip-BBP76Zfi.js";import"./index-3Co5FqxK.js";import"./useThemeProps-Cu4f5P_K.js";import"./Popper-D2sEeogb.js";import"./index-B-oMznAg.js";const ra=({attandence:n,employee:s,hell:a})=>{var u,A,m,z,H,W,$,_,K,k,E,w;o.useEffect(()=>{},[n]);const i="https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",c=(((u=a==null?void 0:a.present)==null?void 0:u.length)||0)+(((A=a==null?void 0:a.absent)==null?void 0:A.length)||0)+(((m=a==null?void 0:a.leave)==null?void 0:m.length)||0),x=o.useMemo(()=>{var R,O,T;return{present:c?Math.floor(((R=a==null?void 0:a.present)==null?void 0:R.length)/c*100):0,absent:c?Math.floor(((O=a==null?void 0:a.absent)==null?void 0:O.length)/c*100):0,leave:c?Math.floor(((T=a==null?void 0:a.leave)==null?void 0:T.length)/c*100):0}},[a,c]),g=c?[{id:0,value:x.present,color:"teal",label:"Present"},{id:1,value:x.leave,color:"orange",label:"Leave"},{id:2,value:x.absent,color:"rgb(156 163 175)",label:"Absent"}]:[{id:0,value:100,color:"rgb(156 163 175)",label:"No record"}],b=window.innerWidth<600?{width:220,height:220}:{width:300,height:300},j=window.innerWidth<600?{innerRadius:95,outerRadius:110}:{innerRadius:130,outerRadius:150};return e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center min-h-[200px] bg-[#e0e4e7] p-1 space-y-1 md:space-y-0 md:space-x-2",children:[e.jsxs("div",{className:"relative  mb-2  w-60 h-60 md:w-80 md:h-80 flex items-center justify-center z-2 rounded-full",children:[e.jsx(ea,{series:[{innerRadius:j.innerRadius,outerRadius:j.outerRadius,data:g,paddingAngle:1,cornerRadius:5}],width:b.width,height:b.height,legend:{hidden:!0}}),e.jsx("div",{className:"absolute w-46 h-46 md:w-63 md:h-63 rounded-full overflow-hidden border-4 border-white",children:e.jsx("img",{src:(s==null?void 0:s.profileimage)||i,alt:(s==null?void 0:s.name)||"Employee",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-full md:w-[550px]",children:[e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Fe,{})," Total Days"]}),e.jsx("span",{className:"font-bold text-gray-600",children:c})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ce,{})," Present"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((z=a==null?void 0:a.present)==null?void 0:z.length)||0," Days"," ",x.present?`(${x.present}%)`:""]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ye,{})," Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((H=a==null?void 0:a.leave)==null?void 0:H.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Be,{})," Absent"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((W=a==null?void 0:a.absent)==null?void 0:W.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-12 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsx(ta,{placement:"top",enterDelay:800,arrow:!0,title:(a==null?void 0:a.overtimesalary)!==null?e.jsxs("div",{className:"flex gap-1 flex-col text-white",children:[e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Basic salary"}),e.jsxs("span",{children:[": ",s==null?void 0:s.salary," ₹"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Net Overtime"}),e.jsxs("span",{children:[": ",((a==null?void 0:a.overtimemin)||0)-((a==null?void 0:a.shorttimemin)||0)," min"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Payment"}),e.jsxs("span",{children:[": ",(a==null?void 0:a.overtimesalary)||0," ₹"]})]})]}):"",children:e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow cursor-help",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Pe,{})," Overtime"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[(($=a==null?void 0:a.overtime)==null?void 0:$.length)||0," ",(a==null?void 0:a.overtimemin)>0&&`(${a==null?void 0:a.overtimemin} min)`]})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(ze,{})," Short Time"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((_=a==null?void 0:a.short)==null?void 0:_.length)||0," ",(a==null?void 0:a.shorttimemin)>0&&`(${a==null?void 0:a.shorttimemin} min)`]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(He,{})," Late Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((K=a==null?void 0:a.latearrival)==null?void 0:K.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(We,{})," Early Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((k=a==null?void 0:a.earlyLeave)==null?void 0:k.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx($e,{})," Early Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((E=a==null?void 0:a.earlyarrival)==null?void 0:E.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(_e,{})," Late Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((w=a==null?void 0:a.lateleave)==null?void 0:w.length)||0})]})]})]})]})};t.extend(Ve);const va=()=>{var se;const{userid:n}=Ke(),[s,a]=o.useState(null),[i,c]=o.useState({}),[x,g]=o.useState([]),[b,j]=o.useState(!0),{company:u,holidays:A}=Qe(r=>r.user),[m,z]=o.useState(null),[H,W]=o.useState([]),[$,_]=o.useState([]),K=Ue(),[k,E]=o.useState(t().year()),[w,R]=o.useState(t().month()),[O,T]=o.useState("all"),[D,V]=o.useState("all"),[Q,Z]=o.useState("all"),[q,ee]=o.useState(null),[G,ae]=o.useState(null),[M,me]=o.useState({present:[],absent:[],leave:[],holiday:[],short:[],overtime:[],latearrival:[],earlyarrival:[],earlyLeave:[],lateleave:[],shorttimemin:0,overtimemin:0,overtimesalary:0}),fe=t().year(),he=Array.from({length:8},(r,l)=>fe+1-l),pe=Array.from({length:12},(r,l)=>({label:t().month(l).format("MMMM"),value:l}));o.useEffect(()=>{var l,h,d,p,I,L,F;if(!u||!i)return;const r=((l=i==null?void 0:i.branchId)==null?void 0:l.defaultsetting)==!1?{attendanceRules:(d=(h=i==null?void 0:i.branchId)==null?void 0:h.setting)==null?void 0:d.attendanceRules,workingMinutes:(I=(p=i==null?void 0:i.branchId)==null?void 0:p.setting)==null?void 0:I.workingMinutes,weeklyOffs:(F=(L=i==null?void 0:i.branchId)==null?void 0:L.setting)==null?void 0:F.weeklyOffs}:{attendanceRules:u==null?void 0:u.attendanceRules,workingMinutes:u==null?void 0:u.workingMinutes,weeklyOffs:u==null?void 0:u.weeklyOffs};z(r)},[u,i]),o.useEffect(()=>{if(!A)return;const r=[];A.forEach(l=>{let h=t(l.fromDate);const d=l.toDate?t(l.toDate):h;for(;h.isSameOrBefore(d,"day");)r.push(h.format("DD/MM/YYYY")),h=h.add(1,"day")}),W(r)},[A]),o.useEffect(()=>{if(!n)return;(async()=>{var h,d;const l=localStorage.getItem("emstoken");try{j(!0);const p=await Ge.get("/api/employeeAttandence",{params:{userid:n},headers:{Authorization:`Bearer ${l}`}});c(p.data.employee),a(p.data.user),g(p.data.attandence)}catch(p){if(console.error("Failed to fetch performance data:",p),p.status==403){swal({title:"Access Denied",text:p.response.data.message||"You are not authorized to manage this tournament.",icon:"warning"}),K("/");return}Je.warning(((d=(h=p.response)==null?void 0:h.data)==null?void 0:d.message)||"error")}finally{j(!1)}})()},[n]),o.useEffect(()=>{if(!x.length||!m)return;const r=x.filter(v=>{const y=t(v.date);return y.year()===k&&(w==="all"||y.month()===w)}),l=[],h=[],d=[],p=[],I=[],L=[],F=[],te=[],re=[],ne=[];let J=0,U=0,X=[];r.forEach(v=>{const y=t(v.date).toDate();let je=t(v.date).format("DD/MM/YYYY");const{punchIn:C,punchOut:Y,workingMinutes:N}=v,ie=H.includes(je),ge=t(v.date).startOf("day").day(),le=m==null?void 0:m.weeklyOffs.includes(ge),de=v.status=="leave",oe=v.status=="absent";ie&&!de&&!oe&&N?X.push({...v,remarks:"worked on holiday"}):le&&!de&&!oe&&N?X.push({...v,remarks:"worked on weekly off"}):X.push(v);const ce=v.status;switch(ce){case"present":l.push(y);break;case"absent":h.push(y);break;case"leave":d.push(y);break;case"holiday":p.push(y);break}if(ce!=="present"||!C||!Y||typeof N!="number")return;if(ie||le)L.push(y),U+=N;else{const Te=N<m.workingMinutes.shortDayThreshold,Ie=N>m.workingMinutes.overtimeAfterMinutes;Te&&(I.push(y),J+=m.workingMinutes.shortDayThreshold-N),Ie&&(L.push(y),U+=N-m.workingMinutes.overtimeAfterMinutes)}const[we,be]=m.attendanceRules.considerEarlyEntryBefore.split(":").map(Number),[Ne,ke]=m.attendanceRules.considerLateEntryAfter.split(":").map(Number),Me=t(C).startOf("day").add(we,"hour").add(be,"minute"),Se=t(C).startOf("day").add(Ne,"hour").add(ke,"minute");t(C).isBefore(Me)&&te.push(y),t(C).isAfter(Se)&&F.push(y);const[Ae,Oe]=m.attendanceRules.considerEarlyExitBefore.split(":").map(Number),[De,Le]=m.attendanceRules.considerLateExitAfter.split(":").map(Number),Ee=t(Y).startOf("day").add(Ae,"hour").add(Oe,"minute"),Re=t(Y).startOf("day").add(De,"hour").add(Le,"minute");t(Y).isBefore(Ee)&&re.push(y),t(Y).isAfter(Re)&&ne.push(y)}),_(X),me({present:l,absent:h,leave:d,holiday:p,short:I,overtime:L,shorttimemin:J,overtimemin:U,latearrival:F,earlyarrival:te,earlyLeave:re,lateleave:ne,overtimesalary:w!=="all"?Math.floor((U-J)*parseFloat(i.salary/t(new Date(k,w)).daysInMonth()/m.workingMinutes.overtimeAfterMinutes)):null})},[x,k,w,m]);const ye=$.filter(r=>{const l=t(r.date).startOf("day");return!(q&&l.isBefore(t(q))||G&&l.isAfter(t(G))||O!=="all"&&r.status!==O||D!=="all"&&!(D==="earlyLeave"&&M.earlyLeave.some(d=>t(d).isSame(l,"day"))||D==="lateleave"&&M.lateleave.some(d=>t(d).isSame(l,"day"))||D==="earlyarrival"&&M.earlyarrival.some(d=>t(d).isSame(l,"day"))||D==="latearrival"&&M.latearrival.some(d=>t(d).isSame(l,"day")))||Q!=="all"&&!(Q==="short"&&M.short.some(d=>t(d).isSame(l,"day"))||Q==="overtime"&&M.overtime.some(d=>t(d).isSame(l,"day"))))}),ve=()=>{E(t().year()),R("all"),T("all"),V("all"),Z("all"),ee(null),ae(null)};return e.jsxs("div",{className:"p-1 md:p-4 capitalize bg-gray-200",children:[b&&e.jsx("p",{children:"Loading performance data..."}),e.jsxs("div",{className:"p-1 py-3 md:p-3 flex flex-wrap gap-1 md:gap-3 items-center justify-between rounded shadow bg-white mb-4",children:[e.jsxs("div",{className:"gap-3 md:gap-3 flex",children:[e.jsxs(S,{className:"w-[90px]   md:w-[120px]",size:"small",children:[e.jsx(B,{children:"Year"}),e.jsx(P,{value:k,label:"Year",onChange:r=>E(r.target.value),children:he.map(r=>e.jsx(f,{value:r,children:r},r))})]}),e.jsxs(S,{size:"small",className:"w-[130px]  md:w-[160px]",children:[e.jsx(B,{children:"Month"}),e.jsxs(P,{value:w,label:"Month",onChange:r=>R(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),pe.map(r=>e.jsx(f,{value:r.value,children:r.label},r.label))]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("p",{className:"font-semibold text-sm md:text-lg",children:s==null?void 0:s.name}),e.jsxs("p",{className:"text-[12px] md:text-sm text-gray-600",children:["(",(se=i==null?void 0:i.branchId)==null?void 0:se.name,")"]})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx(ra,{employee:i,user:s,attandence:x,hell:M}),e.jsxs("div",{className:"p-1 py-4 md:p-4 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 rounded shadow bg-white my-4",children:[e.jsxs(S,{size:"small",sx:{minWidth:120},children:[e.jsx(B,{children:"Type"}),e.jsxs(P,{value:D,label:"Type",onChange:r=>V(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"earlyLeave",children:"Early Leave"}),e.jsx(f,{value:"lateleave",children:"Late Leave"}),e.jsx(f,{value:"earlyarrival",children:"Early Arrival"}),e.jsx(f,{value:"latearrival",children:"Late Arrival"})]})]}),e.jsxs(S,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Status"}),e.jsxs(P,{value:O,label:"Status",onChange:r=>T(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"present",children:"Present"}),e.jsx(f,{value:"leave",children:"Leave"}),e.jsx(f,{value:"absent",children:"Absent"}),e.jsx(f,{value:"weekly off",children:"Weekly off"}),e.jsx(f,{value:"holiday",children:"Holiday"}),e.jsx(f,{value:"half day",children:"Half Day"})]})]}),e.jsxs(S,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Over/Short"}),e.jsxs(P,{value:Q,label:"over/short",onChange:r=>Z(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"overtime",children:"Overtime"}),e.jsx(f,{value:"short",children:"Short Time"})]})]}),e.jsx(S,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"From Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:q||"",onChange:r=>ee(r.target.value)})}),e.jsx(S,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"To Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:G||"",onChange:r=>ae(r.target.value)})}),e.jsx(Xe,{variant:"outlined",color:"secondary",onClick:ve,sx:{alignSelf:"flex-end",minWidth:100},startIcon:e.jsx(aa,{}),children:"Reset"})]}),e.jsx(qe,{columns:la(m),data:ye,pagination:!0,customStyles:sa(),conditionalRowStyles:ia,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(Ze,{className:"text-xl"})," No records found matching your criteria."]})})]})]})},na=n=>{const s=Math.floor(n/60),a=n%60;return`${s}h ${a}m`},ia=[{when:n=>n.remarks,style:{backgroundColor:"rgba(21, 233, 233, 0.2)"}}],la=n=>[{name:"Date",selector:s=>t(s.date).format("DD MMM, YYYY"),sortable:!0,width:"120px"},{name:"Punch In",width:"140px",selector:s=>s.punchIn,cell:s=>{var j,u;if(!s.punchIn)return"-";const[a,i]=(j=n==null?void 0:n.attendanceRules)==null?void 0:j.considerEarlyEntryBefore.split(":").map(Number),[c,x]=(u=n==null?void 0:n.attendanceRules)==null?void 0:u.considerLateEntryAfter.split(":").map(Number),g=t(s.punchIn).startOf("day").add(a,"hour").add(i,"minute"),b=t(s.punchIn).startOf("day").add(c,"hour").add(x,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"text-[16px] text-blue-700"}),t(s.punchIn).format("hh:mm A"),!s.remarks&&t(s.punchIn).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchIn).isAfter(b)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Late"})]})}},{name:"Punch Out",width:"140px",selector:s=>s.punchOut,cell:s=>{var j,u;if(!s.punchOut)return"-";const[a,i]=(j=n==null?void 0:n.attendanceRules)==null?void 0:j.considerEarlyExitBefore.split(":").map(Number),[c,x]=(u=n==null?void 0:n.attendanceRules)==null?void 0:u.considerLateExitAfter.split(":").map(Number),g=t(s.punchOut).startOf("day").add(a,"hour").add(i,"minute"),b=t(s.punchOut).startOf("day").add(c,"hour").add(x,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"text-[16px] text-blue-700"}),t(s.punchOut).format("hh:mm A"),!s.remarks&&t(s.punchOut).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchOut).isAfter(b)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Late"})]})}},{name:"Status",selector:s=>s.status,cell:s=>{const{status:a}=s,c={absent:"bg-red-100 text-red-800",leave:"bg-violet-100 text-violet-800",present:"bg-green-100 text-green-800",holiday:"bg-blue-100 text-blue-800"}[a]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`${c} px-2 py-1 rounded text-xs`,children:a})},width:"120px"},{name:"Working Hours",width:"180px",selector:s=>s.workingMinutes,cell:s=>{var i,c,x,g;const a=s.workingMinutes;return a?e.jsxs("span",{className:" flex",children:[e.jsx("span",{className:"block w-[60px] ",children:na(a)}),!s.remarks&&a<((i=n==null?void 0:n.workingMinutes)==null?void 0:i.shortDayThreshold)&&e.jsxs("span",{className:" block w-[100px] px-2 py-0.5 rounded bg-amber-100 text-amber-900 text-xs",children:["Short ",((c=n==null?void 0:n.workingMinutes)==null?void 0:c.shortDayThreshold)-a," min"]}),!s.remarks&&a>((x=n==null?void 0:n.workingMinutes)==null?void 0:x.overtimeAfterMinutes)&&e.jsxs("span",{className:"px-2 block w-[115px] py-0.5  rounded bg-green-100 text-green-900 text-xs",children:["Overtime ",a-((g=n==null?void 0:n.workingMinutes)==null?void 0:g.overtimeAfterMinutes)," min"]})]}):"-"}},{name:"Remarks",selector:s=>s.remarks&&`${(s==null?void 0:s.workingMinutes)||0} minutes  ${s.remarks}`}];export{va as default};
