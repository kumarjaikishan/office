import{u as Z,g as ee,r as l,j as a,F as z,I as $,S as B,M as i,b as y,B as b,A as R,k as O,aa as ae,h as se,ab as te,a5 as P,aj as le,ak as ne,c as w,y as h,D as L}from"./index-CcdprHkT.js";import{A as de}from"./Autocomplete-DtQjnBrW.js";import"./Popper-Bhi8m9hL.js";import"./Chip-Vu8GCNow.js";const me=()=>{var D,M;const u=new URLSearchParams(window.location.search).get("employeeId"),S=Z(),{employee:n,advance:f,branch:g}=ee(e=>e.user),[v,U]=l.useState([]),[Y,E]=l.useState(!1),[p,A]=l.useState(null),[q,k]=l.useState([]),[W,N]=l.useState(!1),[o,C]=l.useState(u||"all"),[c,G]=l.useState({branch:"all"}),[d,x]=l.useState({employeeId:"",companyId:"",branchId:"",empId:"",amount:0,type:"given",remarks:""});l.useEffect(()=>{f&&U(f)},[f]),l.useEffect(()=>{if(c.branch=="all")k(n);else{const e=n.filter(s=>s.branchId==c.branch);k(e)}},[c.branch]),l.useEffect(()=>{u&&C(u)},[u]);const r=o!=="all"?n==null?void 0:n.find(e=>e._id===o):null,T=v==null?void 0:v.filter(e=>{var m;const s=c.branch==="all"||e.branchId===c.branch,t=((m=e.employeeId)==null?void 0:m._id)===o;return s&&t}),X=(e,s)=>{G(t=>({...t,[e]:s}))},H=e=>{const s=e.target.value;C(s);const t=new URL(window.location.href);s==="all"?t.searchParams.delete("employeeId"):t.searchParams.set("employeeId",s),window.history.replaceState({},"",t)},j=e=>{x({...d,[e.target.name]:e.target.value})},_=(e=null)=>{var s;e?(x({employeeId:((s=e.employeeId)==null?void 0:s._id)||"",companyId:e.companyId||"",branchId:e.branchId||"",empId:e.empId||"",amount:e.amount,type:e.type||"given",remarks:e.remarks}),A(e._id)):(x({employeeId:"",companyId:"",branchId:"",empId:"",amount:0,type:"given",remarks:""}),A(null)),E(!0)},I=()=>E(!1),J=async e=>{var s,t;e.preventDefault();try{N(!0);const F={headers:{Authorization:`Bearer ${localStorage.getItem("emstoken")}`}};p?(await w.put(`/api/advance/${p}`,d,F),h.success("Advance updated")):(await w.post("/api/advance",d,F),h.success("Advance added")),S(L()),I()}catch(m){h.error(((t=(s=m.response)==null?void 0:s.data)==null?void 0:t.message)||"Server error")}finally{N(!1)}},K=async e=>{swal({title:"Are you sure to Delete this entry?",text:"Once deleted, you will not be able to recover this",icon:"warning",buttons:!0,dangerMode:!0}).then(async s=>{if(s)try{const t=localStorage.getItem("emstoken");await w.delete(`/api/advance/${e}`,{headers:{Authorization:`Bearer ${t}`}}),h.success("Advance deleted"),S(L())}catch{h.error("Failed to delete record")}})},Q=e=>{const s=n.find(t=>t._id===e.target.value);s&&x({...d,employeeId:s._id,companyId:s.companyId,branchId:s.branchId,empId:s.empId})},V=[{name:"S.no",selector:(e,s)=>s+1,width:"60px"},{name:"Date",selector:e=>se(e.date).format("DD MMM, YYYY"),width:"120px"},{name:"Remarks",selector:e=>e.remarks||"-"},{name:"Given",selector:e=>e.type==="given"?e.amount:"-",width:"90px"},{name:"Adjusted",selector:e=>e.type==="adjusted"?e.amount:"-",width:"90px"},{name:"Balance",selector:e=>e.balance,width:"100px"},{name:"Actions",cell:e=>!e.payrollId&&a.jsxs(a.Fragment,{children:[a.jsx(P,{onClick:()=>_(e),children:a.jsx(le,{})}),a.jsx(P,{color:"error",onClick:()=>K(e._id),children:a.jsx(ne,{})})]}),width:"140px"}];return a.jsxs("div",{className:"p-3 max-w-6xl mx-auto",children:[a.jsxs("div",{className:"flex flex-wrap gap-3 mb-3",children:[a.jsxs(z,{size:"small",className:"w-[160px]",children:[a.jsx($,{children:"Branch"}),a.jsxs(B,{value:c.branch,onChange:e=>X("branch",e.target.value),label:"Branch",children:[a.jsx(i,{value:"all",children:"All"}),g==null?void 0:g.map(e=>a.jsx(i,{value:e._id,children:e.name},e._id))]})]}),a.jsx(de,{size:"small",className:"w-[350px]",options:q||[],getOptionLabel:e=>{var s;return e?`${((s=e.userid)==null?void 0:s.name)||""} (${e.empId||e.empCode||""})`:""},value:o==="all"?null:n.find(e=>e._id===o)||null,onChange:(e,s)=>{H({target:{value:s?s._id:"all"}})},renderInput:e=>a.jsx(y,{...e,label:"Employee",placeholder:"Search employee"}),isOptionEqualToValue:(e,s)=>e._id===s._id,clearOnEscape:!0}),a.jsx(b,{variant:"contained",onClick:()=>_(),children:"Add Advance"})]}),r&&a.jsxs("div",{className:"flex items-center gap-4 p-3 mb-3 rounded border border-gray-400 bg-gray-50",children:[a.jsx(R,{sx:{width:55,height:55},alt:(D=r.userid)==null?void 0:D.name,src:O(r.profileimage,{format:"webp",width:100,height:100})}),a.jsxs("div",{className:"flex flex-col leading-tight",children:[a.jsx("span",{className:"text-base font-medium capitalize text-gray-800",children:(M=r.userid)==null?void 0:M.name}),a.jsx("span",{className:"text-sm text-gray-600",children:r.designation}),a.jsxs("span",{className:"text-xs text-gray-500",children:["Emp ID: ",r.empId]})]})]}),a.jsx(ae,{columns:V,data:T,pagination:!0,striped:!0,noDataComponent:a.jsx("div",{className:"py-4 my-2 text-center text-gray-500  font-semibold",children:r?"No record found":"Please select an employee"})}),a.jsx(te,{open:Y,outside:!1,onClose:I,children:a.jsx("div",{className:"membermodal w-[500px]",children:a.jsxs("div",{className:"whole",children:[a.jsxs("div",{className:"modalhead",children:[" ",p?"Edit Advance":"Add Advance"]}),a.jsxs("form",{onSubmit:J,children:[a.jsx("span",{className:"modalcontent ",children:a.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[a.jsxs(z,{required:!0,className:"w-full mt-4",size:"small",children:[a.jsx($,{children:"Select Employee"}),a.jsxs(B,{required:!0,label:"select employee",value:d.employeeId,onChange:Q,children:[a.jsx(i,{value:"",children:"Select Employee"}),n==null?void 0:n.map(e=>{var s;return a.jsx(i,{value:e._id,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(R,{src:O(e==null?void 0:e.profileimage,{format:"webp",width:100,height:100}),sx:{width:24,height:24}}),(s=e.userid)==null?void 0:s.name]})},e._id)})]})]}),a.jsxs("div",{className:"w-full flex justify-between gap-3",children:[a.jsx(y,{margin:"dense",size:"small",label:"Amount",name:"amount",type:"number",fullWidth:!0,value:d.amount,onChange:j}),a.jsxs(y,{margin:"dense",size:"small",select:!0,label:"type",name:"type",fullWidth:!0,value:d.type,onChange:j,children:[a.jsx(i,{value:"given",children:"Given"}),a.jsx(i,{value:"adjusted",children:"Adjusted"})]})]}),a.jsx(y,{margin:"dense",multiline:!0,minRows:2,size:"small",label:"Remarks",name:"remarks",fullWidth:!0,value:d.remarks,onChange:j})]})}),a.jsxs("div",{className:"modalfooter",children:[a.jsx(b,{onClick:I,variant:"outlined",children:"Cancel"}),a.jsx(b,{loading:W,type:"submit",variant:"contained",color:"primary",children:p?"Update":"Save"})]})]})]})})})]})};export{me as default};
