import{r,f as _,ap as K,g as i,b as N,j as t,K as G,L as Q,y as g}from"./index-DNmbyctx.js";import{i as V}from"./isSameOrBefore-D8sDQybu.js";import{X as Z}from"./index.es-DhjW5OeU.js";import{A as ee}from"./index-BPc237SY.js";import{u as te}from"./attandencehelper-DWUDTHwq.js";import{H as ae}from"./holidayCalander-ig5vdhhi.js";import{B as se}from"./index-MK-4NbxL.js";import{A as re}from"./AdapterDateFns-C0c0FvBI.js";import{B as k}from"./Box-_Zi1QVWw.js";import{T as z}from"./TextField-DSXkdIrU.js";import{D as B}from"./DatePicker-colPEtXV.js";import{F as j,I as D,S as v}from"./Select-B-OVomDT.js";import{M as d}from"./MenuItem-DmD-nXE-.js";import{B as b}from"./Button-DFRYobdU.js";import{L as le}from"./dateViewRenderers-D_OVfTsO.js";import"./ButtonBase-BoWQgoZ1.js";import"./Tooltip-B5Swor_M.js";import"./useSlotProps-DzawK2Wk.js";import"./createSimplePaletteValueFilter-DJWPGhYx.js";import"./Popper-DSLfBHjw.js";import"./index-Du5EwiQH.js";import"./useThemeProps-LYiZaN9Z.js";import"./InputAdornment-DTunrINL.js";import"./Typography-BbUhKY7I.js";import"./IconButton-BIXCjBIJ.js";i.extend(V);const ke=()=>{const[s,c]=r.useState({name:"",type:"",fromDate:null,toDate:null,description:""}),[E,H]=r.useState(null),[w,I]=r.useState([]),[m,O]=r.useState([]),[p,M]=r.useState(!1),{company:x}=_(e=>e.user),[R,P]=r.useState([1]),[f,F]=r.useState("All"),[h,Y]=r.useState("All"),[y,C]=r.useState("All"),T=K.useRef(null);r.useEffect(()=>{P((x==null?void 0:x.weeklyOffs)||[1])},[x]),r.useEffect(()=>{if(s.fromDate&&!s.toDate){const e=i(s.fromDate).toDate();isNaN(e.getTime())||c(a=>({...a,toDate:e}))}},[s.fromDate]),r.useEffect(()=>{A()},[]);const A=async()=>{try{const e=localStorage.getItem("emstoken"),l=(await N.get("/api/getholidays",{headers:{Authorization:`Bearer ${e}`}})).data.holidays,n=[];l.forEach(o=>{let u=i(o.fromDate);const X=o.toDate?i(o.toDate):u;for(;u.isSameOrBefore(X,"day");)n.push({date:u.format("MM/DD/YYYY"),name:o.name}),u=u.add(1,"day")});const S=l.map(o=>({name:o.name,From:o.fromDate,till:o.toDate,type:o.type,description:o==null?void 0:o.description,action:t.jsxs("div",{className:"action flex gap-2.5",children:[t.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>$(o),children:t.jsx(G,{})}),t.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>L(o._id),children:t.jsx(ee,{})})]})}));r.startTransition(()=>{O(n),I(S)})}catch(e){console.error("Error fetching holidays:",e)}},$=e=>{M(!0),H(e._id),c({name:e.name,type:e.type,fromDate:i(e.fromDate).toDate(),toDate:i(e.toDate).toDate(),description:e.description||""}),setTimeout(()=>{var a;(a=T.current)==null||a.focus()},0)},L=async e=>{Q({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{const l=localStorage.getItem("emstoken"),n=await N.post("/api/deleteholiday",{id:e},{headers:{Authorization:`Bearer ${l}`}});g.success(n.data.message),A()}catch(l){console.error(l),g.warning(l.response.data.message)}})},W=async()=>{try{const e=localStorage.getItem("emstoken"),a=p?"updateholiday":"addholiday",l=p?{...s,holidayId:E}:s,n=await N.post(`/api/${a}`,l,{headers:{Authorization:`Bearer ${e}`}});g.success(n.data.message),c({name:"",type:"Public",fromDate:null,toDate:null,description:""}),M(!1),A()}catch(e){console.error(e.response),g.warning(e.response.data.message)}},q=r.useMemo(()=>w.filter(e=>{const a=i(e.From),l=f==="All"||a.year().toString()===f,n=h==="All"||a.month()===parseInt(h),S=y==="All"||e.type===y;return l&&n&&S}),[w,f,h,y]),J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],U=r.useMemo(()=>{if(!m||m.length===0)return[];const e=i(m[m.length-1].date).year(),a=i(m[0].date).year(),l=[];for(let n=e;n<=a;n++)l.push(n);return l},[m]);return t.jsxs(le,{dateAdapter:re,children:[t.jsxs(k,{className:"flex flex-col md:flex-row gap-4 p-1",children:[t.jsx(ae,{highlightedDates:m.map(e=>({date:i(e.date).toDate(),name:e.name})),weeklyOffs:R}),t.jsx("form",{onSubmit:W,className:"rounded w-full max-w-md",children:t.jsxs(k,{className:"flex flex-col gap-4 p-4 bg-white shadow rounded w-full max-w-md",children:[t.jsx(z,{required:!0,inputRef:T,label:"Holiday Name",size:"small",value:s.name,onChange:e=>c(a=>({...a,name:e.target.value})),fullWidth:!0}),t.jsx(B,{required:!0,label:"From Date",format:"dd/MM/yyyy",value:s.fromDate,onChange:e=>c(a=>({...a,fromDate:e})),slotProps:{textField:{size:"small",fullWidth:!0}}}),t.jsx(B,{required:!0,label:"To Date",format:"dd/MM/yyyy",value:s.toDate,onChange:e=>c(a=>({...a,toDate:e})),slotProps:{textField:{size:"small",fullWidth:!0}}}),t.jsxs(j,{size:"small",required:!0,fullWidth:!0,children:[t.jsx(D,{children:"Type"}),t.jsxs(v,{value:s.type,label:"Type",onChange:e=>c(a=>({...a,type:e.target.value})),children:[t.jsx(d,{disabled:!0,value:"",children:"Select Type"}),t.jsx(d,{value:"National",children:"National"}),t.jsx(d,{value:"Religious",children:"Religious"}),t.jsx(d,{value:"Public",children:"Public"}),t.jsx(d,{value:"Other",children:"Other"})]})]}),t.jsx(z,{label:"Description (optional)",multiline:!0,rows:2,size:"small",value:s.description,onChange:e=>c(a=>({...a,description:e.target.value})),fullWidth:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[p&&t.jsx(b,{variant:"outlined",onClick:()=>{M(!1),c({name:"",type:"Public",fromDate:null,toDate:null,description:""})},children:"Cancel"}),t.jsxs(b,{variant:"contained",type:"submit",children:[p?"Update":"Add"," Holiday"]})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2  w-full md:w-[600px] my-4 ",children:[t.jsxs(j,{className:" md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(D,{children:"Year"}),t.jsxs(v,{label:"Year",value:f,onChange:e=>F(e.target.value),children:[t.jsx(d,{value:"All",children:"All"}),U.map(e=>t.jsx(d,{value:e,children:e},e))]})]}),t.jsxs(j,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(D,{children:" Month"}),t.jsxs(v,{label:"Month",value:h,onChange:e=>Y(e.target.value),children:[t.jsx(d,{value:"All",children:"All"}),J.map((e,a)=>t.jsx(d,{value:a,children:e},e))]})]}),t.jsxs(j,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(D,{children:"Type"}),t.jsxs(v,{label:"Filter by Type",value:y,onChange:e=>C(e.target.value),children:[t.jsx(d,{value:"All",children:"All"}),[...new Set(w.map(e=>e.type))].map(e=>t.jsx(d,{value:e,children:e},e))]})]}),t.jsx(b,{className:"md:max-w-[150px] col-span-1",variant:"outlined",color:"secondary",onClick:()=>{F("All"),Y("All"),C("All")},children:"Reset"})]}),t.jsx("div",{className:"capitalize",children:t.jsx(Z,{columns:oe,data:q,pagination:!0,customStyles:te(),noDataComponent:t.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[t.jsx(se,{className:"text-xl"})," No records found."]}),highlightOnHover:!0})})]})},oe=[{name:"S.no",selector:(s,c)=>++c,width:"50px"},{name:"Name",selector:s=>s.name},{name:"From",selector:s=>i(s.From).format("DD MMM, YYYY"),width:"110px"},{name:"Till",selector:s=>i(s.till).format("DD MMM, YYYY"),width:"110px"},{name:"Type",selector:s=>s.type,width:"90px"},{name:"Action",selector:s=>s.action,width:"80px"}];export{ke as default};
