import{g as I,j as t,h as a,A,k as v,l as Y,V as D,R as E,y,c as O,m as N}from"./index-DBKpBzGg.js";import{a as M}from"./index-BVG7apjh.js";import{A as C}from"./index-ZEQGb_Gi.js";const S=async({isPunchIn:u,inp:n,setisload:l,dispatch:r})=>{l(!1);const p={employeeId:n.employeeId,date:a(n.date).toDate()};n.status=="leave"&&(p.reason=n.reason);const i=u?{...p,...n.punchIn?{punchIn:a(n.punchIn).toDate()}:{},status:n.status}:{...p,...n.punchOut?{punchOut:a(n.punchOut).toDate()}:{}},h=u?"/api/checkin":"/api/checkout";try{const c=localStorage.getItem("emstoken"),e=await O.post(h,{...i},{headers:{Authorization:`Bearer ${c}`}});return y.success(e.data.message,{autoClose:1800}),r(N()),!0}catch(c){console.log(c),c.response?y.warn(c.response.data.message,{autoClose:3e3}):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{l(!1)}},T=async({attandanceId:u,setselectedRows:n,setisload:l,dispatch:r})=>{if(!u)return y.warning("Attandance Id is needed");const p="/api/deleteattandence";try{const i=localStorage.getItem("emstoken"),h=await O.post(p,{attandanceId:u},{headers:{Authorization:`Bearer ${i}`}});return y.success(h.data.message,{autoClose:1800}),r(N()),n([]),!0}catch(i){console.log(i),i.response?y.warn(i.response.data.message,{autoClose:2700}):i.request?console.error("No response from server:",i.request):console.error("Error:",i.message)}finally{l(!1)}};function j(u,n,l){var p,i,h;const r=n.find(c=>c._id===u.branchId&&c.defaultsetting===!1);return r?{attendanceRules:(p=r==null?void 0:r.setting)==null?void 0:p.attendanceRules,workingMinutes:(i=r==null?void 0:r.setting)==null?void 0:i.workingMinutes,weeklyOffs:(h=r==null?void 0:r.setting)==null?void 0:h.weeklyOffs}:{attendanceRules:l==null?void 0:l.attendanceRules,workingMinutes:l==null?void 0:l.workingMinutes,weeklyOffs:l==null?void 0:l.weeklyOffs}}const W=({branch:u,company:n,holidaydate:l,minutesinhours:r,canEdit:p,canDelete:i,edite:h,deletee:c})=>[{name:"Name",selector:e=>{var s,d;return(d=(s=e==null?void 0:e.employeeId)==null?void 0:s.userid)==null?void 0:d.name},sortable:!0,minWidth:"180px",cell:e=>{var s,d,m,x,o;return t.jsxs("div",{className:"flex items-center gap-3 ",children:[t.jsx(A,{src:v((s=e==null?void 0:e.employeeId)==null?void 0:s.profileimage,{format:"webp",width:100,height:100}),alt:(d=e==null?void 0:e.employeeId)==null?void 0:d.employeename,children:!((m=e==null?void 0:e.employeeId)!=null&&m.profileimage)&&t.jsx(Y,{})}),t.jsx(D,{children:t.jsx("p",{className:"text-[12px] md:text-[14px] text-gray-700 font-semibold",children:(o=(x=e==null?void 0:e.employeeId)==null?void 0:x.userid)==null?void 0:o.name})})]})}},{name:"Date",selector:e=>e.date,sortable:!0,width:"110px",cell:e=>a(e.date).format("DD MMM, YYYY")},{name:"Punch In",width:"140px",cell:e=>{if(!e.punchIn)return"- : -";const s=j(e,u,n),d=s==null?void 0:s.weeklyOffs.includes(a(e.date).day()),m=l.includes(a(e.date).format("DD/MM/YYYY")),[x,o]=s.attendanceRules.considerEarlyEntryBefore.split(":").map(Number),[f,g]=s.attendanceRules.considerLateEntryAfter.split(":").map(Number),k=a(e.punchIn).startOf("day").add(x,"hour").add(o,"minute"),b=a(e.punchIn).startOf("day").add(f,"hour").add(g,"minute");return t.jsxs("div",{className:"flex w-full items-center gap-1",children:[t.jsx(M,{className:"text-[16px] text-blue-700"}),a(e.punchIn).format("hh:mm A"),!d&&!m&&t.jsxs(t.Fragment,{children:[a(e.punchIn).isBefore(k)&&t.jsx("span",{className:"px-2 py-1 rounded bg-sky-100 text-sky-800",children:"Early"}),a(e.punchIn).isAfter(b)&&t.jsx("span",{className:"px-2 py-1 rounded bg-amber-100 text-amber-800",children:"Late"})]})]})}},{name:"Punch Out",width:"140px",cell:e=>{if(!e.punchOut)return"- : -";const s=j(e,u,n),d=s==null?void 0:s.weeklyOffs.includes(a(e.date).day()),m=l.includes(a(e.date).format("DD/MM/YYYY")),[x,o]=s.attendanceRules.considerEarlyExitBefore.split(":").map(Number),[f,g]=s.attendanceRules.considerLateExitAfter.split(":").map(Number),k=a(e.punchOut).startOf("day").add(x,"hour").add(o,"minute"),b=a(e.punchOut).startOf("day").add(f,"hour").add(g,"minute");return t.jsxs("div",{className:"flex  items-center gap-1",children:[t.jsx(M,{className:"text-[16px] text-blue-700"}),a(e.punchOut).format("hh:mm A"),!d&&!m&&t.jsxs(t.Fragment,{children:[a(e.punchOut).isBefore(k)&&t.jsx("span",{className:"px-2 py-1 rounded bg-amber-100 text-amber-800",children:"Early"}),a(e.punchOut).isAfter(b)&&t.jsx("span",{className:"px-2 py-1 rounded bg-sky-100 text-sky-800",children:"Late"})]})]})}},{name:"Status",width:"100px",cell:e=>{var o;const s=e.status==="absent",d=e.status==="leave",m=e.status==="holiday",x=e.status==="weekly off";return t.jsx("span",{title:d?(o=e==null?void 0:e.leave)==null?void 0:o.reason:"",className:`px-2 py-1 rounded
             ${s?"bg-red-100 text-red-800":d?"bg-amber-100 text-amber-800":m?"bg-blue-50 text-blue-800":x?"bg-gray-50 text-gray-800":"bg-green-100 text-green-800"}`,children:e.status})}},{name:"Working Hours",width:"210px",cell:e=>{var x,o,f,g;const s=j(e,u,n),d=s==null?void 0:s.weeklyOffs.includes(a(e.date).day()),m=l.includes(a(e.date).format("DD/MM/YYYY"));return e.workingMinutes?t.jsxs("div",{children:[t.jsxs("p",{children:[t.jsx("span",{className:"inline-block w-[50px]",children:r(e==null?void 0:e.workingMinutes)}),d||m?t.jsxs("span",{className:"ml-2 px-1 py-1 rounded bg-green-100 text-green-800",children:["Overtime ",e.workingMinutes," min"]}):t.jsxs(t.Fragment,{children:[e.workingMinutes<((x=s==null?void 0:s.workingMinutes)==null?void 0:x.shortDayThreshold)&&t.jsxs("span",{className:"ml-2 px-1 py-1 rounded bg-amber-100 text-amber-800",children:["Short ",((o=s==null?void 0:s.workingMinutes)==null?void 0:o.shortDayThreshold)-e.workingMinutes," min"]}),e.workingMinutes>((f=s==null?void 0:s.workingMinutes)==null?void 0:f.overtimeAfterMinutes)&&t.jsxs("span",{className:"ml-2 p-1 rounded bg-green-100 text-green-800",children:["Overtime ",e.workingMinutes-((g=s==null?void 0:s.workingMinutes)==null?void 0:g.overtimeAfterMinutes)," min"]})]})]}),t.jsx("p",{className:"text-[12px] mt-1 text-gray-600",children:m?"(Holiday)":d?"(Weekly Off)":""})]}):"-"}},{name:"Action",width:"80px",cell:e=>t.jsxs("div",{className:"flex gap-2.5",children:[p&&t.jsx("span",{className:"text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>h(e),children:t.jsx(E,{})}),i&&t.jsx("span",{className:"text-[18px] text-red-500 cursor-pointer",onClick:()=>c(e._id),children:t.jsx(C,{})})]})}],F=()=>({headCells:{style:{backgroundColor:I(n=>n.user.primaryColor)||"#115e59",fontWeight:"bold",fontSize:"14px",color:"white",justifyContent:"flex-start",paddingLeft:"8px",paddingRight:"0px"}},headRow:{style:{borderBottom:"2px solid #ccc"}},rows:{style:{minHeight:"48px",borderBottom:"1px solid #eee"}},cells:{style:{justifyContent:"flex-start",paddingLeft:"8px",paddingRight:"0px"}}});export{W as c,T as d,S as s,F as u};
