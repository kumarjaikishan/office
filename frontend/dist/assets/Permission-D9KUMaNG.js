import{r as d,j as e,ac as R,ad as T,b as E,B as u,a5 as O,aj as ee,ak as _,ab as se,M as A,c as z,y as c}from"./index-CjtMQ1cj.js";const le=()=>{const[v,D]=d.useState([]),[V,b]=d.useState(!1),[p,W]=d.useState(null),[w,M]=d.useState(null),[i,f]=d.useState({roleid:"",modules:{}}),[m,$]=d.useState(""),[x,g]=d.useState(null),[y,I]=d.useState(""),[B,L]=d.useState(null),[k,C]=d.useState(""),a=x,N={1:"Read",2:"Create",3:"Update",4:"Delete"},U=["teal","blue","yellow","red"],S=async()=>{var s,t,l,r;try{const n=localStorage.getItem("emstoken"),o=await z.get("/api/permission",{headers:{Authorization:`Bearer ${n}`}});D((s=o.data)==null?void 0:s.permission),g((t=o.data.permissionnames)==null?void 0:t.AllPermissionNames)}catch(n){console.log(n),c.warn(((r=(l=n.response)==null?void 0:l.data)==null?void 0:r.message)||"Error",{autoClose:3e3})}};d.useEffect(()=>{S()},[]);const F=s=>{W(t=>t===s?null:s)},q=s=>{M(s);const t=Object.fromEntries(Object.entries(s.modules||{}).filter(([l])=>a==null?void 0:a.includes(l)));f({roleid:s._id,modules:{...t}}),b(!0)},G=(s,t)=>{f(l=>{const r=l.modules[s]||[],o=r.includes(t)?r.filter(j=>j!==t):[...r,t].sort();return{...l,modules:{...l.modules,[s]:o}}})},h=a==null?void 0:a.filter(s=>!Object.prototype.hasOwnProperty.call(i.modules,s)),H=()=>{if(!m){c.warn("Please select a module to add");return}if(!(a!=null&&a.includes(m))){c.warn("Invalid module (not allowed)");return}if(i.modules[m]){c.warn("Module already exists");return}f(s=>({...s,modules:{...s.modules,[m]:[]}})),$("")},J=s=>{const t={...i.modules};delete t[s],f(l=>({...l,modules:t}))},Q=async()=>{var s,t;try{const l=Object.fromEntries(Object.entries(i.modules).filter(([o,j])=>(a==null?void 0:a.includes(o))&&j.length>0).map(([o,j])=>[o,[...new Set(j)].sort()])),r=localStorage.getItem("emstoken"),n=await z.put(`/api/permission/${i.roleid}`,{modules:l},{headers:{Authorization:`Bearer ${r}`}});c.success(n.data.message||"Updated successfully",{autoClose:2e3}),b(!1),M(null),S()}catch(l){console.log(l),c.warn(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Update failed",{autoClose:3e3})}},X=()=>{b(!1),M(null)},Y=()=>{if(y.trim()){if(x.includes(y))return alert("Already exists!");g([...x,y.trim()]),I("")}},Z=s=>{const t=[...x];t.splice(s,1),g(t)},K=s=>{if(!k.trim())return;const t=[...x];t[s]=k.trim(),g(t),L(null),C("")},P=async()=>{var s,t;try{const l=localStorage.getItem("emstoken"),r=await z.put("/api/saveModule",{modules:x},{headers:{Authorization:`Bearer ${l}`}});c.success(r.data.message||"Updated successfully",{autoClose:2e3}),S()}catch(l){console.log(l),c.warn(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Update failed",{autoClose:3e3})}};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full my-2 justify-between items-center cursor-pointer border border-amber-400 bg-amber-100 px-4 py-2 rounded-md",onClick:()=>F("module"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Permission Modules"}),p==="module"?e.jsx(R,{className:"text-xl"}):e.jsx(T,{className:"text-xl"})]}),p==="module"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(E,{size:"small",label:"New Module",value:y,onChange:s=>I(s.target.value)}),e.jsx(u,{variant:"contained",onClick:Y,children:"Add"}),e.jsx(u,{variant:"contained",onClick:P,children:"Save Module"})]}),e.jsxs("table",{className:"min-w-full border text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),e.jsx("th",{className:"border p-2 text-center",children:"Action"})]})}),e.jsx("tbody",{children:x.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-1 capitalize",children:B===t?e.jsx(E,{size:"small",value:k,onChange:l=>C(l.target.value)}):s}),e.jsx("td",{className:"border p-1 text-center",children:B===t?e.jsx(u,{variant:"contained",size:"small",onClick:()=>K(t),children:"Save"}):e.jsxs(e.Fragment,{children:[e.jsx(O,{color:"primary",onClick:()=>{L(t),C(s)},children:e.jsx(ee,{})}),e.jsx(O,{color:"error",onClick:()=>Z(t),children:e.jsx(_,{})})]})})]},t))})]})]})]}),e.jsx("div",{className:"flex flex-col",children:v==null?void 0:v.map((s,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:`flex w-full my-2 justify-between items-center cursor-pointer border-dashed border border-${U[t]}-600 bg-${U[t]}-100 px-4 py-2 rounded-md`,onClick:()=>F(s.role),children:[e.jsx("span",{className:"font-semibold capitalize text-[16px] md:text-lg text-left",children:s.role}),p===`${s.role}`?e.jsx(R,{className:"text-xl"}):e.jsx(T,{className:"text-xl"})]}),p===`${s.role}`&&e.jsxs("div",{className:"p-1 rounded border-teal-300 border-2 border-dashed mt-2",children:[e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(u,{variant:"contained",onClick:()=>q(s),sx:{mr:2},children:"Edit"})}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(N).map(l=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:l},l))]})}),e.jsx("tbody",{children:Object.entries(s.modules).map(([l,r])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:l}),Object.keys(N).map(n=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:r.includes(Number(n))?"âœ…":"-"},n))]},l))})]})]})]},s._id))}),e.jsx(se,{open:V,onClose:()=>b(!1),children:e.jsx("div",{className:"membermodal w-[680px]",children:e.jsxs("form",{action:"",children:[e.jsxs("h2",{className:"font-bold text-lg mb-3",children:["Edit Permission - ",w==null?void 0:w.role]}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex gap-2 mb-3 items-center",children:[e.jsx(E,{select:!0,size:"small",label:"Add Module",value:m,onChange:s=>$(s.target.value),sx:{minWidth:200},children:(h==null?void 0:h.length)===0?e.jsx(A,{disabled:!0,value:"",children:"No modules available"}):h==null?void 0:h.map(s=>e.jsx(A,{value:s,className:"capitalize",children:s},s))}),e.jsx(u,{variant:"contained",onClick:H,disabled:!m,children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(N).map(([s,t])=>e.jsx("th",{className:"border p-2 text-center",children:t},s)),e.jsx("th",{className:"border p-2 text-center",children:"Action"})]})}),e.jsx("tbody",{children:Object.keys(i.modules).sort((s,t)=>(a==null?void 0:a.indexOf(s))-(a==null?void 0:a.indexOf(t))).map(s=>{const t=i.modules[s]||[];return e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:s}),Object.keys(N).map(l=>e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:"h-3 w-3 md:h-5 md:w-5 cursor-pointer",type:"checkbox",checked:t.includes(Number(l)),onChange:()=>G(s,Number(l))})},l)),e.jsx("td",{className:"border text-center",children:e.jsx(O,{color:"error",size:"small",onClick:()=>J(s),children:e.jsx(_,{})})})]},s)})})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(u,{variant:"outlined",onClick:X,children:"Cancel"}),e.jsx(u,{variant:"contained",onClick:Q,children:"Save"})]})]})]})})})]})};export{le as default};
