import{b1 as O,r as x,b2 as w,j as s,t as L,b3 as $,b4 as T,b5 as U,b6 as _,b7 as Y,w as q,n as G,b8 as H,b9 as D,q as Q,o as X,h as J,A as K,k as W,a3 as Z,T as ee,B as I,aQ as se,a as te,g as ae,c as z,y as E,b as ne,i as V,a7 as le,F as re,I as oe,S as ie,M as R,O as ce,C as de,aa as ue}from"./index-DGVhX1ER.js";import{u as me}from"./attandencehelper-D3VrMwgc.js";import{c as pe,d as he,e as ye,a as fe}from"./index-DWsE98Ao.js";import{u as xe}from"./useThemeProps-CuizRZM6.js";import"./index-CDvakZKj.js";const ge=O(),je=H(),ve=ge("div",{name:"MuiStack",slot:"Root"});function be(a){return xe({props:a,name:"MuiStack",defaultTheme:je})}function Se(a,d){const l=x.Children.toArray(a).filter(Boolean);return l.reduce((e,i,o)=>(e.push(i),o<l.length-1&&e.push(x.cloneElement(d,{key:`separator-${o}`})),e),[])}const Ce=a=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[a],ke=({ownerState:a,theme:d})=>{let l={display:"flex",flexDirection:"column",...$({theme:d},T({values:a.direction,breakpoints:d.breakpoints.values}),e=>({flexDirection:e}))};if(a.spacing){const e=U(d),i=Object.keys(d.breakpoints.values).reduce((r,n)=>((typeof a.spacing=="object"&&a.spacing[n]!=null||typeof a.direction=="object"&&a.direction[n]!=null)&&(r[n]=!0),r),{}),o=T({values:a.direction,base:i}),u=T({values:a.spacing,base:i});typeof o=="object"&&Object.keys(o).forEach((r,n,y)=>{if(!o[r]){const b=n>0?o[y[n-1]]:"column";o[r]=b}}),l=_(l,$({theme:d},u,(r,n)=>a.useFlexGap?{gap:D(e,r)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Ce(n?o[n]:a.direction)}`]:D(e,r)}}))}return l=Y(d.breakpoints,l),l};function Ie(a={}){const{createStyledComponent:d=ve,useThemeProps:l=be,componentName:e="MuiStack"}=a,i=()=>q({root:["root"]},r=>G(e,r),{}),o=d(ke);return x.forwardRef(function(r,n){const y=l(r),v=w(y),{component:b="div",direction:g="column",spacing:M=0,divider:j,children:S,className:P,useFlexGap:C=!1,...N}=v,B={direction:g,spacing:M,useFlexGap:C},t=i();return s.jsx(o,{as:b,ownerState:B,ref:n,className:L(t.root,P),...N,children:j?Se(S,j):S})})}const Pe=Ie({createStyledComponent:Q("div",{name:"MuiStack",slot:"Root"}),useThemeProps:a=>X({props:a,name:"MuiStack"})}),Ne=(a,d,l)=>[{name:"S.no",selector:(e,i)=>i+1,width:"60px"},{name:"Employee",selector:e=>{var i,o,u,p,r,n,y;return s.jsxs("div",{className:"flex items-center capitalize gap-3 ",children:[s.jsx(K,{src:W((i=e==null?void 0:e.employeeId)==null?void 0:i.profileimage,{format:"webp",width:100,height:100})||employepic,alt:(u=(o=e==null?void 0:e.employeeId)==null?void 0:o.userid)==null?void 0:u.name,children:!((p=e==null?void 0:e.employeeId)!=null&&p.profileimage)&&employepic}),s.jsxs(Z,{children:[s.jsx(ee,{variant:"body2",children:(n=(r=e==null?void 0:e.employeeId)==null?void 0:r.userid)==null?void 0:n.name}),s.jsxs("p",{className:"t text-[10px] text-gray-600",children:["(",(y=e==null?void 0:e.employeeId)==null?void 0:y.designation,")"]})]})]})},sortable:!0},{name:"Month",selector:e=>J(`${e.year}-${e.month}-01`).format("MM-YYYY")},{name:"Department",selector:e=>e.department,width:"120px"},{name:"Status",selector:e=>e.status,width:"120px"},{name:"Actions",cell:e=>s.jsxs(Pe,{direction:"row",spacing:1,children:[s.jsx(I,{size:"small",variant:"outlined",startIcon:s.jsx(pe,{}),onClick:()=>a(e),children:"View"}),s.jsx(I,{size:"small",variant:"outlined",color:"primary",startIcon:s.jsx(he,{}),onClick:()=>d(e),children:"Edit"}),s.jsx(I,{size:"small",variant:"outlined",color:"error",startIcon:s.jsx(ye,{}),onClick:()=>l(e._id),children:"Delete"})]}),width:"300px"}];function Fe(){const{employeeId:a}=se(),[d,l]=x.useState(!0),[e,i]=x.useState(null),[o,u]=x.useState(null);let p=te();const r=me(),[n,y]=x.useState({searchText:"",branch:"all",department:"all"}),{employee:v,leaveBalance:b,branch:g,department:M}=ae(t=>t.user);x.useEffect(()=>{j()},[]);const j=async()=>{var t,f,h;try{l(!0),u(null);const c=localStorage.getItem("emstoken"),m=await z.get("/api/payroll",{headers:{Authorization:`Bearer ${c}`}});i((t=m==null?void 0:m.data)==null?void 0:t.payrolls)}catch(c){console.log(c),c.response?(u(((h=(f=c.response)==null?void 0:f.data)==null?void 0:h.message)||"Failed to create payroll"),E.warn(c.response.data.message,{autoClose:1200})):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{l(!1)}},S=t=>{p(`/dashboard/payroll/print/${t._id}`)},P=t=>{p(`/dashboard/payroll/edit/${t._id}`)},C=(t,f)=>{y(h=>({...h,[t]:f}))},N=e==null?void 0:e.filter(t=>{var k,A,F;const f=((F=(A=(k=t.employeeId)==null?void 0:k.userid)==null?void 0:A.name)==null?void 0:F.toLowerCase())||"",h=t.branchId||"",c=n.searchText.trim()===""||f.includes(n.searchText.toLowerCase()),m=n.branch==="all"||h===n.branch;return c&&m}),B=async t=>{swal({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async f=>{var h,c;if(f)try{l(!0),u(null);const m=localStorage.getItem("emstoken"),k=await z.delete(`/api/payroll/${t}`,{headers:{Authorization:`Bearer ${m}`}});E.success(k.data.message||"Successfull deleted"),j()}catch(m){console.error(m),u(((c=(h=m.response)==null?void 0:h.data)==null?void 0:c.message)||"Failed to fetch payroll"),E.warn("Using dummy payroll data for testing",{autoClose:1500}),i(v)}finally{l(!1)}})};return e?s.jsxs("div",{className:"w-full mx-auto p-1 md:p-4",children:[s.jsxs("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[s.jsx(ne,{size:"small",className:"w-[100%] md:w-[160px]",value:n.searchText,onChange:t=>C("searchText",t.target.value),InputProps:{startAdornment:s.jsx(V,{position:"start",children:s.jsx(le,{})})},label:"Search Employee"}),s.jsxs(re,{size:"small",className:"w-[47%] md:w-[160px]",children:[s.jsx(oe,{children:"Branch"}),s.jsxs(ie,{label:"Branch",value:n.branch,input:s.jsx(ce,{startAdornment:s.jsx(V,{position:"start",children:s.jsx(de,{fontSize:"small"})}),label:"Branch"}),onChange:t=>C("branch",t.target.value),children:[s.jsx(R,{value:"all",children:"All"}),g==null?void 0:g.map(t=>s.jsx(R,{value:t._id,children:t.name},t._id))]})]})]}),s.jsx("div",{className:"w-full md:w-fit",children:s.jsx(I,{size:"small",className:"w-full md:w-fit",onClick:()=>{p("/dashboard/payroll/add")},variant:"contained",children:" Add Payroll"})})]}),s.jsx("div",{children:s.jsx(ue,{columns:Ne(S,P,B),data:N,pagination:!0,customStyles:r,highlightOnHover:!0,paginationPerPage:20,paginationRowsPerPageOptions:[20,50,100,300],noDataComponent:s.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[s.jsx(fe,{className:"text-xl"})," No Employee records found."]})})})]}):s.jsx("p",{className:"p-4 text-gray-500",children:"No payroll data found"})}export{Fe as default};
