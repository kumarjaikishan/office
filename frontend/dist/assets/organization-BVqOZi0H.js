import{r as g,o as Ie,af as Te,p as me,q as Ae,t as Me,T as K,j as e,w as De,ag as Ee,ah as ee,ai as ge,u as ie,g as xe,b as x,F as G,I as Q,S as Y,M as U,A as re,l as Ne,O as ne,a3 as ae,B as I,c as W,y as N,D as J,a1 as fe,a4 as ze,i as Pe,C as Be,aa as Ce,ab as oe,aj as $e,a2 as Oe,ak as Le,ac as _,ad as q,k as We,h as Fe,al as Re,am as _e,a5 as ue,an as qe,ao as je}from"./index-Pg75Vhzw.js";import{C as te}from"./Checkbox-BkcMNF1w.js";import{F as Ue}from"./FormControlLabel-Bu6T5nCI.js";import{u as ke,I as be}from"./attandencehelper-D55s2G7x.js";import{A as pe,a as He}from"./index-C5nEon1W.js";import{u as Se}from"./imageresizer-D4I-KFLq.js";import"./SwitchBase-CmY2R-f9.js";const Ve=n=>{const{classes:f,inset:C,primary:m,secondary:c,dense:w}=n;return De({root:["root",C&&"inset",w&&"dense",m&&c&&"multiline"],primary:["primary"],secondary:["secondary"]},Ee,f)},Je=Ae("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(n,f)=>{const{ownerState:C}=n;return[{[`& .${ee.primary}`]:f.primary},{[`& .${ee.secondary}`]:f.secondary},f.root,C.inset&&f.inset,C.primary&&C.secondary&&f.multiline,C.dense&&f.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${ge.root}:where(& .${ee.primary})`]:{display:"block"},[`.${ge.root}:where(& .${ee.secondary})`]:{display:"block"},variants:[{props:({ownerState:n})=>n.primary&&n.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:n})=>n.inset,style:{paddingLeft:56}}]}),le=g.forwardRef(function(f,C){const m=Ie({props:f,name:"MuiListItemText"}),{children:c,className:w,disableTypography:d=!1,inset:v=!1,primary:O,primaryTypographyProps:S,secondary:p,secondaryTypographyProps:F,slots:k={},slotProps:r={},...y}=m,{dense:$}=g.useContext(Te);let B=O??c,T=p;const l={...m,disableTypography:d,inset:v,primary:!!B,secondary:!!T,dense:$},u=Ve(l),h={slots:k,slotProps:{primary:S,secondary:F,...r}},[j,z]=me("root",{className:Me(u.root,w),elementType:Je,externalForwardedProps:{...h,...y},ownerState:l,ref:C}),[A,i]=me("primary",{className:u.primary,elementType:K,externalForwardedProps:h,ownerState:l}),[L,M]=me("secondary",{className:u.secondary,elementType:K,externalForwardedProps:h,ownerState:l});return B!=null&&B.type!==K&&!d&&(B=e.jsx(A,{variant:$?"body2":"body1",component:i!=null&&i.variant?void 0:"span",...i,children:B})),T!=null&&T.type!==K&&!d&&(T=e.jsx(L,{variant:"body2",color:"textSecondary",...M,children:T})),e.jsxs(j,{...z,children:[B,T]})}),ye=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Ye=({setopenviewmodal:n,employee:f,company:C,editbranch:m,editbranchdata:c})=>{const w={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[d,v]=g.useState(w),O=ie(),{adminManager:S}=xe(l=>l.user),[p,F]=g.useState([]),k=localStorage.getItem("emstoken");g.useEffect(()=>{v(l=>({...l,companyId:C._id})),m&&v(l=>({...l,...c}))},[C,m]),g.useEffect(()=>{(S==null?void 0:S.length)>0&&F(S.filter(l=>l.role==="manager"))},[S]);const r=()=>{n(!1),v(w)},y=(l,u)=>{v(h=>({...h,[l]:u}))},$=(l,u,h)=>{v(j=>({...j,setting:{...j.setting,[l]:{...j.setting[l],[u]:h}}}))},B=async()=>{var l,u;try{const h=await W.post("/api/addBranch",d,{headers:{Authorization:`Bearer ${k}`}});N.success(h.data.message),n(!1),O(J()),r()}catch(h){console.error(h),N.error(((u=(l=h==null?void 0:h.response)==null?void 0:l.data)==null?void 0:u.message)||"Error adding branch")}},T=async()=>{var l,u;try{const h=await W.post("/api/editBranch",d,{headers:{Authorization:`Bearer ${k}`}});N.success(h.data.message),O(J()),n(!1),r()}catch(h){console.error(h),N.error(((u=(l=h==null?void 0:h.response)==null?void 0:l.data)==null?void 0:u.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:m?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(x,{label:"Branch Name",fullWidth:!0,size:"small",value:d.name,onChange:l=>y("name",l.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(x,{label:"Location",fullWidth:!0,size:"small",value:d.location,onChange:l=>y("location",l.target.value),helperText:"City, State or Address"}),e.jsxs(G,{size:"small",fullWidth:!0,children:[e.jsx(Q,{children:"Managers"}),e.jsx(Y,{multiple:!0,value:(d==null?void 0:d.managerIds)||[],onChange:l=>y("managerIds",l.target.value),input:e.jsx(ne,{label:"Managers"}),renderValue:l=>l.map(u=>{var h;return((h=p.find(j=>j._id===u))==null?void 0:h.name)||"Unknown"}).join(", "),children:p&&p.length>0?p.map(l=>{var u;return e.jsxs(U,{value:l._id,children:[e.jsx(te,{checked:(u=d==null?void 0:d.managerIds)==null?void 0:u.includes(l._id)}),e.jsx(re,{src:l==null?void 0:l.profileImage,alt:l==null?void 0:l.name,children:!(l!=null&&l.profileImage)&&e.jsx(Ne,{})}),e.jsx(le,{className:"ml-2 capitalize",primary:l==null?void 0:l.name})]},l._id)}):e.jsx(U,{disabled:!0,value:"",children:e.jsx(le,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(Ue,{control:e.jsx(te,{checked:!d.defaultsetting,onChange:l=>v(u=>({...u,defaultsetting:!l.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!d.defaultsetting&&e.jsx("div",{className:"border-primary border-2 border-dashed rounded mt-3 py-3 px-1",children:e.jsxs(ae,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(x,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:l=>$("officeTime","in",l.target.value),helperText:"Time when office hours begin"}),e.jsx(x,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:l=>$("officeTime","out",l.target.value),helperText:"Time when office hours end"}),e.jsx(x,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.officeTime.breakMinutes,onChange:l=>$("officeTime","breakMinutes",Number(l.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(x,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.fullDay,onChange:l=>$("workingMinutes","fullDay",Number(l.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(x,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.halfDay,onChange:l=>$("workingMinutes","halfDay",Number(l.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(x,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.shortDayThreshold,onChange:l=>$("workingMinutes","shortDayThreshold",Number(l.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(x,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.overtimeAfterMinutes,onChange:l=>$("workingMinutes","overtimeAfterMinutes",Number(l.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(G,{size:"small",fullWidth:!0,children:[e.jsx(Q,{children:"Weekly Offs"}),e.jsx(Y,{multiple:!0,value:d.setting.weeklyOffs,onChange:l=>v(u=>({...u,setting:{...u.setting,weeklyOffs:l.target.value}})),input:e.jsx(ne,{label:"Weekly Offs"}),renderValue:l=>l.map(u=>{var h;return(h=ye.find(j=>j.value===u))==null?void 0:h.label}).join(", "),children:ye.map(l=>e.jsxs(U,{value:l.value,children:[e.jsx(te,{checked:d.setting.weeklyOffs.includes(l.value)}),e.jsx(le,{primary:l.label})]},l.value))})]}),Object.entries(d.setting.attendanceRules).map(([l,u])=>{const h=l.replace(/([A-Z])/g," $1").replace(/^./,z=>z.toUpperCase()),j={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(x,{fullWidth:!0,size:"small",label:h,type:"time",value:u,onChange:z=>v(A=>({...A,setting:{...A.setting,attendanceRules:{...A.setting.attendanceRules,[l]:z.target.value}}})),helperText:j[l]},l)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:r,children:"Cancel"}),m?e.jsx(I,{variant:"contained",onClick:T,children:"Save"}):e.jsx(I,{variant:"contained",onClick:B,children:"Add Branch"})]})]})},Ze=async({companyinp:n,setisload:f})=>{const C=localStorage.getItem("emstoken");f(!0);try{const m=await W.post("/api/addcompany",{name:n.name,industry:n.industry},{headers:{Authorization:`Bearer ${C}`}});console.log("Query:",m),N.success(m.data.message,{autoClose:1200})}catch(m){console.log(m),m.response?N.warn(m.response.data.message,{autoClose:1200}):m.request?console.error("No response from server:",m.request):console.error("Error:",m.message)}finally{f(!1)}},Ge=[{name:"S.no",selector:n=>n.sno,width:"40px"},{name:"Branch",selector:n=>n.branch},{name:"Department",selector:n=>n.dep_name},{name:"Action",selector:n=>n.action,width:"80px"}],Qe=async({inp:n,setisload:f,setInp:C,setopenmodal:m,init:c,dispatch:w})=>{console.log(n);const{branchId:d,department:v,description:O}=n;if(!v){alert("Please fill in both fields");return}const S=localStorage.getItem("emstoken");f(!0);try{const p=await W.post("/api/adddepartment",{department:v,branchId:d,description:O},{headers:{Authorization:`Bearer ${S}`}});w(J()),N.success(p.data.message,{autoClose:1200}),C(c),m(!1)}catch(p){console.log(p),p.response?N.warn(p.response.data.message,{autoClose:1200}):p.request?console.error("No response from server:",p.request):console.error("Error:",p.message)}finally{f(!1)}},Xe=async({inp:n,setisload:f,setInp:C,setopenmodal:m,init:c,dispatch:w})=>{const{departmentId:d,department:v,description:O}=n;if(!v||!d){alert("All fileds are Required");return}const S=localStorage.getItem("emstoken");f(!0);try{const p=await W.post("/api/updatedepartment",{departmentId:d,department:v,description:O},{headers:{Authorization:`Bearer ${S}`}});w(J()),N.success(p.data.message,{autoClose:1200}),C(c),m(!1)}catch(p){console.log(p),p.response?N.warn(p.response.data.message,{autoClose:1200}):p.request?console.error("No response from server:",p.request):console.error("Error:",p.message)}finally{f(!1)}},Ke=async({departmentId:n,setisload:f,dispatch:C})=>{if(!n){alert("All fileds are Required");return}const m=localStorage.getItem("emstoken");f(!0);try{const c=await W.post("/api/deletedepartment",{departmentId:n},{headers:{Authorization:`Bearer ${m}`}});C(J()),N.success(c.data.message,{autoClose:1200})}catch(c){console.log(c),c.response?N.warn(c.response.data.message,{autoClose:1200}):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{f(!1)}},es=()=>{const[n,f]=g.useState(!1),[C,m]=g.useState(!1),[c,w]=g.useState([]),[d,v]=g.useState(!1),[O,S]=g.useState([]),{branch:p,department:F}=xe(i=>i.user),[k,r]=g.useState({branch:"all",department:" "}),y=k.branch!=="all"||k.department.trim()!=="",$=ie();g.useEffect(()=>{if(!c||c.length===0)return;const i=c.filter(L=>{var R;const M=k.branch==="all"||L.branchid===k.branch,H=k.department.trim()===""||((R=L.dep_name)==null?void 0:R.toLowerCase().includes(k.department.trim().toLowerCase()));return M&&H});S(i)},[k,c]);const B={departmentId:"",branchId:"",department:"",description:""},[T,l]=g.useState(B);g.useEffect(()=>{if(F.length>0){let i=1;const L=F.map(M=>{var H,R;return{id:M._id,sno:i++,branchid:(H=M==null?void 0:M.branchId)==null?void 0:H._id,branch:(R=M==null?void 0:M.branchId)==null?void 0:R.name,dep_name:M==null?void 0:M.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>j(M),children:e.jsx(fe,{})}),e.jsx("span",{className:"delete",onClick:()=>z(M._id),children:e.jsx(pe,{})})]})}});w(L)}},[F]);const u=(i,L)=>{l({...T,[L]:i.target.value})},h=i=>{i.preventDefault(),Qe({inp:T,setisload:m,setInp:l,setopenmodal:f,init:B,dispatch:$})},j=i=>{console.log("edit",i),v(!0),l({branchId:i.branchId._id,departmentId:i._id,department:i.department,description:i.description}),f(!0)},z=i=>{console.log("delete",i),ze({title:"Are you sure?",text:"Once deleted, All empoyee of this department deleted",icon:"warning",buttons:!0,dangerMode:!0}).then(async L=>{L&&Ke({departmentId:i,setisload:m,dispatch:$})})},A=()=>{Xe({inp:T,setisload:m,setInp:l,setopenmodal:f,init:B,dispatch:$})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(G,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(Q,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(Y,{value:k.branch,onChange:i=>r({...k,branch:i.target.value}),input:e.jsx(ne,{startAdornment:e.jsx(Pe,{position:"start",children:e.jsx(Be,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(U,{selected:!0,value:"all",children:"All"}),p==null?void 0:p.map(i=>e.jsx(U,{value:i._id,children:i.name},i._id))]})]}),e.jsx(x,{size:"small",id:"outlined-basic",value:k.department,onChange:i=>r({...k,department:i.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(I,{className:"w-full md:w-auto",variant:"contained",onClick:()=>f(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(Ce,{customStyles:ke(),columns:Ge,data:y?O:c,pagination:!0,highlightOnHover:!0})}),e.jsx(oe,{open:n,onClose:()=>f(!1),children:e.jsx("div",{className:"membermodal w-[650px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Add Department"}),e.jsx("form",{onSubmit:h,children:e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs(G,{sx:{width:"98%"},size:"small",children:[e.jsx(Q,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(Y,{value:T.branchId,label:"branch",onChange:i=>u(i,"branchId"),children:p==null?void 0:p.map(i=>e.jsx(U,{value:i._id,children:i.name},i._id))})]}),e.jsx(x,{sx:{width:"98%"},required:!0,value:T.department,onChange:i=>u(i,"department"),label:"Department",size:"small"}),e.jsx(x,{multiline:!0,rows:4,onChange:i=>u(i,"description"),value:T.description,sx:{width:"98%"},label:"Description",size:"small"})]})})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{size:"small",onClick:()=>{f(!1),v(!1),l(B)},variant:"outlined",children:" cancel"}),!d&&e.jsx(I,{sx:{mr:2},loading:C,loadingPosition:"end",endIcon:e.jsx(be,{}),onClick:h,variant:"contained",type:"submit",children:"Add"}),d&&e.jsx(I,{sx:{mr:2},loading:C,loadingPosition:"end",endIcon:e.jsx(be,{}),variant:"contained",onClick:A,children:"Update"})]})]})})})]})},se={1:"Read",2:"Create",3:"Update",4:"Delete"},ve=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],he={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},ss={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function as(){const[n,f]=g.useState([]),[C,m]=g.useState([]),[c,w]=g.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...he}}),d=ie();g.useEffect(()=>{i()},[]);const v=g.useRef(null),{handleImage:O}=Se(),[S,p]=g.useState(null),[F,k]=g.useState(!1),[r,y]=g.useState(""),[$,B]=g.useState(!1),[T,l]=g.useState(null),u=s=>{l(t=>t===s?null:s)},h=()=>{w({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...he}}),y(""),p(null),k(!1)},[j,z]=g.useState({userid:"",pass:""}),A=async()=>{const s={...c},t=new FormData;m(!0);try{const o=s.profileImage?await O(240,s.profileImage):null;o&&t.append("photo",o),t.append("name",s.name),t.append("email",s.email),t.append("role",s.role),t.append("password",s.password),t.append("permissions",JSON.stringify(s.permissions));const b=localStorage.getItem("emstoken");m(!0);const P=S!==null?`/api/editAdmin/${n[S]._id}`:"/api/addAdmin",E=await W["post"](P,t,{headers:{Authorization:`Bearer ${b}`,"Content-Type":"multipart/form-data"}});N.success(E.data.message,{autoClose:1200}),h(),i(),d(J())}catch(o){console.error(o),o.response?N.warn(o.response.data.message,{autoClose:1200}):N.error("Something went wrong",{autoClose:1200})}finally{m(!1)}},i=async()=>{try{const s=localStorage.getItem("emstoken");m(!0);const t=await W.get("/api/getAdmin",{headers:{Authorization:`Bearer ${s}`}});f(t.data)}catch(s){console.error(s),s.response?N.warn(s.response.data.message,{autoClose:1200}):N.error("Something went wrong",{autoClose:1200})}finally{m(!1)}},L=s=>{const t=n[s];console.log(t),w({...t,profilePreview:t.profileImage||"",profileImage:null}),p(s),k(!0)},M=async s=>{s.preventDefault();try{const t=localStorage.getItem("emstoken"),o=await W.post("/api/updatepassword",{pass:j},{headers:{Authorization:`Bearer ${t}`}});z({userid:"",pass:""}),B(!1),N.success(o.data.message,{autoClose:1200})}catch(t){console.log(t),t.response?N.warn(t.response.data.message,{autoClose:1200}):t.request?console.error("No response from server:",t.request):console.error("Error:",t.message)}},H=async s=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async t=>{var o,b;if(t){let P;try{const D=localStorage.getItem("emstoken");m(!0),P=N.loading("Deleting...");const E=await W.delete(`/api/deleteAdmin/${s}`,{headers:{Authorization:`Bearer ${D}`}});N.update(P,{render:E.data.message,type:"success",isLoading:!1,autoClose:1800}),i(),d(J())}catch(D){console.error(D),N.update(P,{render:((b=(o=D.response)==null?void 0:o.data)==null?void 0:b.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{m(!1)}}})},R=(s,t)=>{w(o=>{const b=o.permissions[s]||[],D=b.includes(t)?b.filter(E=>E!==t):[...b,t].sort();return{...o,permissions:{...o.permissions,[s]:D}}})},de=s=>{const t=s==="admin"?{...he}:{...ss};w({...c,role:s,permissions:t})},ce=s=>{const t=s.target.files[0];t&&w(o=>({...o,profileImage:t,profilePreview:URL.createObjectURL(t)}))},X=()=>{r&&(w(s=>({...s,permissions:{...s.permissions,[r]:[]}})),y(""))},Z=Array.from(new Set([...c.role==="admin"?ve:Object.keys(c.permissions),...Object.keys(c.permissions)])),a=ve.filter(s=>!Z.includes(s));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:" shadow-md rounded-lg",children:[e.jsx("div",{className:"flex justify-between flex-wrap items-center mb-4",children:e.jsx(I,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{h(),k(!0)},children:"Add Admin/ Manager"})}),n.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:n.map((s,t)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(re,{sx:{width:60,height:60},alt:s.name,src:s==null?void 0:s.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[s.name," (",s.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:s.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{title:"Edit",className:"p-2 border rounded hover:bg-gray-100",onClick:()=>L(t),children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx("button",{title:"Password Reset",className:"p-2 border rounded hover:bg-gray-100 text-green-500",onClick:()=>{z({...j,userid:s._id}),B(!0)},children:e.jsx(Oe,{className:"h-4 w-4 "})}),e.jsx("button",{title:"Delete",className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>H(s._id),children:e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>u(t),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",T===t?"Hide Permissions":"View Permissions "]}),T===t?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),T===t&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(se).map(o=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:o},o))]})}),e.jsx("tbody",{children:Object.entries(s.permissions).map(([o,b])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:o}),Object.keys(se).map(P=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:b.includes(Number(P))?"✅":"-"},P))]},o))})]})]})]})]},t))})]}),e.jsx(oe,{open:F,onClose:()=>k(!1),children:e.jsx("div",{className:"membermodal w-[660px]",children:e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"modalhead",children:[" ",S!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-full",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:ce,ref:v,accept:"image/*",name:"",id:"fileInput"}),e.jsx(re,{sx:{width:70,height:70},alt:c.name,src:c.profilePreview}),e.jsx("span",{onClick:()=>v.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(fe,{size:18})})]}),e.jsx(x,{fullWidth:!0,required:!0,value:c.name,onChange:s=>w({...c,name:s.target.value}),label:"Name",size:"small"}),e.jsx(x,{fullWidth:!0,required:!0,value:c.email,onChange:s=>w({...c,email:s.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),S==null&&e.jsxs(e.Fragment,{children:[e.jsx(x,{fullWidth:!0,required:!0,value:c.password,type:"password",onChange:s=>w({...c,password:s.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:c.role,onChange:s=>de(s.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]})]}),c.role==="manager"&&e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border p-2 flex-3 rounded ",value:r,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),a.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(I,{variant:"contained",onClick:X,className:"flex-1",children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(se).map(([s,t])=>e.jsx("th",{className:"border p-2 text-center",children:t},s))]})}),e.jsx("tbody",{children:Z.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:s}),Object.keys(se).map(t=>{var o;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((o=c.permissions[s])==null?void 0:o.includes(Number(t)))||!1,onChange:()=>R(s,Number(t))})},t)})]},s))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:h,children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:A,loading:C,children:S!==null?"Update":"Create"})]})]})})}),e.jsx(oe,{open:$,onClose:()=>{B(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:M,children:[e.jsx("h2",{children:"Reset Passowrd"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(x,{fullWidth:!0,inputProps:{minLength:3,maxLength:10},required:!0,value:j.pass,onChange:s=>z({...j,pass:s.target.value}),label:"Passowrd",size:"small"}),e.jsx(I,{variant:"contained",sx:{mr:2},type:"submit",children:"Reset Password"})]})]})})})]})}const we=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function cs(){var X,Z;const[n,f]=g.useState(null),[C,m]=g.useState(!1),[c,w]=g.useState(!1),[d,v]=g.useState(!1),{handleImage:O}=Se(),[S,p]=g.useState(null),[F,k]=g.useState(!1),[r,y]=g.useState({name:"",address:"",contact:"",fullname:"",deviceSN:"",devices:[{SN:"BJ2C194460597",name:"Head Branch",online:!1}],telegram:{token:"",groupId:""},telegramNotifcation:!1,officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"},payrollPolicies:{allowances:[],bonuses:[],deductions:[]}}),$=()=>{y({...r,devices:[...r.devices,{SN:"",name:"",online:!1}]})},B=a=>{swal({title:"Delete this device?",icon:"warning",buttons:!0,dangerMode:!0}).then(s=>{if(s){const t=r.devices.filter((o,b)=>b!==a);y({...r,devices:t})}})},T=ie(),{employee:l,company:u,branch:h,profile:j}=xe(a=>a.user),z=a=>{f(s=>s===a?null:a)};g.useEffect(()=>{u&&y(u)},[u]);const A=(a,s,t)=>{y(o=>({...o,[a]:{...o[a],[s]:t}}))},i=async a=>{a.preventDefault();try{v(!0);const s=localStorage.getItem("emstoken"),t=await W.post("/api/updateCompany",{...r},{headers:{Authorization:`Bearer ${s}`}});T(J()),N.success(t.data.message,{autoClose:1800})}catch(s){console.log(s),s.response?N.warn(s.response.data.message,{autoClose:2700}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{v(!1)}},L=()=>{},M=a=>{var t;m(!0);const s={...a,managerIds:(t=a==null?void 0:a.managerIds)==null?void 0:t.map(o=>o._id)};p(s),w(!0)},H=ke(),R=a=>a?Date.now()-new Date(a).getTime()<6e4:!1,de=async a=>{const s=`/api/refreshDevice/${a}`;try{k(!0);const t=localStorage.getItem("emstoken"),o=await W.get(s,{headers:{Authorization:`Bearer ${t}`}});y(b=>({...b,devices:o.data.devices}))}catch(t){console.log(t),t.response?N.warn(t.response.data.message,{autoClose:2700}):t.request?console.error("No response from server:",t.request):console.error("Error:",t.message)}finally{k(!1)}},ce=async()=>{try{const a=await W.get(`https://api.telegram.org/bot${r.telegram.token}/getUpdates`);if(a.data.result.length>0){let s={},{id:t,title:o,type:b}=a.data.result[0].message.chat,P={id:t,title:o,type:b};a.data.result.forEach(D=>{var E;if((E=D.message)!=null&&E.from){let V=D.message.from.id;s.hasOwnProperty(V)||(s[V]={name:D.message.from.first_name,username:D.message.from.username||""})}}),console.log(P),console.log(s)}}catch(a){console.log(a)}};return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(j==null?void 0:j.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>z("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),n==="company"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("div",{className:` 
                          rounded overflow-hidden transition-all duration-300 
                          ${n==="company"?"max-h-fit p-0 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsxs("div",{className:"p-1 md:p-4 rounded  flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[r!=null&&r.logo?e.jsx("img",{src:We(r.logo,{format:"webp",width:200,height:200}),alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(He,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async a=>{const s=a.target.files[0];if(!s)return;const t=await O(300,s),o=new FormData;o.append("_id",r._id),o.append("logo",t);try{v(!0);const b=localStorage.getItem("emstoken"),D=(await W.post("/api/updateCompany",o,{headers:{Authorization:`Bearer ${b}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;y(E=>({...E,logo:D})),N.success("Logo uploaded successfully!")}catch(b){console.error(b),N.error("Failed to upload logo.")}finally{v(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(x,{label:"Company Name",size:"small",variant:"standard",fullWidth:!0,value:(r==null?void 0:r.name)||"",onChange:a=>y({...r,name:a.target.value})})}),e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(x,{label:"Contact",type:"tel",variant:"standard",size:"small",fullWidth:!0,value:(r==null?void 0:r.contact)||"",inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},onChange:a=>y({...r,contact:a.target.value.replace(/\D/g,"")})})})]}),e.jsx("div",{children:e.jsx(x,{label:"Company Full Name",variant:"standard",fullWidth:!0,size:"small",value:(r==null?void 0:r.fullname)||"",onChange:a=>y({...r,fullname:a.target.value})})}),e.jsx("div",{children:e.jsx(x,{label:"Address",fullWidth:!0,multiline:!0,size:"small",minRows:2,value:(r==null?void 0:r.address)||"",onChange:a=>y({...r,address:a.target.value})})}),u?e.jsx(I,{variant:"contained",loading:d,onClick:i,children:"Save Changes"}):e.jsx(I,{loading:d,variant:"contained",onClick:()=>Ze({companyinp:r,setisload:v}),children:"+ Create Company"})]})]})})]}),((j==null?void 0:j.role)=="superadmin"||(j==null?void 0:j.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>z("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),n==="branches"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded space-y-1 overflow-hidden transition-all duration-300
                          ${n==="branches"?"max-h-fit p-1 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(I,{variant:"contained",onClick:()=>w(!0),children:"+ Add Branch"})}),e.jsx(Ce,{customStyles:H,columns:[{name:"Name",selector:a=>a.name,sortable:!0},{name:"Location",selector:a=>a.location,sortable:!0},{name:"Manager(s)",cell:a=>{var s;return e.jsx("div",{className:"flex flex-col gap-2",children:(s=a==null?void 0:a.managerIds)==null?void 0:s.map((t,o)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>L(t.userid),children:[e.jsx(re,{src:t==null?void 0:t.profileImage,alt:t.name,children:!(t!=null&&t.profileImage)&&e.jsx(Ne,{})}),e.jsx("span",{children:t.name})]},o))})}},{name:"Actions",width:"120px",cell:a=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>M(a),children:e.jsx(fe,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>M(a),children:e.jsx(pe,{})})]})}],data:h||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>z("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),n==="department"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${n==="department"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(es,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-indigo-50 border-dashed border-indigo-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-indigo-200 px-4 py-2 rounded-md",onClick:()=>z("device"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Devices"}),n==="device"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${n==="device"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs("div",{className:"mb-2  ",children:[(X=r==null?void 0:r.devices)==null?void 0:X.map((a,s)=>{const t=R(a==null?void 0:a.lastHeartbeat);return e.jsxs("div",{className:"flex w-full gap-4 items-center mb-2",children:[e.jsx(x,{label:"S.No",variant:"standard",disabled:!0,size:"small",value:s+1,className:"w-10"}),e.jsx(x,{label:"Device Name",variant:"standard",size:"small",value:a.name,onChange:o=>updateDevice(s,"name",o.target.value)}),e.jsx(x,{label:"Device SN",variant:"standard",size:"small",value:a.SN,onChange:o=>updateDevice(s,"SN",o.target.value)}),e.jsx(x,{label:"Last Sync",variant:"standard",size:"small",value:a!=null&&a.lastHeartbeat?Fe(a==null?void 0:a.lastHeartbeat).format("DD/MM/YY, hh:mm:ss A"):"N/A"}),t?e.jsx(Re,{title:"Device Online",style:{color:"green",fontSize:"1.6rem"}}):e.jsx(_e,{title:"Device Offline",style:{color:"red",fontSize:"1.6rem"}}),e.jsx(ue,{color:"primary",onClick:()=>de(a==null?void 0:a.SN),children:e.jsx(qe,{className:F?"animate-spin":""})}),e.jsx(ue,{color:"error",onClick:()=>B(s),children:e.jsx(je,{})})]},s)}),e.jsx(I,{variant:"contained",onClick:$,children:"Add More Device"})]}),e.jsx(I,{className:"f float-end",variant:"contained",loading:d,onClick:i,children:"Save Changes"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-indigo-50 border-dashed border-indigo-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-indigo-200 px-4 py-2 rounded-md",onClick:()=>z("telegram"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Telegram"}),n==="telegram"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${n==="telegram"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"mb-2  ",children:e.jsxs("div",{className:"flex w-full gap-4 items-center mb-2",children:[e.jsx(x,{label:"Telegram Bot Token",variant:"standard",size:"small",className:"w-[350px]",value:r.telegram.token,onChange:a=>A("telegram","token",a.target.value)}),e.jsx(x,{label:"Group Id",variant:"standard",size:"small",value:(Z=r==null?void 0:r.telegram)==null?void 0:Z.groupId,onChange:a=>A("telegram","groupId",a.target.value)}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs("label",{className:"flex items-center cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:r==null?void 0:r.telegramNotifcation,onChange:a=>y(s=>({...s,telegramNotifcation:a.target.checked})),className:"w-5 h-5 text-blue-600 bg-gray-200 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("span",{className:"ml-2 text-gray-700 font-medium",children:"Enable Notifications"})]})}),e.jsx(ue,{color:"error",onClick:()=>"kis",children:e.jsx(je,{})})]})}),e.jsx(I,{className:" float-end",variant:"contained",loading:d,onClick:ce,children:"Ftech group id"}),e.jsx(I,{className:" float-end",variant:"contained",loading:d,onClick:i,children:"Save Changes"})]})]}),(j==null?void 0:j.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>z("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),n==="admin"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${n==="admin"?"max-h-fit md:p-2 p-1 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(as,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>z("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),n==="attendance"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${n==="attendance"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs(ae,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(x,{label:"Office Time In",fullWidth:!0,type:"time",value:r.officeTime.in,onChange:a=>A("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(x,{label:"Office Time Out",fullWidth:!0,type:"time",value:r.officeTime.out,onChange:a=>A("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(x,{label:"Break Minutes",fullWidth:!0,type:"number",value:r.officeTime.breakMinutes,onChange:a=>A("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(x,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:r.workingMinutes.fullDay,onChange:a=>A("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(x,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:r.workingMinutes.halfDay,onChange:a=>A("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(x,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:r.workingMinutes.shortDayThreshold,onChange:a=>A("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(x,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:r.workingMinutes.overtimeAfterMinutes,onChange:a=>A("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(G,{fullWidth:!0,children:[e.jsx(Q,{children:"Weekly Offs"}),e.jsx(Y,{multiple:!0,value:r.weeklyOffs,onChange:a=>y({...r,weeklyOffs:a.target.value}),input:e.jsx(ne,{label:"Weekly Offs"}),renderValue:a=>a.map(s=>{var t;return(t=we.find(o=>o.value===s))==null?void 0:t.label}).join(", "),children:we.map(a=>e.jsxs(U,{value:a.value,children:[e.jsx(te,{checked:r.weeklyOffs.includes(a.value)}),e.jsx(le,{primary:a.label})]},a.value))})]}),Object.entries(r.attendanceRules).map(([a,s])=>{const t=a.replace(/([A-Z])/g," $1").replace(/^./,b=>b.toUpperCase()),o={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(x,{fullWidth:!0,label:t,type:"time",value:s,onChange:b=>A("attendanceRules",a,b.target.value),helperText:o[a]},a)})]}),e.jsx(ae,{sx:{mt:4,textAlign:"right"},children:e.jsx(I,{variant:"contained",onClick:i,children:"Update Settings"})})]})]}),e.jsxs("div",{className:"border shadow-lg bg-purple-50 border-dashed border-purple-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-purple-200 px-4 py-2 rounded-md",onClick:()=>z("policies"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Default Payroll Policies"}),n==="policies"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("form",{onSubmit:i,children:e.jsxs("div",{className:`rounded overflow-hidden transition-all duration-300 
                     ${n==="policies"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}`,children:[e.jsx("div",{className:"flex flex-col gap-3",children:["allowances","bonuses","deductions"].map(a=>{var t;const s=((t=r==null?void 0:r.payrollPolicies)==null?void 0:t[a])||[];return e.jsxs("div",{className:"flex flex-col shadow-lg gap-2 px-2 pb-2 my-2 border rounded border-dashed relative border-primary",children:[e.jsx("p",{className:"capitalize absolute t-0 -translate-y-1/2 l-2 bg-white px-2",children:a}),e.jsx("div",{className:"mt-6 flex flex-col gap-2",children:s.map((o,b)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{label:"Name",size:"small",required:!0,value:o.name,onChange:P=>{const D=s.map((E,V)=>V===b?{...E,name:P.target.value}:E);y({...r,payrollPolicies:{...r.payrollPolicies,[a]:D}})}}),e.jsxs(Y,{size:"small",className:"w-[120px]",value:o.type,onChange:P=>{const D=s.map((E,V)=>V===b?{...E,type:P.target.value}:E);y({...r,payrollPolicies:{...r.payrollPolicies,[a]:D}})},children:[e.jsx(U,{value:"amount",children:"Amount"}),e.jsx(U,{value:"percentage",children:"%"})]}),e.jsx(x,{label:o.type==="amount"?"₹":"%",type:"number",size:"small",required:!0,className:"w-[90px]",value:o.value,onChange:P=>{const D=s.map((E,V)=>V===b?{...E,value:Number(P.target.value)}:E);y({...r,payrollPolicies:{...r.payrollPolicies,[a]:D}})}}),e.jsx(pe,{className:"text-red-500 w-8 h-8 p-1  cursor-pointer text-lg",onClick:()=>{const P=s.filter((D,E)=>E!==b);y({...r,payrollPolicies:{...r.payrollPolicies,[a]:P}})}})]},b))}),e.jsxs(I,{size:"small",variant:"contained",onClick:()=>y({...r,payrollPolicies:{...r.payrollPolicies,[a]:[...s,{name:"",type:"amount",value:0}]}}),children:["+ Add ",a.slice(0,-1)]})]},a)})}),e.jsx(ae,{sx:{mt:2,textAlign:"right"},children:e.jsx(I,{variant:"contained",type:"submit",children:"Save Policies"})})]})})]}),e.jsx(oe,{open:c,onClose:()=>{w(!1),p(null),m(!1)},children:e.jsx("div",{className:"membermodal w-[680px]",children:e.jsx(Ye,{setopenviewmodal:w,editbranchdata:S,editbranch:C,company:u,employee:l})})})]})}export{cs as default};
