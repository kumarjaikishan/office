import{r as i,g as L,u as P,j as e,G as w,A as N,H as R,B as u,ab as A,b as D,a1 as B,y as d,c as y,a4 as M,D as O}from"./index-CW3zf4UY.js";import{u as U}from"./imageresizer-D4I-KFLq.js";const W=()=>{const[b,$]=i.useState(!1),[G,T]=i.useState(!1),{profile:r}=L(a=>a.user),[s,x]=i.useState(null),[h,o]=i.useState(!1),{handleImage:k}=U(),S=P(),[C,c]=i.useState(!1),[p,g]=i.useState(""),[f,j]=i.useState(null),v=i.useRef(null);i.useEffect(()=>{r&&x(r)},[r]);const E=a=>{const l=a.target.files[0];if(!l)return;j(l);const n=URL.createObjectURL(l);x(t=>({...t,profileImage:n}))},F=async()=>{var l,n;let a;try{o(!0),a=d.loading("Please wait...");const t=localStorage.getItem("emstoken"),m=await y.get("/api/resetrequest",{headers:{Authorization:`Bearer ${t}`}});o(!1),M({title:m.data.extramessage,icon:"success"}),d.update(a,{render:m.data.message,type:"success",isLoading:!1,autoClose:2100})}catch(t){o(!1),d.update(a,{render:((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||t.message,type:"warn",isLoading:!1,autoClose:2200})}},z=async()=>{var a,l;try{o(!0);const n=localStorage.getItem("emstoken"),t=new FormData;if(t.append("name",p),f){const I=await k(200,f);t.append("profileImage",I)}const m=await y.post("/api/update-profile",t,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"}});d.success(m.data.message),S(O()),j(null),c(!1)}catch(n){d.error(((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to update profile"),console.error(n)}finally{o(!1)}};return e.jsxs("div",{className:"p-0 md:p-4",children:[b?e.jsxs("div",{className:"w-full h-[300px] flex gap-5 flex-col justify-center items-center overflow-auto bg-white",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"animate-spin",style:{animationDuration:"2.5s"},size:50,color:"teal"}),e.jsx(w,{className:"absolute -bottom-4 left-0 animate-spin",style:{animationDuration:"3s"},size:20,color:"teal"})]}),e.jsx("p",{className:"text-teal-600",children:"loading..."})]}):e.jsxs("div",{className:"w-full mx-auto bg-white overflow-auto shadow rounded-lg p-1 py-2 md:p-4",children:[e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"relative",children:e.jsx(N,{sx:{width:72,height:72},alt:s==null?void 0:s.name,src:s==null?void 0:s.profileImage})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl capitalize font-bold text-gray-800 break-words",children:s==null?void 0:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s==null?void 0:s.role}),e.jsx("div",{className:"mt-3 space-y-1 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2 break-words",children:[e.jsx(R,{className:"text-gray-500"}),(s==null?void 0:s.email)||"N/A"]})})]})]}),(r==null?void 0:r.role)==="superadmin"&&e.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[e.jsx(u,{onClick:()=>{g(s==null?void 0:s.name),c(!0)},disabled:h,title:"Send Password Reset Link",variant:"contained",className:"w-full md:w-fit",children:"Edit profile"}),e.jsx(u,{onClick:F,disabled:h,title:"Send Password Reset Link",variant:"outlined",className:"w-full md:w-fit",children:"Send Password Reset Link"})]})]}),e.jsx(A,{open:C,onClose:()=>{c(!1)},children:e.jsx("div",{className:"membermodal w-[300px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Edit Profile"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(D,{autoFocus:!0,size:"small",fullWidth:!0,margin:"dense",label:"Profile Name",value:p,onChange:a=>g(a.target.value)}),e.jsx("div",{className:" flex justify-center",children:e.jsxs("div",{className:"relative ",children:[e.jsx(N,{sx:{width:72,height:72},alt:s==null?void 0:s.name,src:s==null?void 0:s.profileImage}),e.jsx("input",{type:"file",ref:v,style:{display:"none"},onChange:E,accept:"image/*"}),e.jsx("span",{onClick:()=>v.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:e.jsx(B,{size:18})})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(u,{variant:"outlined",onClick:()=>c(!1),children:"Cancel"}),e.jsx(u,{variant:"contained",onClick:z,children:"Save Changes"})]})]})})})]})};export{W as default};
