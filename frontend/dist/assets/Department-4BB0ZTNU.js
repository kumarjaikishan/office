import{c as _,l as D,y as f,r as c,g as R,u as U,j as e,U as H,W as T,Y as W,F as B,I as E,S as F,M as A,O as X,i as Y,C as G,b as k,B as I,a0 as J,a1 as K}from"./index-DoRMmwPR.js";import{I as M}from"./index-C8tVHuAn.js";import{M as Q}from"./Modalbox-B_TSNuRf.js";const V=[{name:"S.no",selector:n=>n.sno,width:"40px"},{name:"Branch",selector:n=>n.branch},{name:"Department",selector:n=>n.dep_name},{name:"Action",selector:n=>n.action,width:"80px"}],Z=async({inp:n,setisload:r,setInp:d,setopenmodal:i,init:a,dispatch:x})=>{console.log(n);const{branchId:h,department:m,description:g}=n;if(!m){alert("Please fill in both fields");return}const j=localStorage.getItem("emstoken");r(!0);try{const s=await _.post("/api/adddepartment",{department:m,branchId:h,description:g},{headers:{Authorization:`Bearer ${j}`}});x(D()),f.success(s.data.message,{autoClose:1200}),d(a),i(!1)}catch(s){console.log(s),s.response?f.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{r(!1)}},ee=async({inp:n,setisload:r,setInp:d,setopenmodal:i,init:a,dispatch:x})=>{const{departmentId:h,department:m,description:g}=n;if(!m||!h){alert("All fileds are Required");return}const j=localStorage.getItem("emstoken");r(!0);try{const s=await _.post("/api/updatedepartment",{departmentId:h,department:m,description:g},{headers:{Authorization:`Bearer ${j}`}});x(D()),f.success(s.data.message,{autoClose:1200}),d(a),i(!1)}catch(s){console.log(s),s.response?f.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{r(!1)}},te=async({departmentId:n,setisload:r,dispatch:d})=>{if(!n){alert("All fileds are Required");return}const i=localStorage.getItem("emstoken");r(!0);try{const a=await _.post("/api/deletedepartment",{departmentId:n},{headers:{Authorization:`Bearer ${i}`}});d(D()),f.success(a.data.message,{autoClose:1200})}catch(a){console.log(a),a.response?f.warn(a.response.data.message,{autoClose:1200}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}finally{r(!1)}},re=()=>{const[n,r]=c.useState(!1),[d,i]=c.useState(!1),[a,x]=c.useState([]),[h,m]=c.useState(!1),[g,j]=c.useState([]),{branch:s,department:S}=R(t=>t.user),[o,z]=c.useState({branch:"all",department:" "}),O=o.branch!=="all"||o.department.trim()!=="",N=U();c.useEffect(()=>{if(!a||a.length===0)return;const t=a.filter(u=>{var v;const l=o.branch==="all"||u.branchid===o.branch,C=o.department.trim()===""||((v=u.dep_name)==null?void 0:v.toLowerCase().includes(o.department.trim().toLowerCase()));return l&&C});j(t)},[o,a]);const w={departmentId:"",branchId:"",department:"",description:""},[p,b]=c.useState(w);c.useEffect(()=>{if(S.length>0){let t=1;const u=S.map(l=>{var C,v;return{id:l._id,sno:t++,branchid:(C=l==null?void 0:l.branchId)==null?void 0:C._id,branch:(v=l==null?void 0:l.branchId)==null?void 0:v.name,dep_name:l==null?void 0:l.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>$(l),children:e.jsx(H,{})}),e.jsx("span",{className:"delete",onClick:()=>L(l._id),children:e.jsx(T,{})})]})}});x(u)}},[S]);const y=(t,u)=>{b({...p,[u]:t.target.value})},q=t=>{t.preventDefault(),Z({inp:p,setisload:i,setInp:b,setopenmodal:r,init:w,dispatch:N})},$=t=>{console.log("edit",t),m(!0),b({branchId:t.branchId._id,departmentId:t._id,department:t.department,description:t.description}),r(!0)},L=t=>{console.log("delete",t),W({title:"Are you sure?",text:"Once deleted, All empoyee of this department deleted",icon:"warning",buttons:!0,dangerMode:!0}).then(async u=>{u&&te({departmentId:t,setisload:i,dispatch:N})})},P=()=>{ee({inp:p,setisload:i,setInp:b,setopenmodal:r,init:w,dispatch:N})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(B,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(E,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(F,{value:o.branch,onChange:t=>z({...o,branch:t.target.value}),input:e.jsx(X,{startAdornment:e.jsx(Y,{position:"start",children:e.jsx(G,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(A,{selected:!0,value:"all",children:"All"}),s==null?void 0:s.map(t=>e.jsx(A,{value:t._id,children:t.name},t._id))]})]}),e.jsx(k,{size:"small",id:"outlined-basic",value:o.department,onChange:t=>z({...o,department:t.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(I,{className:"w-full md:w-auto",variant:"contained",onClick:()=>r(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(J,{customStyles:K(),columns:V,data:O?g:a,pagination:!0,highlightOnHover:!0})}),e.jsx(Q,{open:n,onClose:()=>r(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Add Department"}),e.jsx("form",{onSubmit:q,children:e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs(B,{sx:{width:"98%"},size:"small",children:[e.jsx(E,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(F,{value:p.branchId,label:"branch",onChange:t=>y(t,"branchId"),children:s==null?void 0:s.map(t=>e.jsx(A,{value:t._id,children:t.name},t._id))})]}),e.jsx(k,{sx:{width:"98%"},required:!0,value:p.department,onChange:t=>y(t,"department"),label:"Department",size:"small"}),e.jsx(k,{multiline:!0,rows:4,onChange:t=>y(t,"description"),value:p.description,sx:{width:"98%"},label:"Description",size:"small"})]})})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{size:"small",onClick:()=>{r(!1),m(!1),b(w)},variant:"outlined",children:" cancel"}),!h&&e.jsx(I,{sx:{mr:2},loading:d,loadingPosition:"end",endIcon:e.jsx(M,{}),onClick:q,variant:"contained",type:"submit",children:"Add"}),h&&e.jsx(I,{sx:{mr:2},loading:d,loadingPosition:"end",endIcon:e.jsx(M,{}),variant:"contained",onClick:P,children:"Update"})]})]})})})]})};export{re as default};
