import{r as d,u as Y,g as Z,j as a,b as v,i as C,X as S,Y as q,Z as J,F as O,I as R,S as D,M as c,O as K,C as Q,B as N,a0 as ee,a1 as ae,A as w,k as L,V as se,T as te,ak as ne,al as le,c as g,y as h,m as W}from"./index-C0uMPCF7.js";const oe=()=>{const[y,E]=d.useState([]),[G,z]=d.useState(!1),[re,de]=d.useState([]),F=Y(),[l,p]=d.useState({employeeId:"",companyId:"",branchId:"",empId:"",amount:0,type:"given",remarks:""}),[r,P]=d.useState({searchText:"",branch:"all",department:"all"}),[u,B]=d.useState(null),{employee:x,advance:f,branch:I,department:ce}=Z(e=>e.user);d.useEffect(()=>{f&&E(f)},[f]);const b=(e,s)=>{P(t=>({...t,[e]:s}))},U=y==null?void 0:y.filter(e=>{var i,o,m;const s=((m=(o=(i=e.employeeId)==null?void 0:i.userid)==null?void 0:o.name)==null?void 0:m.toLowerCase())||"",t=e.branchId||"",n=r.searchText.trim()===""||s.includes(r.searchText.toLowerCase()),j=r.branch==="all"||t===r.branch;return n&&j}),k=e=>{p({...l,[e.target.name]:e.target.value})},T=(e=null)=>{var s;e?(p({employeeId:((s=e.employeeId)==null?void 0:s._id)||"",companyId:e.companyId||"",branchId:e.branchId||"",empId:e.empId||"",amount:e.amount,type:e.type||"given",remarks:e.remarks}),B(e._id)):(p({employeeId:"",companyId:"",branchId:"",empId:"",amount:0,type:"given",remarks:""}),B(null)),z(!0)},A=()=>z(!1),_=async()=>{var e,s;try{const n={headers:{Authorization:`Bearer ${localStorage.getItem("emstoken")}`}};u?(await g.put(`/api/advance/${u}`,l,n),h.success("Advance updated")):(await g.post("/api/advance",l,n),h.success("Advance added")),F(W()),A(),$()}catch(t){console.error("Error saving advance:",t),h.error(((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Server error")}},X=async e=>{if(window.confirm("Are you sure you want to delete this record?"))try{const s=localStorage.getItem("emstoken");await g.delete(`/api/advance/${e}`,{headers:{Authorization:`Bearer ${s}`}}),h.success("Advance deleted"),F(W()),$()}catch(s){console.error("Error deleting advance:",s),h.error("Failed to delete record")}},$=async()=>{try{const e=localStorage.getItem("emstoken"),{data:s}=await g.get("/api/advance",{headers:{Authorization:`Bearer ${e}`}});E(s.data)}catch(e){console.error("Error fetching advances:",e)}},H=e=>{const s=e.target.value,t=x.find(n=>n._id===s);t&&p({...l,employeeId:t._id,companyId:t.companyId,branchId:t.branchId,empId:t.empId})},M="https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",V=[{name:"S.no",selector:(e,s)=>s+1,width:"60px"},{name:"Employee",selector:e=>{var s,t,n,j,i,o,m;return a.jsxs("div",{className:"flex items-center capitalize gap-3 ",children:[a.jsx(w,{src:L((s=e==null?void 0:e.employeeId)==null?void 0:s.profileimage,{format:"webp",width:100,height:100})||M,alt:(n=(t=e==null?void 0:e.employeeId)==null?void 0:t.userid)==null?void 0:n.name,children:!((j=e==null?void 0:e.employeeId)!=null&&j.profileimage)&&M}),a.jsxs(se,{children:[a.jsx(te,{variant:"body2",children:(o=(i=e==null?void 0:e.employeeId)==null?void 0:i.userid)==null?void 0:o.name}),a.jsxs("p",{className:"t text-[10px] text-gray-600",children:["(",(m=e==null?void 0:e.employeeId)==null?void 0:m.designation,")"]})]})]})},sortable:!0},{name:"Given",selector:e=>e.type=="given"?e.amount:"-",sortable:!0,width:"90px"},{name:"Adjusted",selector:e=>e.type=="adjusted"?e.amount:"-",sortable:!0,width:"100px"},{name:"Balance",selector:e=>e.balance,sortable:!0,width:"100px"},{name:"Remarks",selector:e=>e.remarks||"-",sortable:!0},{name:"Actions",cell:e=>a.jsxs(a.Fragment,{children:[" ",!(e!=null&&e.payrollId)&&a.jsxs(a.Fragment,{children:[a.jsx(S,{color:"primary",onClick:()=>T(e),children:a.jsx(ne,{})}),a.jsx(S,{color:"error",onClick:()=>X(e._id),children:a.jsx(le,{})})]})]}),width:"120px"}];return a.jsxs("div",{className:"p-1 md:p-3",children:[a.jsxs("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:[a.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[a.jsx(v,{size:"small",className:"w-[47%] md:w-[160px]",value:r.searchText,onChange:e=>b("searchText",e.target.value),InputProps:{startAdornment:a.jsx(C,{position:"start",children:a.jsx(J,{})}),endAdornment:r.searchText&&a.jsx(C,{position:"end",children:a.jsx(S,{onClick:()=>b("searchText",""),edge:"end",size:"small",children:a.jsx(q,{})})})},label:"Search Employee"}),a.jsxs(O,{size:"small",className:"w-[47%] md:w-[160px]",children:[a.jsx(R,{children:"Branch"}),a.jsxs(D,{label:"Branch",value:r.branch,input:a.jsx(K,{startAdornment:a.jsx(C,{position:"start",children:a.jsx(Q,{fontSize:"small"})}),label:"Branch"}),onChange:e=>b("branch",e.target.value),children:[a.jsx(c,{value:"all",children:"All"}),I==null?void 0:I.map(e=>a.jsx(c,{value:e._id,children:e.name},e._id))]})]})]}),a.jsx("div",{className:"w-full md:w-fit",children:a.jsx(N,{className:"w-full md:w-fit",variant:"contained",color:"primary",onClick:()=>T(),sx:{mb:2},children:"Add Advance"})})]}),a.jsx(ee,{columns:V,data:U,pagination:!0,highlightOnHover:!0,striped:!0,responsive:!0}),a.jsx(ae,{open:G,outside:!1,onClose:A,children:a.jsx("div",{className:"membermodal w-[500px]",children:a.jsxs("div",{className:"whole",children:[a.jsxs("div",{className:"modalhead",children:[" ",u?"Edit Advance":"Add Advance"]}),a.jsx("form",{onSubmit:_,children:a.jsx("span",{className:"modalcontent ",children:a.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[a.jsxs(O,{className:"w-full mt-4",size:"small",children:[a.jsx(R,{children:"Select Employee"}),a.jsxs(D,{label:"select employee",value:l.employeeId,onChange:H,children:[a.jsx(c,{value:"",children:"Select Employee"}),x==null?void 0:x.map(e=>{var s;return a.jsx(c,{value:e._id,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{src:L(e==null?void 0:e.profileimage,{format:"webp",width:100,height:100}),sx:{width:24,height:24}}),(s=e.userid)==null?void 0:s.name]})},e._id)})]})]}),a.jsxs("div",{className:"w-full flex justify-between gap-3",children:[a.jsx(v,{margin:"dense",size:"small",label:"Amount",name:"amount",type:"number",fullWidth:!0,value:l.amount,onChange:k}),a.jsxs(v,{margin:"dense",size:"small",select:!0,label:"type",name:"type",fullWidth:!0,value:l.type,onChange:k,children:[a.jsx(c,{value:"given",children:"Given"}),a.jsx(c,{value:"adjusted",children:"Adjusted"})]})]}),a.jsx(v,{margin:"dense",multiline:!0,minRows:2,size:"small",label:"Remarks",name:"remarks",fullWidth:!0,value:l.remarks,onChange:k})]})})}),a.jsxs("div",{className:"modalfooter",children:[a.jsx(N,{onClick:A,variant:"outlined",children:"Cancel"}),a.jsx(N,{onClick:_,variant:"contained",color:"primary",children:u?"Update":"Save"})]})]})})})]})};export{oe as default};
