import{r as n,a as V,g as H,bg as W,A,c as f,y as l,j as a,b as O,i as q,bh as G,B as b,k as J,a5 as K,bi as X,M as y,bj as Y,aj as Z,ak as ee,ab as ae,a1 as te}from"./index-BeSL47dy.js";import{u as se}from"./imageresizer-D4I-KFLq.js";import{a as ne}from"./index-wL-4b8zw.js";import{L as re}from"./loader-a2fEE87P.js";const ge=()=>{const[o,z]=n.useState([]),[d,j]=n.useState([]),[c,F]=n.useState(""),P=V(),{ledger:le}=H(e=>e.user),[m,C]=n.useState(null),[w,L]=n.useState(""),[B,g]=n.useState(!1),[i,v]=n.useState(null),{handleImage:D}=se(),[I,u]=n.useState(!1),p={Authorization:`Bearer ${localStorage.getItem("emstoken")}`},[S,k]=n.useState(null),U=!!S,R=W.create(A),T=e=>{e.stopPropagation(),k(e.currentTarget)},h=e=>{e==null||e.stopPropagation(),k(null)};n.useEffect(()=>{N()},[]),n.useEffect(()=>{if(!(o.length<1))if(c.trim()==="")j(o);else{const e=c.toLowerCase();j(o.filter(t=>t.name.toLowerCase().includes(e)))}},[c,o]);const N=async()=>{var e,t;u(!0);try{const s=await f.get("/api/ledger",{headers:p});console.log(s.data),z(s.data.ledgers),j(s.data.ledgers)}catch(s){console.log(s.response),l.warning(((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to fetch ledgers")}finally{u(!1)}},E=(e=null)=>{e?(L(e.name),C(e._id),v(e.profileImage||null)):(L(""),C(null),v(null)),g(!0)},_=async()=>{var s,r;const e=w.trim();if(!e)return l.warn("Ledger name can't be empty");if(e.length<3)return l.warn("Ledger name must be at least 3 characters");const t=new FormData;if(t.append("name",e),i instanceof File){let x=await D(170,i);t.append("image",x)}try{u(!0),m?(await f.put(`/api/ledger/${m}`,t,{headers:{...p,"Content-Type":"multipart/form-data"}}),l.success("Ledger updated")):(await f.post("/api/ledger",t,{headers:{...p,"Content-Type":"multipart/form-data"}}),l.success("Ledger created")),g(!1),N()}catch(x){console.error(x),l.warning(((r=(s=x.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to save ledger")}finally{u(!1)}},Q=async e=>{swal({title:`Are you sure to Delete ${e.name}'s Ledger?`,icon:"warning",buttons:!0,dangerMode:!0}).then(async t=>{if(t)try{await f.delete(`/api/ledger/${e._id}`,{headers:p}),l.success("Ledger deleted"),N()}catch(s){console.log(s),l.error("Failed to delete ledger")}})},M=e=>{if(e){let t=`./${e._id}?name=${encodeURIComponent(e.name)}`;return e.profileImage&&(t+=`&profileimage=${encodeURIComponent(e.profileImage)}`),P(t)}},$=n.useRef(null);return a.jsxs("div",{className:"w-full max-w-6xl mx-auto  bg-white rounded",children:[a.jsxs("div",{className:"p-1 md:p-4 py-4 mb-4",children:[a.jsxs("div",{className:"flex mb-4 gap-2 flex-wrap justify-between",children:[a.jsx(O,{size:"small",label:"Search Ledger",className:"w-full md:w-[200px]",value:c,onChange:e=>F(e.target.value),InputProps:{startAdornment:a.jsx(q,{position:"start",children:a.jsx(G,{className:"text-gray-500"})})}}),a.jsx(b,{className:"w-full md:w-[200px]",variant:"contained",onClick:()=>E(),children:"Add Ledger"})]}),I?a.jsx(re,{}):a.jsx("div",{className:"w-full p-1 md:p-3",children:a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4",children:[d.map((e,t)=>{var s;return a.jsxs("div",{onClick:()=>M(e),className:"relative cursor-pointer overflow-hidden max-w-[270px] rounded-xl shadow-lg hover:shadow-xl transition-all pl-3 pr-1 py-3 bg-gray-50",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex gap-1 items-center",children:[a.jsx(R,{layoutId:`ledger-avatar-${e._id}`,sx:{width:35,height:35},alt:e.name,src:J(e.profileImage,{format:"webp",width:100,height:100}),transition:{layout:{duration:.3,ease:"easeInOut"}}}),a.jsx("div",{className:"text-[14px] md:text-[16px] font-semibold text-gray-800 mb-2 capitalize",children:e.name})]}),a.jsx(K,{onClick:T,size:"small",children:a.jsx(ne,{className:"text-gray-700"})}),a.jsxs(X,{anchorEl:S,open:U,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{elevation:1},children:[a.jsxs(y,{onClick:r=>{r.stopPropagation(),h(),M(e)},children:[a.jsx(Y,{className:" mr-2"})," See"]}),a.jsxs(y,{onClick:r=>{r.stopPropagation(),h(),E(e)},children:[a.jsx(Z,{className:" mr-2"})," Edit"]}),a.jsxs(y,{onClick:r=>{r.stopPropagation(),h(),Q(e)},children:[a.jsx(ee,{className:"text-red-600 mr-2"})," Delete"]})]})]}),a.jsxs("p",{className:`text-[16px] md:text-lg mr-1 text-end font-medium ${e.netBalance>=0?"text-green-600":"text-red-600"}`,children:["â‚¹ ",(s=e==null?void 0:e.netBalance)==null?void 0:s.toLocaleString()]}),a.jsx("span",{className:"w-[4px] h-full absolute left-0 top-0 bg-teal-700"})]},t)}),(d==null?void 0:d.length)<1&&a.jsx("div",{className:"w-full text-center ",children:"No Ledger found"})]})})]}),a.jsx(ae,{open:B,onClose:()=>{g(!1)},children:a.jsx("div",{className:"membermodal w-[300px]",children:a.jsxs("div",{className:"whole",children:[a.jsx("div",{className:"modalhead",children:m?"Edit Ledger":"Add Ledger"}),a.jsxs("span",{className:"modalcontent ",children:[a.jsx(O,{autoFocus:!0,size:"small",fullWidth:!0,margin:"dense",label:"Ledger Name",value:w,onChange:e=>L(e.target.value)}),a.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[a.jsx("input",{style:{display:"none"},type:"file",onChange:e=>v(e.target.files[0]),ref:$,accept:"image/*",id:"fileInput"}),a.jsx(A,{sx:{width:80,height:80},alt:w,src:i?i instanceof File?URL.createObjectURL(i):i:""}),a.jsx("span",{onClick:()=>$.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:a.jsx(te,{size:18})})]})]}),a.jsxs("div",{className:"modalfooter",children:[a.jsx(b,{variant:"outlined",onClick:()=>g(!1),children:"Cancel"}),a.jsx(b,{disabled:I,variant:"contained",onClick:_,children:m?"Update":"Create"})]})]})})})]})};export{ge as default};
