import{j as e,ab as _,b as u,F as L,I as O,S as U,M as A,B as k,c as M,y as h,r as x,g as q,h as b,a1 as P,A as H,l as X,k as G,a3 as J,T as z,aa as K}from"./index-CMccyeWH.js";import{A as Q}from"./index-B3tc89CL.js";import{I as V,u as Z}from"./attandencehelper-C0jUvyO_.js";import{C as E}from"./CheckPermission-DB1t3hha.js";import{a as ee}from"./index-BKUxcJ2i.js";const se=({firstfetch:a,inp:r,openmodal:w,isload:p,handleChange:f,setopenmodal:j,setInp:g,init:i})=>{const y=async l=>{l.preventDefault();const d=localStorage.getItem("emstoken");try{const c=await M.post("/api/leavehandle",{...r},{headers:{Authorization:`Bearer ${d}`}});a(),j(!1),g(i),h.success(c.data.message,{autoClose:2e3})}catch(c){c.response&&h.warning(c.response.data.message,{autoClose:3e3}),console.error(c)}};return e.jsx(_,{open:w,onClose:()=>{j(!1),g(i)},children:e.jsx("div",{className:"membermodal w-[600px]",children:e.jsxs("form",{onSubmit:y,children:[e.jsx("div",{className:"modalhead",children:" Leave Management"}),e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs("div",{className:"flex  gap-2 justify-between",children:[e.jsx(u,{fullWidth:!0,value:r.branch,label:"Branch",size:"small"}),e.jsx(u,{fullWidth:!0,value:r.employeename,label:"Name",size:"small"})]}),e.jsxs("div",{className:"flex  gap-2 justify-between",children:[e.jsx(u,{fullWidth:!0,value:r.showfrom,label:"From",size:"small"}),e.jsx(u,{fullWidth:!0,value:r.showto,label:"To",size:"small"})]}),e.jsx(u,{fullWidth:!0,multiline:!0,minRows:2,value:r.reason,onChange:l=>f(l,"reason"),label:"Reason",size:"small"}),e.jsxs(L,{fullWidth:!0,required:!0,size:"small",children:[e.jsx(O,{children:"Status"}),e.jsxs(U,{value:r.status,label:"Status",onChange:l=>f(l,"status"),children:[e.jsx(A,{value:"approved",children:"Approve"}),e.jsx(A,{value:"rejected",children:"Reject"})]})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(k,{size:"small",onClick:()=>{j(!1),g(i)},variant:"outlined",children:"Cancel"}),e.jsx(k,{sx:{mr:2},loading:p,loadingPosition:"end",endIcon:e.jsx(V,{}),variant:"contained",type:"submit",children:"Update"})]})]})})})},ie=()=>{const[a,r]=x.useState([]),[w,p]=x.useState(!1),[f,j]=x.useState(!1),{department:g,branch:i}=q(s=>s.user),y={leaveid:"",branch:"",employeename:"",from:"",showfrom:"",to:"",showto:"",reason:"",status:""},[l,d]=x.useState(y),c=E("leave",3),B=E("leave",4);x.useEffect(()=>{v()},[]);const R=(s,n)=>{d({...l,[n]:s.target.value})},v=async()=>{var n,m;const s=localStorage.getItem("emstoken");try{const o=await M.get("/api/fetchleave",{headers:{Authorization:`Bearer ${s}`}});let F=1;const T=await o.data.leave.map(t=>{var D,S,C,I,N,Y;return{id:t._id,sno:F++,name:e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx(H,{src:G((D=t==null?void 0:t.employeeId)==null?void 0:D.profileimage,{format:"webp",width:100,height:100}),alt:(S=t==null?void 0:t.employeeId)==null?void 0:S.employeename,children:!((C=t.employeeId)!=null&&C.profileimage)&&e.jsx(X,{})}),e.jsxs(J,{children:[e.jsx(z,{variant:"body2",children:(I=t.employeeId)==null?void 0:I.employeename}),e.jsx(z,{variant:"body2",children:(Y=(N=t.employeeId)==null?void 0:N.userid)==null?void 0:Y.email})]})]}),from:b(t.fromDate).format("DD MMM, YYYY"),to:b(t.toDate).format("DD MMM, YYYY"),reason:t.reason,status:e.jsx("span",{className:`${t.status=="approved"?"bg-green-100 text-green-800":t.status=="rejected"?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800"} px-3 py-1 rounded capitalize`,children:t.status}),action:e.jsxs("div",{className:"flex gap-2",children:[c&&e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>W(t),children:e.jsx(P,{})}),B&&e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>$(t._id),children:e.jsx(Q,{})})]})}});r(T)}catch(o){console.error(o),h.warning(((m=(n=o.response)==null?void 0:n.data)==null?void 0:m.message)||"Error")}},$=async s=>{console.log(s),swal({title:"Are you sure you want to Delete this record?",icon:"warning",buttons:!0,dangerMode:!0}).then(async n=>{if(n){const m=localStorage.getItem("emstoken");try{const o=await M.delete(`/api/leavehandle/${s}`,{headers:{Authorization:`Bearer ${m}`}});v(),h.success(o.data.message,{autoClose:2e3})}catch(o){o.response&&h.warning(o.response.data.message,{autoClose:3e3}),console.error(o)}}})},W=s=>{var n,m;d({leaveid:s._id,branch:i==null?void 0:i.filter(o=>o._id==(s==null?void 0:s.branchId))[0].name,employeename:(m=(n=s==null?void 0:s.employeeId)==null?void 0:n.userid)==null?void 0:m.name,from:s.fromDate,to:s.toDate,showfrom:b(s.fromDate).format("DD MMM, YYYY"),showto:b(s.toDate).format("DD MMM, YYYY"),reason:s==null?void 0:s.reason,status:s==null?void 0:s.status}),p(!0)};return e.jsxs("div",{children:[e.jsx(K,{customStyles:Z(),columns:te,data:a,pagination:!0,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(ee,{className:"text-xl"})," No Leave Request found."]})}),e.jsx(se,{firstfetch:v,handleChange:R,inp:l,isload:f,init:y,setInp:d,openmodal:w,setopenmodal:p})]})},te=[{name:"S.no",selector:a=>a.sno,width:"60px"},{name:"Employee",selector:a=>a.name},{name:"from",selector:a=>a.from,width:"120px"},{name:"to",selector:a=>a.to,width:"120px"},{name:"Reason",selector:a=>a.reason},{name:"Status",selector:a=>a.status,width:"120px"},{name:"Action",selector:a=>a.action,width:"90px"}];export{te as columns,ie as default};
