import{r as w,j as e,o as se,p as pe,h as Ne,Z as Pe,i as Ie,k as fe,t as K,n as ne,_ as Ce,q as ke,u as he,f as Se,A as ae,F as Te,b as G,y as $,v as Z,$ as Oe,a0 as Le,a1 as q,X as U,S as Me}from"./index-BcCf33nC.js";import{M as Ae}from"./Modalbox-Bw9Q2ggC.js";import{a as De,e as Be,u as ze}from"./useSlotProps-V7hcBR52.js";import{s as We}from"./styled-DZt197p0.js";import{i as Re,a as Fe,f as Ge,L as qe,F as de,I as ce,S as me,O as ue}from"./Select-CePOuoRo.js";import{u as Ue}from"./useThemeProps-3XG_gAMD.js";import{T as M}from"./TextField-BzriM_mM.js";import{g as _e,l as J,M as Y}from"./MenuItem-CsPX8TLz.js";import{C as ee}from"./Checkbox-B2-gljw5.js";import{T as _,t as ge}from"./Typography-BmXM6urE.js";import{B as z}from"./Button-Ca_2FZ2Y.js";import He from"./Department-BP0X6evB.js";import{a as Ve,A as Xe}from"./index-D7lVSvz4.js";import{u as Ee}from"./imageresizer-D4I-KFLq.js";import{X as Ze}from"./index.es-B7wbbfJi.js";import{u as Je}from"./attandencehelper--oC63HMC.js";import{B as oe}from"./Box-DbC_wsFB.js";import"./createSimplePaletteValueFilter-6n7mCABr.js";import"./ButtonBase-CC5f2wl3.js";import"./index-C9QG7iKK.js";import"./InputAdornment-B50bXZqM.js";const Qe=(t,r)=>t.filter(o=>r.includes(o)),V=(t,r,o)=>{const l=t.keys[0];Array.isArray(r)?r.forEach((i,d)=>{o((c,x)=>{d<=t.keys.length-1&&(d===0?Object.assign(c,x):c[t.up(t.keys[d])]=x)},i)}):r&&typeof r=="object"?(Object.keys(r).length>t.keys.length?t.keys:Qe(t.keys,Object.keys(r))).forEach(d=>{if(t.keys.includes(d)){const c=r[d];c!==void 0&&o((x,P)=>{l===d?Object.assign(x,P):x[t.up(d)]=P},c)}}):(typeof r=="number"||typeof r=="string")&&o((i,d)=>{Object.assign(i,d)},r)};function re(t){return`--Grid-${t}Spacing`}function le(t){return`--Grid-parent-${t}Spacing`}const ye="--Grid-columns",H="--Grid-parent-columns",Ke=({theme:t,ownerState:r})=>{const o={};return V(t.breakpoints,r.size,(l,i)=>{let d={};i==="grow"&&(d={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(d={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(d={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / var(${H}) - (var(${H}) - ${i}) * (var(${le("column")}) / var(${H})))`}),l(o,d)}),o},Ye=({theme:t,ownerState:r})=>{const o={};return V(t.breakpoints,r.offset,(l,i)=>{let d={};i==="auto"&&(d={marginLeft:"auto"}),typeof i=="number"&&(d={marginLeft:i===0?"0px":`calc(100% * ${i} / var(${H}) + var(${le("column")}) * ${i} / var(${H}))`}),l(o,d)}),o},et=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={[ye]:12};return V(t.breakpoints,r.columns,(l,i)=>{const d=i??12;l(o,{[ye]:d,"> *":{[H]:d}})}),o},tt=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={};return V(t.breakpoints,r.rowSpacing,(l,i)=>{var c;const d=typeof i=="string"?i:(c=t.spacing)==null?void 0:c.call(t,i);l(o,{[re("row")]:d,"> *":{[le("row")]:d}})}),o},st=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={};return V(t.breakpoints,r.columnSpacing,(l,i)=>{var c;const d=typeof i=="string"?i:(c=t.spacing)==null?void 0:c.call(t,i);l(o,{[re("column")]:d,"> *":{[le("column")]:d}})}),o},at=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={};return V(t.breakpoints,r.direction,(l,i)=>{l(o,{flexDirection:i})}),o},rt=({ownerState:t})=>({minWidth:0,boxSizing:"border-box",...t.container&&{display:"flex",flexWrap:"wrap",...t.wrap&&t.wrap!=="wrap"&&{flexWrap:t.wrap},gap:`var(${re("row")}) var(${re("column")})`}}),nt=t=>{const r=[];return Object.entries(t).forEach(([o,l])=>{l!==!1&&l!==void 0&&r.push(`grid-${o}-${String(l)}`)}),r},lt=(t,r="xs")=>{function o(l){return l===void 0?!1:typeof l=="string"&&!Number.isNaN(Number(l))||typeof l=="number"&&l>0}if(o(t))return[`spacing-${r}-${String(t)}`];if(typeof t=="object"&&!Array.isArray(t)){const l=[];return Object.entries(t).forEach(([i,d])=>{o(d)&&l.push(`spacing-${i}-${String(d)}`)}),l}return[]},ot=t=>t===void 0?[]:typeof t=="object"?Object.entries(t).map(([r,o])=>`direction-${r}-${o}`):[`direction-xs-${String(t)}`];function it(t,r){t.item!==void 0&&delete t.item,t.zeroMinWidth!==void 0&&delete t.zeroMinWidth,r.keys.forEach(o=>{t[o]!==void 0&&delete t[o]})}const dt=Pe(),ct=We("div",{name:"MuiGrid",slot:"Root"});function mt(t){return Ue({props:t,name:"MuiGrid",defaultTheme:dt})}function ut(t={}){const{createStyledComponent:r=ct,useThemeProps:o=mt,useTheme:l=De,componentName:i="MuiGrid"}=t,d=(j,N)=>{const{container:u,direction:g,spacing:T,wrap:C,size:k}=j,E={root:["root",u&&"container",C!=="wrap"&&`wrap-xs-${String(C)}`,...ot(g),...nt(k),...u?lt(T,N.breakpoints.keys[0]):[]]};return pe(E,b=>Ne(i,b),{})};function c(j,N,u=()=>!0){const g={};return j===null||(Array.isArray(j)?j.forEach((T,C)=>{T!==null&&u(T)&&N.keys[C]&&(g[N.keys[C]]=T)}):typeof j=="object"?Object.keys(j).forEach(T=>{const C=j[T];C!=null&&u(C)&&(g[T]=C)}):g[N.keys[0]]=j),g}const x=r(et,st,tt,Ke,at,rt,Ye),P=w.forwardRef(function(N,u){const g=l(),T=o(N),C=Be(T);it(C,g.breakpoints);const{className:k,children:E,columns:b=12,container:s=!1,component:p="div",direction:f="row",wrap:A="wrap",size:I={},offset:O={},spacing:a=0,rowSpacing:v=a,columnSpacing:y=a,unstable_level:S=0,...L}=C,n=c(I,g.breakpoints,F=>F!==!1),m=c(O,g.breakpoints),h=N.columns??(S?void 0:b),D=N.spacing??(S?void 0:a),B=N.rowSpacing??N.spacing??(S?void 0:v),W=N.columnSpacing??N.spacing??(S?void 0:y),R={...C,level:S,columns:h,container:s,direction:f,wrap:A,spacing:D,rowSpacing:B,columnSpacing:W,size:n,offset:m},$e=d(R,g);return e.jsx(x,{ref:u,as:p,ownerState:R,className:se($e.root,k),...L,children:w.Children.map(E,F=>{var xe;return w.isValidElement(F)&&Re(F,["Grid"])&&s&&F.props.container?w.cloneElement(F,{unstable_level:((xe=F.props)==null?void 0:xe.unstable_level)??S+1}):F})})});return P.muiName="Grid",P}function pt(t){return Ne("MuiFormControlLabel",t)}const X=Ie("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),ft=t=>{const{classes:r,disabled:o,labelPlacement:l,error:i,required:d}=t,c={root:["root",o&&"disabled",`labelPlacement${Ce(l)}`,i&&"error",d&&"required"],label:["label",o&&"disabled"],asterisk:["asterisk",i&&"error"]};return pe(c,pt,r)},ht=ne("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[{[`& .${X.label}`]:r.label},r.root,r[`labelPlacement${Ce(o.labelPlacement)}`]]}})(ke(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${X.disabled}`]:{cursor:"default"},[`& .${X.label}`]:{[`&.${X.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:r})=>r==="start"||r==="top"||r==="bottom",style:{marginLeft:16}}]}))),xt=ne("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(ke(({theme:t})=>({[`&.${X.error}`]:{color:(t.vars||t).palette.error.main}}))),gt=w.forwardRef(function(r,o){const l=fe({props:r,name:"MuiFormControlLabel"}),{checked:i,className:d,componentsProps:c={},control:x,disabled:P,disableTypography:j,inputRef:N,label:u,labelPlacement:g="end",name:T,onChange:C,required:k,slots:E={},slotProps:b={},value:s,...p}=l,f=Fe(),A=P??x.props.disabled??(f==null?void 0:f.disabled),I=k??x.props.required,O={disabled:A,required:I};["checked","name","onChange","value","inputRef"].forEach(h=>{typeof x.props[h]>"u"&&typeof l[h]<"u"&&(O[h]=l[h])});const a=Ge({props:l,muiFormControl:f,states:["error"]}),v={...l,disabled:A,labelPlacement:g,required:I,error:a.error},y=ft(v),S={slots:E,slotProps:{...c,...b}},[L,n]=K("typography",{elementType:_,externalForwardedProps:S,ownerState:v});let m=u;return m!=null&&m.type!==_&&!j&&(m=e.jsx(L,{component:"span",...n,className:se(y.label,n==null?void 0:n.className),children:m})),e.jsxs(ht,{className:se(y.root,d),ownerState:v,ref:o,...p,children:[w.cloneElement(x,O),I?e.jsxs("div",{children:[m,e.jsxs(xt,{ownerState:v,"aria-hidden":!0,className:y.asterisk,children:[" ","*"]})]}):m]})}),be=ut({createStyledComponent:ne("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[r.root,o.container&&r.container]}}),componentName:"MuiGrid",useThemeProps:t=>fe({props:t,name:"MuiGrid"}),useTheme:ze}),yt=t=>{const{classes:r,inset:o,primary:l,secondary:i,dense:d}=t;return pe({root:["root",o&&"inset",d&&"dense",l&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},_e,r)},bt=ne("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[{[`& .${J.primary}`]:r.primary},{[`& .${J.secondary}`]:r.secondary},r.root,o.inset&&r.inset,o.primary&&o.secondary&&r.multiline,o.dense&&r.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${ge.root}:where(& .${J.primary})`]:{display:"block"},[`.${ge.root}:where(& .${J.secondary})`]:{display:"block"},variants:[{props:({ownerState:t})=>t.primary&&t.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:t})=>t.inset,style:{paddingLeft:56}}]}),te=w.forwardRef(function(r,o){const l=fe({props:r,name:"MuiListItemText"}),{children:i,className:d,disableTypography:c=!1,inset:x=!1,primary:P,primaryTypographyProps:j,secondary:N,secondaryTypographyProps:u,slots:g={},slotProps:T={},...C}=l,{dense:k}=w.useContext(qe);let E=P??i,b=N;const s={...l,disableTypography:c,inset:x,primary:!!E,secondary:!!b,dense:k},p=yt(s),f={slots:g,slotProps:{primary:j,secondary:u,...T}},[A,I]=K("root",{className:se(p.root,d),elementType:bt,externalForwardedProps:{...f,...C},ownerState:s,ref:o}),[O,a]=K("primary",{className:p.primary,elementType:_,externalForwardedProps:f,ownerState:s}),[v,y]=K("secondary",{className:p.secondary,elementType:_,externalForwardedProps:f,ownerState:s});return E!=null&&E.type!==_&&!c&&(E=e.jsx(O,{variant:k?"body2":"body1",component:a!=null&&a.variant?void 0:"span",...a,children:E})),b!=null&&b.type!==_&&!c&&(b=e.jsx(v,{variant:"body2",color:"textSecondary",...y,children:b})),e.jsxs(A,{...I,children:[E,b]})}),je=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],jt=({setopenviewmodal:t,employee:r,company:o,editbranch:l,editbranchdata:i})=>{const d={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[c,x]=w.useState(d),P=he(),{adminManager:j}=Se(s=>s.user),[N,u]=w.useState([]),g=localStorage.getItem("emstoken");w.useEffect(()=>{x(s=>({...s,companyId:o._id})),l&&x(s=>({...s,...i}))},[o,l]),w.useEffect(()=>{(j==null?void 0:j.length)>0&&u(j.filter(s=>s.role==="manager"))},[j]);const T=()=>{t(!1),x(d)},C=(s,p)=>{x(f=>({...f,[s]:p}))},k=(s,p,f)=>{x(A=>({...A,setting:{...A.setting,[s]:{...A.setting[s],[p]:f}}}))},E=async()=>{var s,p;try{const f=await G.post("/api/addBranch",c,{headers:{Authorization:`Bearer ${g}`}});$.success(f.data.message),t(!1),P(Z()),T()}catch(f){console.error(f),$.error(((p=(s=f==null?void 0:f.response)==null?void 0:s.data)==null?void 0:p.message)||"Error adding branch")}},b=async()=>{var s,p;try{const f=await G.post("/api/editBranch",c,{headers:{Authorization:`Bearer ${g}`}});$.success(f.data.message),P(Z()),t(!1),T()}catch(f){console.error(f),$.error(((p=(s=f==null?void 0:f.response)==null?void 0:s.data)==null?void 0:p.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:l?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(be,{container:!0,spacing:2,children:[e.jsx(M,{label:"Branch Name",fullWidth:!0,size:"small",value:c.name,onChange:s=>C("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(M,{label:"Location",fullWidth:!0,size:"small",value:c.location,onChange:s=>C("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(de,{size:"small",fullWidth:!0,children:[e.jsx(ce,{children:"Managers"}),e.jsx(me,{multiple:!0,value:(c==null?void 0:c.managerIds)||[],onChange:s=>C("managerIds",s.target.value),input:e.jsx(ue,{label:"Managers"}),renderValue:s=>s.map(p=>{var f;return((f=N.find(A=>A._id===p))==null?void 0:f.name)||"Unknown"}).join(", "),children:N&&N.length>0?N.map(s=>{var p;return e.jsxs(Y,{value:s._id,children:[e.jsx(ee,{checked:(p=c==null?void 0:c.managerIds)==null?void 0:p.includes(s._id)}),e.jsx(ae,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!(s!=null&&s.profileImage)&&e.jsx(Te,{})}),e.jsx(te,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)}):e.jsx(Y,{disabled:!0,value:"",children:e.jsx(te,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(gt,{control:e.jsx(ee,{checked:!c.defaultsetting,onChange:s=>x(p=>({...p,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!c.defaultsetting&&e.jsx("div",{className:"border-yellow-300 border-2 grid grid-cols-2 gap-3 border-dashed rounded mt-3 p-3",children:e.jsxs(be,{container:!0,spacing:2,children:[e.jsx(M,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>k("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(M,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>k("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(M,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.officeTime.breakMinutes,onChange:s=>k("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(M,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.fullDay,onChange:s=>k("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(M,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.halfDay,onChange:s=>k("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(M,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.shortDayThreshold,onChange:s=>k("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(M,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>k("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(de,{size:"small",fullWidth:!0,children:[e.jsx(ce,{children:"Weekly Offs"}),e.jsx(me,{multiple:!0,value:c.setting.weeklyOffs,onChange:s=>x(p=>({...p,setting:{...p.setting,weeklyOffs:s.target.value}})),input:e.jsx(ue,{label:"Weekly Offs"}),renderValue:s=>s.map(p=>{var f;return(f=je.find(A=>A.value===p))==null?void 0:f.label}).join(", "),children:je.map(s=>e.jsxs(Y,{value:s.value,children:[e.jsx(ee,{checked:c.setting.weeklyOffs.includes(s.value)}),e.jsx(te,{primary:s.label})]},s.value))})]}),Object.entries(c.setting.attendanceRules).map(([s,p])=>{const f=s.replace(/([A-Z])/g," $1").replace(/^./,I=>I.toUpperCase()),A={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(M,{fullWidth:!0,size:"small",label:f,type:"time",value:p,onChange:I=>x(O=>({...O,setting:{...O.setting,attendanceRules:{...O.setting.attendanceRules,[s]:I.target.value}}})),helperText:A[s]},s)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(z,{variant:"outlined",onClick:T,children:"Cancel"}),l?e.jsx(z,{variant:"contained",onClick:b,children:"Save"}):e.jsx(z,{variant:"contained",onClick:E,children:"Add Branch"})]})]})},vt=async({companyinp:t,setisload:r})=>{const o=localStorage.getItem("emstoken");r(!0);try{const l=await G.post("/api/addcompany",{name:t.name,industry:t.industry},{headers:{Authorization:`Bearer ${o}`}});console.log("Query:",l),$.success(l.data.message,{autoClose:1200})}catch(l){console.log(l),l.response?$.warn(l.response.data.message,{autoClose:1200}):l.request?console.error("No response from server:",l.request):console.error("Error:",l.message)}finally{r(!1)}},Q={1:"Read",2:"Create",3:"Update",4:"Delete"},ve=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],ie={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},wt={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function Nt(){const[t,r]=w.useState([]),[o,l]=w.useState([]),[i,d]=w.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ie}}),c=he();w.useEffect(()=>{f()},[]);const x=w.useRef(null),{handleImage:P}=Ee(),[j,N]=w.useState(null),[u,g]=w.useState(!1),[T,C]=w.useState(""),[k,E]=w.useState(null),b=n=>{E(m=>m===n?null:n)},s=()=>{d({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ie}}),C(""),N(null),g(!1)},p=async()=>{const n={...i},m=new FormData;l(!0);try{const h=n.profileImage?await P(300,n.profileImage):null;h&&m.append("photo",h),m.append("name",n.name),m.append("email",n.email),m.append("role",n.role),m.append("password",n.password),m.append("permissions",JSON.stringify(n.permissions));const D=localStorage.getItem("emstoken");l(!0);const B=j!==null?`/api/editAdmin/${t[j]._id}`:"/api/addAdmin",R=await G["post"](B,m,{headers:{Authorization:`Bearer ${D}`,"Content-Type":"multipart/form-data"}});$.success(R.data.message,{autoClose:1200}),s(),f(),c(Z())}catch(h){console.error(h),h.response?$.warn(h.response.data.message,{autoClose:1200}):$.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},f=async()=>{try{const n=localStorage.getItem("emstoken");l(!0);const m=await G.get("/api/getAdmin",{headers:{Authorization:`Bearer ${n}`}});r(m.data)}catch(n){console.error(n),n.response?$.warn(n.response.data.message,{autoClose:1200}):$.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},A=n=>{const m=t[n];d({...m,profilePreview:m.profileImage||"",profileImage:null}),N(n),g(!0)},I=async n=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async m=>{var h,D;if(m){let B;try{const W=localStorage.getItem("emstoken");l(!0),B=$.loading("Deleting...");const R=await G.delete(`/api/deleteAdmin/${n}`,{headers:{Authorization:`Bearer ${W}`}});$.update(B,{render:R.data.message,type:"success",isLoading:!1,autoClose:1800}),f(),c(Z())}catch(W){console.error(W),$.update(B,{render:((D=(h=W.response)==null?void 0:h.data)==null?void 0:D.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{l(!1)}}})},O=(n,m)=>{d(h=>{const D=h.permissions[n]||[],W=D.includes(m)?D.filter(R=>R!==m):[...D,m].sort();return{...h,permissions:{...h.permissions,[n]:W}}})},a=n=>{const m=n==="admin"?{...ie}:{...wt};d({...i,role:n,permissions:m})},v=n=>{const m=n.target.files[0];m&&d(h=>({...h,profileImage:m,profilePreview:URL.createObjectURL(m)}))},y=()=>{T&&(d(n=>({...n,permissions:{...n.permissions,[T]:[]}})),C(""))},S=Array.from(new Set([...i.role==="admin"?ve:Object.keys(i.permissions),...Object.keys(i.permissions)])),L=ve.filter(n=>!S.includes(n));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-2",children:[e.jsxs("div",{className:"flex justify-between flex-wrap items-center mb-4",children:[e.jsx("h2",{className:"text-[16px] mb-2 md:mb-0 md:text-xl font-semibold",children:"Admin/Manager Management"}),e.jsx(z,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{s(),g(!0)},children:"Add Admin/ Manager"})]}),t.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:t.map((n,m)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{sx:{width:60,height:60},alt:n.name,src:n==null?void 0:n.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[n.name," (",n.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:n.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"p-2 border rounded hover:bg-gray-100",onClick:()=>A(m),children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>I(n._id),children:e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>b(m),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",k===m?"Hide Permissions":"View Permissions "]}),k===m?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),k===m&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(Q).map(h=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:h},h))]})}),e.jsx("tbody",{children:Object.entries(n.permissions).map(([h,D])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:h}),Object.keys(Q).map(B=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:D.includes(Number(B))?"✅":"-"},B))]},h))})]})]})]})]},m))})]}),e.jsx(Ae,{open:u,onClose:()=>g(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"modalhead",children:[" ",j!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-[500px]",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:v,ref:x,accept:"image/*",name:"",id:"fileInput"}),e.jsx(ae,{sx:{width:70,height:70},alt:i.name,src:i.profilePreview}),e.jsx("span",{onClick:()=>x.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(Me,{size:18})})]}),e.jsx(M,{fullWidth:!0,required:!0,value:i.name,onChange:n=>d({...i,name:n.target.value}),label:"Name",size:"small"}),e.jsx(M,{fullWidth:!0,required:!0,value:i.email,onChange:n=>d({...i,email:n.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),e.jsx(M,{fullWidth:!0,required:!0,value:i.password,type:"password",onChange:n=>d({...i,password:n.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:i.role,onChange:n=>a(n.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),i.role==="manager"&&e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"border p-2 rounded w-full",value:T,onChange:n=>C(n.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),L.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(z,{variant:"contained",onClick:y,children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(Q).map(([n,m])=>e.jsx("th",{className:"border p-2 text-center",children:m},n))]})}),e.jsx("tbody",{children:S.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:n}),Object.keys(Q).map(m=>{var h;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((h=i.permissions[n])==null?void 0:h.includes(Number(m)))||!1,onChange:()=>O(n,Number(m))})},m)})]},n))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(z,{variant:"outlined",onClick:s,children:"Cancel"}),e.jsx(z,{variant:"contained",onClick:p,loading:o,children:j!==null?"Update":"Create"})]})]})})})]})}const we=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function _t(){const[t,r]=w.useState(null),[o,l]=w.useState(!1),[i,d]=w.useState(!1),[c,x]=w.useState(!1),{handleImage:P}=Ee(),[j,N]=w.useState(null),[u,g]=w.useState({name:"",address:"",contact:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),T=he(),{employee:C,company:k,branch:E,profile:b}=Se(a=>a.user),s=a=>{r(v=>v===a?null:a)};w.useEffect(()=>{k&&g(k)},[k]);const p=(a,v,y)=>{g(S=>({...S,[a]:{...S[a],[v]:y}}))},f=async()=>{try{x(!0);const a=localStorage.getItem("emstoken"),v=await G.post("/api/updateCompany",{...u},{headers:{Authorization:`Bearer ${a}`}});T(Z()),$.success(v.data.message,{autoClose:1800})}catch(a){console.log(a),a.response?$.warn(a.response.data.message,{autoClose:2700}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}finally{x(!1)}},A=()=>{},I=a=>{var y;l(!0);const v={...a,managerIds:(y=a==null?void 0:a.managerIds)==null?void 0:y.map(S=>S._id)};N(v),d(!0)},O=Je();return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(b==null?void 0:b.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),t==="company"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="company"&&e.jsxs("div",{className:"p-4 rounded flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[u!=null&&u.logo?e.jsx("img",{src:u.logo,alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Ve,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async a=>{const v=a.target.files[0];if(!v)return;const y=await P(200,v),S=new FormData;S.append("_id",u._id),S.append("logo",y);try{console.log("api calling"),x(!0);const L=localStorage.getItem("emstoken"),m=(await G.post("/api/updateCompany",S,{headers:{Authorization:`Bearer ${L}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;g(h=>({...h,logo:m})),$.success("Logo uploaded successfully!")}catch(L){console.error(L),$.error("Failed to upload logo.")}finally{x(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Company Name"}),e.jsx("input",{type:"text",onChange:a=>g({...u,name:a.target.value}),value:u==null?void 0:u.name,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Address"}),e.jsx("input",{type:"text",onChange:a=>g({...u,address:a.target.value}),value:u==null?void 0:u.address,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Contact"}),e.jsx("input",{type:"text",onChange:a=>g({...u,contact:a.target.value}),value:u==null?void 0:u.contact,className:"w-full border rounded px-3 py-2"})]}),k?e.jsx(z,{variant:"contained",loading:c,onClick:f,children:"Save Changes"}):e.jsx(z,{loading:c,variant:"contained",onClick:()=>vt({companyinp:u,setisload:x}),children:"+ Create Company"})]})]})]}),((b==null?void 0:b.role)=="superadmin"||(b==null?void 0:b.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),t==="branches"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="branches"&&e.jsxs("div",{className:"p-1 md:p-2 rounded overflow-auto mt-2 space-y-2",children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(z,{variant:"contained",onClick:()=>d(!0),children:"+ Add Branch"})}),e.jsx(Ze,{customStyles:O,columns:[{name:"Name",selector:a=>a.name,sortable:!0},{name:"Location",selector:a=>a.location,sortable:!0},{name:"Manager(s)",cell:a=>{var v;return e.jsx("div",{className:"flex flex-col gap-2",children:(v=a==null?void 0:a.managerIds)==null?void 0:v.map((y,S)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>A(y.userid),children:[e.jsx(ae,{src:y==null?void 0:y.profileImage,alt:y.name,children:!(y!=null&&y.profileImage)&&e.jsx(Te,{})}),e.jsx("span",{children:y.name})]},S))})}},{name:"Actions",width:"120px",cell:a=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>I(a),children:e.jsx(Me,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>I(a),children:e.jsx(Xe,{})})]})}],data:E||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),t==="department"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="department"&&e.jsx("div",{className:"p-1 rounded mt-2 space-y-4",children:e.jsx(He,{})})]}),(b==null?void 0:b.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),t==="admin"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="admin"&&e.jsx("div",{className:"p-1 rounde mt-2 ",children:e.jsx(Nt,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),t==="attendance"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="attendance"&&k&&e.jsxs(oe,{className:" rounded mt-1 p-2 ",children:[e.jsxs(oe,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(M,{label:"Office Time In",fullWidth:!0,type:"time",value:u.officeTime.in,onChange:a=>p("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(M,{label:"Office Time Out",fullWidth:!0,type:"time",value:u.officeTime.out,onChange:a=>p("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(M,{label:"Break Minutes",fullWidth:!0,type:"number",value:u.officeTime.breakMinutes,onChange:a=>p("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(M,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:u.workingMinutes.fullDay,onChange:a=>p("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(M,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:u.workingMinutes.halfDay,onChange:a=>p("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(M,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:u.workingMinutes.shortDayThreshold,onChange:a=>p("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(M,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:u.workingMinutes.overtimeAfterMinutes,onChange:a=>p("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(de,{fullWidth:!0,children:[e.jsx(ce,{children:"Weekly Offs"}),e.jsx(me,{multiple:!0,value:u.weeklyOffs,onChange:a=>g({...u,weeklyOffs:a.target.value}),input:e.jsx(ue,{label:"Weekly Offs"}),renderValue:a=>a.map(v=>{var y;return(y=we.find(S=>S.value===v))==null?void 0:y.label}).join(", "),children:we.map(a=>e.jsxs(Y,{value:a.value,children:[e.jsx(ee,{checked:u.weeklyOffs.includes(a.value)}),e.jsx(te,{primary:a.label})]},a.value))})]}),Object.entries(u.attendanceRules).map(([a,v])=>{const y=a.replace(/([A-Z])/g," $1").replace(/^./,L=>L.toUpperCase()),S={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(M,{fullWidth:!0,label:y,type:"time",value:v,onChange:L=>p("attendanceRules",a,L.target.value),helperText:S[a]},a)})]}),e.jsx(oe,{sx:{mt:4,textAlign:"right"},children:e.jsx(z,{variant:"contained",onClick:f,children:"Update Settings"})})]})]}),e.jsx(Ae,{open:i,onClose:()=>{d(!1),N(null),l(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsx(jt,{setopenviewmodal:d,editbranchdata:j,editbranch:o,company:k,employee:C})})})]})}export{_t as default};
