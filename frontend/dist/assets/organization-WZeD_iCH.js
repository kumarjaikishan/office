import{m as we,l as Ne,r as j,n as pe,al as Ce,am as ke,H as J,T as U,j as e,x as te,w as oe,an as he,z as xe,E as fe,ao as Te,ap as Me,aq as Z,ar as de,u as ie,g as ge,as as Se,b as w,F as ae,I as le,S as re,M as Q,A as ee,k as be,O as ne,ab as X,B,c as F,y as T,K as V,at as Ae,au as Ee,av as R,aj as q,a8 as ye,ah as Ie,aw as Pe,ag as Le,aa as De}from"./index-UVvS6XYW.js";import{M as je}from"./Modalbox-VUZKQTBg.js";import{C as K}from"./Checkbox-CMy4Gs6F.js";import Oe from"./Department-BEKUW-dZ.js";import{u as ve}from"./imageresizer-D4I-KFLq.js";import"./index-GXjyqOjN.js";function Be(r){return Ne("MuiFormControlLabel",r)}const H=we("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),$e=r=>{const{classes:u,disabled:b,labelPlacement:i,error:h,required:f}=r,c={root:["root",b&&"disabled",`labelPlacement${he(i)}`,h&&"error",f&&"required"],label:["label",b&&"disabled"],asterisk:["asterisk",h&&"error"]};return xe(c,Be,u)},ze=oe("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(r,u)=>{const{ownerState:b}=r;return[{[`& .${H.label}`]:u.label},u.root,u[`labelPlacement${he(b.labelPlacement)}`]]}})(fe(({theme:r})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${H.disabled}`]:{cursor:"default"},[`& .${H.label}`]:{[`&.${H.disabled}`]:{color:(r.vars||r).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:u})=>u==="start"||u==="top"||u==="bottom",style:{marginLeft:16}}]}))),Fe=oe("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(fe(({theme:r})=>({[`&.${H.error}`]:{color:(r.vars||r).palette.error.main}}))),We=j.forwardRef(function(u,b){const i=pe({props:u,name:"MuiFormControlLabel"}),{checked:h,className:f,componentsProps:c={},control:y,disabled:D,disableTypography:M,inputRef:E,label:d,labelPlacement:N="end",name:I,onChange:P,required:v,slots:S={},slotProps:g={},value:s,...n}=i,o=Ce(),k=D??y.props.disabled??(o==null?void 0:o.disabled),A=v??y.props.required,L={disabled:k,required:A};["checked","name","onChange","value","inputRef"].forEach(m=>{typeof y.props[m]>"u"&&typeof i[m]<"u"&&(L[m]=i[m])});const t=ke({props:i,muiFormControl:o,states:["error"]}),x={...i,disabled:k,labelPlacement:N,required:A,error:t.error},p=$e(x),C={slots:S,slotProps:{...c,...g}},[O,a]=J("typography",{elementType:U,externalForwardedProps:C,ownerState:x});let l=d;return l!=null&&l.type!==U&&!M&&(l=e.jsx(O,{component:"span",...a,className:te(p.label,a==null?void 0:a.className),children:l})),e.jsxs(ze,{className:te(p.root,f),ownerState:x,ref:b,...n,children:[j.cloneElement(y,L),A?e.jsxs("div",{children:[l,e.jsxs(Fe,{ownerState:x,"aria-hidden":!0,className:p.asterisk,children:["â€‰","*"]})]}):l]})}),Re=r=>{const{classes:u,inset:b,primary:i,secondary:h,dense:f}=r;return xe({root:["root",b&&"inset",f&&"dense",i&&h&&"multiline"],primary:["primary"],secondary:["secondary"]},Me,u)},qe=oe("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(r,u)=>{const{ownerState:b}=r;return[{[`& .${Z.primary}`]:u.primary},{[`& .${Z.secondary}`]:u.secondary},u.root,b.inset&&u.inset,b.primary&&b.secondary&&u.multiline,b.dense&&u.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${de.root}:where(& .${Z.primary})`]:{display:"block"},[`.${de.root}:where(& .${Z.secondary})`]:{display:"block"},variants:[{props:({ownerState:r})=>r.primary&&r.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:r})=>r.inset,style:{paddingLeft:56}}]}),Y=j.forwardRef(function(u,b){const i=pe({props:u,name:"MuiListItemText"}),{children:h,className:f,disableTypography:c=!1,inset:y=!1,primary:D,primaryTypographyProps:M,secondary:E,secondaryTypographyProps:d,slots:N={},slotProps:I={},...P}=i,{dense:v}=j.useContext(Te);let S=D??h,g=E;const s={...i,disableTypography:c,inset:y,primary:!!S,secondary:!!g,dense:v},n=Re(s),o={slots:N,slotProps:{primary:M,secondary:d,...I}},[k,A]=J("root",{className:te(n.root,f),elementType:qe,externalForwardedProps:{...o,...P},ownerState:s,ref:b}),[L,t]=J("primary",{className:n.primary,elementType:U,externalForwardedProps:o,ownerState:s}),[x,p]=J("secondary",{className:n.secondary,elementType:U,externalForwardedProps:o,ownerState:s});return S!=null&&S.type!==U&&!c&&(S=e.jsx(L,{variant:v?"body2":"body1",component:t!=null&&t.variant?void 0:"span",...t,children:S})),g!=null&&g.type!==U&&!c&&(g=e.jsx(x,{variant:"body2",color:"textSecondary",...p,children:g})),e.jsxs(k,{...A,children:[S,g]})}),ce=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Ue=({setopenviewmodal:r,employee:u,company:b,editbranch:i,editbranchdata:h})=>{const f={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[c,y]=j.useState(f),D=ie(),{adminManager:M}=ge(s=>s.user),[E,d]=j.useState([]),N=localStorage.getItem("emstoken");j.useEffect(()=>{y(s=>({...s,companyId:b._id})),i&&y(s=>({...s,...h}))},[b,i]),j.useEffect(()=>{(M==null?void 0:M.length)>0&&d(M.filter(s=>s.role==="manager"))},[M]);const I=()=>{r(!1),y(f)},P=(s,n)=>{y(o=>({...o,[s]:n}))},v=(s,n,o)=>{y(k=>({...k,setting:{...k.setting,[s]:{...k.setting[s],[n]:o}}}))},S=async()=>{var s,n;try{const o=await F.post("/api/addBranch",c,{headers:{Authorization:`Bearer ${N}`}});T.success(o.data.message),r(!1),D(V()),I()}catch(o){console.error(o),T.error(((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)||"Error adding branch")}},g=async()=>{var s,n;try{const o=await F.post("/api/editBranch",c,{headers:{Authorization:`Bearer ${N}`}});T.success(o.data.message),D(V()),r(!1),I()}catch(o){console.error(o),T.error(((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:i?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(Se,{container:!0,spacing:2,children:[e.jsx(w,{label:"Branch Name",fullWidth:!0,size:"small",value:c.name,onChange:s=>P("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(w,{label:"Location",fullWidth:!0,size:"small",value:c.location,onChange:s=>P("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(ae,{size:"small",fullWidth:!0,children:[e.jsx(le,{children:"Managers"}),e.jsx(re,{multiple:!0,value:(c==null?void 0:c.managerIds)||[],onChange:s=>P("managerIds",s.target.value),input:e.jsx(ne,{label:"Managers"}),renderValue:s=>s.map(n=>{var o;return((o=E.find(k=>k._id===n))==null?void 0:o.name)||"Unknown"}).join(", "),children:E&&E.length>0?E.map(s=>{var n;return e.jsxs(Q,{value:s._id,children:[e.jsx(K,{checked:(n=c==null?void 0:c.managerIds)==null?void 0:n.includes(s._id)}),e.jsx(ee,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!(s!=null&&s.profileImage)&&e.jsx(be,{})}),e.jsx(Y,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)}):e.jsx(Q,{disabled:!0,value:"",children:e.jsx(Y,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(We,{control:e.jsx(K,{checked:!c.defaultsetting,onChange:s=>y(n=>({...n,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!c.defaultsetting&&e.jsx("div",{className:"border-yellow-300 border-2 border-dashed rounded mt-3 p-3",children:e.jsxs(X,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(w,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>v("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(w,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>v("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(w,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.officeTime.breakMinutes,onChange:s=>v("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(w,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.fullDay,onChange:s=>v("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(w,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.halfDay,onChange:s=>v("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(w,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.shortDayThreshold,onChange:s=>v("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(w,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>v("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(ae,{size:"small",fullWidth:!0,children:[e.jsx(le,{children:"Weekly Offs"}),e.jsx(re,{multiple:!0,value:c.setting.weeklyOffs,onChange:s=>y(n=>({...n,setting:{...n.setting,weeklyOffs:s.target.value}})),input:e.jsx(ne,{label:"Weekly Offs"}),renderValue:s=>s.map(n=>{var o;return(o=ce.find(k=>k.value===n))==null?void 0:o.label}).join(", "),children:ce.map(s=>e.jsxs(Q,{value:s.value,children:[e.jsx(K,{checked:c.setting.weeklyOffs.includes(s.value)}),e.jsx(Y,{primary:s.label})]},s.value))})]}),Object.entries(c.setting.attendanceRules).map(([s,n])=>{const o=s.replace(/([A-Z])/g," $1").replace(/^./,A=>A.toUpperCase()),k={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(w,{fullWidth:!0,size:"small",label:o,type:"time",value:n,onChange:A=>y(L=>({...L,setting:{...L.setting,attendanceRules:{...L.setting.attendanceRules,[s]:A.target.value}}})),helperText:k[s]},s)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(B,{variant:"outlined",onClick:I,children:"Cancel"}),i?e.jsx(B,{variant:"contained",onClick:g,children:"Save"}):e.jsx(B,{variant:"contained",onClick:S,children:"Add Branch"})]})]})},_e=async({companyinp:r,setisload:u})=>{const b=localStorage.getItem("emstoken");u(!0);try{const i=await F.post("/api/addcompany",{name:r.name,industry:r.industry},{headers:{Authorization:`Bearer ${b}`}});console.log("Query:",i),T.success(i.data.message,{autoClose:1200})}catch(i){console.log(i),i.response?T.warn(i.response.data.message,{autoClose:1200}):i.request?console.error("No response from server:",i.request):console.error("Error:",i.message)}finally{u(!1)}},G={1:"Read",2:"Create",3:"Update",4:"Delete"},me=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],se={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},He={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function Ve(){const[r,u]=j.useState([]),[b,i]=j.useState([]),[h,f]=j.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...se}}),c=ie();j.useEffect(()=>{o()},[]);const y=j.useRef(null),{handleImage:D}=ve(),[M,E]=j.useState(null),[d,N]=j.useState(!1),[I,P]=j.useState(""),[v,S]=j.useState(null),g=a=>{S(l=>l===a?null:a)},s=()=>{f({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...se}}),P(""),E(null),N(!1)},n=async()=>{const a={...h},l=new FormData;i(!0);try{const m=a.profileImage?await D(300,a.profileImage):null;m&&l.append("photo",m),l.append("name",a.name),l.append("email",a.email),l.append("role",a.role),l.append("password",a.password),l.append("permissions",JSON.stringify(a.permissions));const $=localStorage.getItem("emstoken");i(!0);const z=M!==null?`/api/editAdmin/${r[M]._id}`:"/api/addAdmin",_=await F["post"](z,l,{headers:{Authorization:`Bearer ${$}`,"Content-Type":"multipart/form-data"}});T.success(_.data.message,{autoClose:1200}),s(),o(),c(V())}catch(m){console.error(m),m.response?T.warn(m.response.data.message,{autoClose:1200}):T.error("Something went wrong",{autoClose:1200})}finally{i(!1)}},o=async()=>{try{const a=localStorage.getItem("emstoken");i(!0);const l=await F.get("/api/getAdmin",{headers:{Authorization:`Bearer ${a}`}});u(l.data)}catch(a){console.error(a),a.response?T.warn(a.response.data.message,{autoClose:1200}):T.error("Something went wrong",{autoClose:1200})}finally{i(!1)}},k=a=>{const l=r[a];f({...l,profilePreview:l.profileImage||"",profileImage:null}),E(a),N(!0)},A=async a=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async l=>{var m,$;if(l){let z;try{const W=localStorage.getItem("emstoken");i(!0),z=T.loading("Deleting...");const _=await F.delete(`/api/deleteAdmin/${a}`,{headers:{Authorization:`Bearer ${W}`}});T.update(z,{render:_.data.message,type:"success",isLoading:!1,autoClose:1800}),o(),c(V())}catch(W){console.error(W),T.update(z,{render:(($=(m=W.response)==null?void 0:m.data)==null?void 0:$.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{i(!1)}}})},L=(a,l)=>{f(m=>{const $=m.permissions[a]||[],W=$.includes(l)?$.filter(_=>_!==l):[...$,l].sort();return{...m,permissions:{...m.permissions,[a]:W}}})},t=a=>{const l=a==="admin"?{...se}:{...He};f({...h,role:a,permissions:l})},x=a=>{const l=a.target.files[0];l&&f(m=>({...m,profileImage:l,profilePreview:URL.createObjectURL(l)}))},p=()=>{I&&(f(a=>({...a,permissions:{...a.permissions,[I]:[]}})),P(""))},C=Array.from(new Set([...h.role==="admin"?me:Object.keys(h.permissions),...Object.keys(h.permissions)])),O=me.filter(a=>!C.includes(a));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-2",children:[e.jsxs("div",{className:"flex justify-between flex-wrap items-center mb-4",children:[e.jsx("h2",{className:"text-[16px] mb-2 md:mb-0 md:text-xl font-semibold",children:"Admin/Manager Management"}),e.jsx(B,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{s(),N(!0)},children:"Add Admin/ Manager"})]}),r.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:r.map((a,l)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{sx:{width:60,height:60},alt:a.name,src:a==null?void 0:a.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[a.name," (",a.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:a.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"p-2 border rounded hover:bg-gray-100",onClick:()=>k(l),children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>A(a._id),children:e.jsx(Ee,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>g(l),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",v===l?"Hide Permissions":"View Permissions "]}),v===l?e.jsx(R,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),v===l&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(G).map(m=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:m},m))]})}),e.jsx("tbody",{children:Object.entries(a.permissions).map(([m,$])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:m}),Object.keys(G).map(z=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:$.includes(Number(z))?"âœ…":"-"},z))]},m))})]})]})]})]},l))})]}),e.jsx(je,{open:d,onClose:()=>N(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"modalhead",children:[" ",M!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-[500px]",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:x,ref:y,accept:"image/*",name:"",id:"fileInput"}),e.jsx(ee,{sx:{width:70,height:70},alt:h.name,src:h.profilePreview}),e.jsx("span",{onClick:()=>y.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(ye,{size:18})})]}),e.jsx(w,{fullWidth:!0,required:!0,value:h.name,onChange:a=>f({...h,name:a.target.value}),label:"Name",size:"small"}),e.jsx(w,{fullWidth:!0,required:!0,value:h.email,onChange:a=>f({...h,email:a.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),e.jsx(w,{fullWidth:!0,required:!0,value:h.password,type:"password",onChange:a=>f({...h,password:a.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:h.role,onChange:a=>t(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),h.role==="manager"&&e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"border p-2 rounded w-full",value:I,onChange:a=>P(a.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),O.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx(B,{variant:"contained",onClick:p,children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(G).map(([a,l])=>e.jsx("th",{className:"border p-2 text-center",children:l},a))]})}),e.jsx("tbody",{children:C.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:a}),Object.keys(G).map(l=>{var m;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((m=h.permissions[a])==null?void 0:m.includes(Number(l)))||!1,onChange:()=>L(a,Number(l))})},l)})]},a))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(B,{variant:"outlined",onClick:s,children:"Cancel"}),e.jsx(B,{variant:"contained",onClick:n,loading:b,children:M!==null?"Update":"Create"})]})]})})})]})}const ue=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function Ye(){const[r,u]=j.useState(null),[b,i]=j.useState(!1),[h,f]=j.useState(!1),[c,y]=j.useState(!1),{handleImage:D}=ve(),[M,E]=j.useState(null),[d,N]=j.useState({name:"",address:"",contact:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),I=ie(),{employee:P,company:v,branch:S,profile:g}=ge(t=>t.user),s=t=>{u(x=>x===t?null:t)};j.useEffect(()=>{v&&N(v)},[v]);const n=(t,x,p)=>{N(C=>({...C,[t]:{...C[t],[x]:p}}))},o=async()=>{try{y(!0);const t=localStorage.getItem("emstoken"),x=await F.post("/api/updateCompany",{...d},{headers:{Authorization:`Bearer ${t}`}});I(V()),T.success(x.data.message,{autoClose:1800})}catch(t){console.log(t),t.response?T.warn(t.response.data.message,{autoClose:2700}):t.request?console.error("No response from server:",t.request):console.error("Error:",t.message)}finally{y(!1)}},k=()=>{},A=t=>{var p;i(!0);const x={...t,managerIds:(p=t==null?void 0:t.managerIds)==null?void 0:p.map(C=>C._id)};E(x),f(!0)},L=Ie();return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(g==null?void 0:g.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),r==="company"?e.jsx(R,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),r==="company"&&e.jsxs("div",{className:"p-4 rounded flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[d!=null&&d.logo?e.jsx("img",{src:d.logo,alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Pe,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async t=>{const x=t.target.files[0];if(!x)return;const p=await D(200,x),C=new FormData;C.append("_id",d._id),C.append("logo",p);try{console.log("api calling"),y(!0);const O=localStorage.getItem("emstoken"),l=(await F.post("/api/updateCompany",C,{headers:{Authorization:`Bearer ${O}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;N(m=>({...m,logo:l})),T.success("Logo uploaded successfully!")}catch(O){console.error(O),T.error("Failed to upload logo.")}finally{y(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"âœŽ"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Company Name"}),e.jsx("input",{type:"text",onChange:t=>N({...d,name:t.target.value}),value:d==null?void 0:d.name,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Address"}),e.jsx("input",{type:"text",onChange:t=>N({...d,address:t.target.value}),value:d==null?void 0:d.address,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Contact"}),e.jsx("input",{type:"text",onChange:t=>N({...d,contact:t.target.value}),value:d==null?void 0:d.contact,className:"w-full border rounded px-3 py-2"})]}),v?e.jsx(B,{variant:"contained",loading:c,onClick:o,children:"Save Changes"}):e.jsx(B,{loading:c,variant:"contained",onClick:()=>_e({companyinp:d,setisload:y}),children:"+ Create Company"})]})]})]}),((g==null?void 0:g.role)=="superadmin"||(g==null?void 0:g.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),r==="branches"?e.jsx(R,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),r==="branches"&&e.jsxs("div",{className:"p-1 md:p-2 rounded overflow-auto mt-2 space-y-2",children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(B,{variant:"contained",onClick:()=>f(!0),children:"+ Add Branch"})}),e.jsx(Le,{customStyles:L,columns:[{name:"Name",selector:t=>t.name,sortable:!0},{name:"Location",selector:t=>t.location,sortable:!0},{name:"Manager(s)",cell:t=>{var x;return e.jsx("div",{className:"flex flex-col gap-2",children:(x=t==null?void 0:t.managerIds)==null?void 0:x.map((p,C)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>k(p.userid),children:[e.jsx(ee,{src:p==null?void 0:p.profileImage,alt:p.name,children:!(p!=null&&p.profileImage)&&e.jsx(be,{})}),e.jsx("span",{children:p.name})]},C))})}},{name:"Actions",width:"120px",cell:t=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>A(t),children:e.jsx(ye,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>A(t),children:e.jsx(De,{})})]})}],data:S||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),r==="department"?e.jsx(R,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),r==="department"&&e.jsx("div",{className:"p-1 rounded mt-2 space-y-4",children:e.jsx(Oe,{})})]}),(g==null?void 0:g.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),r==="admin"?e.jsx(R,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),r==="admin"&&e.jsx("div",{className:"p-1 rounde mt-2 ",children:e.jsx(Ve,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),r==="attendance"?e.jsx(R,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),r==="attendance"&&v&&e.jsxs(X,{className:" rounded mt-1 p-2 ",children:[e.jsxs(X,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(w,{label:"Office Time In",fullWidth:!0,type:"time",value:d.officeTime.in,onChange:t=>n("officeTime","in",t.target.value),helperText:"Time when office hours begin"}),e.jsx(w,{label:"Office Time Out",fullWidth:!0,type:"time",value:d.officeTime.out,onChange:t=>n("officeTime","out",t.target.value),helperText:"Time when office hours end"}),e.jsx(w,{label:"Break Minutes",fullWidth:!0,type:"number",value:d.officeTime.breakMinutes,onChange:t=>n("officeTime","breakMinutes",Number(t.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(w,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:d.workingMinutes.fullDay,onChange:t=>n("workingMinutes","fullDay",Number(t.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(w,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:d.workingMinutes.halfDay,onChange:t=>n("workingMinutes","halfDay",Number(t.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(w,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:d.workingMinutes.shortDayThreshold,onChange:t=>n("workingMinutes","shortDayThreshold",Number(t.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(w,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:d.workingMinutes.overtimeAfterMinutes,onChange:t=>n("workingMinutes","overtimeAfterMinutes",Number(t.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(ae,{fullWidth:!0,children:[e.jsx(le,{children:"Weekly Offs"}),e.jsx(re,{multiple:!0,value:d.weeklyOffs,onChange:t=>N({...d,weeklyOffs:t.target.value}),input:e.jsx(ne,{label:"Weekly Offs"}),renderValue:t=>t.map(x=>{var p;return(p=ue.find(C=>C.value===x))==null?void 0:p.label}).join(", "),children:ue.map(t=>e.jsxs(Q,{value:t.value,children:[e.jsx(K,{checked:d.weeklyOffs.includes(t.value)}),e.jsx(Y,{primary:t.label})]},t.value))})]}),Object.entries(d.attendanceRules).map(([t,x])=>{const p=t.replace(/([A-Z])/g," $1").replace(/^./,O=>O.toUpperCase()),C={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(w,{fullWidth:!0,label:p,type:"time",value:x,onChange:O=>n("attendanceRules",t,O.target.value),helperText:C[t]},t)})]}),e.jsx(X,{sx:{mt:4,textAlign:"right"},children:e.jsx(B,{variant:"contained",onClick:o,children:"Update Settings"})})]})]}),e.jsx(je,{open:h,onClose:()=>{f(!1),E(null),i(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsx(Ue,{setopenviewmodal:f,editbranchdata:M,editbranch:b,company:v,employee:P})})})]})}export{Ye as default};
