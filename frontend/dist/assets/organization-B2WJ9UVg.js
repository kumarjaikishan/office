import{r as g,a5 as Ce,a6 as ke,a7 as de,a8 as Se,a9 as Ae,T as X,j as e,aa as Te,ab as Me,ac as ee,ad as pe,u as ie,g as ue,b as j,F as Y,I as K,S as J,M as q,A as re,l as je,O as ne,V as ae,B as E,c as L,y as k,m as H,R as he,W as Ie,i as Ee,C as Pe,a0 as be,a1 as oe,ae as ze,U as De,af as Be,a2 as G,a3 as Z,k as $e}from"./index-D1fsttMJ.js";import{C as te}from"./Checkbox-DLlrArie.js";import{F as Oe}from"./FormControlLabel-DTRVJtpF.js";import{u as ve,I as xe}from"./attandencehelper-DlE5eu2R.js";import{A as me,a as Le}from"./index-BuS6xXjA.js";import{u as we}from"./imageresizer-D4I-KFLq.js";import{G as We}from"./Grid-srTxac53.js";import"./styled-BrWe2Nie.js";import"./useThemeProps-DngCwfgt.js";const Fe=r=>{const{classes:f,inset:w,primary:m,secondary:o,dense:v}=r;return Te({root:["root",w&&"inset",v&&"dense",m&&o&&"multiline"],primary:["primary"],secondary:["secondary"]},Me,f)},Re=Se("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(r,f)=>{const{ownerState:w}=r;return[{[`& .${ee.primary}`]:f.primary},{[`& .${ee.secondary}`]:f.secondary},f.root,w.inset&&f.inset,w.primary&&w.secondary&&f.multiline,w.dense&&f.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${pe.root}:where(& .${ee.primary})`]:{display:"block"},[`.${pe.root}:where(& .${ee.secondary})`]:{display:"block"},variants:[{props:({ownerState:r})=>r.primary&&r.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:r})=>r.inset,style:{paddingLeft:56}}]}),le=g.forwardRef(function(f,w){const m=Ce({props:f,name:"MuiListItemText"}),{children:o,className:v,disableTypography:c=!1,inset:b=!1,primary:P,primaryTypographyProps:S,secondary:h,secondaryTypographyProps:l,slots:x={},slotProps:z={},...$}=m,{dense:A}=g.useContext(ke);let I=P??o,y=h;const a={...m,disableTypography:c,inset:b,primary:!!I,secondary:!!y,dense:A},d=Fe(a),u={slots:x,slotProps:{primary:S,secondary:l,...z}},[M,D]=de("root",{className:Ae(d.root,v),elementType:Re,externalForwardedProps:{...u,...$},ownerState:a,ref:w}),[O,s]=de("primary",{className:d.primary,elementType:X,externalForwardedProps:u,ownerState:a}),[p,i]=de("secondary",{className:d.secondary,elementType:X,externalForwardedProps:u,ownerState:a});return I!=null&&I.type!==X&&!c&&(I=e.jsx(O,{variant:A?"body2":"body1",component:s!=null&&s.variant?void 0:"span",...s,children:I})),y!=null&&y.type!==X&&!c&&(y=e.jsx(p,{variant:"body2",color:"textSecondary",...i,children:y})),e.jsxs(M,{...D,children:[I,y]})}),fe=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],_e=({setopenviewmodal:r,employee:f,company:w,editbranch:m,editbranchdata:o})=>{const v={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[c,b]=g.useState(v),P=ie(),{adminManager:S}=ue(a=>a.user),[h,l]=g.useState([]),x=localStorage.getItem("emstoken");g.useEffect(()=>{b(a=>({...a,companyId:w._id})),m&&b(a=>({...a,...o}))},[w,m]),g.useEffect(()=>{(S==null?void 0:S.length)>0&&l(S.filter(a=>a.role==="manager"))},[S]);const z=()=>{r(!1),b(v)},$=(a,d)=>{b(u=>({...u,[a]:d}))},A=(a,d,u)=>{b(M=>({...M,setting:{...M.setting,[a]:{...M.setting[a],[d]:u}}}))},I=async()=>{var a,d;try{const u=await L.post("/api/addBranch",c,{headers:{Authorization:`Bearer ${x}`}});k.success(u.data.message),r(!1),P(H()),z()}catch(u){console.error(u),k.error(((d=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:d.message)||"Error adding branch")}},y=async()=>{var a,d;try{const u=await L.post("/api/editBranch",c,{headers:{Authorization:`Bearer ${x}`}});k.success(u.data.message),P(H()),r(!1),z()}catch(u){console.error(u),k.error(((d=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:d.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:m?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(j,{label:"Branch Name",fullWidth:!0,size:"small",value:c.name,onChange:a=>$("name",a.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(j,{label:"Location",fullWidth:!0,size:"small",value:c.location,onChange:a=>$("location",a.target.value),helperText:"City, State or Address"}),e.jsxs(Y,{size:"small",fullWidth:!0,children:[e.jsx(K,{children:"Managers"}),e.jsx(J,{multiple:!0,value:(c==null?void 0:c.managerIds)||[],onChange:a=>$("managerIds",a.target.value),input:e.jsx(ne,{label:"Managers"}),renderValue:a=>a.map(d=>{var u;return((u=h.find(M=>M._id===d))==null?void 0:u.name)||"Unknown"}).join(", "),children:h&&h.length>0?h.map(a=>{var d;return e.jsxs(q,{value:a._id,children:[e.jsx(te,{checked:(d=c==null?void 0:c.managerIds)==null?void 0:d.includes(a._id)}),e.jsx(re,{src:a==null?void 0:a.profileImage,alt:a==null?void 0:a.name,children:!(a!=null&&a.profileImage)&&e.jsx(je,{})}),e.jsx(le,{className:"ml-2 capitalize",primary:a==null?void 0:a.name})]},a._id)}):e.jsx(q,{disabled:!0,value:"",children:e.jsx(le,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(Oe,{control:e.jsx(te,{checked:!c.defaultsetting,onChange:a=>b(d=>({...d,defaultsetting:!a.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!c.defaultsetting&&e.jsx("div",{className:"border-primary border-2 border-dashed rounded mt-3 py-3 px-1",children:e.jsxs(ae,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(j,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:a=>A("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(j,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:a=>A("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(j,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.officeTime.breakMinutes,onChange:a=>A("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(j,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.fullDay,onChange:a=>A("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(j,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.halfDay,onChange:a=>A("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(j,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.shortDayThreshold,onChange:a=>A("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(j,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.overtimeAfterMinutes,onChange:a=>A("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(Y,{size:"small",fullWidth:!0,children:[e.jsx(K,{children:"Weekly Offs"}),e.jsx(J,{multiple:!0,value:c.setting.weeklyOffs,onChange:a=>b(d=>({...d,setting:{...d.setting,weeklyOffs:a.target.value}})),input:e.jsx(ne,{label:"Weekly Offs"}),renderValue:a=>a.map(d=>{var u;return(u=fe.find(M=>M.value===d))==null?void 0:u.label}).join(", "),children:fe.map(a=>e.jsxs(q,{value:a.value,children:[e.jsx(te,{checked:c.setting.weeklyOffs.includes(a.value)}),e.jsx(le,{primary:a.label})]},a.value))})]}),Object.entries(c.setting.attendanceRules).map(([a,d])=>{const u=a.replace(/([A-Z])/g," $1").replace(/^./,D=>D.toUpperCase()),M={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(j,{fullWidth:!0,size:"small",label:u,type:"time",value:d,onChange:D=>b(O=>({...O,setting:{...O.setting,attendanceRules:{...O.setting.attendanceRules,[a]:D.target.value}}})),helperText:M[a]},a)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(E,{variant:"outlined",onClick:z,children:"Cancel"}),m?e.jsx(E,{variant:"contained",onClick:y,children:"Save"}):e.jsx(E,{variant:"contained",onClick:I,children:"Add Branch"})]})]})},qe=async({companyinp:r,setisload:f})=>{const w=localStorage.getItem("emstoken");f(!0);try{const m=await L.post("/api/addcompany",{name:r.name,industry:r.industry},{headers:{Authorization:`Bearer ${w}`}});console.log("Query:",m),k.success(m.data.message,{autoClose:1200})}catch(m){console.log(m),m.response?k.warn(m.response.data.message,{autoClose:1200}):m.request?console.error("No response from server:",m.request):console.error("Error:",m.message)}finally{f(!1)}},Ue=[{name:"S.no",selector:r=>r.sno,width:"40px"},{name:"Branch",selector:r=>r.branch},{name:"Department",selector:r=>r.dep_name},{name:"Action",selector:r=>r.action,width:"80px"}],He=async({inp:r,setisload:f,setInp:w,setopenmodal:m,init:o,dispatch:v})=>{console.log(r);const{branchId:c,department:b,description:P}=r;if(!b){alert("Please fill in both fields");return}const S=localStorage.getItem("emstoken");f(!0);try{const h=await L.post("/api/adddepartment",{department:b,branchId:c,description:P},{headers:{Authorization:`Bearer ${S}`}});v(H()),k.success(h.data.message,{autoClose:1200}),w(o),m(!1)}catch(h){console.log(h),h.response?k.warn(h.response.data.message,{autoClose:1200}):h.request?console.error("No response from server:",h.request):console.error("Error:",h.message)}finally{f(!1)}},Ve=async({inp:r,setisload:f,setInp:w,setopenmodal:m,init:o,dispatch:v})=>{const{departmentId:c,department:b,description:P}=r;if(!b||!c){alert("All fileds are Required");return}const S=localStorage.getItem("emstoken");f(!0);try{const h=await L.post("/api/updatedepartment",{departmentId:c,department:b,description:P},{headers:{Authorization:`Bearer ${S}`}});v(H()),k.success(h.data.message,{autoClose:1200}),w(o),m(!1)}catch(h){console.log(h),h.response?k.warn(h.response.data.message,{autoClose:1200}):h.request?console.error("No response from server:",h.request):console.error("Error:",h.message)}finally{f(!1)}},Ge=async({departmentId:r,setisload:f,dispatch:w})=>{if(!r){alert("All fileds are Required");return}const m=localStorage.getItem("emstoken");f(!0);try{const o=await L.post("/api/deletedepartment",{departmentId:r},{headers:{Authorization:`Bearer ${m}`}});w(H()),k.success(o.data.message,{autoClose:1200})}catch(o){console.log(o),o.response?k.warn(o.response.data.message,{autoClose:1200}):o.request?console.error("No response from server:",o.request):console.error("Error:",o.message)}finally{f(!1)}},Ze=()=>{const[r,f]=g.useState(!1),[w,m]=g.useState(!1),[o,v]=g.useState([]),[c,b]=g.useState(!1),[P,S]=g.useState([]),{branch:h,department:l}=ue(s=>s.user),[x,z]=g.useState({branch:"all",department:" "}),$=x.branch!=="all"||x.department.trim()!=="",A=ie();g.useEffect(()=>{if(!o||o.length===0)return;const s=o.filter(p=>{var T;const i=x.branch==="all"||p.branchid===x.branch,N=x.department.trim()===""||((T=p.dep_name)==null?void 0:T.toLowerCase().includes(x.department.trim().toLowerCase()));return i&&N});S(s)},[x,o]);const I={departmentId:"",branchId:"",department:"",description:""},[y,a]=g.useState(I);g.useEffect(()=>{if(l.length>0){let s=1;const p=l.map(i=>{var N,T;return{id:i._id,sno:s++,branchid:(N=i==null?void 0:i.branchId)==null?void 0:N._id,branch:(T=i==null?void 0:i.branchId)==null?void 0:T.name,dep_name:i==null?void 0:i.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>M(i),children:e.jsx(he,{})}),e.jsx("span",{className:"delete",onClick:()=>D(i._id),children:e.jsx(me,{})})]})}});v(p)}},[l]);const d=(s,p)=>{a({...y,[p]:s.target.value})},u=s=>{s.preventDefault(),He({inp:y,setisload:m,setInp:a,setopenmodal:f,init:I,dispatch:A})},M=s=>{console.log("edit",s),b(!0),a({branchId:s.branchId._id,departmentId:s._id,department:s.department,description:s.description}),f(!0)},D=s=>{console.log("delete",s),Ie({title:"Are you sure?",text:"Once deleted, All empoyee of this department deleted",icon:"warning",buttons:!0,dangerMode:!0}).then(async p=>{p&&Ge({departmentId:s,setisload:m,dispatch:A})})},O=()=>{Ve({inp:y,setisload:m,setInp:a,setopenmodal:f,init:I,dispatch:A})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(Y,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(K,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(J,{value:x.branch,onChange:s=>z({...x,branch:s.target.value}),input:e.jsx(ne,{startAdornment:e.jsx(Ee,{position:"start",children:e.jsx(Pe,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(q,{selected:!0,value:"all",children:"All"}),h==null?void 0:h.map(s=>e.jsx(q,{value:s._id,children:s.name},s._id))]})]}),e.jsx(j,{size:"small",id:"outlined-basic",value:x.department,onChange:s=>z({...x,department:s.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(E,{className:"w-full md:w-auto",variant:"contained",onClick:()=>f(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(be,{customStyles:ve(),columns:Ue,data:$?P:o,pagination:!0,highlightOnHover:!0})}),e.jsx(oe,{open:r,onClose:()=>f(!1),children:e.jsx("div",{className:"membermodal w-[650px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Add Department"}),e.jsx("form",{onSubmit:u,children:e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs(Y,{sx:{width:"98%"},size:"small",children:[e.jsx(K,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(J,{value:y.branchId,label:"branch",onChange:s=>d(s,"branchId"),children:h==null?void 0:h.map(s=>e.jsx(q,{value:s._id,children:s.name},s._id))})]}),e.jsx(j,{sx:{width:"98%"},required:!0,value:y.department,onChange:s=>d(s,"department"),label:"Department",size:"small"}),e.jsx(j,{multiline:!0,rows:4,onChange:s=>d(s,"description"),value:y.description,sx:{width:"98%"},label:"Description",size:"small"})]})})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(E,{size:"small",onClick:()=>{f(!1),b(!1),a(I)},variant:"outlined",children:" cancel"}),!c&&e.jsx(E,{sx:{mr:2},loading:w,loadingPosition:"end",endIcon:e.jsx(xe,{}),onClick:u,variant:"contained",type:"submit",children:"Add"}),c&&e.jsx(E,{sx:{mr:2},loading:w,loadingPosition:"end",endIcon:e.jsx(xe,{}),variant:"contained",onClick:O,children:"Update"})]})]})})})]})},se={1:"Read",2:"Create",3:"Update",4:"Delete"},ge=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],ce={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},Je={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function Qe(){const[r,f]=g.useState([]),[w,m]=g.useState([]),[o,v]=g.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ce}}),c=ie();g.useEffect(()=>{s()},[]);const b=g.useRef(null),{handleImage:P}=we(),[S,h]=g.useState(null),[l,x]=g.useState(!1),[z,$]=g.useState(""),[A,I]=g.useState(!1),[y,a]=g.useState(null),d=t=>{a(n=>n===t?null:t)},u=()=>{v({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ce}}),$(""),h(null),x(!1)},[M,D]=g.useState({userid:"",pass:""}),O=async()=>{const t={...o},n=new FormData;m(!0);try{const C=t.profileImage?await P(240,t.profileImage):null;C&&n.append("photo",C),n.append("name",t.name),n.append("email",t.email),n.append("role",t.role),n.append("password",t.password),n.append("permissions",JSON.stringify(t.permissions));const R=localStorage.getItem("emstoken");m(!0);const _=S!==null?`/api/editAdmin/${r[S]._id}`:"/api/addAdmin",Q=await L["post"](_,n,{headers:{Authorization:`Bearer ${R}`,"Content-Type":"multipart/form-data"}});k.success(Q.data.message,{autoClose:1200}),u(),s(),c(H())}catch(C){console.error(C),C.response?k.warn(C.response.data.message,{autoClose:1200}):k.error("Something went wrong",{autoClose:1200})}finally{m(!1)}},s=async()=>{try{const t=localStorage.getItem("emstoken");m(!0);const n=await L.get("/api/getAdmin",{headers:{Authorization:`Bearer ${t}`}});f(n.data)}catch(t){console.error(t),t.response?k.warn(t.response.data.message,{autoClose:1200}):k.error("Something went wrong",{autoClose:1200})}finally{m(!1)}},p=t=>{const n=r[t];console.log(n),v({...n,profilePreview:n.profileImage||"",profileImage:null}),h(t),x(!0)},i=async t=>{t.preventDefault();try{const n=localStorage.getItem("emstoken"),C=await L.post("/api/updatepassword",{pass:M},{headers:{Authorization:`Bearer ${n}`}});D({userid:"",pass:""}),I(!1),k.success(C.data.message,{autoClose:1200})}catch(n){console.log(n),n.response?k.warn(n.response.data.message,{autoClose:1200}):n.request?console.error("No response from server:",n.request):console.error("Error:",n.message)}},N=async t=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async n=>{var C,R;if(n){let _;try{const V=localStorage.getItem("emstoken");m(!0),_=k.loading("Deleting...");const Q=await L.delete(`/api/deleteAdmin/${t}`,{headers:{Authorization:`Bearer ${V}`}});k.update(_,{render:Q.data.message,type:"success",isLoading:!1,autoClose:1800}),s(),c(H())}catch(V){console.error(V),k.update(_,{render:((R=(C=V.response)==null?void 0:C.data)==null?void 0:R.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{m(!1)}}})},T=(t,n)=>{v(C=>{const R=C.permissions[t]||[],V=R.includes(n)?R.filter(Q=>Q!==n):[...R,n].sort();return{...C,permissions:{...C.permissions,[t]:V}}})},W=t=>{const n=t==="admin"?{...ce}:{...Je};v({...o,role:t,permissions:n})},F=t=>{const n=t.target.files[0];n&&v(C=>({...C,profileImage:n,profilePreview:URL.createObjectURL(n)}))},B=()=>{z&&(v(t=>({...t,permissions:{...t.permissions,[z]:[]}})),$(""))},U=Array.from(new Set([...o.role==="admin"?ge:Object.keys(o.permissions),...Object.keys(o.permissions)])),Ne=ge.filter(t=>!U.includes(t));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:" shadow-md rounded-lg",children:[e.jsx("div",{className:"flex justify-between flex-wrap items-center mb-4",children:e.jsx(E,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{u(),x(!0)},children:"Add Admin/ Manager"})}),r.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:r.map((t,n)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(re,{sx:{width:60,height:60},alt:t.name,src:t==null?void 0:t.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[t.name," (",t.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:t.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{title:"Edit",className:"p-2 border rounded hover:bg-gray-100",onClick:()=>p(n),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx("button",{title:"Password Reset",className:"p-2 border rounded hover:bg-gray-100 text-green-500",onClick:()=>{D({...M,userid:t._id}),I(!0)},children:e.jsx(De,{className:"h-4 w-4 "})}),e.jsx("button",{title:"Delete",className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>N(t._id),children:e.jsx(Be,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>d(n),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",y===n?"Hide Permissions":"View Permissions "]}),y===n?e.jsx(G,{className:"text-xl"}):e.jsx(Z,{className:"text-xl"})]}),y===n&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(se).map(C=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:C},C))]})}),e.jsx("tbody",{children:Object.entries(t.permissions).map(([C,R])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:C}),Object.keys(se).map(_=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:R.includes(Number(_))?"✅":"-"},_))]},C))})]})]})]})]},n))})]}),e.jsx(oe,{open:l,onClose:()=>x(!1),children:e.jsx("div",{className:"membermodal w-[660px]",children:e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"modalhead",children:[" ",S!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-full",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:F,ref:b,accept:"image/*",name:"",id:"fileInput"}),e.jsx(re,{sx:{width:70,height:70},alt:o.name,src:o.profilePreview}),e.jsx("span",{onClick:()=>b.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(he,{size:18})})]}),e.jsx(j,{fullWidth:!0,required:!0,value:o.name,onChange:t=>v({...o,name:t.target.value}),label:"Name",size:"small"}),e.jsx(j,{fullWidth:!0,required:!0,value:o.email,onChange:t=>v({...o,email:t.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),S==null&&e.jsxs(e.Fragment,{children:[e.jsx(j,{fullWidth:!0,required:!0,value:o.password,type:"password",onChange:t=>v({...o,password:t.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:o.role,onChange:t=>W(t.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]})]}),o.role==="manager"&&e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border p-2 flex-3 rounded ",value:z,onChange:t=>$(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),Ne.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(E,{variant:"contained",onClick:B,className:"flex-1",children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(se).map(([t,n])=>e.jsx("th",{className:"border p-2 text-center",children:n},t))]})}),e.jsx("tbody",{children:U.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:t}),Object.keys(se).map(n=>{var C;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((C=o.permissions[t])==null?void 0:C.includes(Number(n)))||!1,onChange:()=>T(t,Number(n))})},n)})]},t))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(E,{variant:"outlined",onClick:u,children:"Cancel"}),e.jsx(E,{variant:"contained",onClick:O,loading:w,children:S!==null?"Update":"Create"})]})]})})}),e.jsx(oe,{open:A,onClose:()=>{I(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:i,children:[e.jsx("h2",{children:"Reset Passowrd"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(j,{fullWidth:!0,inputProps:{minLength:3,maxLength:10},required:!0,value:M.pass,onChange:t=>D({...M,pass:t.target.value}),label:"Passowrd",size:"small"}),e.jsx(E,{variant:"contained",sx:{mr:2},type:"submit",children:"Reset Password"})]})]})})})]})}const ye=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function ns(){const[r,f]=g.useState(null),[w,m]=g.useState(!1),[o,v]=g.useState(!1),[c,b]=g.useState(!1),{handleImage:P}=we(),[S,h]=g.useState(null),[l,x]=g.useState({name:"",address:"",contact:"",fullname:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"},payrollPolicies:{allowances:[],bonuses:[],deductions:[]}}),z=ie(),{employee:$,company:A,branch:I,profile:y}=ue(s=>s.user),a=s=>{f(p=>p===s?null:s)};g.useEffect(()=>{A&&x(A)},[A]);const d=(s,p,i)=>{x(N=>({...N,[s]:{...N[s],[p]:i}}))},u=async()=>{try{b(!0);const s=localStorage.getItem("emstoken"),p=await L.post("/api/updateCompany",{...l},{headers:{Authorization:`Bearer ${s}`}});z(H()),k.success(p.data.message,{autoClose:1800})}catch(s){console.log(s),s.response?k.warn(s.response.data.message,{autoClose:2700}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{b(!1)}},M=()=>{},D=s=>{var i;m(!0);const p={...s,managerIds:(i=s==null?void 0:s.managerIds)==null?void 0:i.map(N=>N._id)};h(p),v(!0)},O=ve();return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(y==null?void 0:y.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>a("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),r==="company"?e.jsx(G,{className:"text-xl"}):e.jsx(Z,{className:"text-xl"})]}),e.jsx("div",{className:` 
                          rounded overflow-hidden transition-all duration-300 
                          ${r==="company"?"max-h-fit p-0 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsxs("div",{className:"p-1 md:p-4 rounded  flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[l!=null&&l.logo?e.jsx("img",{src:$e(l.logo,{format:"webp",width:200,height:200})||employepic,alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Le,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async s=>{const p=s.target.files[0];if(!p)return;const i=await P(300,p),N=new FormData;N.append("_id",l._id),N.append("logo",i);try{b(!0);const T=localStorage.getItem("emstoken"),F=(await L.post("/api/updateCompany",N,{headers:{Authorization:`Bearer ${T}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;x(B=>({...B,logo:F})),k.success("Logo uploaded successfully!")}catch(T){console.error(T),k.error("Failed to upload logo.")}finally{b(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(j,{label:"Company Name",size:"small",variant:"standard",fullWidth:!0,value:(l==null?void 0:l.name)||"",onChange:s=>x({...l,name:s.target.value})})}),e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(j,{label:"Contact",type:"tel",variant:"standard",size:"small",fullWidth:!0,value:(l==null?void 0:l.contact)||"",inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},onChange:s=>x({...l,contact:s.target.value.replace(/\D/g,"")})})})]}),e.jsx("div",{children:e.jsx(j,{label:"Company Full Name",variant:"standard",fullWidth:!0,size:"small",value:(l==null?void 0:l.fullname)||"",onChange:s=>x({...l,fullname:s.target.value})})}),e.jsx("div",{children:e.jsx(j,{label:"Address",fullWidth:!0,multiline:!0,size:"small",minRows:2,value:(l==null?void 0:l.address)||"",onChange:s=>x({...l,address:s.target.value})})}),A?e.jsx(E,{variant:"contained",loading:c,onClick:u,children:"Save Changes"}):e.jsx(E,{loading:c,variant:"contained",onClick:()=>qe({companyinp:l,setisload:b}),children:"+ Create Company"})]})]})})]}),((y==null?void 0:y.role)=="superadmin"||(y==null?void 0:y.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>a("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),r==="branches"?e.jsx(G,{className:"text-xl"}):e.jsx(Z,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded space-y-1 overflow-hidden transition-all duration-300
                          ${r==="branches"?"max-h-fit p-1 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(E,{variant:"contained",onClick:()=>v(!0),children:"+ Add Branch"})}),e.jsx(be,{customStyles:O,columns:[{name:"Name",selector:s=>s.name,sortable:!0},{name:"Location",selector:s=>s.location,sortable:!0},{name:"Manager(s)",cell:s=>{var p;return e.jsx("div",{className:"flex flex-col gap-2",children:(p=s==null?void 0:s.managerIds)==null?void 0:p.map((i,N)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>M(i.userid),children:[e.jsx(re,{src:i==null?void 0:i.profileImage,alt:i.name,children:!(i!=null&&i.profileImage)&&e.jsx(je,{})}),e.jsx("span",{children:i.name})]},N))})}},{name:"Actions",width:"120px",cell:s=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>D(s),children:e.jsx(he,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>D(s),children:e.jsx(me,{})})]})}],data:I||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>a("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),r==="department"?e.jsx(G,{className:"text-xl"}):e.jsx(Z,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${r==="department"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(Ze,{})})]}),(y==null?void 0:y.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>a("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),r==="admin"?e.jsx(G,{className:"text-xl"}):e.jsx(Z,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${r==="admin"?"max-h-fit md:p-2 p-1 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(Qe,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>a("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),r==="attendance"?e.jsx(G,{className:"text-xl"}):e.jsx(Z,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${r==="attendance"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs(ae,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(j,{label:"Office Time In",fullWidth:!0,type:"time",value:l.officeTime.in,onChange:s=>d("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(j,{label:"Office Time Out",fullWidth:!0,type:"time",value:l.officeTime.out,onChange:s=>d("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(j,{label:"Break Minutes",fullWidth:!0,type:"number",value:l.officeTime.breakMinutes,onChange:s=>d("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(j,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:l.workingMinutes.fullDay,onChange:s=>d("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(j,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:l.workingMinutes.halfDay,onChange:s=>d("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(j,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:l.workingMinutes.shortDayThreshold,onChange:s=>d("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(j,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:l.workingMinutes.overtimeAfterMinutes,onChange:s=>d("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(Y,{fullWidth:!0,children:[e.jsx(K,{children:"Weekly Offs"}),e.jsx(J,{multiple:!0,value:l.weeklyOffs,onChange:s=>x({...l,weeklyOffs:s.target.value}),input:e.jsx(ne,{label:"Weekly Offs"}),renderValue:s=>s.map(p=>{var i;return(i=ye.find(N=>N.value===p))==null?void 0:i.label}).join(", "),children:ye.map(s=>e.jsxs(q,{value:s.value,children:[e.jsx(te,{checked:l.weeklyOffs.includes(s.value)}),e.jsx(le,{primary:s.label})]},s.value))})]}),Object.entries(l.attendanceRules).map(([s,p])=>{const i=s.replace(/([A-Z])/g," $1").replace(/^./,T=>T.toUpperCase()),N={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(j,{fullWidth:!0,label:i,type:"time",value:p,onChange:T=>d("attendanceRules",s,T.target.value),helperText:N[s]},s)})]}),e.jsx(ae,{sx:{mt:4,textAlign:"right"},children:e.jsx(E,{variant:"contained",onClick:u,children:"Update Settings"})})]})]}),e.jsxs("div",{className:"border shadow-lg bg-purple-50 border-dashed border-purple-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-purple-200 px-4 py-2 rounded-md",onClick:()=>a("policies"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Default Payroll Policies"}),r==="policies"?e.jsx(G,{className:"text-xl"}):e.jsx(Z,{className:"text-xl"})]}),e.jsxs("div",{className:`rounded overflow-hidden transition-all duration-300 
                     ${r==="policies"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}`,children:[e.jsx("div",{className:"flex flex-col gap-3",children:["allowances","bonuses","deductions"].map(s=>{var i;const p=((i=l==null?void 0:l.payrollPolicies)==null?void 0:i[s])||[];return e.jsxs(We,{item:!0,xs:12,md:4,children:[e.jsx(X,{variant:"h6",className:"capitalize",children:s}),p.map((N,T)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{label:"Name",size:"small",value:N.name,onChange:W=>{const F=p.map((B,U)=>U===T?{...B,name:W.target.value}:B);x({...l,payrollPolicies:{...l.payrollPolicies,[s]:F}})}}),e.jsxs(J,{size:"small",className:"w-[120px]",value:N.type,onChange:W=>{const F=p.map((B,U)=>U===T?{...B,type:W.target.value}:B);x({...l,payrollPolicies:{...l.payrollPolicies,[s]:F}})},children:[e.jsx(q,{value:"amount",children:"Amount"}),e.jsx(q,{value:"percentage",children:"%"})]}),e.jsx(j,{label:N.type==="amount"?"₹":"%",type:"number",size:"small",value:N.value,onChange:W=>{const F=p.map((B,U)=>U===T?{...B,value:Number(W.target.value)}:B);x({...l,payrollPolicies:{...l.payrollPolicies,[s]:F}})}}),e.jsx(me,{className:"text-red-500 cursor-pointer text-lg",onClick:()=>{const W=p.filter((F,B)=>B!==T);x({...l,payrollPolicies:{...l.payrollPolicies,[s]:W}})}})]},T)),e.jsxs(E,{size:"small",variant:"outlined",onClick:()=>x({...l,payrollPolicies:{...l.payrollPolicies,[s]:[...p,{name:"",type:"amount",value:0}]}}),children:["+ Add ",s.slice(0,-1)]})]},s)})}),e.jsx(ae,{sx:{mt:2,textAlign:"right"},children:e.jsx(E,{variant:"contained",onClick:u,children:"Save Policies"})})]})]}),e.jsx(oe,{open:o,onClose:()=>{v(!1),h(null),m(!1)},children:e.jsx("div",{className:"membermodal w-[680px]",children:e.jsx(_e,{setopenviewmodal:v,editbranchdata:S,editbranch:w,company:A,employee:$})})})]})}export{ns as default};
