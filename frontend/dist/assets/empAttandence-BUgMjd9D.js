import{f as U,r as i,j as e,B as Fe,af as Ie,ag as Te,ah as Ce,ak as Ye,al as Be,am as He,an as Pe,g as t}from"./index-Be_QPdDA.js";import{a as ze}from"./index-BgxvZXJV.js";import{X as We}from"./index.es-Bwtc4Ut-.js";import{P as $e,R as _e}from"./PieChart-B9SwWfcz.js";import{a as oe}from"./index-BvCueg8_.js";import{u as Xe}from"./attandencehelper-DfRGmELq.js";import{F as O,I as _,S as X}from"./Select-wtP9BYgZ.js";import{M as g}from"./MenuItem-BJd3KrCW.js";import{T as de}from"./TextField-Bwsdogxn.js";import{B as Ue}from"./Button-BIzmkch7.js";import"./ButtonBase-BuAZY-7T.js";import"./index-BZeVrLDG.js";import"./useThemeProps-qeC2oJeJ.js";import"./useSlotProps-CjQPci2g.js";import"./Typography-BKet93uY.js";import"./createSimplePaletteValueFilter-DkxTn1m9.js";import"./Popper-B-Gfda_H.js";import"./IconButton-B9DtNOtw.js";const qe=({attandence:r,hell:a})=>{var p,R,F,I,T,M,A,b,D,k;const{profile:d}=U(w=>w.employee);i.useEffect(()=>{},[r]);const c=(((p=a==null?void 0:a.present)==null?void 0:p.length)||0)+(((R=a==null?void 0:a.absent)==null?void 0:R.length)||0)+(((F=a==null?void 0:a.leave)==null?void 0:F.length)||0),u=i.useMemo(()=>{var w,v,C;return{present:c?Math.floor(((w=a==null?void 0:a.present)==null?void 0:w.length)/c*100):0,absent:c?Math.floor(((v=a==null?void 0:a.absent)==null?void 0:v.length)/c*100):0,leave:c?Math.floor(((C=a==null?void 0:a.leave)==null?void 0:C.length)/c*100):0}},[a,c]),y=c?[{id:0,value:u.present,color:"teal",label:"Present"},{id:1,value:u.leave,color:"orange",label:"Leave"},{id:2,value:u.absent,color:"rgb(156 163 175)",label:"Absent"}]:[{id:0,value:100,color:"rgb(156 163 175)",label:"No record"}],m={width:300,height:300},j={innerRadius:130,outerRadius:150};return e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center min-h-[200px] bg-[#e0e4e7] p-1 space-y-1 md:space-y-0 md:space-x-2",children:[e.jsxs("div",{className:"relative w-80 h-80 flex items-center justify-center z-2 rounded-full",children:[e.jsx($e,{series:[{innerRadius:j.innerRadius,outerRadius:j.outerRadius,data:y,paddingAngle:1,cornerRadius:5}],width:m.width,height:m.height,legend:{hidden:!0}}),e.jsx("div",{className:"absolute w-63 h-63 rounded-full overflow-hidden border-4 border-white",children:e.jsx("img",{src:(d==null?void 0:d.profileimage)||"https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",alt:(d==null?void 0:d.designation)||"Employee",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-[550px]",children:[e.jsxs("div",{className:"attandencecarde",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Fe,{})," Total Days"]}),e.jsx("span",{className:"font-bold text-gray-600",children:c})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ie,{})," Present"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((I=a==null?void 0:a.present)==null?void 0:I.length)||0," Days"," ",u.present?`(${u.present}%)`:""]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Te,{})," Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((T=a==null?void 0:a.leave)==null?void 0:T.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ce,{})," Absent"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((M=a==null?void 0:a.absent)==null?void 0:M.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ye,{})," Late Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((A=a==null?void 0:a.latearrival)==null?void 0:A.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Be,{})," Early Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((b=a==null?void 0:a.earlyLeave)==null?void 0:b.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(He,{})," Early Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((D=a==null?void 0:a.earlyarrival)==null?void 0:D.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Pe,{})," Late Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((k=a==null?void 0:a.lateleave)==null?void 0:k.length)||0})]})]})]})]})},fa=()=>{const[r,a]=i.useState([]),[d,c]=i.useState(!1),{holidays:u}=U(s=>s.user),{attendance:y,companysetting:m,profile:j}=U(s=>s.employee),[l,p]=i.useState(null),[R,F]=i.useState([]),[I,T]=i.useState([]),[M,A]=i.useState(t().year()),[b,D]=i.useState(t().month()),[k,w]=i.useState("all"),[v,C]=i.useState("all"),[H,ce]=i.useState("all"),[P,q]=i.useState(null),[z,G]=i.useState(null),[N,ue]=i.useState({present:[],absent:[],leave:[],holiday:[],short:[],overtime:[],latearrival:[],earlyarrival:[],earlyLeave:[],lateleave:[],shorttimemin:0,overtimemin:0,overtimesalary:0}),me=t().year(),xe=Array.from({length:8},(s,n)=>me+1-n),fe=Array.from({length:12},(s,n)=>({label:t().month(n).format("MMMM"),value:n}));i.useEffect(()=>{y&&a(y),m&&p(m)},[y]),i.useEffect(()=>{if(!u)return;const s=[];u.forEach(n=>{let h=t(n.fromDate);const o=n.toDate?t(n.toDate):h;for(;h.isSameOrBefore(o,"day");)s.push(h.format("DD/MM/YYYY")),h=h.add(1,"day")}),F(s)},[u]),i.useEffect(()=>{var ae;if(!r.length||!l)return;const s=r.filter(f=>{const x=t(f.date);return x.year()===M&&(b==="all"||x.month()===b)}),n=[],h=[],o=[],J=[],K=[],W=[],Q=[],V=[],Z=[],ee=[];let $=0,Y=0,B=[];s.forEach(f=>{var ie;const x=t(f.date).toDate();let ye=t(f.date).format("DD/MM/YYYY");const te=R.includes(ye),ve=t(f.date).startOf("day").day(),se=(ie=m==null?void 0:m.weeklyOffs)==null?void 0:ie.includes(ve),re=f.status=="leave",ne=f.status=="absent";te&&!re&&!ne?B.push({...f,remarks:"worked on holiday"}):se&&!re&&!ne?B.push({...f,remarks:"worked on weekly off"}):B.push(f);const le=f.status;switch(le){case"present":n.push(x);break;case"absent":h.push(x);break;case"leave":o.push(x);break;case"holiday":J.push(x);break}if(le!=="present")return;const{punchIn:E,punchOut:L,workingMinutes:S}=f;if(!E||!L||typeof S!="number")return;if(te||se)W.push(x),Y+=S;else{const Oe=S<l.workingMinutes.fullDay,Re=S>=l.workingMinutes.fullDay;Oe&&(K.push(x),$+=l.workingMinutes.fullDay-S),Re&&(W.push(x),Y+=S-l.workingMinutes.fullDay)}const[ge,je]=l.attendanceRules.considerEarlyEntryBefore.split(":").map(Number),[be,we]=l.attendanceRules.considerLateEntryAfter.split(":").map(Number),Ne=t(E).startOf("day").add(ge,"hour").add(je,"minute"),Me=t(E).startOf("day").add(be,"hour").add(we,"minute");t(E).isBefore(Ne)&&V.push(x),t(E).isAfter(Me)&&Q.push(x);const[ke,Se]=l.attendanceRules.considerEarlyExitBefore.split(":").map(Number),[Ae,De]=l.attendanceRules.considerLateExitAfter.split(":").map(Number),Ee=t(L).startOf("day").add(ke,"hour").add(Se,"minute"),Le=t(L).startOf("day").add(Ae,"hour").add(De,"minute");t(L).isBefore(Ee)&&Z.push(x),t(L).isAfter(Le)&&ee.push(x)}),T(B),ue({present:n,absent:h,leave:o,holiday:J,short:K,overtime:W,shorttimemin:$,overtimemin:Y,latearrival:Q,earlyarrival:V,earlyLeave:Z,lateleave:ee,overtimesalary:Math.floor((Y-$)*(8500/31/((ae=m==null?void 0:m.workingMinutes)==null?void 0:ae.fullDay)).toFixed(2))})},[r,M,b,l]);const pe=I.filter(s=>{const n=t(s.date).startOf("day");return!(P&&n.isBefore(t(P))||z&&n.isAfter(t(z))||k!=="all"&&s.status!==k||v!=="all"&&!(v==="earlyLeave"&&N.earlyLeave.some(o=>t(o).isSame(n,"day"))||v==="lateleave"&&N.lateleave.some(o=>t(o).isSame(n,"day"))||v==="earlyarrival"&&N.earlyarrival.some(o=>t(o).isSame(n,"day"))||v==="latearrival"&&N.latearrival.some(o=>t(o).isSame(n,"day")))||H!=="all"&&!(H==="short"&&N.short.some(o=>t(o).isSame(n,"day"))||H==="overtime"&&N.overtime.some(o=>t(o).isSame(n,"day"))))}),he=()=>{A(t().year()),D("all"),w("all"),C("all"),ce("all"),q(null),G(null)};return e.jsxs("div",{className:"p-4 capitalize bg-gray-200",children:[d&&e.jsx("p",{children:"Loading performance data..."}),e.jsxs("div",{className:"p-3 flex gap-3 rounded shadow bg-white mb-4",children:[e.jsxs(O,{size:"small",sx:{minWidth:120},children:[e.jsx(_,{children:"Year"}),e.jsx(X,{value:M,label:"Year",onChange:s=>A(s.target.value),children:xe.map(s=>e.jsx(g,{value:s,children:s},s))})]}),e.jsxs(O,{size:"small",sx:{minWidth:150},children:[e.jsx(_,{children:"Month"}),e.jsxs(X,{value:b,label:"Month",onChange:s=>D(s.target.value),children:[e.jsx(g,{value:"all",children:"All"}),fe.map(s=>e.jsx(g,{value:s.value,children:s.label},s.label))]})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{attandence:r,hell:N}),e.jsxs("div",{className:"p-4 flex gap-3 rounded shadow bg-white my-4",children:[e.jsxs(O,{size:"small",sx:{minWidth:150},children:[e.jsx(_,{children:"Status"}),e.jsxs(X,{value:k,label:"Status",onChange:s=>w(s.target.value),children:[e.jsx(g,{value:"all",children:"All"}),e.jsx(g,{value:"present",children:"Present"}),e.jsx(g,{value:"leave",children:"Leave"}),e.jsx(g,{value:"absent",children:"Absent"}),e.jsx(g,{value:"halfday",children:"Half Day"})]})]}),e.jsx(O,{size:"small",sx:{minWidth:150},children:e.jsx(de,{label:"From Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:P||"",onChange:s=>q(s.target.value)})}),e.jsx(O,{size:"small",sx:{minWidth:150},children:e.jsx(de,{label:"To Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:z||"",onChange:s=>G(s.target.value)})}),e.jsx(Ue,{variant:"outlined",color:"secondary",onClick:he,sx:{alignSelf:"flex-end",minWidth:100},startIcon:e.jsx(_e,{}),children:"Reset"})]}),e.jsx(We,{columns:Je(l),data:pe,pagination:!0,customStyles:Xe(),conditionalRowStyles:Ge,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(ze,{className:"text-xl"})," No records found matching your criteria."]})})]})]})},Ge=[{when:r=>r.remarks,style:{backgroundColor:"rgba(21, 233, 233, 0.2)"}}],Je=r=>[{name:"Date",selector:a=>t(a.date).format("DD MMM, YYYY"),sortable:!0,width:"120px"},{name:"Punch In",selector:a=>a.punchIn,cell:a=>{var l,p;if(!a.punchIn)return"-";const[d,c]=(l=r==null?void 0:r.attendanceRules)==null?void 0:l.considerEarlyEntryBefore.split(":").map(Number),[u,y]=(p=r==null?void 0:r.attendanceRules)==null?void 0:p.considerLateEntryAfter.split(":").map(Number),m=t(a.punchIn).startOf("day").add(d,"hour").add(c,"minute"),j=t(a.punchIn).startOf("day").add(u,"hour").add(y,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"text-[16px] text-blue-700"}),t(a.punchIn).format("hh:mm A"),!a.remarks&&t(a.punchIn).isBefore(m)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Early"}),!a.remarks&&t(a.punchIn).isAfter(j)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Late"})]})}},{name:"Punch Out",selector:a=>a.punchOut,cell:a=>{var l,p;if(!a.punchOut)return"-";const[d,c]=(l=r==null?void 0:r.attendanceRules)==null?void 0:l.considerEarlyExitBefore.split(":").map(Number),[u,y]=(p=r==null?void 0:r.attendanceRules)==null?void 0:p.considerLateExitAfter.split(":").map(Number),m=t(a.punchOut).startOf("day").add(d,"hour").add(c,"minute"),j=t(a.punchOut).startOf("day").add(u,"hour").add(y,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"text-[16px] text-blue-700"}),t(a.punchOut).format("hh:mm A"),!a.remarks&&t(a.punchOut).isBefore(m)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Early"}),!a.remarks&&t(a.punchOut).isAfter(j)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Late"})]})}},{name:"Status",selector:a=>a.status,cell:a=>{const{status:d}=a,u={absent:"bg-red-100 text-red-800",leave:"bg-violet-100 text-violet-800",present:"bg-green-100 text-green-800",holiday:"bg-blue-100 text-blue-800"}[d]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`${u} px-2 py-1 rounded text-xs`,children:d})},width:"140px"},{name:"Remarks",selector:a=>a.remarks&&`${a.workingMinutes} minutes  ${a.remarks}`}];export{fa as default};
