import{r as l,g as Q,aV as Z,h as i,c as C,j as e,a1 as ee,a4 as te,y as v,F as w,I as M,S as A,M as c,B as f,aW as ae,aX as se,aY as le,aa as re,ab as z,b as H}from"./index-DsmeUTAl.js";import{i as oe}from"./isSameOrBefore-DISxm6ck.js";import{A as ne}from"./index-DhpbthLe.js";import{u as ie}from"./attandencehelper-CS7tsB29.js";import{H as de}from"./holidayCalander-D1YuLWPg.js";import{a as ce}from"./index-DeWx_leO.js";import{A as me}from"./AdapterDateFns-fnjAvTQU.js";import{D as E}from"./DatePicker-Da8YUj1a.js";import{L as ue}from"./dateViewRenderers-BsSmy9Ro.js";import"./Tooltip-BVQqdOB-.js";import"./Popper-XehbIi2B.js";import"./index-BGlw_wbb.js";i.extend(oe);const be=()=>{const[s,d]=l.useState({name:"",type:"",fromDate:null,toDate:null,description:""}),[O,R]=l.useState(null),[N,B]=l.useState([]),[m,P]=l.useState([]),[h,b]=l.useState(!1),{company:y}=Q(t=>t.user),[W,$]=l.useState([1]),[j,Y]=l.useState("All"),[g,F]=l.useState("All"),[D,k]=l.useState("All"),T=Z.useRef(null),[L,I]=l.useState(!1),[q,u]=l.useState(!1);l.useEffect(()=>{$((y==null?void 0:y.weeklyOffs)||[1])},[y]),l.useEffect(()=>{if(s.fromDate&&!s.toDate){const t=i(s.fromDate).toDate();isNaN(t.getTime())||d(a=>({...a,toDate:t}))}},[s.fromDate]),l.useEffect(()=>{S()},[]);const S=async()=>{try{const t=localStorage.getItem("emstoken"),r=(await C.get("/api/getholidays",{headers:{Authorization:`Bearer ${t}`}})).data.holidays,n=[];r.forEach(o=>{let x=i(o.fromDate);const K=o.toDate?i(o.toDate):x;for(;x.isSameOrBefore(K,"day");)n.push({date:x.format("MM/DD/YYYY"),name:o.name}),x=x.add(1,"day")});const p=r.map(o=>({name:o.name,From:o.fromDate,till:o.toDate,type:o.type,description:o==null?void 0:o.description,action:e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>J(o),children:e.jsx(ee,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>U(o._id),children:e.jsx(ne,{})})]})}));l.startTransition(()=>{P(n),B(p)})}catch(t){console.error("Error fetching holidays:",t)}},J=t=>{b(!0),u(!0),R(t._id),d({name:t.name,type:t.type,fromDate:i(t.fromDate).toDate(),toDate:i(t.toDate).toDate(),description:t.description||""}),setTimeout(()=>{var a;(a=T.current)==null||a.focus()},0)},U=async t=>{te({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{const r=localStorage.getItem("emstoken"),n=await C.post("/api/deleteholiday",{id:t},{headers:{Authorization:`Bearer ${r}`}});v.success(n.data.message),S()}catch(r){console.error(r),v.warning(r.response.data.message)}})},X=async t=>{t.preventDefault();try{const a=localStorage.getItem("emstoken"),r=h?"updateholiday":"addholiday",n=h?{...s,holidayId:O}:s,p=await C.post(`/api/${r}`,n,{headers:{Authorization:`Bearer ${a}`}});v.success(p.data.message),d({name:"",type:"Public",fromDate:null,toDate:null,description:""}),b(!1),u(!1),S()}catch(a){console.error(a.response),v.warning(a.response.data.message)}},_=l.useMemo(()=>N.filter(t=>{const a=i(t.From),r=j==="All"||a.year().toString()===j,n=g==="All"||a.month()===parseInt(g),p=D==="All"||t.type===D;return r&&n&&p}),[N,j,g,D]),V=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],G=l.useMemo(()=>{if(!m||m.length===0)return[];const t=i(m[m.length-1].date).year(),a=i(m[0].date).year(),r=[];for(let n=t;n<=a;n++)r.push(n);return r},[m]);return e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(ue,{dateAdapter:me,children:[e.jsxs("div",{className:"flex flex-wrap  justify-between items-center gap-3 w-full my-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap justify-between w-full md:w-fit",children:[e.jsxs(w,{size:"small",className:"w-[47%] md:w-[120px]",children:[e.jsx(M,{children:"Year"}),e.jsxs(A,{label:"Year",value:j,onChange:t=>Y(t.target.value),children:[e.jsx(c,{value:"All",children:"All"}),G.map(t=>e.jsx(c,{value:t,children:t},t))]})]}),e.jsxs(w,{size:"small",className:"w-[47%] md:w-[120px]",children:[e.jsx(M,{children:"Month"}),e.jsxs(A,{label:"Month",value:g,onChange:t=>F(t.target.value),children:[e.jsx(c,{value:"All",children:"All"}),V.map((t,a)=>e.jsx(c,{value:a,children:t},t))]})]}),e.jsxs(w,{size:"small",className:"w-[47%] md:w-[150px]",children:[e.jsx(M,{children:"Type"}),e.jsxs(A,{label:"Filter by Type",value:D,onChange:t=>k(t.target.value),children:[e.jsx(c,{value:"All",children:"All"}),[...new Set(N.map(t=>t.type))].map(t=>e.jsx(c,{value:t,children:t},t))]})]}),e.jsx(f,{variant:"outlined",color:"secondary",className:"w-[47%] md:w-fit",startIcon:e.jsx(ae,{}),onClick:()=>{Y("All"),F("All"),k("All")},children:"Reset"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-fit",children:[e.jsx(f,{startIcon:e.jsx(se,{}),variant:"contained",onClick:()=>I(!0),children:"Calendar"}),e.jsx(f,{startIcon:e.jsx(le,{}),variant:"contained",onClick:()=>u(!0),children:"Add Holiday"})]})]}),e.jsx("div",{className:"capitalize",children:e.jsx(re,{columns:pe,data:_,pagination:!0,customStyles:ie(),noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(ce,{className:"text-xl"})," No records found."]}),highlightOnHover:!0})}),e.jsx(z,{open:L,onClose:()=>I(!1),children:e.jsx("div",{className:"membermodal w-[400px]",children:e.jsx(de,{highlightedDates:m.map(t=>({date:i(t.date).toDate(),name:t.name})),weeklyOffs:W})})}),e.jsx(z,{open:q,onClose:()=>{u(!1)},children:e.jsx("div",{className:"membermodal w-[600px]",children:e.jsxs("form",{onSubmit:X,children:[e.jsxs("div",{className:"modalhead",children:[" ",h?"Edit Holiday":"Add holiday"]}),e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(H,{required:!0,inputRef:T,label:"Holiday Name",size:"small",value:s.name,onChange:t=>d(a=>({...a,name:t.target.value})),fullWidth:!0}),e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx(E,{required:!0,label:"From Date",format:"dd/MM/yyyy",value:s.fromDate,onChange:t=>d(a=>({...a,fromDate:t})),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx(E,{required:!0,label:"To Date",format:"dd/MM/yyyy",value:s.toDate,onChange:t=>d(a=>({...a,toDate:t})),slotProps:{textField:{size:"small",fullWidth:!0}}})]}),e.jsxs(w,{size:"small",required:!0,fullWidth:!0,children:[e.jsx(M,{children:"Type"}),e.jsxs(A,{value:s.type,label:"Type",onChange:t=>d(a=>({...a,type:t.target.value})),children:[e.jsx(c,{disabled:!0,value:"",children:"Select Type"}),e.jsx(c,{value:"National",children:"National"}),e.jsx(c,{value:"Religious",children:"Religious"}),e.jsx(c,{value:"Public",children:"Public"}),e.jsx(c,{value:"Other",children:"Other"})]})]}),e.jsx(H,{label:"Description (optional)",multiline:!0,rows:2,size:"small",value:s.description,onChange:t=>d(a=>({...a,description:t.target.value})),fullWidth:!0})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(f,{variant:"outlined",onClick:()=>{b(!1),u(!1),d({name:"",type:"Public",fromDate:null,toDate:null,description:""})},children:"Cancel"}),e.jsxs(f,{variant:"contained",type:"submit",children:[h?"Update":"Add"," Holiday"]})]})]})})})]})})},pe=[{name:"S.no",selector:(s,d)=>++d,width:"50px"},{name:"Name",selector:s=>s.name},{name:"From",selector:s=>i(s.From).format("DD MMM, YYYY"),width:"110px"},{name:"Till",selector:s=>i(s.till).format("DD MMM, YYYY"),width:"110px"},{name:"Type",selector:s=>s.type,width:"90px"},{name:"Action",selector:s=>s.action,width:"80px"}];export{be as default};
