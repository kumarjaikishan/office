import{aN as H,r as m,a as X,u as q,g as K,c as $,aV as Q,y as h,j as a,b as W,i as k,a7 as Z,F as b,I as v,S as I,M as x,O as ee,C as ae,aa as te,A as se,k as ne,a3 as le,T as re,B as g}from"./index-D_KYbKMv.js";import{u as oe}from"./attandencehelper-BpECklSl.js";import{a as ie,b as z,c as ce,d as de}from"./index-BvY2lkv_.js";import{C as f}from"./CheckPermission-DhcfYdBq.js";import"./index-BXx8RfSK.js";function je(){var A;const{employeeId:me}=H(),[he,C]=m.useState(!0),[B,S]=m.useState(null),[i,N]=m.useState([]),[ue,P]=m.useState(null),j=X(),M=oe(),w=q(),[n,D]=m.useState({searchText:"",branch:"all",month:new Date().getMonth()+1,year:new Date().getFullYear()}),{employee:u,branch:c,profile:d}=K(e=>e.user);m.useEffect(()=>{_()},[]);const _=async()=>{var e,t,s,l;try{C(!0);const o=localStorage.getItem("emstoken"),r=await $.get("/api/payroll",{headers:{Authorization:`Bearer ${o}`}});N(((e=r==null?void 0:r.data)==null?void 0:e.payrolls)||[]),w(Q(((t=r==null?void 0:r.data)==null?void 0:t.payrolls)||[]))}catch(o){console.error(o),h.warn(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch payroll",{autoClose:1200})}finally{C(!1)}},y=(e,t)=>{D(s=>({...s,[e]:t}))},F=u==null?void 0:u.filter(e=>{var r,p;const t=((p=(r=e.userid)==null?void 0:r.name)==null?void 0:p.toLowerCase())||"",s=e.branchId||"",l=n.searchText.trim()===""||t.includes(n.searchText.toLowerCase()),o=n.branch==="all"||s===n.branch;return l&&o&&e.status}),E={};i==null||i.forEach(e=>{var s;const t=`${(s=e.employeeId)==null?void 0:s._id}-${e.month}-${e.year}`;E[t]=!0});const T=e=>{j("/dashboard/payroll/add",{state:{employeee:e,month:n.month,year:n.year}})},G=e=>{const t=i.find(s=>{var l;return((l=s.employeeId)==null?void 0:l._id)===e._id&&s.month===n.month&&s.year===n.year});if(!t)return h.info("Payroll not generated yet for this period");j(`/dashboard/payroll/print/${t._id}`)},O=e=>{const t=i.find(s=>{var l;return((l=s.employeeId)==null?void 0:l._id)===e._id&&s.month===n.month&&s.year===n.year});if(!t)return h.info("Payroll not generated yet for this period");j(`/dashboard/payroll/edit/${t._id}`)},L=async e=>{const t=i.find(s=>{var l;return((l=s.employeeId)==null?void 0:l._id)===e&&s.month===n.month&&s.year===n.year});if(!t)return h.info("No payroll to delete for this period");swal({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async s=>{var l,o;if(s)try{S(e),P(null);const r=localStorage.getItem("emstoken"),p=await $.delete(`/api/payroll/${t._id}`,{headers:{Authorization:`Bearer ${r}`}});h.success(p.data.message||"Successfull deleted"),_()}catch(r){console.error(r),P(((o=(l=r.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to fetch payroll"),h.warn("Using dummy payroll data for testing",{autoClose:1500}),N(u)}finally{S(null)}})},J=f("salary",2);f("salary",1);const R=f("salary",3),V=f("salary",4),Y=["January","February","March","April","May","June","July","August","September","October","November","December"];if(!u)return a.jsx("p",{className:"p-4 text-gray-500",children:"No employee data found"});const U=[{name:"S.no",selector:(e,t)=>t+1,width:"60px"},{name:"Employee",selector:e=>{var t,s;return a.jsxs("div",{className:"flex items-center capitalize gap-3",children:[a.jsx(se,{src:ne(e==null?void 0:e.profileimage,{format:"webp",width:100,height:100}),alt:(t=e==null?void 0:e.userid)==null?void 0:t.name}),a.jsxs(le,{children:[a.jsx(re,{variant:"body2",children:(s=e==null?void 0:e.userid)==null?void 0:s.name}),a.jsxs("p",{className:"text-[10px] text-gray-600",children:["(",(e==null?void 0:e.designation)||"-",")"]})]})]})},sortable:!0},{name:"Email",selector:e=>{var t;return(t=e.userid)==null?void 0:t.email},width:"180px"},{name:"Department",selector:e=>{var t;return((t=e.department)==null?void 0:t.department)||"-"},width:"120px"},{name:"Actions",width:"450px",cell:e=>{const t=`${e._id}-${n.month}-${n.year}`,s=E[t];return a.jsxs("div",{className:"flex gap-2",children:[J&&a.jsx(g,{size:"small",variant:"contained",startIcon:a.jsx(z,{}),disabled:s,title:s?"Already Generated":"Generate Payroll",onClick:()=>T(e),children:"Generate"}),a.jsx(g,{size:"small",disabled:!s,variant:"outlined",startIcon:a.jsx(z,{}),onClick:()=>G(e),children:"View"}),R&&a.jsx(g,{size:"small",disabled:!s,variant:"outlined",startIcon:a.jsx(ce,{}),onClick:()=>O(e),children:"Edit"}),V&&a.jsx(g,{size:"small",loading:B==e._id,disabled:!s,color:"error",variant:"outlined",startIcon:a.jsx(de,{}),onClick:()=>L(e._id),children:"Delete"})]})}}];return a.jsxs("div",{className:"w-full max-w-7xl  mx-auto p-1 md:p-4",children:[a.jsx("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:a.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[a.jsx(W,{size:"small",className:"w-[100%] md:w-[160px]",value:n.searchText,onChange:e=>y("searchText",e.target.value),InputProps:{startAdornment:a.jsx(k,{position:"start",children:a.jsx(Z,{})})},label:"Search Employee"}),a.jsxs(b,{size:"small",className:"w-[47%] md:w-[160px]",children:[a.jsx(v,{children:"Branch"}),a.jsxs(I,{label:"Branch",value:n.branch,input:a.jsx(ee,{startAdornment:a.jsx(k,{position:"start",children:a.jsx(ae,{fontSize:"small"})}),label:"Branch"}),onChange:e=>y("branch",e.target.value),children:[a.jsx(x,{value:"all",children:"All"}),(d==null?void 0:d.role)==="manager"?(A=c==null?void 0:c.filter(e=>{var t;return(t=d==null?void 0:d.branchIds)==null?void 0:t.includes(e._id)}))==null?void 0:A.map(e=>a.jsx(x,{value:e._id,children:e.name},e._id)):c==null?void 0:c.map(e=>a.jsx(x,{value:e._id,children:e.name},e._id))]})]}),a.jsxs(b,{size:"small",children:[a.jsx(v,{children:"Month"}),a.jsx(I,{label:"Month",value:n.month,onChange:e=>y("month",e.target.value),children:Y.map((e,t)=>a.jsx(x,{value:t+1,children:e},t))})]}),a.jsxs(b,{size:"small",children:[a.jsx(v,{children:"Year"}),a.jsx(I,{label:"Year",value:n.year,onChange:e=>y("year",e.target.value),children:["2024","2025","2026"].map(e=>a.jsx(x,{value:e,children:e},e))})]})]})}),a.jsx(te,{columns:U,data:F,pagination:!0,customStyles:M,highlightOnHover:!0,paginationPerPage:20,paginationRowsPerPageOptions:[20,50,100,300],noDataComponent:a.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[a.jsx(ie,{className:"text-xl"})," No Employee records found."]})})]})}export{je as default};
