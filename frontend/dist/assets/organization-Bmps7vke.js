import{r as v,j as e,o as ee,p as pe,h as Ce,S as Ie,i as Pe,k as fe,t as Z,n as ae,U as ke,q as Se,u as he,f as oe,A as te,F as Te,b as R,y as I,v as ie,V as Le,W as Oe,X as G,Q as q,K as Me}from"./index-Yr5TVBX8.js";import{M as Ae}from"./Modalbox-DFzdZFVl.js";import{a as Be,e as De,u as ze}from"./useSlotProps-BKaa53Ma.js";import{s as We}from"./styled-BfM_0h8J.js";import{i as Re,a as Fe,f as Ge,L as qe,F as ce,I as de,S as me,O as ue}from"./Select-BzO5C_ZD.js";import{u as Ue}from"./useThemeProps-CYy8tAlW.js";import{T as M}from"./TextField-BZQlsKpZ.js";import{g as _e,l as X,M as J}from"./MenuItem-DUYgeWuo.js";import{C as K}from"./Checkbox-DTWD5d0j.js";import{T as U,t as ye}from"./Typography-wzkP9v2k.js";import{B as D}from"./Button-DbYv_FMR.js";import He from"./Department-CNq7pX5W.js";import{a as Ve,A as Xe}from"./index-DPLLIyaO.js";import{u as Ee}from"./imageresizer-D4I-KFLq.js";import{X as Qe}from"./index.es-BNEnLlPq.js";import{B as ne}from"./Box-CAslWZV8.js";import"./createSimplePaletteValueFilter-B57QjJRu.js";import"./ButtonBase-BPEedJVC.js";import"./index-BtacAYSp.js";import"./attandencehelper-Dy0nLLzv.js";import"./InputAdornment-XZdrXKpE.js";const Ze=(t,n)=>t.filter(o=>n.includes(o)),H=(t,n,o)=>{const l=t.keys[0];Array.isArray(n)?n.forEach((i,c)=>{o((m,g)=>{c<=t.keys.length-1&&(c===0?Object.assign(m,g):m[t.up(t.keys[c])]=g)},i)}):n&&typeof n=="object"?(Object.keys(n).length>t.keys.length?t.keys:Ze(t.keys,Object.keys(n))).forEach(c=>{if(t.keys.includes(c)){const m=n[c];m!==void 0&&o((g,T)=>{l===c?Object.assign(g,T):g[t.up(c)]=T},m)}}):(typeof n=="number"||typeof n=="string")&&o((i,c)=>{Object.assign(i,c)},n)};function se(t){return`--Grid-${t}Spacing`}function re(t){return`--Grid-parent-${t}Spacing`}const be="--Grid-columns",_="--Grid-parent-columns",Je=({theme:t,ownerState:n})=>{const o={};return H(t.breakpoints,n.size,(l,i)=>{let c={};i==="grow"&&(c={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(c={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / var(${_}) - (var(${_}) - ${i}) * (var(${re("column")}) / var(${_})))`}),l(o,c)}),o},Ke=({theme:t,ownerState:n})=>{const o={};return H(t.breakpoints,n.offset,(l,i)=>{let c={};i==="auto"&&(c={marginLeft:"auto"}),typeof i=="number"&&(c={marginLeft:i===0?"0px":`calc(100% * ${i} / var(${_}) + var(${re("column")}) * ${i} / var(${_}))`}),l(o,c)}),o},Ye=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={[be]:12};return H(t.breakpoints,n.columns,(l,i)=>{const c=i??12;l(o,{[be]:c,"> *":{[_]:c}})}),o},et=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={};return H(t.breakpoints,n.rowSpacing,(l,i)=>{var m;const c=typeof i=="string"?i:(m=t.spacing)==null?void 0:m.call(t,i);l(o,{[se("row")]:c,"> *":{[re("row")]:c}})}),o},tt=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={};return H(t.breakpoints,n.columnSpacing,(l,i)=>{var m;const c=typeof i=="string"?i:(m=t.spacing)==null?void 0:m.call(t,i);l(o,{[se("column")]:c,"> *":{[re("column")]:c}})}),o},st=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={};return H(t.breakpoints,n.direction,(l,i)=>{l(o,{flexDirection:i})}),o},at=({ownerState:t})=>({minWidth:0,boxSizing:"border-box",...t.container&&{display:"flex",flexWrap:"wrap",...t.wrap&&t.wrap!=="wrap"&&{flexWrap:t.wrap},gap:`var(${se("row")}) var(${se("column")})`}}),rt=t=>{const n=[];return Object.entries(t).forEach(([o,l])=>{l!==!1&&l!==void 0&&n.push(`grid-${o}-${String(l)}`)}),n},nt=(t,n="xs")=>{function o(l){return l===void 0?!1:typeof l=="string"&&!Number.isNaN(Number(l))||typeof l=="number"&&l>0}if(o(t))return[`spacing-${n}-${String(t)}`];if(typeof t=="object"&&!Array.isArray(t)){const l=[];return Object.entries(t).forEach(([i,c])=>{o(c)&&l.push(`spacing-${i}-${String(c)}`)}),l}return[]},lt=t=>t===void 0?[]:typeof t=="object"?Object.entries(t).map(([n,o])=>`direction-${n}-${o}`):[`direction-xs-${String(t)}`];function ot(t,n){t.item!==void 0&&delete t.item,t.zeroMinWidth!==void 0&&delete t.zeroMinWidth,n.keys.forEach(o=>{t[o]!==void 0&&delete t[o]})}const it=Ie(),ct=We("div",{name:"MuiGrid",slot:"Root"});function dt(t){return Ue({props:t,name:"MuiGrid",defaultTheme:it})}function mt(t={}){const{createStyledComponent:n=ct,useThemeProps:o=dt,useTheme:l=Be,componentName:i="MuiGrid"}=t,c=(C,N)=>{const{container:p,direction:b,spacing:S,wrap:w,size:k}=C,$={root:["root",p&&"container",w!=="wrap"&&`wrap-xs-${String(w)}`,...lt(b),...rt(k),...p?nt(S,N.breakpoints.keys[0]):[]]};return pe($,y=>Ce(i,y),{})};function m(C,N,p=()=>!0){const b={};return C===null||(Array.isArray(C)?C.forEach((S,w)=>{S!==null&&p(S)&&N.keys[w]&&(b[N.keys[w]]=S)}):typeof C=="object"?Object.keys(C).forEach(S=>{const w=C[S];w!=null&&p(w)&&(b[S]=w)}):b[N.keys[0]]=C),b}const g=n(Ye,tt,et,Je,st,at,Ke),T=v.forwardRef(function(N,p){const b=l(),S=o(N),w=De(S);ot(w,b.breakpoints);const{className:k,children:$,columns:y=12,container:s=!1,component:u="div",direction:f="row",wrap:A="wrap",size:P={},offset:O={},spacing:L=0,rowSpacing:r=L,columnSpacing:j=L,unstable_level:x=0,...a}=w,d=m(P,b.breakpoints,W=>W!==!1),h=m(O,b.breakpoints),E=N.columns??(x?void 0:y),B=N.spacing??(x?void 0:L),z=N.rowSpacing??N.spacing??(x?void 0:r),F=N.columnSpacing??N.spacing??(x?void 0:j),xe={...w,level:x,columns:E,container:s,direction:f,wrap:A,spacing:B,rowSpacing:z,columnSpacing:F,size:d,offset:h},$e=c(xe,b);return e.jsx(g,{ref:p,as:u,ownerState:xe,className:ee($e.root,k),...a,children:v.Children.map($,W=>{var ge;return v.isValidElement(W)&&Re(W,["Grid"])&&s&&W.props.container?v.cloneElement(W,{unstable_level:((ge=W.props)==null?void 0:ge.unstable_level)??x+1}):W})})});return T.muiName="Grid",T}function ut(t){return Ce("MuiFormControlLabel",t)}const V=Pe("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),pt=t=>{const{classes:n,disabled:o,labelPlacement:l,error:i,required:c}=t,m={root:["root",o&&"disabled",`labelPlacement${ke(l)}`,i&&"error",c&&"required"],label:["label",o&&"disabled"],asterisk:["asterisk",i&&"error"]};return pe(m,ut,n)},ft=ae("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[{[`& .${V.label}`]:n.label},n.root,n[`labelPlacement${ke(o.labelPlacement)}`]]}})(Se(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${V.disabled}`]:{cursor:"default"},[`& .${V.label}`]:{[`&.${V.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:n})=>n==="start"||n==="top"||n==="bottom",style:{marginLeft:16}}]}))),ht=ae("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(Se(({theme:t})=>({[`&.${V.error}`]:{color:(t.vars||t).palette.error.main}}))),xt=v.forwardRef(function(n,o){const l=fe({props:n,name:"MuiFormControlLabel"}),{checked:i,className:c,componentsProps:m={},control:g,disabled:T,disableTypography:C,inputRef:N,label:p,labelPlacement:b="end",name:S,onChange:w,required:k,slots:$={},slotProps:y={},value:s,...u}=l,f=Fe(),A=T??g.props.disabled??(f==null?void 0:f.disabled),P=k??g.props.required,O={disabled:A,required:P};["checked","name","onChange","value","inputRef"].forEach(E=>{typeof g.props[E]>"u"&&typeof l[E]<"u"&&(O[E]=l[E])});const L=Ge({props:l,muiFormControl:f,states:["error"]}),r={...l,disabled:A,labelPlacement:b,required:P,error:L.error},j=pt(r),x={slots:$,slotProps:{...m,...y}},[a,d]=Z("typography",{elementType:U,externalForwardedProps:x,ownerState:r});let h=p;return h!=null&&h.type!==U&&!C&&(h=e.jsx(a,{component:"span",...d,className:ee(j.label,d==null?void 0:d.className),children:h})),e.jsxs(ft,{className:ee(j.root,c),ownerState:r,ref:o,...u,children:[v.cloneElement(g,O),P?e.jsxs("div",{children:[h,e.jsxs(ht,{ownerState:r,"aria-hidden":!0,className:j.asterisk,children:[" ","*"]})]}):h]})}),je=mt({createStyledComponent:ae("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[n.root,o.container&&n.container]}}),componentName:"MuiGrid",useThemeProps:t=>fe({props:t,name:"MuiGrid"}),useTheme:ze}),gt=t=>{const{classes:n,inset:o,primary:l,secondary:i,dense:c}=t;return pe({root:["root",o&&"inset",c&&"dense",l&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},_e,n)},yt=ae("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[{[`& .${X.primary}`]:n.primary},{[`& .${X.secondary}`]:n.secondary},n.root,o.inset&&n.inset,o.primary&&o.secondary&&n.multiline,o.dense&&n.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${ye.root}:where(& .${X.primary})`]:{display:"block"},[`.${ye.root}:where(& .${X.secondary})`]:{display:"block"},variants:[{props:({ownerState:t})=>t.primary&&t.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:t})=>t.inset,style:{paddingLeft:56}}]}),Y=v.forwardRef(function(n,o){const l=fe({props:n,name:"MuiListItemText"}),{children:i,className:c,disableTypography:m=!1,inset:g=!1,primary:T,primaryTypographyProps:C,secondary:N,secondaryTypographyProps:p,slots:b={},slotProps:S={},...w}=l,{dense:k}=v.useContext(qe);let $=T??i,y=N;const s={...l,disableTypography:m,inset:g,primary:!!$,secondary:!!y,dense:k},u=gt(s),f={slots:b,slotProps:{primary:C,secondary:p,...S}},[A,P]=Z("root",{className:ee(u.root,c),elementType:yt,externalForwardedProps:{...f,...w},ownerState:s,ref:o}),[O,L]=Z("primary",{className:u.primary,elementType:U,externalForwardedProps:f,ownerState:s}),[r,j]=Z("secondary",{className:u.secondary,elementType:U,externalForwardedProps:f,ownerState:s});return $!=null&&$.type!==U&&!m&&($=e.jsx(O,{variant:k?"body2":"body1",component:L!=null&&L.variant?void 0:"span",...L,children:$})),y!=null&&y.type!==U&&!m&&(y=e.jsx(r,{variant:"body2",color:"textSecondary",...j,children:y})),e.jsxs(A,{...P,children:[$,y]})}),ve=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],bt=({setopenviewmodal:t,employee:n,company:o,editbranch:l,editbranchdata:i})=>{const c={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:540},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[m,g]=v.useState(c),T=he(),{adminManager:C}=oe(s=>s.user),[N,p]=v.useState([]),b=localStorage.getItem("emstoken");v.useEffect(()=>{p(n),g(s=>({...s,companyId:o._id})),l&&g(s=>({...s,...i}))},[o,l]),v.useEffect(()=>{(C==null?void 0:C.length)>0&&p(C.filter(s=>s.role==="manager"))},[C]);const S=()=>{t(!1),g(c)},w=(s,u)=>{g(f=>({...f,[s]:u}))},k=(s,u,f)=>{g(A=>({...A,setting:{...A.setting,[s]:{...A.setting[s],[u]:f}}}))},$=async()=>{var s,u;try{const f=await R.post("/api/addBranch",m,{headers:{Authorization:`Bearer ${b}`}});I.success(f.data.message),t(!1),T(ie()),S()}catch(f){console.error(f),I.error(((u=(s=f==null?void 0:f.response)==null?void 0:s.data)==null?void 0:u.message)||"Error adding branch")}},y=async()=>{var s,u;try{const f=await R.post("/api/editBranch",m,{headers:{Authorization:`Bearer ${b}`}});I.success(f.data.message),T(ie()),t(!1),S()}catch(f){console.error(f),I.error(((u=(s=f==null?void 0:f.response)==null?void 0:s.data)==null?void 0:u.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:l?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(je,{container:!0,spacing:2,children:[e.jsx(M,{label:"Branch Name",fullWidth:!0,size:"small",value:m.name,onChange:s=>w("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(M,{label:"Location",fullWidth:!0,size:"small",value:m.location,onChange:s=>w("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(ce,{size:"small",fullWidth:!0,children:[e.jsx(de,{children:"Managers"}),e.jsx(me,{multiple:!0,value:(m==null?void 0:m.managerIds)||[],onChange:s=>w("managerIds",s.target.value),input:e.jsx(ue,{label:"Managers"}),renderValue:s=>s.map(u=>{var f;return((f=N.find(A=>A._id===u))==null?void 0:f.name)||"Unknown"}).join(", "),children:N&&N.length>0?N.map(s=>{var u;return e.jsxs(J,{value:s._id,children:[e.jsx(K,{checked:(u=m==null?void 0:m.managerIds)==null?void 0:u.includes(s._id)}),e.jsx(te,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!(s!=null&&s.profileImage)&&e.jsx(Te,{})}),e.jsx(Y,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)}):e.jsx(J,{disabled:!0,value:"",children:e.jsx(Y,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(xt,{control:e.jsx(K,{checked:!m.defaultsetting,onChange:s=>g(u=>({...u,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!m.defaultsetting&&e.jsx("div",{className:"border-yellow-300 border-2 grid grid-cols-2 gap-3 border-dashed rounded mt-3 p-3",children:e.jsxs(je,{container:!0,spacing:2,children:[e.jsx(M,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:m.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>k("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(M,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:m.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>k("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(M,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.officeTime.breakMinutes,onChange:s=>k("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(M,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.fullDay,onChange:s=>k("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(M,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.halfDay,onChange:s=>k("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(M,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.shortDayThreshold,onChange:s=>k("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(M,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>k("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(ce,{size:"small",fullWidth:!0,children:[e.jsx(de,{children:"Weekly Offs"}),e.jsx(me,{multiple:!0,value:m.setting.weeklyOffs,onChange:s=>g(u=>({...u,setting:{...u.setting,weeklyOffs:s.target.value}})),input:e.jsx(ue,{label:"Weekly Offs"}),renderValue:s=>s.map(u=>{var f;return(f=ve.find(A=>A.value===u))==null?void 0:f.label}).join(", "),children:ve.map(s=>e.jsxs(J,{value:s.value,children:[e.jsx(K,{checked:m.setting.weeklyOffs.includes(s.value)}),e.jsx(Y,{primary:s.label})]},s.value))})]}),Object.entries(m.setting.attendanceRules).map(([s,u])=>{const f=s.replace(/([A-Z])/g," $1").replace(/^./,P=>P.toUpperCase()),A={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(M,{fullWidth:!0,size:"small",label:f,type:"time",value:u,onChange:P=>g(O=>({...O,setting:{...O.setting,attendanceRules:{...O.setting.attendanceRules,[s]:P.target.value}}})),helperText:A[s]},s)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(D,{variant:"outlined",onClick:S,children:"Cancel"}),l?e.jsx(D,{variant:"contained",onClick:y,children:"Save"}):e.jsx(D,{variant:"contained",onClick:$,children:"Add Branch"})]})]})},jt=async({companyinp:t,setisload:n})=>{const o=localStorage.getItem("emstoken");n(!0);try{const l=await R.post("/api/addcompany",{name:t.name,industry:t.industry},{headers:{Authorization:`Bearer ${o}`}});console.log("Query:",l),I.success(l.data.message,{autoClose:1200})}catch(l){console.log(l),l.response?I.warn(l.response.data.message,{autoClose:1200}):l.request?console.error("No response from server:",l.request):console.error("Error:",l.message)}finally{n(!1)}},Q={1:"Read",2:"Create",3:"Update",4:"Delete"},we=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],le={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},vt={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function wt(){const[t,n]=v.useState([]),[o,l]=v.useState([]),[i,c]=v.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...le}});he(),v.useEffect(()=>{u()},[]);const m=v.useRef(null),{handleImage:g}=Ee(),[T,C]=v.useState(null),[N,p]=v.useState(!1),[b,S]=v.useState(""),[w,k]=v.useState(null),$=a=>{k(d=>d===a?null:a)},y=()=>{c({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...le}}),S(""),C(null),p(!1)},s=async()=>{const a={...i},d=new FormData;l(!0);try{const h=a.profileImage?await g(300,a.profileImage):null;h&&d.append("photo",h),d.append("name",a.name),d.append("email",a.email),d.append("role",a.role),d.append("password",a.password),d.append("permissions",JSON.stringify(a.permissions));const E=localStorage.getItem("emstoken");l(!0);const B=T!==null?`/api/editAdmin/${t[T]._id}`:"/api/addAdmin",F=await R["post"](B,d,{headers:{Authorization:`Bearer ${E}`,"Content-Type":"multipart/form-data"}});I.success(F.data.message,{autoClose:1200}),y(),u()}catch(h){console.error(h),h.response?I.warn(h.response.data.message,{autoClose:1200}):I.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},u=async()=>{try{const a=localStorage.getItem("emstoken");l(!0);const d=await R.get("/api/getAdmin",{headers:{Authorization:`Bearer ${a}`}});n(d.data)}catch(a){console.error(a),a.response?I.warn(a.response.data.message,{autoClose:1200}):I.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},f=a=>{const d=t[a];c({...d,profilePreview:d.profileImage||"",profileImage:null}),C(a),p(!0)},A=async a=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async d=>{var h,E;if(d){let B;try{const z=localStorage.getItem("emstoken");l(!0),B=I.loading("Deleting...");const F=await R.delete(`/api/deleteAdmin/${a}`,{headers:{Authorization:`Bearer ${z}`}});I.update(B,{render:F.data.message,type:"success",isLoading:!1,autoClose:1800}),u()}catch(z){console.error(z),I.update(B,{render:((E=(h=z.response)==null?void 0:h.data)==null?void 0:E.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{l(!1)}}})},P=(a,d)=>{c(h=>{const E=h.permissions[a]||[],z=E.includes(d)?E.filter(F=>F!==d):[...E,d].sort();return{...h,permissions:{...h.permissions,[a]:z}}})},O=a=>{const d=a==="admin"?{...le}:{...vt};c({...i,role:a,permissions:d})},L=a=>{const d=a.target.files[0];d&&c(h=>({...h,profileImage:d,profilePreview:URL.createObjectURL(d)}))},r=()=>{b&&(c(a=>({...a,permissions:{...a.permissions,[b]:[]}})),S(""))},j=Array.from(new Set([...i.role==="admin"?we:Object.keys(i.permissions),...Object.keys(i.permissions)])),x=we.filter(a=>!j.includes(a));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-2",children:[e.jsxs("div",{className:"flex justify-between flex-wrap items-center mb-4",children:[e.jsx("h2",{className:"text-[16px] mb-2 md:mb-0 md:text-xl font-semibold",children:"Admin/Manager Management"}),e.jsx(D,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{y(),p(!0)},children:"Add Admin/ Manager"})]}),t.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:t.map((a,d)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{sx:{width:60,height:60},alt:a.name,src:a==null?void 0:a.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[a.name," (",a.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:a.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"p-2 border rounded hover:bg-gray-100",onClick:()=>f(d),children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>A(a._id),children:e.jsx(Oe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>$(d),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",w===d?"Hide Permissions":"View Permissions "]}),w===d?e.jsx(G,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),w===d&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(Q).map(h=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:h},h))]})}),e.jsx("tbody",{children:Object.entries(a.permissions).map(([h,E])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:h}),Object.keys(Q).map(B=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:E.includes(Number(B))?"✅":"-"},B))]},h))})]})]})]})]},d))})]}),e.jsx(Ae,{open:N,onClose:()=>p(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:s,children:[e.jsxs("div",{className:"modalhead",children:[" ",T!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-[500px]",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:L,ref:m,accept:"image/*",name:"",id:"fileInput"}),e.jsx(te,{sx:{width:70,height:70},alt:i.name,src:i.profilePreview}),e.jsx("span",{onClick:()=>m.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(Me,{size:18})})]}),e.jsx(M,{fullWidth:!0,required:!0,value:i.name,onChange:a=>c({...i,name:a.target.value}),label:"Name",size:"small"}),e.jsx(M,{fullWidth:!0,required:!0,value:i.email,onChange:a=>c({...i,email:a.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),e.jsx(M,{fullWidth:!0,required:!0,value:i.password,type:"password",onChange:a=>c({...i,password:a.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:i.role,onChange:a=>O(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),i.role==="manager"&&e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"border p-2 rounded w-full",value:b,onChange:a=>S(a.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),x.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx(D,{variant:"contained",onClick:r,children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(Q).map(([a,d])=>e.jsx("th",{className:"border p-2 text-center",children:d},a))]})}),e.jsx("tbody",{children:j.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:a}),Object.keys(Q).map(d=>{var h;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((h=i.permissions[a])==null?void 0:h.includes(Number(d)))||!1,onChange:()=>P(a,Number(d))})},d)})]},a))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(D,{variant:"outlined",onClick:y,children:"Cancel"}),e.jsx(D,{variant:"contained",onClick:s,loading:o,children:T!==null?"Update":"Create"})]})]})})})]})}const Ne=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function Ut(){const[t,n]=v.useState(null),[o,l]=v.useState(!1),[i,c]=v.useState(!1),[m,g]=v.useState(!1),{handleImage:T}=Ee(),[C,N]=v.useState(null),[p,b]=v.useState({name:"",industry:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),S=he(),{employee:w,company:k,branch:$,profile:y}=oe(r=>r.user),s=r=>{n(j=>j===r?null:r)};v.useEffect(()=>{k&&b(k)},[k]);const u=(r,j,x)=>{b(a=>({...a,[r]:{...a[r],[j]:x}}))},f=async()=>{try{g(!0);const r=localStorage.getItem("emstoken"),j=await R.post("/api/updateCompany",{...p},{headers:{Authorization:`Bearer ${r}`}});S(ie()),I.success(j.data.message,{autoClose:1800})}catch(r){console.log(r),r.response?I.warn(r.response.data.message,{autoClose:2700}):r.request?console.error("No response from server:",r.request):console.error("Error:",r.message)}finally{g(!1)}},A=()=>{},P=r=>{var x;l(!0);const j={...r,managerIds:(x=r==null?void 0:r.managerIds)==null?void 0:x.map(a=>a._id)};N(j),c(!0)},L={headCells:{style:{backgroundColor:oe(r=>r.user.primaryColor)||"teal",fontWeight:"bold",fontSize:"14px",color:"white",justifyContent:"flex-start",paddingLeft:"4px",paddingRight:"4px"}},headRow:{style:{borderBottom:"2px solid #ccc"}},rows:{style:{minHeight:"48px",borderBottom:"1px solid #eee"}},cells:{style:{justifyContent:"flex-start",paddingLeft:"4px",paddingRight:"4px"}}};return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(y==null?void 0:y.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-blue-100 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),t==="company"?e.jsx(G,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),t==="company"&&e.jsxs("div",{className:"p-4 rounded flex flex-col md:flex-row items-center border-blue-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[e.jsx("img",{src:(p==null?void 0:p.logo)||e.jsx(Ve,{}),alt:"Company Logo",className:"w-full h-full object-fill rounded-2xl border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async r=>{const j=r.target.files[0];if(!j)return;const x=await T(200,j),a=new FormData;a.append("_id",p._id),a.append("logo",x);try{console.log("api calling"),g(!0);const d=localStorage.getItem("emstoken"),E=(await R.post("/api/updateCompany",a,{headers:{Authorization:`Bearer ${d}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;b(B=>({...B,logo:E})),I.success("Logo uploaded successfully!")}catch(d){console.error(d),I.error("Failed to upload logo.")}finally{g(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Company Name"}),e.jsx("input",{type:"text",onChange:r=>b({...p,name:r.target.value}),value:p.name,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Industry"}),e.jsx("input",{type:"text",onChange:r=>b({...p,industry:r.target.value}),value:p.industry,className:"w-full border rounded px-3 py-2"})]}),k?e.jsx(D,{variant:"contained",loading:m,onClick:f,children:"Save Changes"}):e.jsx(D,{loading:m,variant:"contained",onClick:()=>jt({companyinp:p,setisload:g}),children:"+ Create Company"})]})]})]}),((y==null?void 0:y.role)=="superadmin"||(y==null?void 0:y.role)=="admin")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-100 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),t==="branches"?e.jsx(G,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),t==="branches"&&e.jsxs("div",{className:"p-1 md:p-4 rounded overflow-auto border-green-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-md font-medium",children:"Branch List"}),e.jsx(D,{variant:"contained",onClick:()=>c(!0),children:"+ Add Branch"})]}),e.jsx(Qe,{customStyles:L,columns:[{name:"Name",selector:r=>r.name,sortable:!0},{name:"Location",selector:r=>r.location,sortable:!0},{name:"Manager(s)",cell:r=>{var j;return e.jsx("div",{className:"flex flex-col gap-2",children:(j=r==null?void 0:r.managerIds)==null?void 0:j.map((x,a)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>A(x.userid),children:[e.jsx(te,{src:x==null?void 0:x.profileImage,alt:x.name,children:!(x!=null&&x.profileImage)&&e.jsx(Te,{})}),e.jsx("span",{children:x.name})]},a))})}},{name:"Actions",width:"120px",cell:r=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>P(r),children:e.jsx(Me,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>P(r),children:e.jsx(Xe,{})})]})}],data:$||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),t==="department"?e.jsx(G,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),t==="department"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 space-y-4",children:e.jsx(He,{})})]}),(y==null?void 0:y.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),t==="admin"?e.jsx(G,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),t==="admin"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 ",children:e.jsx(wt,{})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-100 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),t==="attendance"?e.jsx(G,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),t==="attendance"&&k&&e.jsxs(ne,{className:" border-yellow-300  border-2 border-dashed rounded mt-1 p-2 ",children:[e.jsxs(ne,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(M,{label:"Office Time In",fullWidth:!0,type:"time",value:p.officeTime.in,onChange:r=>u("officeTime","in",r.target.value),helperText:"Time when office hours begin"}),e.jsx(M,{label:"Office Time Out",fullWidth:!0,type:"time",value:p.officeTime.out,onChange:r=>u("officeTime","out",r.target.value),helperText:"Time when office hours end"}),e.jsx(M,{label:"Break Minutes",fullWidth:!0,type:"number",value:p.officeTime.breakMinutes,onChange:r=>u("officeTime","breakMinutes",Number(r.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(M,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:p.workingMinutes.fullDay,onChange:r=>u("workingMinutes","fullDay",Number(r.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(M,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:p.workingMinutes.halfDay,onChange:r=>u("workingMinutes","halfDay",Number(r.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(M,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:p.workingMinutes.shortDayThreshold,onChange:r=>u("workingMinutes","shortDayThreshold",Number(r.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(M,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:p.workingMinutes.overtimeAfterMinutes,onChange:r=>u("workingMinutes","overtimeAfterMinutes",Number(r.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(ce,{fullWidth:!0,children:[e.jsx(de,{children:"Weekly Offs"}),e.jsx(me,{multiple:!0,value:p.weeklyOffs,onChange:r=>b({...p,weeklyOffs:r.target.value}),input:e.jsx(ue,{label:"Weekly Offs"}),renderValue:r=>r.map(j=>{var x;return(x=Ne.find(a=>a.value===j))==null?void 0:x.label}).join(", "),children:Ne.map(r=>e.jsxs(J,{value:r.value,children:[e.jsx(K,{checked:p.weeklyOffs.includes(r.value)}),e.jsx(Y,{primary:r.label})]},r.value))})]}),Object.entries(p.attendanceRules).map(([r,j])=>{const x=r.replace(/([A-Z])/g," $1").replace(/^./,d=>d.toUpperCase()),a={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(M,{fullWidth:!0,label:x,type:"time",value:j,onChange:d=>u("attendanceRules",r,d.target.value),helperText:a[r]},r)})]}),e.jsx(ne,{sx:{mt:4,textAlign:"right"},children:e.jsx(D,{variant:"contained",onClick:f,children:"Update Settings"})})]})]}),e.jsx(Ae,{open:i,onClose:()=>{c(!1),N(null),l(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsx(bt,{setopenviewmodal:c,editbranchdata:C,editbranch:o,company:k,employee:w})})})]})}export{Ut as default};
