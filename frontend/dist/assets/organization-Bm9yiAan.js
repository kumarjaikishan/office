import{i as fe,h as ge,r as p,k as be,t as ye,j as e,o as te,n as ie,P as de,p as je,q as ce,u as me,f as ue,A as H,F as he,b as B,y as k,g as Q,Q as ve,R as we,I as Ne,S as W,L as R}from"./index-kljkLAdx.js";import{M as pe}from"./Modalbox-Bpkpx_lz.js";import{G as ae,L as Z}from"./ListItemText-CVmMwTGb.js";import{T as y}from"./TextField-BRiLb6so.js";import{a as Ce,f as ke,F as J,I as X,S as Y,O as K}from"./Select-BDcJ5Irb.js";import{M as ee}from"./MenuItem-0VOkJbYV.js";import{C as _}from"./Checkbox-rvfTtW5-.js";import{T as le}from"./Typography-joAp7ObB.js";import{B as z}from"./Button-DwVDi69b.js";import Me from"./Department-BfdywVi0.js";import{a as Te}from"./index-DlZzQYa4.js";import{u as xe}from"./imageresizer-D4I-KFLq.js";import{B as V}from"./Box-DDCmwXuZ.js";import"./useSlotProps-D29sKDDW.js";import"./styled-DUiIUvLd.js";import"./useThemeProps-BQ4WUnBv.js";import"./createSimplePaletteValueFilter-BbsR_CTk.js";import"./ButtonBase-BoH0owAA.js";import"./index-8z59Ek1P.js";import"./index.es-DLt2FNMB.js";import"./attandencehelper-Dq93Z19_.js";import"./dayjs.min-D8gI4GFV.js";import"./InputAdornment-CLoACnic.js";function Ae(n){return ge("MuiFormControlLabel",n)}const $=fe("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Se=n=>{const{classes:x,disabled:M,labelPlacement:m,error:h,required:f}=n,c={root:["root",M&&"disabled",`labelPlacement${de(m)}`,h&&"error",f&&"required"],label:["label",M&&"disabled"],asterisk:["asterisk",h&&"error"]};return je(c,Ae,x)},Ee=ie("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(n,x)=>{const{ownerState:M}=n;return[{[`& .${$.label}`]:x.label},x.root,x[`labelPlacement${de(M.labelPlacement)}`]]}})(ce(({theme:n})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${$.disabled}`]:{cursor:"default"},[`& .${$.label}`]:{[`&.${$.disabled}`]:{color:(n.vars||n).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:x})=>x==="start"||x==="top"||x==="bottom",style:{marginLeft:16}}]}))),Ie=ie("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(ce(({theme:n})=>({[`&.${$.error}`]:{color:(n.vars||n).palette.error.main}}))),De=p.forwardRef(function(x,M){const m=be({props:x,name:"MuiFormControlLabel"}),{checked:h,className:f,componentsProps:c={},control:g,disabled:S,disableTypography:I,inputRef:D,label:i,labelPlacement:C="end",name:L,onChange:P,required:w,slots:O={},slotProps:j={},value:s,...r}=m,o=Ce(),N=S??g.props.disabled??(o==null?void 0:o.disabled),E=w??g.props.required,t={disabled:N,required:E};["checked","name","onChange","value","inputRef"].forEach(T=>{typeof g.props[T]>"u"&&typeof m[T]<"u"&&(t[T]=m[T])});const v=ke({props:m,muiFormControl:o,states:["error"]}),b={...m,disabled:N,labelPlacement:C,required:E,error:v.error},u=Se(b),A={slots:O,slotProps:{...c,...j}},[a,l]=ye("typography",{elementType:le,externalForwardedProps:A,ownerState:b});let d=i;return d!=null&&d.type!==le&&!I&&(d=e.jsx(a,{component:"span",...l,className:te(u.label,l==null?void 0:l.className),children:d})),e.jsxs(Ee,{className:te(u.root,f),ownerState:b,ref:M,...r,children:[p.cloneElement(g,t),E?e.jsxs("div",{children:[d,e.jsxs(Ie,{ownerState:b,"aria-hidden":!0,className:u.asterisk,children:[" ","*"]})]}):d]})}),re=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Le=({setopenviewmodal:n,employee:x,company:M,editbranch:m,editbranchdata:h})=>{const f={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:540},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[c,g]=p.useState(f),S=me(),{adminManager:I}=ue(s=>s.user),[D,i]=p.useState([]),C=localStorage.getItem("emstoken");p.useEffect(()=>{i(x),g(s=>({...s,companyId:M._id})),m&&g(s=>({...s,...h}))},[M,m]),p.useEffect(()=>{I.length>0&&i(I.filter(s=>s.role==="manager"))},[I]);const L=()=>{n(!1),g(f)},P=(s,r)=>{g(o=>({...o,[s]:r}))},w=(s,r,o)=>{g(N=>({...N,setting:{...N.setting,[s]:{...N.setting[s],[r]:o}}}))},O=async()=>{var s,r;try{const o=await B.post("/api/addBranch",c,{headers:{Authorization:`Bearer ${C}`}});k.success(o.data.message),n(!1),S(Q()),L()}catch(o){console.error(o),k.error(((r=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:r.message)||"Error adding branch")}},j=async()=>{var s,r;try{const o=await B.post("/api/editBranch",c,{headers:{Authorization:`Bearer ${C}`}});k.success(o.data.message),S(Q()),n(!1),L()}catch(o){console.error(o),k.error(((r=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:r.message)||"Error editing branch")}};return e.jsxs("form",{children:[e.jsx("h2",{children:m?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(ae,{container:!0,spacing:2,children:[e.jsx(y,{label:"Branch Name",fullWidth:!0,size:"small",value:c.name,onChange:s=>P("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(y,{label:"Location",fullWidth:!0,size:"small",value:c.location,onChange:s=>P("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(J,{size:"small",fullWidth:!0,children:[e.jsx(X,{children:"Managers"}),e.jsx(Y,{multiple:!0,value:c.managerIds,onChange:s=>P("managerIds",s.target.value),input:e.jsx(K,{label:"Managers"}),renderValue:s=>s.map(r=>{var o;return(o=D.find(N=>N._id===r))==null?void 0:o.name}).join(", "),children:D==null?void 0:D.map(s=>{var r;return e.jsxs(ee,{value:s==null?void 0:s._id,children:[e.jsx(_,{checked:(r=c==null?void 0:c.managerIds)==null?void 0:r.includes(s._id)}),e.jsx(H,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!s.profileImage&&e.jsx(he,{})}),e.jsx(Z,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)})})]})]}),e.jsx(De,{control:e.jsx(_,{checked:!c.defaultsetting,onChange:s=>g(r=>({...r,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!c.defaultsetting&&e.jsx("div",{className:"border-yellow-300 border-2 grid grid-cols-2 gap-3 border-dashed rounded mt-3 p-3",children:e.jsxs(ae,{container:!0,spacing:2,children:[e.jsx(y,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>w("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(y,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>w("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(y,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.officeTime.breakMinutes,onChange:s=>w("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(y,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.fullDay,onChange:s=>w("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(y,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.halfDay,onChange:s=>w("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(y,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.shortDayThreshold,onChange:s=>w("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(y,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>w("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(J,{size:"small",fullWidth:!0,children:[e.jsx(X,{children:"Weekly Offs"}),e.jsx(Y,{multiple:!0,value:c.setting.weeklyOffs,onChange:s=>g(r=>({...r,setting:{...r.setting,weeklyOffs:s.target.value}})),input:e.jsx(K,{label:"Weekly Offs"}),renderValue:s=>s.map(r=>{var o;return(o=re.find(N=>N.value===r))==null?void 0:o.label}).join(", "),children:re.map(s=>e.jsxs(ee,{value:s.value,children:[e.jsx(_,{checked:c.setting.weeklyOffs.includes(s.value)}),e.jsx(Z,{primary:s.label})]},s.value))})]}),Object.entries(c.setting.attendanceRules).map(([s,r])=>{const o=s.replace(/([A-Z])/g," $1").replace(/^./,E=>E.toUpperCase()),N={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(y,{fullWidth:!0,size:"small",label:o,type:"time",value:r,onChange:E=>g(t=>({...t,setting:{...t.setting,attendanceRules:{...t.setting.attendanceRules,[s]:E.target.value}}})),helperText:N[s]},s)})]})}),e.jsxs("div",{className:"flex gap-2 mt-3 w-full",children:[e.jsx(z,{variant:"outlined",onClick:L,children:"Cancel"}),m?e.jsx(z,{variant:"contained",onClick:j,children:"Save"}):e.jsx(z,{variant:"contained",onClick:O,children:"Add Branch"})]})]})]})},Pe=async({companyinp:n,setisload:x})=>{const M=localStorage.getItem("emstoken");x(!0);try{const m=await B.post("/api/addcompany",{name:n.name,industry:n.industry},{headers:{Authorization:`Bearer ${M}`}});console.log("Query:",m),k.success(m.data.message,{autoClose:1200})}catch(m){console.log(m),m.response?k.warn(m.response.data.message,{autoClose:1200}):m.request?console.error("No response from server:",m.request):console.error("Error:",m.message)}finally{x(!1)}},U={1:"Read",2:"Create",3:"Update",4:"Delete"},ne=["attandence","branch","department","employee","ledgerentry","holiday","leave","ledger","notification","salary"],G={attandence:[1,2,3,4],branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],ledgerentry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],ledger:[1,2,3,4],notification:[1,2,3,4],salary:[1,2,3]},Oe={employee:[1,2,3],attandence:[1,2,3],department:[1,2,3],holiday:[1,2],leave:[1,3],ledger:[1,2,3,4],ledgerentry:[1,2,3,4],notification:[1,2],salary:[1]};function Be(){const[n,x]=p.useState([]),[M,m]=p.useState([]),[h,f]=p.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...G}});p.useEffect(()=>{r()},[]);const c=p.useRef(null),{handleImage:g}=xe(),[S,I]=p.useState(null),[D,i]=p.useState(!1),[C,L]=p.useState(""),[P,w]=p.useState(null),O=a=>{w(l=>l===a?null:a)},j=()=>{f({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...G}}),L(""),I(null),i(!1)},s=async()=>{const a={...h};console.log(h);const l=new FormData;try{const d=a.profileImage?await g(300,a.profileImage):null;d&&l.append("photo",d),l.append("name",a.name),l.append("email",a.email),l.append("role",a.role),l.append("password",a.password),l.append("permissions",JSON.stringify(a.permissions));const T=localStorage.getItem("emstoken");m(!0);const F=S!==null?`/api/editAdmin/${n[S]._id}`:"/api/addAdmin",q=await B["post"](F,l,{headers:{Authorization:`Bearer ${T}`,"Content-Type":"multipart/form-data"}});k.success(q.data.message,{autoClose:1200}),console.log(q.data),j(),r()}catch(d){console.error(d),d.response?k.warn(d.response.data.message,{autoClose:1200}):k.error("Something went wrong",{autoClose:1200})}finally{m(!1)}},r=async()=>{try{const a=localStorage.getItem("emstoken"),l=await B.get("/api/getAdmin",{headers:{Authorization:`Bearer ${a}`}});console.log(l.data),x(l.data)}catch(a){console.error(a),a.response?k.warn(a.response.data.message,{autoClose:1200}):k.error("Something went wrong",{autoClose:1200})}finally{m(!1)}},o=a=>{const l=n[a];f({...l,profilePreview:l.profileImage||"",profileImage:null}),I(a),i(!0)},N=a=>{const l=n.filter((d,T)=>T!==a);x(l)},E=(a,l)=>{f(d=>{const T=d.permissions[a]||[],se=T.includes(l)?T.filter(q=>q!==l):[...T,l].sort();return{...d,permissions:{...d.permissions,[a]:se}}})},t=a=>{const l=a==="admin"?{...G}:{...Oe};f({...h,role:a,permissions:l})},v=a=>{const l=a.target.files[0];l&&f(d=>({...d,profileImage:l,profilePreview:URL.createObjectURL(l)}))},b=()=>{C&&(f(a=>({...a,permissions:{...a.permissions,[C]:[]}})),L(""))},u=Array.from(new Set([...h.role==="admin"?ne:Object.keys(h.permissions),...Object.keys(h.permissions)])),A=ne.filter(a=>!u.includes(a));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-[16px] md:text-xl font-semibold",children:"Admin Management"}),e.jsx("button",{className:"bg-blue-600 text-white px-3 md:px-4 py-1 md:py-2 rounded hover:bg-blue-700",onClick:()=>{j(),i(!0)},children:"Add Admin"})]}),n.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:n.map((a,l)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{sx:{width:60,height:60},alt:a.name,src:a==null?void 0:a.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[a.name," (",a.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:a.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"p-2 border rounded hover:bg-gray-100",onClick:()=>o(l),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>N(l),children:e.jsx(we,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("button",{onClick:()=>O(l),className:"text-blue-600 cursor-pointer text-sm mt-1 ",children:P===l?"Hide Permissions":"View Permissions "}),P===l&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(U).map(d=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:d},d))]})}),e.jsx("tbody",{children:Object.entries(a.permissions).map(([d,T])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:d}),Object.keys(U).map(F=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:T.includes(Number(F))?"✅":"-"},F))]},d))})]})]})]})]},l))})]}),e.jsx(pe,{open:D,onClose:()=>i(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:s,children:[e.jsxs("h2",{children:[" ",S!==null?"Edit Admin":"Add Admin"]}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-[500px]",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:v,ref:c,accept:"image/*",name:"",id:"fileInput"}),e.jsx(H,{sx:{width:70,height:70},alt:h.name,src:h.profilePreview}),e.jsx("span",{onClick:()=>c.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(Ne,{size:18})})]}),e.jsx(y,{fullWidth:!0,required:!0,value:h.name,onChange:a=>f({...h,name:a.target.value}),label:"Name",size:"small"}),e.jsx(y,{fullWidth:!0,required:!0,value:h.email,onChange:a=>f({...h,email:a.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),e.jsx(y,{fullWidth:!0,required:!0,value:h.password,type:"password",onChange:a=>f({...h,password:a.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:h.role,onChange:a=>t(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),h.role==="manager"&&e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"border p-2 rounded w-full",value:C,onChange:a=>L(a.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),A.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Add"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(U).map(([a,l])=>e.jsx("th",{className:"border p-2 text-center",children:l},a))]})}),e.jsx("tbody",{children:u.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:a}),Object.keys(U).map(l=>{var d;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:`h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                             checked:bg-teal-600 checked:border-teal-600 \r
                                                             focus:ring-2 focus:ring-teal-400 focus:outline-none \r
                                                             transition duration-200 ease-in-out`,type:"checkbox",checked:((d=h.permissions[a])==null?void 0:d.includes(Number(l)))||!1,onChange:()=>E(a,Number(l))})},l)})]},a))})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{className:"px-4 py-1 border rounded hover:bg-gray-100",onClick:j,children:"Cancel"}),e.jsx("button",{className:"px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:s,children:S!==null?"Update":"Create"})]})]})]})})})]})}const oe=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function ns(){const[n,x]=p.useState(null),[M,m]=p.useState(!1),[h,f]=p.useState(!1),[c,g]=p.useState(!1),{handleImage:S}=xe(),[I,D]=p.useState(null),[i,C]=p.useState({name:"",industry:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),L=me(),{employee:P,company:w,branch:O,profile:j}=ue(t=>t.user),s=t=>{x(v=>v===t?null:t)};p.useEffect(()=>{w&&C(w)},[w]);const r=(t,v,b)=>{C(u=>({...u,[t]:{...u[t],[v]:b}}))},o=async()=>{try{g(!0);const t=localStorage.getItem("emstoken"),v=await B.post("/api/updateCompany",{...i},{headers:{Authorization:`Bearer ${t}`}});L(Q()),k.success(v.data.message,{autoClose:1800})}catch(t){console.log(t),t.response?k.warn(t.response.data.message,{autoClose:2700}):t.request?console.error("No response from server:",t.request):console.error("Error:",t.message)}finally{g(!1)}},N=()=>{},E=t=>{var b;m(!0);const v={...t,managerIds:(b=t==null?void 0:t.managerIds)==null?void 0:b.map(u=>u._id)};D(v),f(!0)};return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(j==null?void 0:j.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-blue-100 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),n==="company"?e.jsx(W,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),n==="company"&&e.jsxs("div",{className:"p-4 rounded flex flex-col md:flex-row items-center border-blue-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[e.jsx("img",{src:(i==null?void 0:i.logo)||e.jsx(Te,{}),alt:"Company Logo",className:"w-full h-full object-fill rounded-2xl border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async t=>{const v=t.target.files[0];if(!v)return;const b=await S(200,v),u=new FormData;u.append("_id",i._id),u.append("logo",b);try{console.log("api calling"),g(!0);const A=localStorage.getItem("emstoken"),l=(await B.post("/api/updateCompany",u,{headers:{Authorization:`Bearer ${A}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;C(d=>({...d,logo:l})),k.success("Logo uploaded successfully!")}catch(A){console.error(A),k.error("Failed to upload logo.")}finally{g(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Company Name"}),e.jsx("input",{type:"text",onChange:t=>C({...i,name:t.target.value}),value:i.name,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Industry"}),e.jsx("input",{type:"text",onChange:t=>C({...i,industry:t.target.value}),value:i.industry,className:"w-full border rounded px-3 py-2"})]}),w?e.jsx(z,{variant:"contained",loading:c,onClick:o,children:"Save Changes"}):e.jsx(z,{loading:c,variant:"contained",onClick:()=>Pe({companyinp:i,setisload:g}),children:"+ Create Company"})]})]})]}),((j==null?void 0:j.role)=="superadmin"||(j==null?void 0:j.role)=="admin")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-100 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),n==="branches"?e.jsx(W,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),n==="branches"&&e.jsxs("div",{className:"p-1 md:p-4 rounded overflow-auto  border-green-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-md font-medium",children:"Branch List"}),e.jsx("button",{onClick:()=>f(!0),className:"bg-green-500 text-white px-3 py-1 rounded",children:"+ Add Branch"})]}),e.jsxs("table",{className:"w-full capitalize text-[12px] md:text-sm border",children:[e.jsx("thead",{className:"bg-green-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Name"}),e.jsx("th",{className:"p-2 border",children:"Location"}),e.jsx("th",{className:"p-2 border",children:"Manager(s)"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsxs("tbody",{children:[O&&O.map((t,v)=>{var b;return e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 border",children:t.name}),e.jsx("td",{className:"p-2 border",children:t.location}),e.jsx("td",{className:"p-2 border capitalize",children:e.jsx("div",{className:"flex flex-col gap-2",children:(b=t==null?void 0:t.managerIds)==null?void 0:b.map((u,A)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>N(u.userid),children:[e.jsx(H,{src:u==null?void 0:u.profileImage,alt:u.name,children:!(u!=null&&u.profileImage)&&e.jsx(he,{})}),e.jsx("span",{children:u.name})]},A))})}),e.jsx("td",{className:"p-2 border",children:e.jsx("button",{onClick:()=>E(t),className:"bg-blue-500 text-white px-3 py-1 rounded",children:"Edit"})})]},v)}),!O&&e.jsx("div",{children:"No branch Found"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),n==="department"?e.jsx(W,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),n==="department"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 space-y-4",children:e.jsx(Me,{})})]}),(j==null?void 0:j.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin"}),n==="admin"?e.jsx(W,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),n==="admin"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 ",children:e.jsx(Be,{})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-100 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),n==="attendance"?e.jsx(W,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),n==="attendance"&&w&&e.jsxs(V,{className:" border-yellow-300  border-2 border-dashed rounded mt-1 p-2 ",children:[e.jsxs(V,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(y,{label:"Office Time In",fullWidth:!0,type:"time",value:i.officeTime.in,onChange:t=>r("officeTime","in",t.target.value),helperText:"Time when office hours begin"}),e.jsx(y,{label:"Office Time Out",fullWidth:!0,type:"time",value:i.officeTime.out,onChange:t=>r("officeTime","out",t.target.value),helperText:"Time when office hours end"}),e.jsx(y,{label:"Break Minutes",fullWidth:!0,type:"number",value:i.officeTime.breakMinutes,onChange:t=>r("officeTime","breakMinutes",Number(t.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(y,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:i.workingMinutes.fullDay,onChange:t=>r("workingMinutes","fullDay",Number(t.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(y,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:i.workingMinutes.halfDay,onChange:t=>r("workingMinutes","halfDay",Number(t.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(y,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:i.workingMinutes.shortDayThreshold,onChange:t=>r("workingMinutes","shortDayThreshold",Number(t.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(y,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:i.workingMinutes.overtimeAfterMinutes,onChange:t=>r("workingMinutes","overtimeAfterMinutes",Number(t.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(J,{fullWidth:!0,children:[e.jsx(X,{children:"Weekly Offs"}),e.jsx(Y,{multiple:!0,value:i.weeklyOffs,onChange:t=>C({...i,weeklyOffs:t.target.value}),input:e.jsx(K,{label:"Weekly Offs"}),renderValue:t=>t.map(v=>{var b;return(b=oe.find(u=>u.value===v))==null?void 0:b.label}).join(", "),children:oe.map(t=>e.jsxs(ee,{value:t.value,children:[e.jsx(_,{checked:i.weeklyOffs.includes(t.value)}),e.jsx(Z,{primary:t.label})]},t.value))})]}),Object.entries(i.attendanceRules).map(([t,v])=>{const b=t.replace(/([A-Z])/g," $1").replace(/^./,A=>A.toUpperCase()),u={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(y,{fullWidth:!0,label:b,type:"time",value:v,onChange:A=>r("attendanceRules",t,A.target.value),helperText:u[t]},t)})]}),e.jsx(V,{sx:{mt:4,textAlign:"right"},children:e.jsx(z,{variant:"contained",onClick:o,children:"Update Settings"})})]})]}),e.jsx(pe,{open:h,onClose:()=>{f(!1),D(null),m(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsx(Le,{setopenviewmodal:f,editbranchdata:I,editbranch:M,company:w,employee:P})})})]})}export{ns as default};
