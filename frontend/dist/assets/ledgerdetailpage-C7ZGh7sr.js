import{h as b,j as e,ai as ie,aj as oe,b2 as de,bj as ce,a as me,r as o,c as E,y as m,A as ue,B as g,F as O,I as $,S as T,M as k,O as U,i as _,C as V,b as v,bk as xe,a0 as pe,a1 as he,a3 as ge}from"./index-C1itNt9r.js";import{b as be}from"./index-D029hqxr.js";import{L as je}from"./loader-D6GAk9JR.js";const fe=(u,x)=>[{name:"S.No",selector:(l,P)=>P+1,width:"60px"},{name:"Date",selector:l=>b(l.date).format("DD MMM, YYYY"),sortable:!0},{name:"Particular",selector:l=>l.particular},{name:"Debit",selector:l=>parseFloat(l.debit)===0?"":l.debit,width:"90px"},{name:"Credit",selector:l=>parseFloat(l.credit)===0?"":l.credit,width:"90px"},{name:"Balance",selector:l=>l.balance},{name:"Actions",cell:l=>e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit Entry",onClick:()=>u(l),style:{cursor:"pointer",marginRight:10}}),e.jsx(oe,{className:"delete text-[18px] text-red-500 cursor-pointer",title:"Delete Entry",onClick:()=>x(l._id),style:{cursor:"pointer"}})]}),width:"120px"}],A=({label:u,value:x})=>{const l=parseFloat(x)<0;return e.jsxs("div",{className:"bg-teal-50 border border-teal-300 border-dashed rounded-md px-4 py-2 min-w-[150px] text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:u}),e.jsx("hr",{className:"my-2 border-teal-200"}),e.jsxs("p",{className:`text-lg font-semibold ${l?"text-red-600":"text-black"}`,children:[x," â‚¹"]})]})},Ne=()=>{const{id:u}=de(),[x]=ce(),l=me(),[P,L]=o.useState(!1),F=x.get("name"),H=decodeURIComponent(x.get("profileimage")),[w,W]=o.useState([]),[y,X]=o.useState([]),[C,R]=o.useState("all"),[N,z]=o.useState("all"),[S,B]=o.useState(""),[q,G]=o.useState(0),[J,K]=o.useState(0),[Q,Z]=o.useState(0),I={date:b().format("YYYY-MM-DD"),particular:"",debit:"",credit:""},[n,p]=o.useState(I),[ee,j]=o.useState(!1),[D,f]=o.useState(null),M={Authorization:`Bearer ${localStorage.getItem("emstoken")}`};o.useEffect(()=>{Y()},[u]),o.useEffect(()=>{if(!w)return;const t=w.filter(a=>{const i=b(a.date),r=C!=="all"?i.year()===Number(C):!0,h=N!=="all"?i.month()+1===Number(N):!0,ne=S?i.isSame(S,"day"):!0;return r&&h&&ne});X(t);const s=t.reduce((a,i)=>a+(i.debit||0),0),d=t.reduce((a,i)=>a+(i.credit||0),0),c=s-d;G(s),K(d),Z(c)},[w,C,N,S]);const Y=async()=>{var t;L(!0);try{const s=await E.get(`/api/entries/${u}`,{headers:M});W((t=s.data)==null?void 0:t.entries)}catch(s){console.log(s),m.error(s.response.data.message)}finally{L(!1)}},te=()=>{R("all"),z("all"),B("")},ae=async t=>{swal({title:"Are you sure to Delete this entry?",text:"Once deleted, you will not be able to recover this",icon:"warning",buttons:!0,dangerMode:!0}).then(async s=>{var d,c;if(s)try{let a=await E.delete(`/api/ledgerentry/${t}`,{headers:M});m.success(a.data.message),Y()}catch(a){console.log(a),m.warning(((c=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:c.message)||(a==null?void 0:a.message)||"Error deleting entry")}})},se=()=>{const t=["S.No","Date","Particular","Debit","Credit","Balance"],s=y.map((r,h)=>[h+1,b(r.date).format("YYYY-MM-DD"),r.particular,r.debit,r.credit,r.balance]),d=[t,...s].map(r=>r.join(",")).join(`
`),c=new Blob([d],{type:"text/csv"}),a=URL.createObjectURL(c),i=document.createElement("a");i.href=a,i.download=`${F}_ledger.csv`,i.click(),URL.revokeObjectURL(a)},le=async()=>{var a,i;if(!n.particular||n.particular.trim()===""){m.warn("Particular field can't be blank");return}const t=(a=n.debit)==null?void 0:a.toString().trim(),s=(i=n.credit)==null?void 0:i.toString().trim();if(t===""&&s===""){m.warn("At least one value needed: Debit or Credit");return}const d=parseFloat(t||0),c=parseFloat(s||0);if(d&&c){m.warn("Only one of Debit or Credit is allowed");return}try{const r={...n,date:new Date(n.date),ledgerId:u,debit:d||0,credit:c||0};let h;D!==null?(h=await E.put(`/api/ledgerentry/${D}`,r,{headers:M}),f(null)):h=await E.post("/api/ledgerentry",r,{headers:M}),m.success(h.data.message),j(!1),p(I),Y()}catch(r){console.log(r),m.warning(r.response.data.message)}},re=t=>{var d,c;const s=new Date(t.date).toISOString().split("T")[0];p({date:s,particular:t.particular,debit:((d=t.debit)==null?void 0:d.toString())||"",credit:((c=t.credit)==null?void 0:c.toString())||""}),f(t._id),j(!0)};return e.jsxs("div",{className:"bg-white rounded shadow-md p-1 md:p-5 relative ",children:[e.jsxs("div",{className:"border border-teal-600 border-dashed rounded-md p-3 md:p-5 mb-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-start md:items-center",children:[e.jsxs("div",{className:"flex items-start md:items-center  gap-3",children:[e.jsx(ue,{sx:{width:55,height:55},alt:F,src:H}),e.jsx("h2",{className:"text-2xl font-semibold text-teal-700 capitalize",children:F})]}),e.jsx(g,{className:" w-full md:w-auto",onClick:()=>l(-1),variant:"contained",children:"Ledger Page"})]}),P?e.jsx(je,{}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(A,{label:"Total Debit",value:q}),e.jsx(A,{label:"Total Credit",value:J}),e.jsx(A,{label:"Net Balance",value:Q.toFixed(2)})]})]}),e.jsxs("div",{className:"flex  flex-wrap items-center gap-3 mb-4",children:[e.jsxs("div",{className:"p-1 md:p-2 rounded shadow mb-4 md:mb-0 grid grid-cols-2 md:grid-cols-none md:flex gap-3 md:gap-2 mt-1 w-full  md:w-fit",children:[e.jsxs(O,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx($,{children:"Year"}),e.jsxs(T,{value:C,input:e.jsx(U,{startAdornment:e.jsx(_,{position:"start",children:e.jsx(V,{fontSize:"small"})}),label:"Year"}),onChange:t=>R(t.target.value),children:[e.jsx(k,{value:"all",children:"All"}),[...new Set(w.map(t=>b(t.date).year()))].map(t=>e.jsx(k,{value:t,children:t},t))]})]}),e.jsxs(O,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx($,{children:"Month"}),e.jsxs(T,{value:N,input:e.jsx(U,{startAdornment:e.jsx(_,{position:"start",children:e.jsx(V,{fontSize:"small"})}),label:"Month"}),onChange:t=>z(t.target.value),children:[e.jsx(k,{value:"all",children:"All"}),Array.from({length:12},(t,s)=>e.jsx(k,{value:s+1,children:b().month(s).format("MMMM")},s))]})]}),e.jsx(v,{size:"small",type:"date",className:"col-span-1  md:w-[160px]",value:S,onChange:t=>B(t.target.value),label:"Date",InputLabelProps:{shrink:!0}}),e.jsx(g,{className:"col-span-1  md:w-[120px]",variant:"outlined",color:"secondary",title:"Reset",startIcon:e.jsx(xe,{}),onClick:te,children:"Reset"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 ml-auto",children:[e.jsx(g,{variant:"contained",onClick:()=>{j(!0),f(null)},children:"Add Entry"}),e.jsx(g,{variant:"outlined",onClick:se,startIcon:e.jsx(be,{}),children:"Export CSV"})]})]}),e.jsx("div",{className:" overflow-x-auto",children:e.jsx(pe,{columns:fe(re,ae),data:y||[],pagination:!0,customStyles:he(),highlightOnHover:!0,noDataComponent:"No entries found",paginationPerPage:10,paginationRowsPerPageOptions:[10,25,50,100,y.length>100?y.length:null].filter(Boolean),paginationComponentOptions:{rowsPerPageText:"Rows per page:"}})}),e.jsx(ge,{open:ee,onClose:()=>{j(!1),f(null)},children:e.jsx("div",{className:"membermodal w-[310px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:D!==null?"Edit Entry":"Add Entry"}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"flex  w-full flex-col gap-3",children:[e.jsx(v,{fullWidth:!0,type:"date",label:"Date",size:"small",InputLabelProps:{shrink:!0},value:n.date||"",onChange:t=>p({...n,date:t.target.value})}),e.jsx(v,{multiline:!0,minRows:2,label:"Particular",size:"small",value:n.particular||"",onChange:t=>p({...n,particular:t.target.value})}),e.jsx(v,{type:"number",label:"Debit",size:"small",value:n.debit||"",onChange:t=>p({...n,debit:t.target.value,credit:""})}),e.jsx(v,{type:"number",label:"Credit",size:"small",value:n.credit||"",onChange:t=>p({...n,credit:t.target.value,debit:""})})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(g,{variant:"outlined",onClick:()=>{j(!1),p(I),f(null)},children:"Cancel"}),e.jsx(g,{variant:"contained",onClick:le,children:D!==null?"Update":"Add"})]})]})})})]})};export{Ne as default};
