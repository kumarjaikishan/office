import{a6 as Me,a7 as Se,r as g,a8 as be,a9 as Ae,aa as Ee,ab as Y,T as V,j as e,ac as le,ad as me,ae as ye,af as je,ag as ve,ah as Ie,ai as Pe,aj as Q,ak as he,u as ue,g as we,b as v,F as re,I as ne,S as oe,M as K,A as ae,k as Ne,O as ie,X as de,B as D,c as W,y as C,l as J,al as Le,V as De,am as $e,a3 as _,a4 as H,U as Ce,a1 as Oe,an as Be,a0 as ze,W as Fe}from"./index-Bmv7iLYX.js";import{M as ce}from"./Modalbox-rfFArPWj.js";import{C as ee}from"./Checkbox-CPv1T_cC.js";import We from"./Department-nQfmpgMs.js";import{u as ke}from"./imageresizer-D4I-KFLq.js";import"./index-C-zkqrXD.js";function Re(r){return Se("MuiFormControlLabel",r)}const Z=Me("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),qe=r=>{const{classes:m,disabled:y,labelPlacement:i,error:p,required:b}=r,c={root:["root",y&&"disabled",`labelPlacement${ye(i)}`,p&&"error",b&&"required"],label:["label",y&&"disabled"],asterisk:["asterisk",p&&"error"]};return je(c,Re,m)},Ue=me("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(r,m)=>{const{ownerState:y}=r;return[{[`& .${Z.label}`]:m.label},m.root,m[`labelPlacement${ye(y.labelPlacement)}`]]}})(ve(({theme:r})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${Z.disabled}`]:{cursor:"default"},[`& .${Z.label}`]:{[`&.${Z.disabled}`]:{color:(r.vars||r).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:m})=>m==="start"||m==="top"||m==="bottom",style:{marginLeft:16}}]}))),_e=me("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(ve(({theme:r})=>({[`&.${Z.error}`]:{color:(r.vars||r).palette.error.main}}))),He=g.forwardRef(function(m,y){const i=be({props:m,name:"MuiFormControlLabel"}),{checked:p,className:b,componentsProps:c={},control:j,disabled:$,disableTypography:T,inputRef:E,label:d,labelPlacement:k="end",name:P,onChange:L,required:N,slots:S={},slotProps:h={},value:s,...o}=i,n=Ae(),w=$??j.props.disabled??(n==null?void 0:n.disabled),A=N??j.props.required,I={disabled:w,required:A};["checked","name","onChange","value","inputRef"].forEach(R=>{typeof j.props[R]>"u"&&typeof i[R]<"u"&&(I[R]=i[R])});const a=Ee({props:i,muiFormControl:n,states:["error"]}),x={...i,disabled:w,labelPlacement:k,required:A,error:a.error},u=qe(x),M={slots:S,slotProps:{...c,...h}},[O,q]=Y("typography",{elementType:V,externalForwardedProps:M,ownerState:x});let B=d;return B!=null&&B.type!==V&&!T&&(B=e.jsx(O,{component:"span",...q,className:le(u.label,q==null?void 0:q.className),children:B})),e.jsxs(Ue,{className:le(u.root,b),ownerState:x,ref:y,...o,children:[g.cloneElement(j,I),A?e.jsxs("div",{children:[B,e.jsxs(_e,{ownerState:x,"aria-hidden":!0,className:u.asterisk,children:[" ","*"]})]}):B]})}),Ve=r=>{const{classes:m,inset:y,primary:i,secondary:p,dense:b}=r;return je({root:["root",y&&"inset",b&&"dense",i&&p&&"multiline"],primary:["primary"],secondary:["secondary"]},Pe,m)},Xe=me("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(r,m)=>{const{ownerState:y}=r;return[{[`& .${Q.primary}`]:m.primary},{[`& .${Q.secondary}`]:m.secondary},m.root,y.inset&&m.inset,y.primary&&y.secondary&&m.multiline,y.dense&&m.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${he.root}:where(& .${Q.primary})`]:{display:"block"},[`.${he.root}:where(& .${Q.secondary})`]:{display:"block"},variants:[{props:({ownerState:r})=>r.primary&&r.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:r})=>r.inset,style:{paddingLeft:56}}]}),se=g.forwardRef(function(m,y){const i=be({props:m,name:"MuiListItemText"}),{children:p,className:b,disableTypography:c=!1,inset:j=!1,primary:$,primaryTypographyProps:T,secondary:E,secondaryTypographyProps:d,slots:k={},slotProps:P={},...L}=i,{dense:N}=g.useContext(Ie);let S=$??p,h=E;const s={...i,disableTypography:c,inset:j,primary:!!S,secondary:!!h,dense:N},o=Ve(s),n={slots:k,slotProps:{primary:T,secondary:d,...P}},[w,A]=Y("root",{className:le(o.root,b),elementType:Xe,externalForwardedProps:{...n,...L},ownerState:s,ref:y}),[I,a]=Y("primary",{className:o.primary,elementType:V,externalForwardedProps:n,ownerState:s}),[x,u]=Y("secondary",{className:o.secondary,elementType:V,externalForwardedProps:n,ownerState:s});return S!=null&&S.type!==V&&!c&&(S=e.jsx(I,{variant:N?"body2":"body1",component:a!=null&&a.variant?void 0:"span",...a,children:S})),h!=null&&h.type!==V&&!c&&(h=e.jsx(x,{variant:"body2",color:"textSecondary",...u,children:h})),e.jsxs(w,{...A,children:[S,h]})}),xe=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Ze=({setopenviewmodal:r,employee:m,company:y,editbranch:i,editbranchdata:p})=>{const b={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[c,j]=g.useState(b),$=ue(),{adminManager:T}=we(s=>s.user),[E,d]=g.useState([]),k=localStorage.getItem("emstoken");g.useEffect(()=>{j(s=>({...s,companyId:y._id})),i&&j(s=>({...s,...p}))},[y,i]),g.useEffect(()=>{(T==null?void 0:T.length)>0&&d(T.filter(s=>s.role==="manager"))},[T]);const P=()=>{r(!1),j(b)},L=(s,o)=>{j(n=>({...n,[s]:o}))},N=(s,o,n)=>{j(w=>({...w,setting:{...w.setting,[s]:{...w.setting[s],[o]:n}}}))},S=async()=>{var s,o;try{const n=await W.post("/api/addBranch",c,{headers:{Authorization:`Bearer ${k}`}});C.success(n.data.message),r(!1),$(J()),P()}catch(n){console.error(n),C.error(((o=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:o.message)||"Error adding branch")}},h=async()=>{var s,o;try{const n=await W.post("/api/editBranch",c,{headers:{Authorization:`Bearer ${k}`}});C.success(n.data.message),$(J()),r(!1),P()}catch(n){console.error(n),C.error(((o=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:o.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:i?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(v,{label:"Branch Name",fullWidth:!0,size:"small",value:c.name,onChange:s=>L("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(v,{label:"Location",fullWidth:!0,size:"small",value:c.location,onChange:s=>L("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(re,{size:"small",fullWidth:!0,children:[e.jsx(ne,{children:"Managers"}),e.jsx(oe,{multiple:!0,value:(c==null?void 0:c.managerIds)||[],onChange:s=>L("managerIds",s.target.value),input:e.jsx(ie,{label:"Managers"}),renderValue:s=>s.map(o=>{var n;return((n=E.find(w=>w._id===o))==null?void 0:n.name)||"Unknown"}).join(", "),children:E&&E.length>0?E.map(s=>{var o;return e.jsxs(K,{value:s._id,children:[e.jsx(ee,{checked:(o=c==null?void 0:c.managerIds)==null?void 0:o.includes(s._id)}),e.jsx(ae,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!(s!=null&&s.profileImage)&&e.jsx(Ne,{})}),e.jsx(se,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)}):e.jsx(K,{disabled:!0,value:"",children:e.jsx(se,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(He,{control:e.jsx(ee,{checked:!c.defaultsetting,onChange:s=>j(o=>({...o,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!c.defaultsetting&&e.jsx("div",{className:"border-primary border-2 border-dashed rounded mt-3 py-3 px-1",children:e.jsxs(de,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(v,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>N("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(v,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:c.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>N("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(v,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.officeTime.breakMinutes,onChange:s=>N("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(v,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.fullDay,onChange:s=>N("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(v,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.halfDay,onChange:s=>N("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(v,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.shortDayThreshold,onChange:s=>N("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(v,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:c.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>N("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(re,{size:"small",fullWidth:!0,children:[e.jsx(ne,{children:"Weekly Offs"}),e.jsx(oe,{multiple:!0,value:c.setting.weeklyOffs,onChange:s=>j(o=>({...o,setting:{...o.setting,weeklyOffs:s.target.value}})),input:e.jsx(ie,{label:"Weekly Offs"}),renderValue:s=>s.map(o=>{var n;return(n=xe.find(w=>w.value===o))==null?void 0:n.label}).join(", "),children:xe.map(s=>e.jsxs(K,{value:s.value,children:[e.jsx(ee,{checked:c.setting.weeklyOffs.includes(s.value)}),e.jsx(se,{primary:s.label})]},s.value))})]}),Object.entries(c.setting.attendanceRules).map(([s,o])=>{const n=s.replace(/([A-Z])/g," $1").replace(/^./,A=>A.toUpperCase()),w={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(v,{fullWidth:!0,size:"small",label:n,type:"time",value:o,onChange:A=>j(I=>({...I,setting:{...I.setting,attendanceRules:{...I.setting.attendanceRules,[s]:A.target.value}}})),helperText:w[s]},s)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(D,{variant:"outlined",onClick:P,children:"Cancel"}),i?e.jsx(D,{variant:"contained",onClick:h,children:"Save"}):e.jsx(D,{variant:"contained",onClick:S,children:"Add Branch"})]})]})},Je=async({companyinp:r,setisload:m})=>{const y=localStorage.getItem("emstoken");m(!0);try{const i=await W.post("/api/addcompany",{name:r.name,industry:r.industry},{headers:{Authorization:`Bearer ${y}`}});console.log("Query:",i),C.success(i.data.message,{autoClose:1200})}catch(i){console.log(i),i.response?C.warn(i.response.data.message,{autoClose:1200}):i.request?console.error("No response from server:",i.request):console.error("Error:",i.message)}finally{m(!1)}},G={1:"Read",2:"Create",3:"Update",4:"Delete"},fe=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],te={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},Qe={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function Ge(){const[r,m]=g.useState([]),[y,i]=g.useState([]),[p,b]=g.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...te}}),c=ue();g.useEffect(()=>{a()},[]);const j=g.useRef(null),{handleImage:$}=ke(),[T,E]=g.useState(null),[d,k]=g.useState(!1),[P,L]=g.useState(""),[N,S]=g.useState(!1),[h,s]=g.useState(null),o=t=>{s(l=>l===t?null:t)},n=()=>{b({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...te}}),L(""),E(null),k(!1)},[w,A]=g.useState({userid:"",pass:""}),I=async()=>{const t={...p},l=new FormData;i(!0);try{const f=t.profileImage?await $(300,t.profileImage):null;f&&l.append("photo",f),l.append("name",t.name),l.append("email",t.email),l.append("role",t.role),l.append("password",t.password),l.append("permissions",JSON.stringify(t.permissions));const z=localStorage.getItem("emstoken");i(!0);const F=T!==null?`/api/editAdmin/${r[T]._id}`:"/api/addAdmin",X=await W["post"](F,l,{headers:{Authorization:`Bearer ${z}`,"Content-Type":"multipart/form-data"}});C.success(X.data.message,{autoClose:1200}),n(),a(),c(J())}catch(f){console.error(f),f.response?C.warn(f.response.data.message,{autoClose:1200}):C.error("Something went wrong",{autoClose:1200})}finally{i(!1)}},a=async()=>{try{const t=localStorage.getItem("emstoken");i(!0);const l=await W.get("/api/getAdmin",{headers:{Authorization:`Bearer ${t}`}});m(l.data)}catch(t){console.error(t),t.response?C.warn(t.response.data.message,{autoClose:1200}):C.error("Something went wrong",{autoClose:1200})}finally{i(!1)}},x=t=>{const l=r[t];console.log(l),b({...l,profilePreview:l.profileImage||"",profileImage:null}),E(t),k(!0)},u=async t=>{t.preventDefault();try{const l=localStorage.getItem("emstoken"),f=await W.post("/api/updatepassword",{pass:w},{headers:{Authorization:`Bearer ${l}`}});A({userid:"",pass:""}),S(!1),C.success(f.data.message,{autoClose:1200})}catch(l){console.log(l),l.response?C.warn(l.response.data.message,{autoClose:1200}):l.request?console.error("No response from server:",l.request):console.error("Error:",l.message)}},M=async t=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async l=>{var f,z;if(l){let F;try{const U=localStorage.getItem("emstoken");i(!0),F=C.loading("Deleting...");const X=await W.delete(`/api/deleteAdmin/${t}`,{headers:{Authorization:`Bearer ${U}`}});C.update(F,{render:X.data.message,type:"success",isLoading:!1,autoClose:1800}),a(),c(J())}catch(U){console.error(U),C.update(F,{render:((z=(f=U.response)==null?void 0:f.data)==null?void 0:z.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{i(!1)}}})},O=(t,l)=>{b(f=>{const z=f.permissions[t]||[],U=z.includes(l)?z.filter(X=>X!==l):[...z,l].sort();return{...f,permissions:{...f.permissions,[t]:U}}})},q=t=>{const l=t==="admin"?{...te}:{...Qe};b({...p,role:t,permissions:l})},B=t=>{const l=t.target.files[0];l&&b(f=>({...f,profileImage:l,profilePreview:URL.createObjectURL(l)}))},R=()=>{P&&(b(t=>({...t,permissions:{...t.permissions,[P]:[]}})),L(""))},pe=Array.from(new Set([...p.role==="admin"?fe:Object.keys(p.permissions),...Object.keys(p.permissions)])),Te=fe.filter(t=>!pe.includes(t));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-1",children:[e.jsxs("div",{className:"flex justify-between flex-wrap items-center mb-4",children:[e.jsx("h2",{className:"text-[16px] mb-2 md:mb-0 md:text-xl font-semibold",children:"Admin/Manager Management"}),e.jsx(D,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{n(),k(!0)},children:"Add Admin/ Manager"})]}),r.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:r.map((t,l)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{sx:{width:60,height:60},alt:t.name,src:t==null?void 0:t.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[t.name," (",t.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:t.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{title:"Edit",className:"p-2 border rounded hover:bg-gray-100",onClick:()=>x(l),children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx("button",{title:"Password Reset",className:"p-2 border rounded hover:bg-gray-100 text-green-500",onClick:()=>{A({...w,userid:t._id}),S(!0)},children:e.jsx(De,{className:"h-4 w-4 border"})}),e.jsx("button",{title:"Delete",className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>M(t._id),children:e.jsx($e,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>o(l),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",h===l?"Hide Permissions":"View Permissions "]}),h===l?e.jsx(_,{className:"text-xl"}):e.jsx(H,{className:"text-xl"})]}),h===l&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(G).map(f=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:f},f))]})}),e.jsx("tbody",{children:Object.entries(t.permissions).map(([f,z])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:f}),Object.keys(G).map(F=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:z.includes(Number(F))?"✅":"-"},F))]},f))})]})]})]})]},l))})]}),e.jsx(ce,{open:d,onClose:()=>k(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"modalhead",children:[" ",T!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-full",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:B,ref:j,accept:"image/*",name:"",id:"fileInput"}),e.jsx(ae,{sx:{width:70,height:70},alt:p.name,src:p.profilePreview}),e.jsx("span",{onClick:()=>j.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(Ce,{size:18})})]}),e.jsx(v,{fullWidth:!0,required:!0,value:p.name,onChange:t=>b({...p,name:t.target.value}),label:"Name",size:"small"}),e.jsx(v,{fullWidth:!0,required:!0,value:p.email,onChange:t=>b({...p,email:t.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),T==null&&e.jsxs(e.Fragment,{children:[e.jsx(v,{fullWidth:!0,required:!0,value:p.password,type:"password",onChange:t=>b({...p,password:t.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:p.role,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]})]}),p.role==="manager"&&e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border p-2 flex-3 rounded ",value:P,onChange:t=>L(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),Te.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(D,{variant:"contained",onClick:R,className:"flex-1",children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(G).map(([t,l])=>e.jsx("th",{className:"border p-2 text-center",children:l},t))]})}),e.jsx("tbody",{children:pe.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:t}),Object.keys(G).map(l=>{var f;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((f=p.permissions[t])==null?void 0:f.includes(Number(l)))||!1,onChange:()=>O(t,Number(l))})},l)})]},t))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(D,{variant:"outlined",onClick:n,children:"Cancel"}),e.jsx(D,{variant:"contained",onClick:I,loading:y,children:T!==null?"Update":"Create"})]})]})})}),e.jsx(ce,{open:N,onClose:()=>{S(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:u,children:[e.jsx("h2",{children:"Reset Passowrd"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(v,{fullWidth:!0,inputProps:{minLength:3,maxLength:10},required:!0,value:w.pass,onChange:t=>A({...w,pass:t.target.value}),label:"Passowrd",size:"small"}),e.jsx(D,{variant:"contained",sx:{mr:2},type:"submit",children:"Reset Password"})]})]})})})]})}const ge=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function ls(){const[r,m]=g.useState(null),[y,i]=g.useState(!1),[p,b]=g.useState(!1),[c,j]=g.useState(!1),{handleImage:$}=ke(),[T,E]=g.useState(null),[d,k]=g.useState({name:"",address:"",contact:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),P=ue(),{employee:L,company:N,branch:S,profile:h}=we(a=>a.user),s=a=>{m(x=>x===a?null:a)};g.useEffect(()=>{N&&k(N)},[N]);const o=(a,x,u)=>{k(M=>({...M,[a]:{...M[a],[x]:u}}))},n=async()=>{try{j(!0);const a=localStorage.getItem("emstoken"),x=await W.post("/api/updateCompany",{...d},{headers:{Authorization:`Bearer ${a}`}});P(J()),C.success(x.data.message,{autoClose:1800})}catch(a){console.log(a),a.response?C.warn(a.response.data.message,{autoClose:2700}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}finally{j(!1)}},w=()=>{},A=a=>{var u;i(!0);const x={...a,managerIds:(u=a==null?void 0:a.managerIds)==null?void 0:u.map(M=>M._id)};E(x),b(!0)},I=Oe();return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(h==null?void 0:h.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),r==="company"?e.jsx(_,{className:"text-xl"}):e.jsx(H,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${r==="company"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsxs("div",{className:"p-4 rounded flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[d!=null&&d.logo?e.jsx("img",{src:d.logo,alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Be,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async a=>{const x=a.target.files[0];if(!x)return;const u=await $(200,x),M=new FormData;M.append("_id",d._id),M.append("logo",u);try{console.log("api calling"),j(!0);const O=localStorage.getItem("emstoken"),B=(await W.post("/api/updateCompany",M,{headers:{Authorization:`Bearer ${O}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;k(R=>({...R,logo:B})),C.success("Logo uploaded successfully!")}catch(O){console.error(O),C.error("Failed to upload logo.")}finally{j(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"w-full md:flex-1",children:[e.jsx("label",{className:"block",children:"Company Name"}),e.jsx("input",{type:"text",onChange:a=>k({...d,name:a.target.value}),value:d==null?void 0:d.name,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{className:"w-full md:flex-1",children:[e.jsx("label",{className:"block",children:"Contact"}),e.jsx("input",{type:"text",onChange:a=>k({...d,contact:a.target.value}),value:d==null?void 0:d.contact,className:"w-full border rounded px-3 py-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Address"}),e.jsx("input",{type:"text",onChange:a=>k({...d,address:a.target.value}),value:d==null?void 0:d.address,className:"w-full border rounded px-3 py-2"})]}),N?e.jsx(D,{variant:"contained",loading:c,onClick:n,children:"Save Changes"}):e.jsx(D,{loading:c,variant:"contained",onClick:()=>Je({companyinp:d,setisload:j}),children:"+ Create Company"})]})]})})]}),((h==null?void 0:h.role)=="superadmin"||(h==null?void 0:h.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),r==="branches"?e.jsx(_,{className:"text-xl"}):e.jsx(H,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded space-y-1 overflow-hidden transition-all duration-300
                          ${r==="branches"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(D,{variant:"contained",onClick:()=>b(!0),children:"+ Add Branch"})}),e.jsx(ze,{customStyles:I,columns:[{name:"Name",selector:a=>a.name,sortable:!0},{name:"Location",selector:a=>a.location,sortable:!0},{name:"Manager(s)",cell:a=>{var x;return e.jsx("div",{className:"flex flex-col gap-2",children:(x=a==null?void 0:a.managerIds)==null?void 0:x.map((u,M)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>w(u.userid),children:[e.jsx(ae,{src:u==null?void 0:u.profileImage,alt:u.name,children:!(u!=null&&u.profileImage)&&e.jsx(Ne,{})}),e.jsx("span",{children:u.name})]},M))})}},{name:"Actions",width:"120px",cell:a=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>A(a),children:e.jsx(Ce,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>A(a),children:e.jsx(Fe,{})})]})}],data:S||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),r==="department"?e.jsx(_,{className:"text-xl"}):e.jsx(H,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${r==="department"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(We,{})})]}),(h==null?void 0:h.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),r==="admin"?e.jsx(_,{className:"text-xl"}):e.jsx(H,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${r==="admin"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(Ge,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),r==="attendance"?e.jsx(_,{className:"text-xl"}):e.jsx(H,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${r==="attendance"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs(de,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(v,{label:"Office Time In",fullWidth:!0,type:"time",value:d.officeTime.in,onChange:a=>o("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(v,{label:"Office Time Out",fullWidth:!0,type:"time",value:d.officeTime.out,onChange:a=>o("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(v,{label:"Break Minutes",fullWidth:!0,type:"number",value:d.officeTime.breakMinutes,onChange:a=>o("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(v,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:d.workingMinutes.fullDay,onChange:a=>o("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(v,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:d.workingMinutes.halfDay,onChange:a=>o("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(v,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:d.workingMinutes.shortDayThreshold,onChange:a=>o("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(v,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:d.workingMinutes.overtimeAfterMinutes,onChange:a=>o("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(re,{fullWidth:!0,children:[e.jsx(ne,{children:"Weekly Offs"}),e.jsx(oe,{multiple:!0,value:d.weeklyOffs,onChange:a=>k({...d,weeklyOffs:a.target.value}),input:e.jsx(ie,{label:"Weekly Offs"}),renderValue:a=>a.map(x=>{var u;return(u=ge.find(M=>M.value===x))==null?void 0:u.label}).join(", "),children:ge.map(a=>e.jsxs(K,{value:a.value,children:[e.jsx(ee,{checked:d.weeklyOffs.includes(a.value)}),e.jsx(se,{primary:a.label})]},a.value))})]}),Object.entries(d.attendanceRules).map(([a,x])=>{const u=a.replace(/([A-Z])/g," $1").replace(/^./,O=>O.toUpperCase()),M={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(v,{fullWidth:!0,label:u,type:"time",value:x,onChange:O=>o("attendanceRules",a,O.target.value),helperText:M[a]},a)})]}),e.jsx(de,{sx:{mt:4,textAlign:"right"},children:e.jsx(D,{variant:"contained",onClick:n,children:"Update Settings"})})]})]}),e.jsx(ce,{open:p,onClose:()=>{b(!1),E(null),i(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsx(Ze,{setopenviewmodal:b,editbranchdata:T,editbranch:y,company:N,employee:L})})})]})}export{ls as default};
