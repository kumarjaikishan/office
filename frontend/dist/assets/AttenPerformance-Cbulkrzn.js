import{r as d,j as e,B as Fe,af as Ce,ag as Ye,ah as Be,ai as Pe,aj as ze,ak as He,al as We,am as $e,an as _e,ao as Xe,f as Ue,a as qe,g as t,b as Ge,y as Je}from"./index-BbzY4ZUI.js";import{i as Ke}from"./isSameOrBefore-CkUik5Wv.js";import{a as Qe}from"./index-V9jBxvno.js";import{X as Ve}from"./index.es-D1qtK2rE.js";import{P as Ze,R as ea}from"./PieChart-BAbgfmWu.js";import{a as ue}from"./index-D4jmEOvm.js";import{T as aa}from"./Tooltip-DyRLdZgL.js";import{u as sa}from"./attandencehelper-B0fjni3z.js";import{F as M,I as B,S as P}from"./Select-D_NGKd3N.js";import{M as p}from"./MenuItem-BeTW2alY.js";import{T as me}from"./TextField-BDLtnsif.js";import{B as ta}from"./Button-DWI-vyDf.js";import"./ButtonBase-DViDmRa1.js";import"./index-Zb20sMUE.js";import"./useThemeProps-s3TZz8nb.js";import"./useSlotProps-CI7U4UXW.js";import"./Typography-B4QEqcF5.js";import"./createSimplePaletteValueFilter-CPf6oSdo.js";import"./Popper-DNjo3NFF.js";import"./IconButton-JA4QtRuh.js";const ra=({attandence:n,employee:s,hell:a})=>{var u,S,x,z,H,W,$,_,X,N,E,w;d.useEffect(()=>{},[n]);const i="https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",c=(((u=a==null?void 0:a.present)==null?void 0:u.length)||0)+(((S=a==null?void 0:a.absent)==null?void 0:S.length)||0)+(((x=a==null?void 0:a.leave)==null?void 0:x.length)||0),m=d.useMemo(()=>{var R,D,I;return{present:c?Math.floor(((R=a==null?void 0:a.present)==null?void 0:R.length)/c*100):0,absent:c?Math.floor(((D=a==null?void 0:a.absent)==null?void 0:D.length)/c*100):0,leave:c?Math.floor(((I=a==null?void 0:a.leave)==null?void 0:I.length)/c*100):0}},[a,c]),g=c?[{id:0,value:m.present,color:"teal",label:"Present"},{id:1,value:m.leave,color:"orange",label:"Leave"},{id:2,value:m.absent,color:"rgb(156 163 175)",label:"Absent"}]:[{id:0,value:100,color:"rgb(156 163 175)",label:"No record"}],b=window.innerWidth<600?{width:220,height:220}:{width:300,height:300},j=window.innerWidth<600?{innerRadius:95,outerRadius:110}:{innerRadius:130,outerRadius:150};return e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center min-h-[200px] bg-[#e0e4e7] p-1 space-y-1 md:space-y-0 md:space-x-2",children:[e.jsxs("div",{className:"relative  mb-2  w-60 h-60 md:w-80 md:h-80 flex items-center justify-center z-2 rounded-full",children:[e.jsx(Ze,{series:[{innerRadius:j.innerRadius,outerRadius:j.outerRadius,data:g,paddingAngle:1,cornerRadius:5}],width:b.width,height:b.height,legend:{hidden:!0}}),e.jsx("div",{className:"absolute w-46 h-46 md:w-63 md:h-63 rounded-full overflow-hidden border-4 border-white",children:e.jsx("img",{src:(s==null?void 0:s.profileimage)||i,alt:(s==null?void 0:s.name)||"Employee",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-full md:w-[550px]",children:[e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Fe,{})," Total Days"]}),e.jsx("span",{className:"font-bold text-gray-600",children:c})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ce,{})," Present"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((z=a==null?void 0:a.present)==null?void 0:z.length)||0," Days"," ",m.present?`(${m.present}%)`:""]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ye,{})," Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((H=a==null?void 0:a.leave)==null?void 0:H.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Be,{})," Absent"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((W=a==null?void 0:a.absent)==null?void 0:W.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-12 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsx(aa,{placement:"top",enterDelay:800,arrow:!0,title:(a==null?void 0:a.overtimesalary)!==null?e.jsxs("div",{className:"flex gap-1 flex-col text-white",children:[e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Basic salary"}),e.jsxs("span",{children:[": ",s==null?void 0:s.salary," ₹"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Net Overtime"}),e.jsxs("span",{children:[": ",((a==null?void 0:a.overtimemin)||0)-((a==null?void 0:a.shorttimemin)||0)," min"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Payment"}),e.jsxs("span",{children:[": ",(a==null?void 0:a.overtimesalary)||0," ₹"]})]})]}):"",children:e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow cursor-help",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Pe,{})," Overtime"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[(($=a==null?void 0:a.overtime)==null?void 0:$.length)||0," ",(a==null?void 0:a.overtimemin)>0&&`(${a==null?void 0:a.overtimemin} min)`]})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(ze,{})," Short Time"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((_=a==null?void 0:a.short)==null?void 0:_.length)||0," ",(a==null?void 0:a.shorttimemin)>0&&`(${a==null?void 0:a.shorttimemin} min)`]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(He,{})," Late Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((X=a==null?void 0:a.latearrival)==null?void 0:X.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(We,{})," Early Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((N=a==null?void 0:a.earlyLeave)==null?void 0:N.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx($e,{})," Early Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((E=a==null?void 0:a.earlyarrival)==null?void 0:E.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(_e,{})," Late Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((w=a==null?void 0:a.lateleave)==null?void 0:w.length)||0})]})]})]})]})};t.extend(Ke);const Aa=()=>{var se;const{userid:n}=Xe(),[s,a]=d.useState(null),[i,c]=d.useState({}),[m,g]=d.useState([]),[b,j]=d.useState(!0),{company:u,holidays:S}=Ue(r=>r.user),[x,z]=d.useState(null),[H,W]=d.useState([]),[$,_]=d.useState([]),X=qe(),[N,E]=d.useState(t().year()),[w,R]=d.useState(t().month()),[D,I]=d.useState("all"),[A,V]=d.useState("all"),[U,Z]=d.useState("all"),[J,ee]=d.useState(null),[K,ae]=d.useState(null),[k,xe]=d.useState({present:[],absent:[],leave:[],holiday:[],short:[],overtime:[],latearrival:[],earlyarrival:[],earlyLeave:[],lateleave:[],shorttimemin:0,overtimemin:0,overtimesalary:0}),fe=t().year(),pe=Array.from({length:8},(r,l)=>fe+1-l),he=Array.from({length:12},(r,l)=>({label:t().month(l).format("MMMM"),value:l}));d.useEffect(()=>{var l,f,o,h,T,O,F;if(!u||!i)return;const r=((l=i==null?void 0:i.branchId)==null?void 0:l.defaultsetting)==!1?{attendanceRules:(o=(f=i==null?void 0:i.branchId)==null?void 0:f.setting)==null?void 0:o.attendanceRules,workingMinutes:(T=(h=i==null?void 0:i.branchId)==null?void 0:h.setting)==null?void 0:T.workingMinutes,weeklyOffs:(F=(O=i==null?void 0:i.branchId)==null?void 0:O.setting)==null?void 0:F.weeklyOffs}:{attendanceRules:u==null?void 0:u.attendanceRules,workingMinutes:u==null?void 0:u.workingMinutes,weeklyOffs:u==null?void 0:u.weeklyOffs};z(r)},[u,i]),d.useEffect(()=>{if(!S)return;const r=[];S.forEach(l=>{let f=t(l.fromDate);const o=l.toDate?t(l.toDate):f;for(;f.isSameOrBefore(o,"day");)r.push(f.format("DD/MM/YYYY")),f=f.add(1,"day")}),W(r)},[S]),d.useEffect(()=>{if(!n)return;(async()=>{var f,o;const l=localStorage.getItem("emstoken");try{j(!0);const h=await Ge.get("/api/employeeAttandence",{params:{userid:n},headers:{Authorization:`Bearer ${l}`}});c(h.data.employee),a(h.data.user),g(h.data.attandence)}catch(h){if(console.error("Failed to fetch performance data:",h),h.status==403){swal({title:"Access Denied",text:h.response.data.message||"You are not authorized to manage this tournament.",icon:"warning"}),X("/");return}Je.warning(((o=(f=h.response)==null?void 0:f.data)==null?void 0:o.message)||"error")}finally{j(!1)}})()},[n]),d.useEffect(()=>{if(!m.length||!x)return;const r=m.filter(v=>{const y=t(v.date);return y.year()===N&&(w==="all"||y.month()===w)}),l=[],f=[],o=[],h=[],T=[],O=[],F=[],te=[],re=[],ne=[];let Q=0,q=0,G=[];r.forEach(v=>{const y=t(v.date).toDate();let je=t(v.date).format("DD/MM/YYYY");const ie=H.includes(je),ge=t(v.date).startOf("day").day(),le=x==null?void 0:x.weeklyOffs.includes(ge),oe=v.status=="leave",de=v.status=="absent";ie&&!oe&&!de?G.push({...v,remarks:"worked on holiday"}):le&&!oe&&!de?G.push({...v,remarks:"worked on weekly off"}):G.push(v);const ce=v.status;switch(ce){case"present":l.push(y);break;case"absent":f.push(y);break;case"leave":o.push(y);break;case"holiday":h.push(y);break}if(ce!=="present")return;const{punchIn:C,punchOut:Y,workingMinutes:L}=v;if(!C||!Y||typeof L!="number")return;if(ie||le)O.push(y),q+=L;else{const Ie=L<x.workingMinutes.fullDay,Te=L>=x.workingMinutes.fullDay;Ie&&(T.push(y),Q+=x.workingMinutes.fullDay-L),Te&&(O.push(y),q+=L-x.workingMinutes.fullDay)}const[we,be]=x.attendanceRules.considerEarlyEntryBefore.split(":").map(Number),[Ne,ke]=x.attendanceRules.considerLateEntryAfter.split(":").map(Number),Me=t(C).startOf("day").add(we,"hour").add(be,"minute"),Se=t(C).startOf("day").add(Ne,"hour").add(ke,"minute");t(C).isBefore(Me)&&te.push(y),t(C).isAfter(Se)&&F.push(y);const[De,Ae]=x.attendanceRules.considerEarlyExitBefore.split(":").map(Number),[Oe,Le]=x.attendanceRules.considerLateExitAfter.split(":").map(Number),Ee=t(Y).startOf("day").add(De,"hour").add(Ae,"minute"),Re=t(Y).startOf("day").add(Oe,"hour").add(Le,"minute");t(Y).isBefore(Ee)&&re.push(y),t(Y).isAfter(Re)&&ne.push(y)}),_(G),xe({present:l,absent:f,leave:o,holiday:h,short:T,overtime:O,shorttimemin:Q,overtimemin:q,latearrival:F,earlyarrival:te,earlyLeave:re,lateleave:ne,overtimesalary:w!=="all"?Math.floor((q-Q)*parseFloat(i.salary/t(new Date(N,w)).daysInMonth()/x.workingMinutes.fullDay)):null})},[m,N,w,x]);const ye=$.filter(r=>{const l=t(r.date).startOf("day");return!(J&&l.isBefore(t(J))||K&&l.isAfter(t(K))||D!=="all"&&r.status!==D||A!=="all"&&!(A==="earlyLeave"&&k.earlyLeave.some(o=>t(o).isSame(l,"day"))||A==="lateleave"&&k.lateleave.some(o=>t(o).isSame(l,"day"))||A==="earlyarrival"&&k.earlyarrival.some(o=>t(o).isSame(l,"day"))||A==="latearrival"&&k.latearrival.some(o=>t(o).isSame(l,"day")))||U!=="all"&&!(U==="short"&&k.short.some(o=>t(o).isSame(l,"day"))||U==="overtime"&&k.overtime.some(o=>t(o).isSame(l,"day"))))}),ve=()=>{E(t().year()),R("all"),I("all"),V("all"),Z("all"),ee(null),ae(null)};return e.jsxs("div",{className:"p-1 md:p-4 capitalize bg-gray-200",children:[b&&e.jsx("p",{children:"Loading performance data..."}),e.jsxs("div",{className:"p-1 py-3 md:p-3 flex flex-wrap gap-1 md:gap-3 items-center justify-between rounded shadow bg-white mb-4",children:[e.jsxs("div",{className:" gap-3 md:gap-3 grid-col-2 ",children:[e.jsxs(M,{className:"w-[90px]  md:w-[120px]",size:"small",children:[e.jsx(B,{children:"Year"}),e.jsx(P,{value:N,label:"Year",onChange:r=>E(r.target.value),children:pe.map(r=>e.jsx(p,{value:r,children:r},r))})]}),e.jsxs(M,{size:"small",className:"w-[130px] flex-1 md:w-[160px]",children:[e.jsx(B,{children:"Month"}),e.jsxs(P,{value:w,label:"Month",onChange:r=>R(r.target.value),children:[e.jsx(p,{value:"all",children:"All"}),he.map(r=>e.jsx(p,{value:r.value,children:r.label},r.label))]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("p",{className:"font-semibold text-sm md:text-lg",children:s==null?void 0:s.name}),e.jsxs("p",{className:"text-[12px] md:text-sm text-gray-600",children:["(",(se=i==null?void 0:i.branchId)==null?void 0:se.name,")"]})]})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(ra,{employee:i,user:s,attandence:m,hell:k}),e.jsxs("div",{className:"p-1 py-4 md:p-4 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 rounded shadow bg-white my-4",children:[e.jsxs(M,{size:"small",sx:{minWidth:120},children:[e.jsx(B,{children:"Type"}),e.jsxs(P,{value:A,label:"Type",onChange:r=>V(r.target.value),children:[e.jsx(p,{value:"all",children:"All"}),e.jsx(p,{value:"earlyLeave",children:"Early Leave"}),e.jsx(p,{value:"lateleave",children:"Late Leave"}),e.jsx(p,{value:"earlyarrival",children:"Early Arrival"}),e.jsx(p,{value:"latearrival",children:"Late Arrival"})]})]}),e.jsxs(M,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Status"}),e.jsxs(P,{value:D,label:"Status",onChange:r=>I(r.target.value),children:[e.jsx(p,{value:"all",children:"All"}),e.jsx(p,{value:"present",children:"Present"}),e.jsx(p,{value:"leave",children:"Leave"}),e.jsx(p,{value:"absent",children:"Absent"}),e.jsx(p,{value:"halfday",children:"Half Day"})]})]}),e.jsxs(M,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Over/Short"}),e.jsxs(P,{value:U,label:"over/short",onChange:r=>Z(r.target.value),children:[e.jsx(p,{value:"all",children:"All"}),e.jsx(p,{value:"overtime",children:"Overtime"}),e.jsx(p,{value:"short",children:"Short Time"})]})]}),e.jsx(M,{size:"small",sx:{minWidth:150},children:e.jsx(me,{label:"From Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:J||"",onChange:r=>ee(r.target.value)})}),e.jsx(M,{size:"small",sx:{minWidth:150},children:e.jsx(me,{label:"To Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:K||"",onChange:r=>ae(r.target.value)})}),e.jsx(ta,{variant:"outlined",color:"secondary",onClick:ve,sx:{alignSelf:"flex-end",minWidth:100},startIcon:e.jsx(ea,{}),children:"Reset"})]}),e.jsx(Ve,{columns:la(x),data:ye,pagination:!0,customStyles:sa(),conditionalRowStyles:ia,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(Qe,{className:"text-xl"})," No records found matching your criteria."]})})]})]})},na=n=>{const s=Math.floor(n/60),a=n%60;return`${s}h ${a}m`},ia=[{when:n=>n.remarks,style:{backgroundColor:"rgba(21, 233, 233, 0.2)"}}],la=n=>[{name:"Date",selector:s=>t(s.date).format("DD MMM, YYYY"),sortable:!0,width:"120px"},{name:"Punch In",selector:s=>s.punchIn,cell:s=>{var j,u;if(!s.punchIn)return"-";const[a,i]=(j=n==null?void 0:n.attendanceRules)==null?void 0:j.considerEarlyEntryBefore.split(":").map(Number),[c,m]=(u=n==null?void 0:n.attendanceRules)==null?void 0:u.considerLateEntryAfter.split(":").map(Number),g=t(s.punchIn).startOf("day").add(a,"hour").add(i,"minute"),b=t(s.punchIn).startOf("day").add(c,"hour").add(m,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"text-[16px] text-blue-700"}),t(s.punchIn).format("hh:mm A"),!s.remarks&&t(s.punchIn).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchIn).isAfter(b)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Late"})]})}},{name:"Punch Out",selector:s=>s.punchOut,cell:s=>{var j,u;if(!s.punchOut)return"-";const[a,i]=(j=n==null?void 0:n.attendanceRules)==null?void 0:j.considerEarlyExitBefore.split(":").map(Number),[c,m]=(u=n==null?void 0:n.attendanceRules)==null?void 0:u.considerLateExitAfter.split(":").map(Number),g=t(s.punchOut).startOf("day").add(a,"hour").add(i,"minute"),b=t(s.punchOut).startOf("day").add(c,"hour").add(m,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"text-[16px] text-blue-700"}),t(s.punchOut).format("hh:mm A"),!s.remarks&&t(s.punchOut).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchOut).isAfter(b)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Late"})]})}},{name:"Status",selector:s=>s.status,cell:s=>{const{status:a}=s,c={absent:"bg-red-100 text-red-800",leave:"bg-violet-100 text-violet-800",present:"bg-green-100 text-green-800",holiday:"bg-blue-100 text-blue-800"}[a]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`${c} px-2 py-1 rounded text-xs`,children:a})},width:"140px"},{name:"Working Hours",width:"180px",selector:s=>s.workingMinutes,cell:s=>{var i,c,m,g;const a=s.workingMinutes;return a?e.jsxs("span",{className:" flex",children:[e.jsx("span",{className:"block w-[60px] ",children:na(a)}),!s.remarks&&a<((i=n==null?void 0:n.workingMinutes)==null?void 0:i.fullDay)&&e.jsxs("span",{className:" block w-[100px] px-2 py-0.5 rounded bg-amber-100 text-amber-900 text-xs",children:["Short ",((c=n==null?void 0:n.workingMinutes)==null?void 0:c.fullDay)-a," min"]}),!s.remarks&&a>((m=n==null?void 0:n.workingMinutes)==null?void 0:m.fullDay)&&e.jsxs("span",{className:"px-2 block w-[115px] py-0.5  rounded bg-green-100 text-green-900 text-xs",children:["Overtime ",a-((g=n==null?void 0:n.workingMinutes)==null?void 0:g.fullDay)," min"]})]}):"-"}},{name:"Remarks",selector:s=>s.remarks&&`${(s==null?void 0:s.workingMinutes)||0} minutes  ${s.remarks}`}];export{Aa as default};
