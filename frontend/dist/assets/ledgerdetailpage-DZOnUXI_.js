import{j as e,Q as le,R as ne,aj as oe,ap as ie,a as de,r as o,b as E,y as x,A as ce,C as z,aq as me}from"./index-CleMBIBn.js";import{b as ue}from"./index-BATINc3G.js";import{X as pe}from"./index.es-BzX17GyM.js";import{d as g}from"./dayjs.min-DSKahEwl.js";import{M as xe}from"./Modalbox-rZpR_NLY.js";import{B as h}from"./Button-CoB3H69l.js";import{F as O,I as $,S as L,O as T}from"./Select-D3hz-9Ri.js";import{M as I}from"./MenuItem-DOZMs1J2.js";import{I as U}from"./InputAdornment-BHx7rmla.js";import{T as v}from"./TextField-DiABiCHh.js";import{B as he}from"./Box-DxCvFchx.js";import"./createSimplePaletteValueFilter-BYlBxWKv.js";import"./ButtonBase-CbJsO36x.js";import"./useSlotProps-BIGTSc1Y.js";import"./Typography-CcZCxKTQ.js";const ge=(m,u)=>[{name:"S.No",selector:(r,b)=>b+1,width:"60px"},{name:"Date",selector:r=>g(r.date).format("DD MMM, YYYY"),sortable:!0},{name:"Particular",selector:r=>r.particular},{name:"Debit",selector:r=>r.debit,width:"90px"},{name:"Credit",selector:r=>r.credit,width:"90px"},{name:"Balance",selector:r=>r.balance},{name:"Actions",cell:r=>e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit Entry",onClick:()=>m(r),style:{cursor:"pointer",marginRight:10}}),e.jsx(ne,{className:"delete text-[18px] text-red-500 cursor-pointer",title:"Delete Entry",onClick:()=>u(r._id),style:{cursor:"pointer"}})]}),width:"120px"}],P=({label:m,value:u})=>{const r=parseFloat(u)<0;return e.jsxs("div",{className:"bg-teal-50 border border-teal-300 border-dashed rounded-md px-4 py-2 min-w-[150px] text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:m}),e.jsx("hr",{className:"my-2 border-teal-200"}),e.jsxs("p",{className:`text-lg font-semibold ${r?"text-red-600":"text-black"}`,children:[u," â‚¹"]})]})},Ae=()=>{const{id:m}=oe(),[u]=ie(),r=de(),b=u.get("name"),_=decodeURIComponent(u.get("profileimage")),[w,V]=o.useState([]),[y,X]=o.useState([]),[N,A]=o.useState("all"),[C,F]=o.useState("all"),[D,R]=o.useState(""),[q,H]=o.useState(0),[Q,G]=o.useState(0),[J,K]=o.useState(0),B={date:g().format("YYYY-MM-DD"),particular:"",debit:"",credit:""},[i,p]=o.useState(B),[W,j]=o.useState(!1),[S,f]=o.useState(null),M={Authorization:`Bearer ${localStorage.getItem("emstoken")}`};o.useEffect(()=>{k()},[m]),o.useEffect(()=>{if(!w)return;const t=w.filter(s=>{const d=g(s.date),c=N!=="all"?d.year()===Number(N):!0,Y=C!=="all"?d.month()+1===Number(C):!0,re=D?d.isSame(D,"day"):!0;return c&&Y&&re});X(t);const a=t.reduce((s,d)=>s+(d.debit||0),0),l=t.reduce((s,d)=>s+(d.credit||0),0),n=a-l;H(a),G(l),K(n)},[w,N,C,D]);const k=async()=>{var t;try{const a=await E.get(`/api/entries/${m}`,{headers:M});V((t=a.data)==null?void 0:t.entries)}catch(a){console.log(a),x.error(a.response.data.message)}},Z=()=>{A(""),F(""),R("")},ee=async t=>{swal({title:"Are you sure to Delete this entry?",text:"Once deleted, you will not be able to recover this",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{var l,n;if(a)try{let s=await E.delete(`/api/ledgerentry/${t}`,{headers:M});x.success(s.data.message),k()}catch(s){console.log(s),x.warning(((n=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"Error deleting entry")}})},te=()=>{const t=["S.No","Date","Particular","Debit","Credit","Balance"],a=y.map((c,Y)=>[Y+1,g(c.date).format("YYYY-MM-DD"),c.particular,c.debit,c.credit,c.balance]),l=[t,...a].map(c=>c.join(",")).join(`
`),n=new Blob([l],{type:"text/csv"}),s=URL.createObjectURL(n),d=document.createElement("a");d.href=s,d.download=`${b}_ledger.csv`,d.click(),URL.revokeObjectURL(s)},ae=async()=>{const t=parseFloat(i.debit||0),a=parseFloat(i.credit||0);if(t&&a){x.warn("Only one of Debit or Credit allowed");return}try{const l={...i,date:new Date(i.date),ledgerId:m,debit:t||0,credit:a||0};let n;S!==null?(n=await E.put(`/api/ledgerentry/${S}`,l,{headers:M}),f(null)):n=await E.post("/api/ledgerentry",l,{headers:M}),x.success(n.data.message),j(!1),p(B),k()}catch(l){console.log(l),x.warning(l.response.data.message)}},se=t=>{var l,n;const a=new Date(t.date).toISOString().split("T")[0];p({date:a,particular:t.particular,debit:((l=t.debit)==null?void 0:l.toString())||"",credit:((n=t.credit)==null?void 0:n.toString())||""}),f(t._id),j(!0)};return e.jsxs("div",{className:"bg-white rounded shadow-md p-1 md:p-5 rounded",children:[e.jsxs("div",{className:"border border-teal-600 border-dashed rounded-md p-3 md:p-5 mb-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-start md:items-center",children:[e.jsxs("div",{className:"flex items-start md:items-center  gap-3",children:[e.jsx(ce,{sx:{width:55,height:55},alt:b,src:_}),e.jsx("h2",{className:"text-2xl font-semibold text-teal-700 capitalize",children:b})]}),e.jsx(h,{className:" w-full md:w-auto",onClick:()=>r(-1),variant:"contained",children:"Master Sheet"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(P,{label:"Total Debit",value:q}),e.jsx(P,{label:"Total Credit",value:Q}),e.jsx(P,{label:"Net Balance",value:J.toFixed(2)})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsxs("div",{className:"p-1 md:p-2 rounded shadow mb-4 grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-2 mt-1 w-full md:w-fit",children:[e.jsxs(O,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx($,{children:"Year"}),e.jsxs(L,{value:N,input:e.jsx(T,{startAdornment:e.jsx(U,{position:"start",children:e.jsx(z,{fontSize:"small"})}),label:"Year"}),onChange:t=>A(t.target.value),children:[e.jsx(I,{value:"all",children:"All"}),[...new Set(w.map(t=>g(t.date).year()))].map(t=>e.jsx(I,{value:t,children:t},t))]})]}),e.jsxs(O,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx($,{children:"Month"}),e.jsxs(L,{value:C,input:e.jsx(T,{startAdornment:e.jsx(U,{position:"start",children:e.jsx(z,{fontSize:"small"})}),label:"Month"}),onChange:t=>F(t.target.value),children:[e.jsx(I,{value:"all",children:"All"}),Array.from({length:12},(t,a)=>e.jsx(I,{value:a+1,children:g().month(a).format("MMMM")},a))]})]}),e.jsx(v,{size:"small",type:"date",className:"col-span-1 md:w-[120px]",value:D,onChange:t=>R(t.target.value),label:"Date",InputLabelProps:{shrink:!0}}),e.jsx(h,{className:"col-span-1  md:w-[120px]",variant:"outlined",color:"secondary",title:"Reset",startIcon:e.jsx(me,{}),onClick:Z,children:"Reset"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 ml-auto",children:[e.jsx(h,{variant:"contained",onClick:()=>{j(!0),f(null)},children:"Add Entry"}),e.jsx(h,{variant:"outlined",onClick:te,startIcon:e.jsx(ue,{}),children:"Export CSV"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(pe,{columns:ge(se,ee),data:y||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No entries found for selected filters.",paginationPerPage:10,paginationRowsPerPageOptions:[10,25,50,100,y.length>100?y.length:null].filter(Boolean),paginationComponentOptions:{rowsPerPageText:"Rows per page:"}})}),e.jsx(xe,{open:W,onClose:()=>{j(!1),f(null)},children:e.jsx("div",{className:"membermodal w-[310px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:S!==null?"Edit Entry":"Add Entry"}),e.jsx("span",{className:"modalcontent ",children:e.jsxs(he,{display:"flex",flexDirection:"column",gap:2,mt:1,children:[e.jsx(v,{type:"date",label:"Date",size:"small",InputLabelProps:{shrink:!0},value:i.date||"",onChange:t=>p({...i,date:t.target.value})}),e.jsx(v,{multiline:!0,minRows:2,label:"Particular",size:"small",value:i.particular||"",onChange:t=>p({...i,particular:t.target.value})}),e.jsx(v,{type:"number",label:"Debit",size:"small",value:i.debit||"",onChange:t=>p({...i,debit:t.target.value,credit:""})}),e.jsx(v,{type:"number",label:"Credit",size:"small",value:i.credit||"",onChange:t=>p({...i,credit:t.target.value,debit:""})})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(h,{onClick:()=>{j(!1),f(null)},children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:ae,children:S!==null?"Update":"Add"})]})]})})})]})};export{Ae as default};
