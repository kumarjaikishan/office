import{b as _,v as D,y as f,r as c,f as R,u as T,j as e,K as X,L as H,C as K}from"./index-DR2mEqic.js";import{I as B}from"./index-ClSvd9mX.js";import{X as U}from"./index.es-CbD3Z05-.js";import{u as G}from"./attandencehelper-ClrD5BmH.js";import{M as J}from"./Modalbox-D4DOzwa_.js";import{A as Q}from"./index-B1OoOroJ.js";import{F as E,I as F,S as M,O as V}from"./Select-BZ0sAC3-.js";import{M as N}from"./MenuItem-Cyp-xg_K.js";import{I as W}from"./InputAdornment-CVGBO80q.js";import{T as k}from"./TextField-DHrh6JBb.js";import{B as w}from"./Button-CrtZxZji.js";import"./createSimplePaletteValueFilter-Bd0s2EwF.js";import"./useSlotProps-0bPIsTny.js";import"./ButtonBase-J-KTWyu5.js";import"./Typography-CeX3OQjR.js";const Y=[{name:"S.no",selector:r=>r.sno,width:"40px"},{name:"Branch",selector:r=>r.branch},{name:"Department",selector:r=>r.dep_name},{name:"Action",selector:r=>r.action,width:"80px"}],Z=async({inp:r,setisload:n,setInp:d,setopenmodal:i,init:a,dispatch:x})=>{console.log(r);const{branchId:p,department:m,description:g}=r;if(!m){alert("Please fill in both fields");return}const j=localStorage.getItem("emstoken");n(!0);try{const s=await _.post("/api/adddepartment",{department:m,branchId:p,description:g},{headers:{Authorization:`Bearer ${j}`}});x(D()),f.success(s.data.message,{autoClose:1200}),d(a),i(!1)}catch(s){console.log(s),s.response?f.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{n(!1)}},ee=async({inp:r,setisload:n,setInp:d,setopenmodal:i,init:a,dispatch:x})=>{const{departmentId:p,department:m,description:g}=r;if(!m||!p){alert("All fileds are Required");return}const j=localStorage.getItem("emstoken");n(!0);try{const s=await _.post("/api/updatedepartment",{departmentId:p,department:m,description:g},{headers:{Authorization:`Bearer ${j}`}});x(D()),f.success(s.data.message,{autoClose:1200}),d(a),i(!1)}catch(s){console.log(s),s.response?f.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{n(!1)}},te=async({departmentId:r,setisload:n,dispatch:d})=>{if(!r){alert("All fileds are Required");return}const i=localStorage.getItem("emstoken");n(!0);try{const a=await _.post("/api/deletedepartment",{departmentId:r},{headers:{Authorization:`Bearer ${i}`}});d(D()),f.success(a.data.message,{autoClose:1200})}catch(a){console.log(a),a.response?f.warn(a.response.data.message,{autoClose:1200}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}finally{n(!1)}},ge=()=>{const[r,n]=c.useState(!1),[d,i]=c.useState(!1),[a,x]=c.useState([]),[p,m]=c.useState(!1),[g,j]=c.useState([]),{branch:s,department:S}=R(t=>t.user),[l,z]=c.useState({branch:"all",department:" "}),O=l.branch!=="all"||l.department.trim()!=="",y=T();c.useEffect(()=>{if(!a||a.length===0)return;const t=a.filter(u=>{var v;const o=l.branch==="all"||u.branchid===l.branch,C=l.department.trim()===""||((v=u.dep_name)==null?void 0:v.toLowerCase().includes(l.department.trim().toLowerCase()));return o&&C});j(t)},[l,a]);const I={departmentId:"",branchId:"",department:"",description:""},[h,b]=c.useState(I);c.useEffect(()=>{if(S.length>0){let t=1;const u=S.map(o=>{var C,v;return{id:o._id,sno:t++,branchid:(C=o==null?void 0:o.branchId)==null?void 0:C._id,branch:(v=o==null?void 0:o.branchId)==null?void 0:v.name,dep_name:o==null?void 0:o.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>$(o),children:e.jsx(X,{})}),e.jsx("span",{className:"delete",onClick:()=>L(o._id),children:e.jsx(Q,{})})]})}});x(u)}},[S]);const A=(t,u)=>{b({...h,[u]:t.target.value})},q=t=>{t.preventDefault(),Z({inp:h,setisload:i,setInp:b,setopenmodal:n,init:I,dispatch:y})},$=t=>{console.log("edit",t),m(!0),b({branchId:t.branchId._id,departmentId:t._id,department:t.department,description:t.description}),n(!0)},L=t=>{console.log("delete",t),H({title:"Are you sure?",text:"Once deleted, All empoyee of this department deleted",icon:"warning",buttons:!0,dangerMode:!0}).then(async u=>{u&&te({departmentId:t,setisload:i,dispatch:y})})},P=()=>{ee({inp:h,setisload:i,setInp:b,setopenmodal:n,init:I,dispatch:y})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(E,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(F,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(M,{value:l.branch,onChange:t=>z({...l,branch:t.target.value}),input:e.jsx(V,{startAdornment:e.jsx(W,{position:"start",children:e.jsx(K,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(N,{selected:!0,value:"all",children:"All"}),s==null?void 0:s.map(t=>e.jsx(N,{value:t._id,children:t.name},t._id))]})]}),e.jsx(k,{size:"small",id:"outlined-basic",value:l.department,onChange:t=>z({...l,department:t.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(w,{className:"w-full md:w-auto",variant:"contained",onClick:()=>n(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(U,{customStyles:G(),columns:Y,data:O?g:a,pagination:!0,highlightOnHover:!0})}),e.jsx(J,{open:r,onClose:()=>n(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Add Department"}),e.jsx("form",{onSubmit:q,children:e.jsxs("span",{className:"modalcontent",children:[e.jsxs(E,{sx:{width:"98%"},size:"small",children:[e.jsx(F,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(M,{value:h.branchId,label:"branch",onChange:t=>A(t,"branchId"),children:s==null?void 0:s.map(t=>e.jsx(N,{value:t._id,children:t.name},t._id))})]}),e.jsx(k,{sx:{width:"98%"},required:!0,value:h.department,onChange:t=>A(t,"department"),label:"Department",size:"small"}),e.jsx(k,{multiline:!0,rows:4,onChange:t=>A(t,"description"),value:h.description,sx:{width:"98%"},label:"Description",size:"small"})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(w,{size:"small",onClick:()=>{n(!1),m(!1),b(I)},variant:"outlined",children:" cancel"}),!p&&e.jsx(w,{sx:{mr:2},loading:d,loadingPosition:"end",endIcon:e.jsx(B,{}),onClick:q,variant:"contained",type:"submit",children:"Add"}),p&&e.jsx(w,{sx:{mr:2},loading:d,loadingPosition:"end",endIcon:e.jsx(B,{}),variant:"contained",onClick:P,children:"Update"})]})]})})})]})};export{ge as default};
