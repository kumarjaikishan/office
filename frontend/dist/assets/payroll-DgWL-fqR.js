import{b5 as G,r as j,b6 as H,j as s,t as X,b7 as R,b8 as M,b9 as J,ba as K,bb as Q,w as W,n as Z,bc as ee,bd as _,q as se,o as ae,h as te,A as ne,k as re,a3 as le,T as oe,B as P,aU as ie,a as ce,g as de,c as w,y as A,b as ue,i as O,a7 as me,F as pe,I as he,S as ye,M as F,O as xe,C as fe,aa as ge}from"./index-D3S1IBH9.js";import{u as je}from"./attandencehelper-DZ68C6Kv.js";import{c as be,d as ve,e as Ce,a as Se}from"./index-CPkw--rO.js";import{u as ke}from"./useThemeProps-CTo_RX6W.js";import{C as I}from"./CheckPermission-6X-C5_ez.js";import"./index-C7AE0gmy.js";const Ie=G(),Pe=ee(),Ne=Ie("div",{name:"MuiStack",slot:"Root"});function Be(t){return ke({props:t,name:"MuiStack",defaultTheme:Pe})}function Ee(t,d){const r=j.Children.toArray(t).filter(Boolean);return r.reduce((l,u,i)=>(l.push(u),i<r.length-1&&l.push(j.cloneElement(d,{key:`separator-${i}`})),l),[])}const Te=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Me=({ownerState:t,theme:d})=>{let r={display:"flex",flexDirection:"column",...R({theme:d},M({values:t.direction,breakpoints:d.breakpoints.values}),l=>({flexDirection:l}))};if(t.spacing){const l=J(d),u=Object.keys(d.breakpoints.values).reduce((o,n)=>((typeof t.spacing=="object"&&t.spacing[n]!=null||typeof t.direction=="object"&&t.direction[n]!=null)&&(o[n]=!0),o),{}),i=M({values:t.direction,base:u}),e=M({values:t.spacing,base:u});typeof i=="object"&&Object.keys(i).forEach((o,n,g)=>{if(!i[o]){const v=n>0?i[g[n-1]]:"column";i[o]=v}}),r=K(r,R({theme:d},e,(o,n)=>t.useFlexGap?{gap:_(l,o)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Te(n?i[n]:t.direction)}`]:_(l,o)}}))}return r=Q(d.breakpoints,r),r};function Ae(t={}){const{createStyledComponent:d=Ne,useThemeProps:r=Be,componentName:l="MuiStack"}=t,u=()=>W({root:["root"]},o=>Z(l,o),{}),i=d(Me);return j.forwardRef(function(o,n){const g=r(o),b=H(g),{component:v="div",direction:p="column",spacing:D=0,divider:x,children:C,className:N,useFlexGap:B=!1,...S}=b,E={direction:p,spacing:D,useFlexGap:B},T=u();return s.jsx(i,{as:v,ownerState:E,ref:n,className:X(T.root,N),...S,children:x?Ee(C,x):C})})}const Fe=Ae({createStyledComponent:se("div",{name:"MuiStack",slot:"Root"}),useThemeProps:t=>ae({props:t,name:"MuiStack"})}),De=(t,d,r,l,u,i)=>[{name:"S.no",selector:(e,m)=>m+1,width:"60px"},{name:"Employee",selector:e=>{var m,o,n,g,b,v,p;return s.jsxs("div",{className:"flex items-center capitalize gap-3 ",children:[s.jsx(ne,{src:re((m=e==null?void 0:e.employeeId)==null?void 0:m.profileimage,{format:"webp",width:100,height:100})||employepic,alt:(n=(o=e==null?void 0:e.employeeId)==null?void 0:o.userid)==null?void 0:n.name,children:!((g=e==null?void 0:e.employeeId)!=null&&g.profileimage)&&employepic}),s.jsxs(le,{children:[s.jsx(oe,{variant:"body2",children:(v=(b=e==null?void 0:e.employeeId)==null?void 0:b.userid)==null?void 0:v.name}),s.jsxs("p",{className:"t text-[10px] text-gray-600",children:["(",(p=e==null?void 0:e.employeeId)==null?void 0:p.designation,")"]})]})]})},sortable:!0},{name:"Month",selector:e=>te(`${e.year}-${e.month}-01`).format("MM-YYYY")},{name:"Department",selector:e=>e.department,width:"120px"},{name:"Status",selector:e=>e.status,width:"120px"},{name:"Actions",cell:e=>s.jsxs(Fe,{direction:"row",spacing:1,children:[s.jsx(P,{size:"small",variant:"outlined",disabled:!l,startIcon:s.jsx(be,{}),onClick:()=>t(e),children:"View"}),s.jsx(P,{size:"small",variant:"outlined",color:"primary",disabled:!u,startIcon:s.jsx(ve,{}),onClick:()=>d(e),children:"Edit"}),s.jsx(P,{size:"small",variant:"outlined",color:"error",disabled:!i,startIcon:s.jsx(Ce,{}),onClick:()=>r(e._id),children:"Delete"})]}),width:"300px"}];function Oe(){var $;const{employeeId:t}=ie(),[d,r]=j.useState(!0),[l,u]=j.useState(null),[i,e]=j.useState(null);let m=ce();const o=je(),[n,g]=j.useState({searchText:"",branch:"all",department:"all"}),{employee:b,leaveBalance:v,branch:p,departmen:D,profile:x}=de(a=>a.user);j.useEffect(()=>{C()},[]);const C=async()=>{var a,h,f;try{r(!0),e(null);const c=localStorage.getItem("emstoken"),y=await w.get("/api/payroll",{headers:{Authorization:`Bearer ${c}`}});u((a=y==null?void 0:y.data)==null?void 0:a.payrolls)}catch(c){console.log(c),c.response?(e(((f=(h=c.response)==null?void 0:h.data)==null?void 0:f.message)||"Failed to create payroll"),A.warn(c.response.data.message,{autoClose:1200})):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{r(!1)}},N=a=>{m(`/dashboard/payroll/print/${a._id}`)},B=a=>{m(`/dashboard/payroll/edit/${a._id}`)},S=(a,h)=>{g(f=>({...f,[a]:h}))},E=l==null?void 0:l.filter(a=>{var k,V,z;const h=((z=(V=(k=a.employeeId)==null?void 0:k.userid)==null?void 0:V.name)==null?void 0:z.toLowerCase())||"",f=a.branchId||"",c=n.searchText.trim()===""||h.includes(n.searchText.toLowerCase()),y=n.branch==="all"||f===n.branch;return c&&y}),T=async a=>{swal({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async h=>{var f,c;if(h)try{r(!0),e(null);const y=localStorage.getItem("emstoken"),k=await w.delete(`/api/payroll/${a}`,{headers:{Authorization:`Bearer ${y}`}});A.success(k.data.message||"Successfull deleted"),C()}catch(y){console.error(y),e(((c=(f=y.response)==null?void 0:f.data)==null?void 0:c.message)||"Failed to fetch payroll"),A.warn("Using dummy payroll data for testing",{autoClose:1500}),u(b)}finally{r(!1)}})},U=I("salary",2),L=I("salary",1),Y=I("salary",3),q=I("salary",4);return l?s.jsxs("div",{className:"w-full mx-auto p-1 md:p-4",children:[s.jsxs("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[s.jsx(ue,{size:"small",className:"w-[100%] md:w-[160px]",value:n.searchText,onChange:a=>S("searchText",a.target.value),InputProps:{startAdornment:s.jsx(O,{position:"start",children:s.jsx(me,{})})},label:"Search Employee"}),s.jsxs(pe,{size:"small",className:"w-[47%] md:w-[160px]",children:[s.jsx(he,{children:"Branch"}),s.jsxs(ye,{label:"Branch",value:n.branch,input:s.jsx(xe,{startAdornment:s.jsx(O,{position:"start",children:s.jsx(fe,{fontSize:"small"})}),label:"Branch"}),onChange:a=>S("branch",a.target.value),children:[s.jsx(F,{value:"all",children:"All"}),(x==null?void 0:x.role)==="manager"?($=p==null?void 0:p.filter(a=>{var h;return(h=x==null?void 0:x.branchIds)==null?void 0:h.includes(a._id)}))==null?void 0:$.map(a=>s.jsx(F,{value:a._id,children:a.name},a._id)):p==null?void 0:p.map(a=>s.jsxs(F,{value:a._id,children:[" ",a.name," "]},a._id))]})]})]}),U&&s.jsx("div",{className:"w-full md:w-fit",children:s.jsx(P,{size:"small",className:"w-full md:w-fit",onClick:()=>{m("/dashboard/payroll/add")},variant:"contained",children:" Add Payroll"})})]}),s.jsx("div",{children:s.jsx(ge,{columns:De(N,B,T,L,Y,q),data:E,pagination:!0,customStyles:o,highlightOnHover:!0,paginationPerPage:20,paginationRowsPerPageOptions:[20,50,100,300],noDataComponent:s.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[s.jsx(Se,{className:"text-xl"})," No Employee records found."]})})})]}):s.jsx("p",{className:"p-4 text-gray-500",children:"No payroll data found"})}export{Oe as default};
