import{g as w,r as l,a as U,u as $,h as j,j as s,F as E,I as F,S as C,M as h,O as D,i as O,C as z,A as G,k as H,l as J}from"./index-B-UsU4mf.js";import{D as K}from"./dashboardCard-fyGmUiKl.js";import{T as Q}from"./Tooltip-e449RMWK.js";import"./Popper-C5nv4R6g.js";const ee=()=>{var S;const{attandence:x,employee:p,branch:u,department:f}=w(e=>e.user),{islogin:A,isadmin:V}=w(e=>e.auth),[b,k]=l.useState([]),[v,P]=l.useState([]),[N,R]=l.useState([]),[I,B]=l.useState([]);let M=U();$();const q=l.useRef(x),[d,L]=l.useState("all"),[m,_]=l.useState("all"),[g,T]=l.useState([]);return l.useEffect(()=>{!A&&M("/login")},[]),l.useEffect(()=>{if(!p||p.length===0)return;const e=p.filter(c=>{const i=d==="all"||c.branchId===d,r=m==="all"||c.department._id===m;return i&&r});T(e)},[d,m,p]),l.useEffect(()=>{_("all")},[d]),l.useEffect(()=>{q.current=x},[x]),l.useEffect(()=>{if(!x)return;let e=x.filter(t=>j(t.date).isSame(j(),"day"));console.log(e);let c=e==null?void 0:e.filter(t=>!t.punchOut&&t.status!=="absent"&&t.status!=="leave"),i=e==null?void 0:e.filter(t=>t.status=="present"),r=e==null?void 0:e.filter(t=>t.status=="absent"),n=e==null?void 0:e.filter(t=>t.status=="leave");k(c),P(i),R(r),B(n)},[x]),l.useEffect(()=>()=>{},[]),s.jsxs("div",{className:"p-0  md:p-3",children:[s.jsx("div",{className:"mb-3 ",children:s.jsx(K,{employee:p,todayleave:I.length+N.length,todaypresent:v.length,currentpresent:b.length})}),s.jsxs("div",{className:"w-full flex-col flex gap-5 shadow  bg-white p-2 rounded",children:[s.jsxs("div",{className:"flex gap-3 pt-3",children:[s.jsxs(E,{sx:{width:"160px"},required:!0,size:"small",children:[s.jsx(F,{id:"demo-simple-select-helper-label",children:"Branch"}),s.jsxs(C,{value:d,input:s.jsx(D,{startAdornment:s.jsx(O,{position:"start",children:s.jsx(z,{fontSize:"small"})}),label:"branch"}),onChange:e=>L(e.target.value),children:[s.jsx(h,{selected:!0,value:"all",children:"All"}),(u==null?void 0:u.length)>1?u==null?void 0:u.map(e=>s.jsx(h,{value:e._id,children:e.name},e._id)):s.jsx(h,{disabled:!0,value:"",children:"No Branch Found"})]})]}),s.jsxs(E,{sx:{width:"160px"},required:!0,size:"small",children:[s.jsx(F,{id:"demo-simple-select-helper-label",children:"Department"}),s.jsxs(C,{disabled:d=="all",value:m,input:s.jsx(D,{startAdornment:s.jsx(O,{position:"start",children:s.jsx(z,{fontSize:"small"})}),label:"Department"}),onChange:e=>_(e.target.value),children:[s.jsx(h,{selected:!0,value:"all",children:"All"}),(f==null?void 0:f.length)>1?(S=f.filter(e=>e.branchId._id==d))==null?void 0:S.map(e=>s.jsx(h,{value:e._id,children:e.department},e._id)):s.jsx(h,{disabled:!0,value:"",children:"No Department Found"})]})]})]}),s.jsx("div",{className:"px-1 md:px-3 grid grid-cols-5 md:grid-cols-10 lg:grid-cols-13 gap-2 md:gap-4",children:g==null?void 0:g.filter(e=>e.status!==!1).map(e=>{var t,y;const c=b.some(o=>{var a;return((a=o.employeeId)==null?void 0:a._id)===(e==null?void 0:e._id)}),i=N.some(o=>{var a;return((a=o.employeeId)==null?void 0:a._id)===(e==null?void 0:e._id)}),r=I.find(o=>{var a;return((a=o.employeeId)==null?void 0:a._id)===(e==null?void 0:e._id)}),n=v.find(o=>{var a;return((a=o.employeeId)==null?void 0:a._id)===(e==null?void 0:e._id)});return s.jsx(Q,{arrow:!0,enterDelay:800,placement:"top",title:s.jsxs("div",{className:"flex flex-col",children:[i&&s.jsx("span",{children:"Absent"}),r&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"on Leave"}),s.jsx("span",{children:(t=r==null?void 0:r.leave)==null?void 0:t.reason})]}),!i&&!r&&s.jsxs(s.Fragment,{children:[s.jsxs("span",{children:["In      "," ",n!=null&&n.punchIn?j(n.punchIn).format("hh:mm A"):" -:-"]}),s.jsxs("span",{children:["Out    ",n!=null&&n.punchOut?j(n.punchOut).format("hh:mm A"):"-:-"]})]})]}),children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("span",{className:`${i||r?"border-red-500":c?"border-green-500":"border-amber-400"} p-[2px] border-3 rounded-full`,children:s.jsx(G,{src:H(e==null?void 0:e.profileimage,{format:"webp",width:100,height:100}),alt:e.employeename,children:!e.profileimage&&s.jsx(J,{})})}),s.jsx("p",{className:`${i||r?"text-red-600 text-[14px]":c?"text-green-600 text-[14px]":"text-amber-700"} text-[12px] text-center transition-all duration-300 capitalize`,children:(y=e==null?void 0:e.userid)==null?void 0:y.name})]})},e._id)})}),s.jsxs("div",{className:"flex gap-5",children:[s.jsxs("span",{className:"flex items-center gap-1 text-green-500 text-[13px] ",children:[s.jsx("span",{className:"block w-[15px] rounded-3xl h-[15px] bg-green-500 "})," Currently In Premise"]}),s.jsxs("span",{className:"flex items-center gap-1 text-amber-700 text-[13px]",children:[s.jsx("span",{className:"block w-[15px] rounded-3xl h-[15px] bg-amber-500 "})," Present"]}),s.jsxs("span",{className:"flex items-center gap-1 text-red-500 text-[13px]",children:[s.jsx("span",{className:"block w-[15px] rounded-3xl h-[15px] bg-red-500  "})," Leave/Absent"]})]})]})]})};export{ee as default};
