import{r as g,o as Te,af as Ae,p as ue,q as Me,t as De,T as ee,j as e,w as Ee,ag as ze,ah as se,ai as je,u as de,g as fe,b as p,F as G,I as Q,S as Y,M as U,A as ne,l as Ce,O as oe,a3 as te,B as I,c as W,y as N,D as J,a1 as ge,a4 as Pe,i as Be,C as $e,aa as ke,ab as ie,aj as Oe,a2 as Le,ak as We,ac as _,ad as q,k as Fe,h as Re,al as _e,am as qe,a5 as he,an as Ue,ao as be}from"./index-1A7JaBJN.js";import{C as le}from"./Checkbox-DJ5m2guv.js";import{F as He}from"./FormControlLabel-DrKb4ao4.js";import{u as Se,I as ye}from"./attandencehelper-C0uMSDR2.js";import{A as pe,a as Ve}from"./index-CDmuWZhD.js";import{u as Ie}from"./imageresizer-D4I-KFLq.js";import"./SwitchBase-u8B2VYkF.js";const Je=n=>{const{classes:f,inset:C,primary:c,secondary:d,dense:w}=n;return Ee({root:["root",C&&"inset",w&&"dense",c&&d&&"multiline"],primary:["primary"],secondary:["secondary"]},ze,f)},Ye=Me("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(n,f)=>{const{ownerState:C}=n;return[{[`& .${se.primary}`]:f.primary},{[`& .${se.secondary}`]:f.secondary},f.root,C.inset&&f.inset,C.primary&&C.secondary&&f.multiline,C.dense&&f.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${je.root}:where(& .${se.primary})`]:{display:"block"},[`.${je.root}:where(& .${se.secondary})`]:{display:"block"},variants:[{props:({ownerState:n})=>n.primary&&n.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:n})=>n.inset,style:{paddingLeft:56}}]}),re=g.forwardRef(function(f,C){const c=Te({props:f,name:"MuiListItemText"}),{children:d,className:w,disableTypography:i=!1,inset:v=!1,primary:$,primaryTypographyProps:S,secondary:x,secondaryTypographyProps:F,slots:k={},slotProps:l={},...b}=c,{dense:P}=g.useContext(Ae);let E=$??d,T=x;const t={...c,disableTypography:i,inset:v,primary:!!E,secondary:!!T,dense:P},m=Je(t),h={slots:k,slotProps:{primary:S,secondary:F,...l}},[j,D]=ue("root",{className:De(m.root,w),elementType:Ye,externalForwardedProps:{...h,...b},ownerState:t,ref:C}),[A,o]=ue("primary",{className:m.primary,elementType:ee,externalForwardedProps:h,ownerState:t}),[L,M]=ue("secondary",{className:m.secondary,elementType:ee,externalForwardedProps:h,ownerState:t});return E!=null&&E.type!==ee&&!i&&(E=e.jsx(A,{variant:P?"body2":"body1",component:o!=null&&o.variant?void 0:"span",...o,children:E})),T!=null&&T.type!==ee&&!i&&(T=e.jsx(L,{variant:"body2",color:"textSecondary",...M,children:T})),e.jsxs(j,{...D,children:[E,T]})}),ve=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Ze=({setopenviewmodal:n,employee:f,company:C,editbranch:c,editbranchdata:d})=>{const w={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[i,v]=g.useState(w),$=de(),{adminManager:S}=fe(t=>t.user),[x,F]=g.useState([]),k=localStorage.getItem("emstoken");g.useEffect(()=>{v(t=>({...t,companyId:C._id})),c&&v(t=>({...t,...d}))},[C,c]),g.useEffect(()=>{(S==null?void 0:S.length)>0&&F(S.filter(t=>t.role==="manager"))},[S]);const l=()=>{n(!1),v(w)},b=(t,m)=>{v(h=>({...h,[t]:m}))},P=(t,m,h)=>{v(j=>({...j,setting:{...j.setting,[t]:{...j.setting[t],[m]:h}}}))},E=async()=>{var t,m;try{const h=await W.post("/api/addBranch",i,{headers:{Authorization:`Bearer ${k}`}});N.success(h.data.message),n(!1),$(J()),l()}catch(h){console.error(h),N.error(((m=(t=h==null?void 0:h.response)==null?void 0:t.data)==null?void 0:m.message)||"Error adding branch")}},T=async()=>{var t,m;try{const h=await W.post("/api/editBranch",i,{headers:{Authorization:`Bearer ${k}`}});N.success(h.data.message),$(J()),n(!1),l()}catch(h){console.error(h),N.error(((m=(t=h==null?void 0:h.response)==null?void 0:t.data)==null?void 0:m.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:c?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(p,{label:"Branch Name",fullWidth:!0,size:"small",value:i.name,onChange:t=>b("name",t.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(p,{label:"Location",fullWidth:!0,size:"small",value:i.location,onChange:t=>b("location",t.target.value),helperText:"City, State or Address"}),e.jsxs(G,{size:"small",fullWidth:!0,children:[e.jsx(Q,{children:"Managers"}),e.jsx(Y,{multiple:!0,value:(i==null?void 0:i.managerIds)||[],onChange:t=>b("managerIds",t.target.value),input:e.jsx(oe,{label:"Managers"}),renderValue:t=>t.map(m=>{var h;return((h=x.find(j=>j._id===m))==null?void 0:h.name)||"Unknown"}).join(", "),children:x&&x.length>0?x.map(t=>{var m;return e.jsxs(U,{value:t._id,children:[e.jsx(le,{checked:(m=i==null?void 0:i.managerIds)==null?void 0:m.includes(t._id)}),e.jsx(ne,{src:t==null?void 0:t.profileImage,alt:t==null?void 0:t.name,children:!(t!=null&&t.profileImage)&&e.jsx(Ce,{})}),e.jsx(re,{className:"ml-2 capitalize",primary:t==null?void 0:t.name})]},t._id)}):e.jsx(U,{disabled:!0,value:"",children:e.jsx(re,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(He,{control:e.jsx(le,{checked:!i.defaultsetting,onChange:t=>v(m=>({...m,defaultsetting:!t.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!i.defaultsetting&&e.jsx("div",{className:"border-primary border-2 border-dashed rounded mt-3 py-3 px-1",children:e.jsxs(te,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(p,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:i.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:t=>P("officeTime","in",t.target.value),helperText:"Time when office hours begin"}),e.jsx(p,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:i.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:t=>P("officeTime","out",t.target.value),helperText:"Time when office hours end"}),e.jsx(p,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.officeTime.breakMinutes,onChange:t=>P("officeTime","breakMinutes",Number(t.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(p,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.fullDay,onChange:t=>P("workingMinutes","fullDay",Number(t.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(p,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.halfDay,onChange:t=>P("workingMinutes","halfDay",Number(t.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(p,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.shortDayThreshold,onChange:t=>P("workingMinutes","shortDayThreshold",Number(t.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(p,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.overtimeAfterMinutes,onChange:t=>P("workingMinutes","overtimeAfterMinutes",Number(t.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(G,{size:"small",fullWidth:!0,children:[e.jsx(Q,{children:"Weekly Offs"}),e.jsx(Y,{multiple:!0,value:i.setting.weeklyOffs,onChange:t=>v(m=>({...m,setting:{...m.setting,weeklyOffs:t.target.value}})),input:e.jsx(oe,{label:"Weekly Offs"}),renderValue:t=>t.map(m=>{var h;return(h=ve.find(j=>j.value===m))==null?void 0:h.label}).join(", "),children:ve.map(t=>e.jsxs(U,{value:t.value,children:[e.jsx(le,{checked:i.setting.weeklyOffs.includes(t.value)}),e.jsx(re,{primary:t.label})]},t.value))})]}),Object.entries(i.setting.attendanceRules).map(([t,m])=>{const h=t.replace(/([A-Z])/g," $1").replace(/^./,D=>D.toUpperCase()),j={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(p,{fullWidth:!0,size:"small",label:h,type:"time",value:m,onChange:D=>v(A=>({...A,setting:{...A.setting,attendanceRules:{...A.setting.attendanceRules,[t]:D.target.value}}})),helperText:j[t]},t)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:l,children:"Cancel"}),c?e.jsx(I,{variant:"contained",onClick:T,children:"Save"}):e.jsx(I,{variant:"contained",onClick:E,children:"Add Branch"})]})]})},Ge=async({companyinp:n,setisload:f})=>{const C=localStorage.getItem("emstoken");f(!0);try{const c=await W.post("/api/addcompany",{name:n.name,industry:n.industry},{headers:{Authorization:`Bearer ${C}`}});console.log("Query:",c),N.success(c.data.message,{autoClose:1200})}catch(c){console.log(c),c.response?N.warn(c.response.data.message,{autoClose:1200}):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{f(!1)}},Qe=[{name:"S.no",selector:n=>n.sno,width:"40px"},{name:"Branch",selector:n=>n.branch},{name:"Department",selector:n=>n.dep_name},{name:"Action",selector:n=>n.action,width:"80px"}],Xe=async({inp:n,setisload:f,setInp:C,setopenmodal:c,init:d,dispatch:w})=>{console.log(n);const{branchId:i,department:v,description:$}=n;if(!v){alert("Please fill in both fields");return}const S=localStorage.getItem("emstoken");f(!0);try{const x=await W.post("/api/adddepartment",{department:v,branchId:i,description:$},{headers:{Authorization:`Bearer ${S}`}});w(J()),N.success(x.data.message,{autoClose:1200}),C(d),c(!1)}catch(x){console.log(x),x.response?N.warn(x.response.data.message,{autoClose:1200}):x.request?console.error("No response from server:",x.request):console.error("Error:",x.message)}finally{f(!1)}},Ke=async({inp:n,setisload:f,setInp:C,setopenmodal:c,init:d,dispatch:w})=>{const{departmentId:i,department:v,description:$}=n;if(!v||!i){alert("All fileds are Required");return}const S=localStorage.getItem("emstoken");f(!0);try{const x=await W.post("/api/updatedepartment",{departmentId:i,department:v,description:$},{headers:{Authorization:`Bearer ${S}`}});w(J()),N.success(x.data.message,{autoClose:1200}),C(d),c(!1)}catch(x){console.log(x),x.response?N.warn(x.response.data.message,{autoClose:1200}):x.request?console.error("No response from server:",x.request):console.error("Error:",x.message)}finally{f(!1)}},es=async({departmentId:n,setisload:f,dispatch:C})=>{if(!n){alert("All fileds are Required");return}const c=localStorage.getItem("emstoken");f(!0);try{const d=await W.post("/api/deletedepartment",{departmentId:n},{headers:{Authorization:`Bearer ${c}`}});C(J()),N.success(d.data.message,{autoClose:1200})}catch(d){console.log(d),d.response?N.warn(d.response.data.message,{autoClose:1200}):d.request?console.error("No response from server:",d.request):console.error("Error:",d.message)}finally{f(!1)}},ss=()=>{const[n,f]=g.useState(!1),[C,c]=g.useState(!1),[d,w]=g.useState([]),[i,v]=g.useState(!1),[$,S]=g.useState([]),{branch:x,department:F}=fe(o=>o.user),[k,l]=g.useState({branch:"all",department:" "}),b=k.branch!=="all"||k.department.trim()!=="",P=de();g.useEffect(()=>{if(!d||d.length===0)return;const o=d.filter(L=>{var R;const M=k.branch==="all"||L.branchid===k.branch,H=k.department.trim()===""||((R=L.dep_name)==null?void 0:R.toLowerCase().includes(k.department.trim().toLowerCase()));return M&&H});S(o)},[k,d]);const E={departmentId:"",branchId:"",department:"",description:""},[T,t]=g.useState(E);g.useEffect(()=>{if(F.length>0){let o=1;const L=F.map(M=>{var H,R;return{id:M._id,sno:o++,branchid:(H=M==null?void 0:M.branchId)==null?void 0:H._id,branch:(R=M==null?void 0:M.branchId)==null?void 0:R.name,dep_name:M==null?void 0:M.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>j(M),children:e.jsx(ge,{})}),e.jsx("span",{className:"delete",onClick:()=>D(M._id),children:e.jsx(pe,{})})]})}});w(L)}},[F]);const m=(o,L)=>{t({...T,[L]:o.target.value})},h=o=>{o.preventDefault(),Xe({inp:T,setisload:c,setInp:t,setopenmodal:f,init:E,dispatch:P})},j=o=>{console.log("edit",o),v(!0),t({branchId:o.branchId._id,departmentId:o._id,department:o.department,description:o.description}),f(!0)},D=o=>{console.log("delete",o),Pe({title:"Are you sure?",text:"Once deleted, All empoyee of this department deleted",icon:"warning",buttons:!0,dangerMode:!0}).then(async L=>{L&&es({departmentId:o,setisload:c,dispatch:P})})},A=()=>{Ke({inp:T,setisload:c,setInp:t,setopenmodal:f,init:E,dispatch:P})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(G,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(Q,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(Y,{value:k.branch,onChange:o=>l({...k,branch:o.target.value}),input:e.jsx(oe,{startAdornment:e.jsx(Be,{position:"start",children:e.jsx($e,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(U,{selected:!0,value:"all",children:"All"}),x==null?void 0:x.map(o=>e.jsx(U,{value:o._id,children:o.name},o._id))]})]}),e.jsx(p,{size:"small",id:"outlined-basic",value:k.department,onChange:o=>l({...k,department:o.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(I,{className:"w-full md:w-auto",variant:"contained",onClick:()=>f(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(ke,{customStyles:Se(),columns:Qe,data:b?$:d,pagination:!0,highlightOnHover:!0})}),e.jsx(ie,{open:n,onClose:()=>f(!1),children:e.jsx("div",{className:"membermodal w-[650px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Add Department"}),e.jsx("form",{onSubmit:h,children:e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs(G,{sx:{width:"98%"},size:"small",children:[e.jsx(Q,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(Y,{value:T.branchId,label:"branch",onChange:o=>m(o,"branchId"),children:x==null?void 0:x.map(o=>e.jsx(U,{value:o._id,children:o.name},o._id))})]}),e.jsx(p,{sx:{width:"98%"},required:!0,value:T.department,onChange:o=>m(o,"department"),label:"Department",size:"small"}),e.jsx(p,{multiline:!0,rows:4,onChange:o=>m(o,"description"),value:T.description,sx:{width:"98%"},label:"Description",size:"small"})]})})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{size:"small",onClick:()=>{f(!1),v(!1),t(E)},variant:"outlined",children:" cancel"}),!i&&e.jsx(I,{sx:{mr:2},loading:C,loadingPosition:"end",endIcon:e.jsx(ye,{}),onClick:h,variant:"contained",type:"submit",children:"Add"}),i&&e.jsx(I,{sx:{mr:2},loading:C,loadingPosition:"end",endIcon:e.jsx(ye,{}),variant:"contained",onClick:A,children:"Update"})]})]})})})]})},ae={1:"Read",2:"Create",3:"Update",4:"Delete"},we=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],xe={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},as={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function ts(){const[n,f]=g.useState([]),[C,c]=g.useState([]),[d,w]=g.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...xe}}),i=de();g.useEffect(()=>{o()},[]);const v=g.useRef(null),{handleImage:$}=Ie(),[S,x]=g.useState(null),[F,k]=g.useState(!1),[l,b]=g.useState(""),[P,E]=g.useState(!1),[T,t]=g.useState(null),m=s=>{t(a=>a===s?null:s)},h=()=>{w({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...xe}}),b(""),x(null),k(!1)},[j,D]=g.useState({userid:"",pass:""}),A=async()=>{const s={...d},a=new FormData;c(!0);try{const r=s.profileImage?await $(240,s.profileImage):null;r&&a.append("photo",r),a.append("name",s.name),a.append("email",s.email),a.append("role",s.role),a.append("password",s.password),a.append("permissions",JSON.stringify(s.permissions));const u=localStorage.getItem("emstoken");c(!0);const y=S!==null?`/api/editAdmin/${n[S]._id}`:"/api/addAdmin",z=await W["post"](y,a,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"multipart/form-data"}});N.success(z.data.message,{autoClose:1200}),h(),o(),i(J())}catch(r){console.error(r),r.response?N.warn(r.response.data.message,{autoClose:1200}):N.error("Something went wrong",{autoClose:1200})}finally{c(!1)}},o=async()=>{try{const s=localStorage.getItem("emstoken");c(!0);const a=await W.get("/api/getAdmin",{headers:{Authorization:`Bearer ${s}`}});f(a.data)}catch(s){console.error(s),s.response?N.warn(s.response.data.message,{autoClose:1200}):N.error("Something went wrong",{autoClose:1200})}finally{c(!1)}},L=s=>{const a=n[s];console.log(a),w({...a,profilePreview:a.profileImage||"",profileImage:null}),x(s),k(!0)},M=async s=>{s.preventDefault();try{const a=localStorage.getItem("emstoken"),r=await W.post("/api/updatepassword",{pass:j},{headers:{Authorization:`Bearer ${a}`}});D({userid:"",pass:""}),E(!1),N.success(r.data.message,{autoClose:1200})}catch(a){console.log(a),a.response?N.warn(a.response.data.message,{autoClose:1200}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}},H=async s=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{var r,u;if(a){let y;try{const B=localStorage.getItem("emstoken");c(!0),y=N.loading("Deleting...");const z=await W.delete(`/api/deleteAdmin/${s}`,{headers:{Authorization:`Bearer ${B}`}});N.update(y,{render:z.data.message,type:"success",isLoading:!1,autoClose:1800}),o(),i(J())}catch(B){console.error(B),N.update(y,{render:((u=(r=B.response)==null?void 0:r.data)==null?void 0:u.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{c(!1)}}})},R=(s,a)=>{w(r=>{const u=r.permissions[s]||[],B=u.includes(a)?u.filter(z=>z!==a):[...u,a].sort();return{...r,permissions:{...r.permissions,[s]:B}}})},ce=s=>{const a=s==="admin"?{...xe}:{...as};w({...d,role:s,permissions:a})},me=s=>{const a=s.target.files[0];a&&w(r=>({...r,profileImage:a,profilePreview:URL.createObjectURL(a)}))},X=()=>{l&&(w(s=>({...s,permissions:{...s.permissions,[l]:[]}})),b(""))},Z=Array.from(new Set([...d.role==="admin"?we:Object.keys(d.permissions),...Object.keys(d.permissions)])),K=we.filter(s=>!Z.includes(s));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:" shadow-md rounded-lg",children:[e.jsx("div",{className:"flex justify-between flex-wrap items-center mb-4",children:e.jsx(I,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{h(),k(!0)},children:"Add Admin/ Manager"})}),n.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:n.map((s,a)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ne,{sx:{width:60,height:60},alt:s.name,src:s==null?void 0:s.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[s.name," (",s.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:s.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{title:"Edit",className:"p-2 border rounded hover:bg-gray-100",onClick:()=>L(a),children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx("button",{title:"Password Reset",className:"p-2 border rounded hover:bg-gray-100 text-green-500",onClick:()=>{D({...j,userid:s._id}),E(!0)},children:e.jsx(Le,{className:"h-4 w-4 "})}),e.jsx("button",{title:"Delete",className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>H(s._id),children:e.jsx(We,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>m(a),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",T===a?"Hide Permissions":"View Permissions "]}),T===a?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),T===a&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(ae).map(r=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:r},r))]})}),e.jsx("tbody",{children:Object.entries(s.permissions).map(([r,u])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:r}),Object.keys(ae).map(y=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:u.includes(Number(y))?"✅":"-"},y))]},r))})]})]})]})]},a))})]}),e.jsx(ie,{open:F,onClose:()=>k(!1),children:e.jsx("div",{className:"membermodal w-[660px]",children:e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"modalhead",children:[" ",S!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-full",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:me,ref:v,accept:"image/*",name:"",id:"fileInput"}),e.jsx(ne,{sx:{width:70,height:70},alt:d.name,src:d.profilePreview}),e.jsx("span",{onClick:()=>v.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(ge,{size:18})})]}),e.jsx(p,{fullWidth:!0,required:!0,value:d.name,onChange:s=>w({...d,name:s.target.value}),label:"Name",size:"small"}),e.jsx(p,{fullWidth:!0,required:!0,value:d.email,onChange:s=>w({...d,email:s.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),S==null&&e.jsxs(e.Fragment,{children:[e.jsx(p,{fullWidth:!0,required:!0,value:d.password,type:"password",onChange:s=>w({...d,password:s.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:d.role,onChange:s=>ce(s.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]})]}),d.role==="manager"&&e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border p-2 flex-3 rounded ",value:l,onChange:s=>b(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),K.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(I,{variant:"contained",onClick:X,className:"flex-1",children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(ae).map(([s,a])=>e.jsx("th",{className:"border p-2 text-center",children:a},s))]})}),e.jsx("tbody",{children:Z.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:s}),Object.keys(ae).map(a=>{var r;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((r=d.permissions[s])==null?void 0:r.includes(Number(a)))||!1,onChange:()=>R(s,Number(a))})},a)})]},s))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:h,children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:A,loading:C,children:S!==null?"Update":"Create"})]})]})})}),e.jsx(ie,{open:P,onClose:()=>{E(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:M,children:[e.jsx("h2",{children:"Reset Passowrd"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(p,{fullWidth:!0,inputProps:{minLength:3,maxLength:10},required:!0,value:j.pass,onChange:s=>D({...j,pass:s.target.value}),label:"Passowrd",size:"small"}),e.jsx(I,{variant:"contained",sx:{mr:2},type:"submit",children:"Reset Password"})]})]})})})]})}const Ne=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function ms(){var X,Z,K;const[n,f]=g.useState(null),[C,c]=g.useState(!1),[d,w]=g.useState(!1),[i,v]=g.useState(!1),{handleImage:$}=Ie(),[S,x]=g.useState(null),[F,k]=g.useState(!1),[l,b]=g.useState({name:"",address:"",contact:"",fullname:"",deviceSN:"",devices:[{SN:"BJ2C194460597",name:"Head Branch",online:!1}],telegram:{token:"",groupId:""},telegramNotifcation:!1,officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"},payrollPolicies:{allowances:[],bonuses:[],deductions:[]}}),P=()=>{b({...l,devices:[...l.devices,{SN:"",name:"",online:!1}]})},E=s=>{swal({title:"Delete this device?",icon:"warning",buttons:!0,dangerMode:!0}).then(a=>{if(a){const r=l.devices.filter((u,y)=>y!==s);b({...l,devices:r})}})},T=de(),{employee:t,company:m,branch:h,profile:j}=fe(s=>s.user),D=s=>{f(a=>a===s?null:s)};g.useEffect(()=>{m&&b(m)},[m]);const A=(s,a,r)=>{b(u=>({...u,[s]:{...u[s],[a]:r}}))},o=async s=>{s.preventDefault();try{v(!0);const a=localStorage.getItem("emstoken"),r=await W.post("/api/updateCompany",{...l},{headers:{Authorization:`Bearer ${a}`}});T(J()),N.success(r.data.message,{autoClose:1800})}catch(a){console.log(a),a.response?N.warn(a.response.data.message,{autoClose:2700}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}finally{v(!1)}},L=()=>{},M=s=>{var r;c(!0);const a={...s,managerIds:(r=s==null?void 0:s.managerIds)==null?void 0:r.map(u=>u._id)};x(a),w(!0)},H=Se(),R=s=>s?Date.now()-new Date(s).getTime()<6e4:!1,ce=async s=>{const a=`/api/refreshDevice/${s}`;try{k(!0);const r=localStorage.getItem("emstoken"),u=await W.get(a,{headers:{Authorization:`Bearer ${r}`}});b(y=>({...y,devices:u.data.devices}))}catch(r){console.log(r),r.response?N.warn(r.response.data.message,{autoClose:2700}):r.request?console.error("No response from server:",r.request):console.error("Error:",r.message)}finally{k(!1)}},me=async()=>{try{const s=await W.get(`https://api.telegram.org/bot${l.telegram.token}/getUpdates`);if(s.data.result.length>0){let a={},{id:r,title:u,type:y}=s.data.result[0].message.chat,B={id:r,title:u,type:y};s.data.result.forEach(z=>{var O;if((O=z.message)!=null&&O.from){let V=z.message.from.id;a.hasOwnProperty(V)||(a[V]={name:z.message.from.first_name,username:z.message.from.username||""})}}),console.log(B),console.log(a)}}catch(s){console.log(s)}};return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(j==null?void 0:j.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>D("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),n==="company"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("div",{className:` 
                          rounded overflow-hidden transition-all duration-300 
                          ${n==="company"?"max-h-fit p-0 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsxs("div",{className:"p-1 md:p-4 rounded  flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[l!=null&&l.logo?e.jsx("img",{src:Fe(l.logo,{format:"webp",width:200,height:200}),alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Ve,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async s=>{const a=s.target.files[0];if(!a)return;const r=await $(300,a),u=new FormData;u.append("_id",l._id),u.append("logo",r);try{v(!0);const y=localStorage.getItem("emstoken"),z=(await W.post("/api/updateCompany",u,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;b(O=>({...O,logo:z})),N.success("Logo uploaded successfully!")}catch(y){console.error(y),N.error("Failed to upload logo.")}finally{v(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(p,{label:"Company Name",size:"small",variant:"standard",fullWidth:!0,value:(l==null?void 0:l.name)||"",onChange:s=>b({...l,name:s.target.value})})}),e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(p,{label:"Contact",type:"tel",variant:"standard",size:"small",fullWidth:!0,value:(l==null?void 0:l.contact)||"",inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},onChange:s=>b({...l,contact:s.target.value.replace(/\D/g,"")})})})]}),e.jsx("div",{children:e.jsx(p,{label:"Company Full Name",variant:"standard",fullWidth:!0,size:"small",value:(l==null?void 0:l.fullname)||"",onChange:s=>b({...l,fullname:s.target.value})})}),e.jsx("div",{children:e.jsx(p,{label:"Address",fullWidth:!0,multiline:!0,size:"small",minRows:2,value:(l==null?void 0:l.address)||"",onChange:s=>b({...l,address:s.target.value})})}),m?e.jsx(I,{variant:"contained",loading:i,onClick:o,children:"Save Changes"}):e.jsx(I,{loading:i,variant:"contained",onClick:()=>Ge({companyinp:l,setisload:v}),children:"+ Create Company"})]})]})})]}),((j==null?void 0:j.role)=="superadmin"||(j==null?void 0:j.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>D("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),n==="branches"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded space-y-1 overflow-hidden transition-all duration-300
                          ${n==="branches"?"max-h-fit p-1 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(I,{variant:"contained",onClick:()=>w(!0),children:"+ Add Branch"})}),e.jsx(ke,{customStyles:H,columns:[{name:"Name",selector:s=>s.name,sortable:!0},{name:"Location",selector:s=>s.location,sortable:!0},{name:"Manager(s)",cell:s=>{var a;return e.jsx("div",{className:"flex flex-col gap-2",children:(a=s==null?void 0:s.managerIds)==null?void 0:a.map((r,u)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>L(r.userid),children:[e.jsx(ne,{src:r==null?void 0:r.profileImage,alt:r.name,children:!(r!=null&&r.profileImage)&&e.jsx(Ce,{})}),e.jsx("span",{children:r.name})]},u))})}},{name:"Actions",width:"120px",cell:s=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>M(s),children:e.jsx(ge,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>M(s),children:e.jsx(pe,{})})]})}],data:h||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>D("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),n==="department"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${n==="department"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(ss,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-indigo-50 border-dashed border-indigo-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-indigo-200 px-4 py-2 rounded-md",onClick:()=>D("device"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Devices"}),n==="device"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${n==="device"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs("div",{className:"mb-2  ",children:[(X=l==null?void 0:l.devices)==null?void 0:X.map((s,a)=>{const r=R(s==null?void 0:s.lastHeartbeat);return e.jsxs("div",{className:"flex w-full gap-4 items-center mb-2",children:[e.jsx(p,{label:"S.No",variant:"standard",disabled:!0,size:"small",value:a+1,className:"w-10"}),e.jsx(p,{label:"Device Name",variant:"standard",size:"small",value:s.name,onChange:u=>updateDevice(a,"name",u.target.value)}),e.jsx(p,{label:"Device SN",variant:"standard",size:"small",value:s.SN,onChange:u=>updateDevice(a,"SN",u.target.value)}),e.jsx(p,{label:"Last Sync",variant:"standard",size:"small",value:s!=null&&s.lastHeartbeat?Re(s==null?void 0:s.lastHeartbeat).format("DD/MM/YY, hh:mm:ss A"):"N/A"}),r?e.jsx(_e,{title:"Device Online",style:{color:"green",fontSize:"1.6rem"}}):e.jsx(qe,{title:"Device Offline",style:{color:"red",fontSize:"1.6rem"}}),e.jsx(he,{color:"primary",onClick:()=>ce(s==null?void 0:s.SN),children:e.jsx(Ue,{className:F?"animate-spin":""})}),e.jsx(he,{color:"error",onClick:()=>E(a),children:e.jsx(be,{})})]},a)}),e.jsx(I,{variant:"contained",onClick:P,children:"Add More Device"})]}),e.jsx(I,{className:"f float-end",variant:"contained",loading:i,onClick:o,children:"Save Changes"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-indigo-50 border-dashed border-indigo-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-indigo-200 px-4 py-2 rounded-md",onClick:()=>D("telegram"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Telegram"}),n==="telegram"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${n==="telegram"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"mb-2  ",children:e.jsxs("div",{className:"flex w-full gap-4 items-center mb-2",children:[e.jsx(p,{label:"Telegram Bot Token",variant:"standard",size:"small",className:"w-[350px]",value:(Z=l==null?void 0:l.telegram)==null?void 0:Z.token,onChange:s=>A("telegram","token",s.target.value)}),e.jsx(p,{label:"Group Id",variant:"standard",size:"small",value:(K=l==null?void 0:l.telegram)==null?void 0:K.groupId,onChange:s=>A("telegram","groupId",s.target.value)}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs("label",{className:"flex items-center cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:l==null?void 0:l.telegramNotifcation,onChange:s=>b(a=>({...a,telegramNotifcation:s.target.checked})),className:"w-5 h-5 text-blue-600 bg-gray-200 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("span",{className:"ml-2 text-gray-700 font-medium",children:"Enable Notifications"})]})}),e.jsx(he,{color:"error",onClick:()=>"kis",children:e.jsx(be,{})})]})}),e.jsx(I,{className:" float-end",variant:"contained",loading:i,onClick:me,children:"Ftech group id"}),e.jsx(I,{className:" float-end",variant:"contained",loading:i,onClick:o,children:"Save Changes"})]})]}),(j==null?void 0:j.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>D("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),n==="admin"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${n==="admin"?"max-h-fit md:p-2 p-1 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(ts,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>D("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),n==="attendance"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${n==="attendance"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs(te,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(p,{label:"Office Time In",fullWidth:!0,type:"time",value:l.officeTime.in,onChange:s=>A("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(p,{label:"Office Time Out",fullWidth:!0,type:"time",value:l.officeTime.out,onChange:s=>A("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(p,{label:"Break Minutes",fullWidth:!0,type:"number",value:l.officeTime.breakMinutes,onChange:s=>A("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(p,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:l.workingMinutes.fullDay,onChange:s=>A("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(p,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:l.workingMinutes.halfDay,onChange:s=>A("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(p,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:l.workingMinutes.shortDayThreshold,onChange:s=>A("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(p,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:l.workingMinutes.overtimeAfterMinutes,onChange:s=>A("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(G,{fullWidth:!0,children:[e.jsx(Q,{children:"Weekly Offs"}),e.jsx(Y,{multiple:!0,value:l.weeklyOffs,onChange:s=>b({...l,weeklyOffs:s.target.value}),input:e.jsx(oe,{label:"Weekly Offs"}),renderValue:s=>s.map(a=>{var r;return(r=Ne.find(u=>u.value===a))==null?void 0:r.label}).join(", "),children:Ne.map(s=>e.jsxs(U,{value:s.value,children:[e.jsx(le,{checked:l.weeklyOffs.includes(s.value)}),e.jsx(re,{primary:s.label})]},s.value))})]}),Object.entries(l.attendanceRules).map(([s,a])=>{const r=s.replace(/([A-Z])/g," $1").replace(/^./,y=>y.toUpperCase()),u={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(p,{fullWidth:!0,label:r,type:"time",value:a,onChange:y=>A("attendanceRules",s,y.target.value),helperText:u[s]},s)})]}),e.jsx(te,{sx:{mt:4,textAlign:"right"},children:e.jsx(I,{variant:"contained",onClick:o,children:"Update Settings"})})]})]}),e.jsxs("div",{className:"border shadow-lg bg-purple-50 border-dashed border-purple-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-purple-200 px-4 py-2 rounded-md",onClick:()=>D("policies"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Default Payroll Policies"}),n==="policies"?e.jsx(_,{className:"text-xl"}):e.jsx(q,{className:"text-xl"})]}),e.jsx("form",{onSubmit:o,children:e.jsxs("div",{className:`rounded overflow-hidden transition-all duration-300 
                     ${n==="policies"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}`,children:[e.jsx("div",{className:"flex flex-col gap-3",children:["allowances","bonuses","deductions"].map(s=>{var r;const a=((r=l==null?void 0:l.payrollPolicies)==null?void 0:r[s])||[];return e.jsxs("div",{className:"flex flex-col shadow-lg gap-2 px-2 pb-2 my-2 border rounded border-dashed relative border-primary",children:[e.jsx("p",{className:"capitalize absolute t-0 -translate-y-1/2 l-2 bg-white px-2",children:s}),e.jsx("div",{className:"mt-6 flex flex-col gap-2",children:a.map((u,y)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{label:"Name",size:"small",required:!0,value:u.name,onChange:B=>{const z=a.map((O,V)=>V===y?{...O,name:B.target.value}:O);b({...l,payrollPolicies:{...l.payrollPolicies,[s]:z}})}}),e.jsxs(Y,{size:"small",className:"w-[120px]",value:u.type,onChange:B=>{const z=a.map((O,V)=>V===y?{...O,type:B.target.value}:O);b({...l,payrollPolicies:{...l.payrollPolicies,[s]:z}})},children:[e.jsx(U,{value:"amount",children:"Amount"}),e.jsx(U,{value:"percentage",children:"%"})]}),e.jsx(p,{label:u.type==="amount"?"₹":"%",type:"number",size:"small",required:!0,className:"w-[90px]",value:u.value,onChange:B=>{const z=a.map((O,V)=>V===y?{...O,value:Number(B.target.value)}:O);b({...l,payrollPolicies:{...l.payrollPolicies,[s]:z}})}}),e.jsx(pe,{className:"text-red-500 w-8 h-8 p-1  cursor-pointer text-lg",onClick:()=>{const B=a.filter((z,O)=>O!==y);b({...l,payrollPolicies:{...l.payrollPolicies,[s]:B}})}})]},y))}),e.jsxs(I,{size:"small",variant:"contained",onClick:()=>b({...l,payrollPolicies:{...l.payrollPolicies,[s]:[...a,{name:"",type:"amount",value:0}]}}),children:["+ Add ",s.slice(0,-1)]})]},s)})}),e.jsx(te,{sx:{mt:2,textAlign:"right"},children:e.jsx(I,{variant:"contained",type:"submit",children:"Save Policies"})})]})})]}),e.jsx(ie,{open:d,onClose:()=>{w(!1),x(null),c(!1)},children:e.jsx("div",{className:"membermodal w-[680px]",children:e.jsx(Ze,{setopenviewmodal:w,editbranchdata:S,editbranch:C,company:m,employee:t})})})]})}export{ms as default};
