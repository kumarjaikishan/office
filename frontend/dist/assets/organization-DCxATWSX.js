import{r as v,j as e,o as X,p as ue,h as we,S as $e,i as Pe,k as pe,t as J,n as te,U as Ne,q as Ce,u as ke,f as Se,A as Y,F as Te,b as W,y as O,v as ne,V as Ie,W as Le,X as R,Q as F,K as Oe}from"./index-BbzY4ZUI.js";import{M as Me}from"./Modalbox-wGiHBFhx.js";import{a as Be,e as De,u as ze}from"./useSlotProps-CI7U4UXW.js";import{s as We}from"./styled-DEkU-a_z.js";import{i as Re,a as Fe,f as Ge,L as qe,F as le,I as oe,S as ie,O as ce}from"./Select-D_NGKd3N.js";import{u as Ue}from"./useThemeProps-s3TZz8nb.js";import{T as E}from"./TextField-BDLtnsif.js";import{g as _e,l as Q,M as de}from"./MenuItem-BeTW2alY.js";import{C as K}from"./Checkbox-CGgov3ff.js";import{T as G,t as xe}from"./Typography-B4QEqcF5.js";import{B}from"./Button-DWI-vyDf.js";import Ve from"./Department-EZoBcGEx.js";import{a as He}from"./index-zcu_T75I.js";import{u as Ee}from"./imageresizer-D4I-KFLq.js";import{B as ae}from"./Box-C64WVMau.js";import"./createSimplePaletteValueFilter-CPf6oSdo.js";import"./ButtonBase-DViDmRa1.js";import"./index-D4jmEOvm.js";import"./index.es-D1qtK2rE.js";import"./attandencehelper-B0fjni3z.js";import"./InputAdornment-CFUorUYE.js";const Qe=(t,r)=>t.filter(o=>r.includes(o)),U=(t,r,o)=>{const l=t.keys[0];Array.isArray(r)?r.forEach((i,c)=>{o((d,g)=>{c<=t.keys.length-1&&(c===0?Object.assign(d,g):d[t.up(t.keys[c])]=g)},i)}):r&&typeof r=="object"?(Object.keys(r).length>t.keys.length?t.keys:Qe(t.keys,Object.keys(r))).forEach(c=>{if(t.keys.includes(c)){const d=r[c];d!==void 0&&o((g,M)=>{l===c?Object.assign(g,M):g[t.up(c)]=M},d)}}):(typeof r=="number"||typeof r=="string")&&o((i,c)=>{Object.assign(i,c)},r)};function ee(t){return`--Grid-${t}Spacing`}function se(t){return`--Grid-parent-${t}Spacing`}const ge="--Grid-columns",q="--Grid-parent-columns",Ze=({theme:t,ownerState:r})=>{const o={};return U(t.breakpoints,r.size,(l,i)=>{let c={};i==="grow"&&(c={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(c={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / var(${q}) - (var(${q}) - ${i}) * (var(${se("column")}) / var(${q})))`}),l(o,c)}),o},Je=({theme:t,ownerState:r})=>{const o={};return U(t.breakpoints,r.offset,(l,i)=>{let c={};i==="auto"&&(c={marginLeft:"auto"}),typeof i=="number"&&(c={marginLeft:i===0?"0px":`calc(100% * ${i} / var(${q}) + var(${se("column")}) * ${i} / var(${q}))`}),l(o,c)}),o},Ke=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={[ge]:12};return U(t.breakpoints,r.columns,(l,i)=>{const c=i??12;l(o,{[ge]:c,"> *":{[q]:c}})}),o},Xe=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={};return U(t.breakpoints,r.rowSpacing,(l,i)=>{var d;const c=typeof i=="string"?i:(d=t.spacing)==null?void 0:d.call(t,i);l(o,{[ee("row")]:c,"> *":{[se("row")]:c}})}),o},Ye=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={};return U(t.breakpoints,r.columnSpacing,(l,i)=>{var d;const c=typeof i=="string"?i:(d=t.spacing)==null?void 0:d.call(t,i);l(o,{[ee("column")]:c,"> *":{[se("column")]:c}})}),o},et=({theme:t,ownerState:r})=>{if(!r.container)return{};const o={};return U(t.breakpoints,r.direction,(l,i)=>{l(o,{flexDirection:i})}),o},tt=({ownerState:t})=>({minWidth:0,boxSizing:"border-box",...t.container&&{display:"flex",flexWrap:"wrap",...t.wrap&&t.wrap!=="wrap"&&{flexWrap:t.wrap},gap:`var(${ee("row")}) var(${ee("column")})`}}),st=t=>{const r=[];return Object.entries(t).forEach(([o,l])=>{l!==!1&&l!==void 0&&r.push(`grid-${o}-${String(l)}`)}),r},at=(t,r="xs")=>{function o(l){return l===void 0?!1:typeof l=="string"&&!Number.isNaN(Number(l))||typeof l=="number"&&l>0}if(o(t))return[`spacing-${r}-${String(t)}`];if(typeof t=="object"&&!Array.isArray(t)){const l=[];return Object.entries(t).forEach(([i,c])=>{o(c)&&l.push(`spacing-${i}-${String(c)}`)}),l}return[]},rt=t=>t===void 0?[]:typeof t=="object"?Object.entries(t).map(([r,o])=>`direction-${r}-${o}`):[`direction-xs-${String(t)}`];function nt(t,r){t.item!==void 0&&delete t.item,t.zeroMinWidth!==void 0&&delete t.zeroMinWidth,r.keys.forEach(o=>{t[o]!==void 0&&delete t[o]})}const lt=$e(),ot=We("div",{name:"MuiGrid",slot:"Root"});function it(t){return Ue({props:t,name:"MuiGrid",defaultTheme:lt})}function ct(t={}){const{createStyledComponent:r=ot,useThemeProps:o=it,useTheme:l=Be,componentName:i="MuiGrid"}=t,c=(S,N)=>{const{container:p,direction:b,spacing:T,wrap:w,size:C}=S,A={root:["root",p&&"container",w!=="wrap"&&`wrap-xs-${String(w)}`,...rt(b),...st(C),...p?at(T,N.breakpoints.keys[0]):[]]};return ue(A,y=>we(i,y),{})};function d(S,N,p=()=>!0){const b={};return S===null||(Array.isArray(S)?S.forEach((T,w)=>{T!==null&&p(T)&&N.keys[w]&&(b[N.keys[w]]=T)}):typeof S=="object"?Object.keys(S).forEach(T=>{const w=S[T];w!=null&&p(w)&&(b[T]=w)}):b[N.keys[0]]=S),b}const g=r(Ke,Ye,Xe,Ze,et,tt,Je),M=v.forwardRef(function(N,p){const b=l(),T=o(N),w=De(T);nt(w,b.breakpoints);const{className:C,children:A,columns:y=12,container:s=!1,component:u="div",direction:f="row",wrap:$="wrap",size:I={},offset:a={},spacing:j=0,rowSpacing:k=j,columnSpacing:h=j,unstable_level:P=0,...n}=w,m=d(I,b.breakpoints,D=>D!==!1),x=d(a,b.breakpoints),L=N.columns??(P?void 0:y),z=N.spacing??(P?void 0:j),H=N.rowSpacing??N.spacing??(P?void 0:k),_=N.columnSpacing??N.spacing??(P?void 0:h),fe={...w,level:P,columns:L,container:s,direction:f,wrap:$,spacing:z,rowSpacing:H,columnSpacing:_,size:m,offset:x},Ae=c(fe,b);return e.jsx(g,{ref:p,as:u,ownerState:fe,className:X(Ae.root,C),...n,children:v.Children.map(A,D=>{var he;return v.isValidElement(D)&&Re(D,["Grid"])&&s&&D.props.container?v.cloneElement(D,{unstable_level:((he=D.props)==null?void 0:he.unstable_level)??P+1}):D})})});return M.muiName="Grid",M}function dt(t){return we("MuiFormControlLabel",t)}const V=Pe("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),mt=t=>{const{classes:r,disabled:o,labelPlacement:l,error:i,required:c}=t,d={root:["root",o&&"disabled",`labelPlacement${Ne(l)}`,i&&"error",c&&"required"],label:["label",o&&"disabled"],asterisk:["asterisk",i&&"error"]};return ue(d,dt,r)},ut=te("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[{[`& .${V.label}`]:r.label},r.root,r[`labelPlacement${Ne(o.labelPlacement)}`]]}})(Ce(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${V.disabled}`]:{cursor:"default"},[`& .${V.label}`]:{[`&.${V.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:r})=>r==="start"||r==="top"||r==="bottom",style:{marginLeft:16}}]}))),pt=te("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(Ce(({theme:t})=>({[`&.${V.error}`]:{color:(t.vars||t).palette.error.main}}))),ft=v.forwardRef(function(r,o){const l=pe({props:r,name:"MuiFormControlLabel"}),{checked:i,className:c,componentsProps:d={},control:g,disabled:M,disableTypography:S,inputRef:N,label:p,labelPlacement:b="end",name:T,onChange:w,required:C,slots:A={},slotProps:y={},value:s,...u}=l,f=Fe(),$=M??g.props.disabled??(f==null?void 0:f.disabled),I=C??g.props.required,a={disabled:$,required:I};["checked","name","onChange","value","inputRef"].forEach(L=>{typeof g.props[L]>"u"&&typeof l[L]<"u"&&(a[L]=l[L])});const j=Ge({props:l,muiFormControl:f,states:["error"]}),k={...l,disabled:$,labelPlacement:b,required:I,error:j.error},h=mt(k),P={slots:A,slotProps:{...d,...y}},[n,m]=J("typography",{elementType:G,externalForwardedProps:P,ownerState:k});let x=p;return x!=null&&x.type!==G&&!S&&(x=e.jsx(n,{component:"span",...m,className:X(h.label,m==null?void 0:m.className),children:x})),e.jsxs(ut,{className:X(h.root,c),ownerState:k,ref:o,...u,children:[v.cloneElement(g,a),I?e.jsxs("div",{children:[x,e.jsxs(pt,{ownerState:k,"aria-hidden":!0,className:h.asterisk,children:[" ","*"]})]}):x]})}),ye=ct({createStyledComponent:te("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[r.root,o.container&&r.container]}}),componentName:"MuiGrid",useThemeProps:t=>pe({props:t,name:"MuiGrid"}),useTheme:ze}),ht=t=>{const{classes:r,inset:o,primary:l,secondary:i,dense:c}=t;return ue({root:["root",o&&"inset",c&&"dense",l&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},_e,r)},xt=te("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[{[`& .${Q.primary}`]:r.primary},{[`& .${Q.secondary}`]:r.secondary},r.root,o.inset&&r.inset,o.primary&&o.secondary&&r.multiline,o.dense&&r.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${xe.root}:where(& .${Q.primary})`]:{display:"block"},[`.${xe.root}:where(& .${Q.secondary})`]:{display:"block"},variants:[{props:({ownerState:t})=>t.primary&&t.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:t})=>t.inset,style:{paddingLeft:56}}]}),me=v.forwardRef(function(r,o){const l=pe({props:r,name:"MuiListItemText"}),{children:i,className:c,disableTypography:d=!1,inset:g=!1,primary:M,primaryTypographyProps:S,secondary:N,secondaryTypographyProps:p,slots:b={},slotProps:T={},...w}=l,{dense:C}=v.useContext(qe);let A=M??i,y=N;const s={...l,disableTypography:d,inset:g,primary:!!A,secondary:!!y,dense:C},u=ht(s),f={slots:b,slotProps:{primary:S,secondary:p,...T}},[$,I]=J("root",{className:X(u.root,c),elementType:xt,externalForwardedProps:{...f,...w},ownerState:s,ref:o}),[a,j]=J("primary",{className:u.primary,elementType:G,externalForwardedProps:f,ownerState:s}),[k,h]=J("secondary",{className:u.secondary,elementType:G,externalForwardedProps:f,ownerState:s});return A!=null&&A.type!==G&&!d&&(A=e.jsx(a,{variant:C?"body2":"body1",component:j!=null&&j.variant?void 0:"span",...j,children:A})),y!=null&&y.type!==G&&!d&&(y=e.jsx(k,{variant:"body2",color:"textSecondary",...h,children:y})),e.jsxs($,{...I,children:[A,y]})}),be=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],gt=({setopenviewmodal:t,employee:r,company:o,editbranch:l,editbranchdata:i})=>{const c={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:540},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[d,g]=v.useState(c),M=ke(),{adminManager:S}=Se(s=>s.user),[N,p]=v.useState([]),b=localStorage.getItem("emstoken");v.useEffect(()=>{p(r),g(s=>({...s,companyId:o._id})),l&&g(s=>({...s,...i}))},[o,l]),v.useEffect(()=>{S.length>0&&p(S.filter(s=>s.role==="manager"))},[S]);const T=()=>{t(!1),g(c)},w=(s,u)=>{g(f=>({...f,[s]:u}))},C=(s,u,f)=>{g($=>({...$,setting:{...$.setting,[s]:{...$.setting[s],[u]:f}}}))},A=async()=>{var s,u;try{const f=await W.post("/api/addBranch",d,{headers:{Authorization:`Bearer ${b}`}});O.success(f.data.message),t(!1),M(ne()),T()}catch(f){console.error(f),O.error(((u=(s=f==null?void 0:f.response)==null?void 0:s.data)==null?void 0:u.message)||"Error adding branch")}},y=async()=>{var s,u;try{const f=await W.post("/api/editBranch",d,{headers:{Authorization:`Bearer ${b}`}});O.success(f.data.message),M(ne()),t(!1),T()}catch(f){console.error(f),O.error(((u=(s=f==null?void 0:f.response)==null?void 0:s.data)==null?void 0:u.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:l?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(ye,{container:!0,spacing:2,children:[e.jsx(E,{label:"Branch Name",fullWidth:!0,size:"small",value:d.name,onChange:s=>w("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(E,{label:"Location",fullWidth:!0,size:"small",value:d.location,onChange:s=>w("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(le,{size:"small",fullWidth:!0,children:[e.jsx(oe,{children:"Managers"}),e.jsx(ie,{multiple:!0,value:d.managerIds,onChange:s=>w("managerIds",s.target.value),input:e.jsx(ce,{label:"Managers"}),renderValue:s=>s.map(u=>{var f;return(f=N.find($=>$._id===u))==null?void 0:f.name}).join(", "),children:N==null?void 0:N.map(s=>{var u;return e.jsxs(de,{value:s==null?void 0:s._id,children:[e.jsx(K,{checked:(u=d==null?void 0:d.managerIds)==null?void 0:u.includes(s._id)}),e.jsx(Y,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!s.profileImage&&e.jsx(Te,{})}),e.jsx(me,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)})})]})]}),e.jsx(ft,{control:e.jsx(K,{checked:!d.defaultsetting,onChange:s=>g(u=>({...u,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!d.defaultsetting&&e.jsx("div",{className:"border-yellow-300 border-2 grid grid-cols-2 gap-3 border-dashed rounded mt-3 p-3",children:e.jsxs(ye,{container:!0,spacing:2,children:[e.jsx(E,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>C("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(E,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>C("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(E,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.officeTime.breakMinutes,onChange:s=>C("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(E,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.fullDay,onChange:s=>C("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(E,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.halfDay,onChange:s=>C("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(E,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.shortDayThreshold,onChange:s=>C("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(E,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>C("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(le,{size:"small",fullWidth:!0,children:[e.jsx(oe,{children:"Weekly Offs"}),e.jsx(ie,{multiple:!0,value:d.setting.weeklyOffs,onChange:s=>g(u=>({...u,setting:{...u.setting,weeklyOffs:s.target.value}})),input:e.jsx(ce,{label:"Weekly Offs"}),renderValue:s=>s.map(u=>{var f;return(f=be.find($=>$.value===u))==null?void 0:f.label}).join(", "),children:be.map(s=>e.jsxs(de,{value:s.value,children:[e.jsx(K,{checked:d.setting.weeklyOffs.includes(s.value)}),e.jsx(me,{primary:s.label})]},s.value))})]}),Object.entries(d.setting.attendanceRules).map(([s,u])=>{const f=s.replace(/([A-Z])/g," $1").replace(/^./,I=>I.toUpperCase()),$={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(E,{fullWidth:!0,size:"small",label:f,type:"time",value:u,onChange:I=>g(a=>({...a,setting:{...a.setting,attendanceRules:{...a.setting.attendanceRules,[s]:I.target.value}}})),helperText:$[s]},s)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(B,{variant:"outlined",onClick:T,children:"Cancel"}),l?e.jsx(B,{variant:"contained",onClick:y,children:"Save"}):e.jsx(B,{variant:"contained",onClick:A,children:"Add Branch"})]})]})},yt=async({companyinp:t,setisload:r})=>{const o=localStorage.getItem("emstoken");r(!0);try{const l=await W.post("/api/addcompany",{name:t.name,industry:t.industry},{headers:{Authorization:`Bearer ${o}`}});console.log("Query:",l),O.success(l.data.message,{autoClose:1200})}catch(l){console.log(l),l.response?O.warn(l.response.data.message,{autoClose:1200}):l.request?console.error("No response from server:",l.request):console.error("Error:",l.message)}finally{r(!1)}},Z={1:"Read",2:"Create",3:"Update",4:"Delete"},je=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],re={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},bt={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function jt(){const[t,r]=v.useState([]),[o,l]=v.useState([]),[i,c]=v.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...re}});v.useEffect(()=>{u()},[]);const d=v.useRef(null),{handleImage:g}=Ee(),[M,S]=v.useState(null),[N,p]=v.useState(!1),[b,T]=v.useState(""),[w,C]=v.useState(null),A=n=>{C(m=>m===n?null:n)},y=()=>{c({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...re}}),T(""),S(null),p(!1)},s=async()=>{const n={...i},m=new FormData;l(!0);try{const x=n.profileImage?await g(300,n.profileImage):null;x&&m.append("photo",x),m.append("name",n.name),m.append("email",n.email),m.append("role",n.role),m.append("password",n.password),m.append("permissions",JSON.stringify(n.permissions));const L=localStorage.getItem("emstoken");l(!0);const z=M!==null?`/api/editAdmin/${t[M]._id}`:"/api/addAdmin",_=await W["post"](z,m,{headers:{Authorization:`Bearer ${L}`,"Content-Type":"multipart/form-data"}});O.success(_.data.message,{autoClose:1200}),y(),u()}catch(x){console.error(x),x.response?O.warn(x.response.data.message,{autoClose:1200}):O.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},u=async()=>{try{const n=localStorage.getItem("emstoken"),m=await W.get("/api/getAdmin",{headers:{Authorization:`Bearer ${n}`}});console.log(m.data),r(m.data)}catch(n){console.error(n),n.response?O.warn(n.response.data.message,{autoClose:1200}):O.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},f=n=>{const m=t[n];c({...m,profilePreview:m.profileImage||"",profileImage:null}),S(n),p(!0)},$=n=>{const m=t.filter((x,L)=>L!==n);r(m)},I=(n,m)=>{c(x=>{const L=x.permissions[n]||[],H=L.includes(m)?L.filter(_=>_!==m):[...L,m].sort();return{...x,permissions:{...x.permissions,[n]:H}}})},a=n=>{const m=n==="admin"?{...re}:{...bt};c({...i,role:n,permissions:m})},j=n=>{const m=n.target.files[0];m&&c(x=>({...x,profileImage:m,profilePreview:URL.createObjectURL(m)}))},k=()=>{b&&(c(n=>({...n,permissions:{...n.permissions,[b]:[]}})),T(""))},h=Array.from(new Set([...i.role==="admin"?je:Object.keys(i.permissions),...Object.keys(i.permissions)])),P=je.filter(n=>!h.includes(n));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-2",children:[e.jsxs("div",{className:"flex justify-between flex-wrap items-center mb-4",children:[e.jsx("h2",{className:"text-[16px] mb-2 md:mb-0 md:text-xl font-semibold",children:"Admin/Manager Management"}),e.jsx(B,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{y(),p(!0)},children:"Add Admin/ Manager"})]}),t.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:t.map((n,m)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{sx:{width:60,height:60},alt:n.name,src:n==null?void 0:n.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[n.name," (",n.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:n.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"p-2 border rounded hover:bg-gray-100",onClick:()=>f(m),children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>$(m),children:e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>A(m),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",w===m?"Hide Permissions":"View Permissions "]}),w===m?e.jsx(R,{className:"text-xl"}):e.jsx(F,{className:"text-xl"})]}),w===m&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(Z).map(x=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:x},x))]})}),e.jsx("tbody",{children:Object.entries(n.permissions).map(([x,L])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:x}),Object.keys(Z).map(z=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:L.includes(Number(z))?"✅":"-"},z))]},x))})]})]})]})]},m))})]}),e.jsx(Me,{open:N,onClose:()=>p(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:s,children:[e.jsxs("div",{className:"modalhead",children:[" ",M!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-[500px]",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:j,ref:d,accept:"image/*",name:"",id:"fileInput"}),e.jsx(Y,{sx:{width:70,height:70},alt:i.name,src:i.profilePreview}),e.jsx("span",{onClick:()=>d.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(Oe,{size:18})})]}),e.jsx(E,{fullWidth:!0,required:!0,value:i.name,onChange:n=>c({...i,name:n.target.value}),label:"Name",size:"small"}),e.jsx(E,{fullWidth:!0,required:!0,value:i.email,onChange:n=>c({...i,email:n.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),e.jsx(E,{fullWidth:!0,required:!0,value:i.password,type:"password",onChange:n=>c({...i,password:n.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:i.role,onChange:n=>a(n.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),i.role==="manager"&&e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"border p-2 rounded w-full",value:b,onChange:n=>T(n.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),P.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(B,{variant:"contained",onClick:k,children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(Z).map(([n,m])=>e.jsx("th",{className:"border p-2 text-center",children:m},n))]})}),e.jsx("tbody",{children:h.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:n}),Object.keys(Z).map(m=>{var x;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((x=i.permissions[n])==null?void 0:x.includes(Number(m)))||!1,onChange:()=>I(n,Number(m))})},m)})]},n))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(B,{variant:"outlined",onClick:y,children:"Cancel"}),e.jsx(B,{variant:"contained",onClick:s,loading:o,children:M!==null?"Update":"Create"})]})]})})})]})}const ve=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function Gt(){const[t,r]=v.useState(null),[o,l]=v.useState(!1),[i,c]=v.useState(!1),[d,g]=v.useState(!1),{handleImage:M}=Ee(),[S,N]=v.useState(null),[p,b]=v.useState({name:"",industry:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),T=ke(),{employee:w,company:C,branch:A,profile:y}=Se(a=>a.user),s=a=>{r(j=>j===a?null:a)};v.useEffect(()=>{C&&b(C)},[C]);const u=(a,j,k)=>{b(h=>({...h,[a]:{...h[a],[j]:k}}))},f=async()=>{try{g(!0);const a=localStorage.getItem("emstoken"),j=await W.post("/api/updateCompany",{...p},{headers:{Authorization:`Bearer ${a}`}});T(ne()),O.success(j.data.message,{autoClose:1800})}catch(a){console.log(a),a.response?O.warn(a.response.data.message,{autoClose:2700}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}finally{g(!1)}},$=()=>{},I=a=>{var k;l(!0);const j={...a,managerIds:(k=a==null?void 0:a.managerIds)==null?void 0:k.map(h=>h._id)};N(j),c(!0)};return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(y==null?void 0:y.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-blue-100 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),t==="company"?e.jsx(R,{className:"text-xl"}):e.jsx(F,{className:"text-xl"})]}),t==="company"&&e.jsxs("div",{className:"p-4 rounded flex flex-col md:flex-row items-center border-blue-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[e.jsx("img",{src:(p==null?void 0:p.logo)||e.jsx(He,{}),alt:"Company Logo",className:"w-full h-full object-fill rounded-2xl border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async a=>{const j=a.target.files[0];if(!j)return;const k=await M(200,j),h=new FormData;h.append("_id",p._id),h.append("logo",k);try{console.log("api calling"),g(!0);const P=localStorage.getItem("emstoken"),m=(await W.post("/api/updateCompany",h,{headers:{Authorization:`Bearer ${P}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;b(x=>({...x,logo:m})),O.success("Logo uploaded successfully!")}catch(P){console.error(P),O.error("Failed to upload logo.")}finally{g(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Company Name"}),e.jsx("input",{type:"text",onChange:a=>b({...p,name:a.target.value}),value:p.name,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Industry"}),e.jsx("input",{type:"text",onChange:a=>b({...p,industry:a.target.value}),value:p.industry,className:"w-full border rounded px-3 py-2"})]}),C?e.jsx(B,{variant:"contained",loading:d,onClick:f,children:"Save Changes"}):e.jsx(B,{loading:d,variant:"contained",onClick:()=>yt({companyinp:p,setisload:g}),children:"+ Create Company"})]})]})]}),((y==null?void 0:y.role)=="superadmin"||(y==null?void 0:y.role)=="admin")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-100 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),t==="branches"?e.jsx(R,{className:"text-xl"}):e.jsx(F,{className:"text-xl"})]}),t==="branches"&&e.jsxs("div",{className:"p-1 md:p-4 rounded overflow-auto  border-green-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-md font-medium",children:"Branch List"}),e.jsx(B,{variant:"contained",onClick:()=>c(!0),children:"+ Add Branch"})]}),e.jsxs("table",{className:"w-full capitalize text-[12px] md:text-sm border",children:[e.jsx("thead",{className:"bg-green-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Name"}),e.jsx("th",{className:"p-2 border",children:"Location"}),e.jsx("th",{className:"p-2 border",children:"Manager(s)"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsxs("tbody",{children:[A&&A.map((a,j)=>{var k;return e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 border",children:a.name}),e.jsx("td",{className:"p-2 border",children:a.location}),e.jsx("td",{className:"p-2 border capitalize",children:e.jsx("div",{className:"flex flex-col gap-2",children:(k=a==null?void 0:a.managerIds)==null?void 0:k.map((h,P)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>$(h.userid),children:[e.jsx(Y,{src:h==null?void 0:h.profileImage,alt:h.name,children:!(h!=null&&h.profileImage)&&e.jsx(Te,{})}),e.jsx("span",{children:h.name})]},P))})}),e.jsx("td",{className:"p-2 border ",children:e.jsxs("div",{className:"flex gap-2 w-[180px]",children:[e.jsx(B,{variant:"contained",className:"mr-2",onClick:()=>I(a),children:"Edit"}),e.jsx(B,{variant:"contained",className:"ml-2",disabled:!0,onClick:()=>I(a),children:"Delete"})]})})]},j)}),!A&&e.jsx("div",{children:"No branch Found"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),t==="department"?e.jsx(R,{className:"text-xl"}):e.jsx(F,{className:"text-xl"})]}),t==="department"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 space-y-4",children:e.jsx(Ve,{})})]}),(y==null?void 0:y.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),t==="admin"?e.jsx(R,{className:"text-xl"}):e.jsx(F,{className:"text-xl"})]}),t==="admin"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 ",children:e.jsx(jt,{})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-100 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),t==="attendance"?e.jsx(R,{className:"text-xl"}):e.jsx(F,{className:"text-xl"})]}),t==="attendance"&&C&&e.jsxs(ae,{className:" border-yellow-300  border-2 border-dashed rounded mt-1 p-2 ",children:[e.jsxs(ae,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(E,{label:"Office Time In",fullWidth:!0,type:"time",value:p.officeTime.in,onChange:a=>u("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(E,{label:"Office Time Out",fullWidth:!0,type:"time",value:p.officeTime.out,onChange:a=>u("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(E,{label:"Break Minutes",fullWidth:!0,type:"number",value:p.officeTime.breakMinutes,onChange:a=>u("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(E,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:p.workingMinutes.fullDay,onChange:a=>u("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(E,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:p.workingMinutes.halfDay,onChange:a=>u("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(E,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:p.workingMinutes.shortDayThreshold,onChange:a=>u("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(E,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:p.workingMinutes.overtimeAfterMinutes,onChange:a=>u("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(le,{fullWidth:!0,children:[e.jsx(oe,{children:"Weekly Offs"}),e.jsx(ie,{multiple:!0,value:p.weeklyOffs,onChange:a=>b({...p,weeklyOffs:a.target.value}),input:e.jsx(ce,{label:"Weekly Offs"}),renderValue:a=>a.map(j=>{var k;return(k=ve.find(h=>h.value===j))==null?void 0:k.label}).join(", "),children:ve.map(a=>e.jsxs(de,{value:a.value,children:[e.jsx(K,{checked:p.weeklyOffs.includes(a.value)}),e.jsx(me,{primary:a.label})]},a.value))})]}),Object.entries(p.attendanceRules).map(([a,j])=>{const k=a.replace(/([A-Z])/g," $1").replace(/^./,P=>P.toUpperCase()),h={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(E,{fullWidth:!0,label:k,type:"time",value:j,onChange:P=>u("attendanceRules",a,P.target.value),helperText:h[a]},a)})]}),e.jsx(ae,{sx:{mt:4,textAlign:"right"},children:e.jsx(B,{variant:"contained",onClick:f,children:"Update Settings"})})]})]}),e.jsx(Me,{open:i,onClose:()=>{c(!1),N(null),l(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsx(gt,{setopenviewmodal:c,editbranchdata:S,editbranch:o,company:C,employee:w})})})]})}export{Gt as default};
