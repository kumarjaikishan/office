import{r as o,j as e,X as T,Q as R,V as ee,W as V,b as E,y as c}from"./index-BnPnHAWO.js";import{M as se}from"./Modalbox-C6mxA1ov.js";import{T as O}from"./TextField-DicE64Wz.js";import{B as u}from"./Button-Bcz6Kzi9.js";import{I as z}from"./IconButton-RFDh2tiM.js";import{M as _}from"./MenuItem-BwsEWOD5.js";import"./Select-B4fkvyty.js";import"./createSimplePaletteValueFilter-CV2aCUyM.js";import"./useSlotProps-BT0rsFT6.js";import"./ButtonBase-lQW-ETfK.js";const ue=()=>{const[v,A]=o.useState([]),[D,p]=o.useState(!1),[b,W]=o.useState(null),[w,M]=o.useState(null),[i,f]=o.useState({roleid:"",modules:{}}),[m,I]=o.useState(""),[x,g]=o.useState(null),[y,$]=o.useState(""),[B,L]=o.useState(null),[C,S]=o.useState(""),r=x,N={1:"Read",2:"Create",3:"Update",4:"Delete"},U=["teal","blue","yellow","red"],k=async()=>{var s,t,l,a;try{const d=localStorage.getItem("emstoken"),n=await E.get("/api/permission",{headers:{Authorization:`Bearer ${d}`}});A((s=n.data)==null?void 0:s.permission),g((t=n.data.permissionnames)==null?void 0:t.AllPermissionNames)}catch(d){console.log(d),c.warn(((a=(l=d.response)==null?void 0:l.data)==null?void 0:a.message)||"Error",{autoClose:3e3})}};o.useEffect(()=>{k()},[]);const F=s=>{W(t=>t===s?null:s)},Q=s=>{M(s);const t=Object.fromEntries(Object.entries(s.modules||{}).filter(([l])=>r==null?void 0:r.includes(l)));f({roleid:s._id,modules:{...t}}),p(!0)},X=(s,t)=>{f(l=>{const a=l.modules[s]||[],n=a.includes(t)?a.filter(j=>j!==t):[...a,t].sort();return{...l,modules:{...l.modules,[s]:n}}})},h=r==null?void 0:r.filter(s=>!Object.prototype.hasOwnProperty.call(i.modules,s)),q=()=>{if(!m){c.warn("Please select a module to add");return}if(!(r!=null&&r.includes(m))){c.warn("Invalid module (not allowed)");return}if(i.modules[m]){c.warn("Module already exists");return}f(s=>({...s,modules:{...s.modules,[m]:[]}})),I("")},G=s=>{const t={...i.modules};delete t[s],f(l=>({...l,modules:t}))},H=async()=>{var s,t;try{const l=Object.fromEntries(Object.entries(i.modules).filter(([n,j])=>(r==null?void 0:r.includes(n))&&j.length>0).map(([n,j])=>[n,[...new Set(j)].sort()])),a=localStorage.getItem("emstoken"),d=await E.put(`/api/permission/${i.roleid}`,{modules:l},{headers:{Authorization:`Bearer ${a}`}});c.success(d.data.message||"Updated successfully",{autoClose:2e3}),p(!1),M(null),k()}catch(l){console.log(l),c.warn(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Update failed",{autoClose:3e3})}},J=()=>{p(!1),M(null)},Y=()=>{if(y.trim()){if(x.includes(y))return alert("Already exists!");g([...x,y.trim()]),$("")}},Z=s=>{const t=[...x];t.splice(s,1),g(t)},K=s=>{if(!C.trim())return;const t=[...x];t[s]=C.trim(),g(t),L(null),S("")},P=async()=>{var s,t;try{const l=localStorage.getItem("emstoken"),a=await E.put("/api/saveModule",{modules:x},{headers:{Authorization:`Bearer ${l}`}});c.success(a.data.message||"Updated successfully",{autoClose:2e3}),k()}catch(l){console.log(l),c.warn(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Update failed",{autoClose:3e3})}};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex w-full my-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>F("module"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Permission Modules"}),b==="module"?e.jsx(T,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),b==="module"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(O,{size:"small",label:"New Module",value:y,onChange:s=>$(s.target.value)}),e.jsx(u,{variant:"contained",onClick:Y,children:"Add"}),e.jsx(u,{variant:"contained",onClick:P,children:"Save Module"})]}),e.jsxs("table",{className:"min-w-full border text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),e.jsx("th",{className:"border p-2 text-center",children:"Action"})]})}),e.jsx("tbody",{children:x.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-1 capitalize",children:B===t?e.jsx(O,{size:"small",value:C,onChange:l=>S(l.target.value)}):s}),e.jsx("td",{className:"border p-1 text-center",children:B===t?e.jsx(u,{variant:"contained",size:"small",onClick:()=>K(t),children:"Save"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{color:"primary",onClick:()=>{L(t),S(s)},children:e.jsx(ee,{})}),e.jsx(z,{color:"error",onClick:()=>Z(t),children:e.jsx(V,{})})]})})]},t))})]})]})]}),e.jsx("div",{className:"flex flex-col",children:v==null?void 0:v.map((s,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:`flex w-full my-2 justify-between items-center cursor-pointer bg-${U[t%U.length]}-100 px-4 py-2 rounded-md`,onClick:()=>F(s.role),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:s.role}),b===`${s.role}`?e.jsx(T,{className:"text-xl"}):e.jsx(R,{className:"text-xl"})]}),b===`${s.role}`&&e.jsxs("div",{className:"p-1 rounded border-teal-300 border-2 border-dashed mt-2",children:[e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(u,{variant:"contained",onClick:()=>Q(s),sx:{mr:2},children:"Edit"})}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(N).map(l=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:l},l))]})}),e.jsx("tbody",{children:Object.entries(s.modules).map(([l,a])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:l}),Object.keys(N).map(d=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:a.includes(Number(d))?"âœ…":"-"},d))]},l))})]})]})]},s._id))}),e.jsx(se,{open:D,onClose:()=>p(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{action:"",children:[e.jsxs("h2",{className:"font-bold text-lg mb-3",children:["Edit Permission - ",w==null?void 0:w.role]}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex gap-2 mb-3 items-center",children:[e.jsx(O,{select:!0,size:"small",label:"Add Module",value:m,onChange:s=>I(s.target.value),sx:{minWidth:200},children:(h==null?void 0:h.length)===0?e.jsx(_,{disabled:!0,value:"",children:"No modules available"}):h==null?void 0:h.map(s=>e.jsx(_,{value:s,className:"capitalize",children:s},s))}),e.jsx(u,{variant:"contained",onClick:q,disabled:!m,children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(N).map(([s,t])=>e.jsx("th",{className:"border p-2 text-center",children:t},s)),e.jsx("th",{className:"border p-2 text-center",children:"Action"})]})}),e.jsx("tbody",{children:Object.keys(i.modules).sort((s,t)=>(r==null?void 0:r.indexOf(s))-(r==null?void 0:r.indexOf(t))).map(s=>{const t=i.modules[s]||[];return e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:s}),Object.keys(N).map(l=>e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:"h-3 w-3 md:h-5 md:w-5 cursor-pointer",type:"checkbox",checked:t.includes(Number(l)),onChange:()=>X(s,Number(l))})},l)),e.jsx("td",{className:"border text-center",children:e.jsx(z,{color:"error",size:"small",onClick:()=>G(s),children:e.jsx(V,{})})})]},s)})})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(u,{variant:"outlined",onClick:J,children:"Cancel"}),e.jsx(u,{variant:"contained",onClick:H,children:"Save"})]})]})]})})})]})};export{ue as default};
