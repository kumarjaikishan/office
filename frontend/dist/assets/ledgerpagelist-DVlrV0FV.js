import{r,a as Q,f as W,b as f,y as l,j as t,at as H,A as z,au as K,V as q,W as G,K as J}from"./index-BnPnHAWO.js";import{u as X}from"./imageresizer-D4I-KFLq.js";import{a as Y}from"./index-C-R_0VJA.js";import{M as Z}from"./Modalbox-C6mxA1ov.js";import{L as ee}from"./loader-BxMJDeY2.js";import{T as A}from"./TextField-DicE64Wz.js";import{I as te}from"./InputAdornment-CqRqdav4.js";import{B as y}from"./Button-Bcz6Kzi9.js";import{I as ae}from"./IconButton-RFDh2tiM.js";import{e as se}from"./Select-B4fkvyty.js";import{M as b}from"./MenuItem-BwsEWOD5.js";import"./createSimplePaletteValueFilter-CV2aCUyM.js";import"./Typography-BZIt85P4.js";import"./ButtonBase-lQW-ETfK.js";import"./useSlotProps-BT0rsFT6.js";const Le=()=>{const[i,F]=r.useState([]),[d,j]=r.useState([]),[c,O]=r.useState(""),P=Q(),{ledger:B}=W(e=>e.user),[m,C]=r.useState(null),[w,L]=r.useState(""),[D,p]=r.useState(!1),[o,N]=r.useState(null),{handleImage:R}=X(),[I,g]=r.useState(!1),u={Authorization:`Bearer ${localStorage.getItem("emstoken")}`},[S,E]=r.useState(null),U=!!S,T=e=>{e.stopPropagation(),E(e.currentTarget)},h=e=>{e==null||e.stopPropagation(),E(null)};r.useEffect(()=>{v()},[B]),r.useEffect(()=>{if(!(i.length<1))if(c.trim()==="")j(i);else{const e=c.toLowerCase();j(i.filter(a=>a.name.toLowerCase().includes(e)))}},[c,i]);const v=async()=>{var e,a;g(!0);try{const s=await f.get("/api/ledger",{headers:u});F(s.data.ledgers),j(s.data.ledgers)}catch(s){console.log(s.response),l.warning(((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch ledgers")}finally{g(!1)}},M=(e=null)=>{e?(L(e.name),C(e._id),N(e.profileImage||null)):(L(""),C(null),N(null)),p(!0)},V=async()=>{var s,n;const e=w.trim();if(!e)return l.warn("Ledger name can't be empty");if(e.length<3)return l.warn("Ledger name must be at least 3 characters");const a=new FormData;if(a.append("name",e),o instanceof File){let x=await R(170,o);a.append("image",x)}try{g(!0),m?(await f.put(`/api/ledger/${m}`,a,{headers:{...u,"Content-Type":"multipart/form-data"}}),l.success("Ledger updated")):(await f.post("/api/ledger",a,{headers:{...u,"Content-Type":"multipart/form-data"}}),l.success("Ledger created")),p(!1),v()}catch(x){console.error(x),l.warning(((n=(s=x.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to save ledger")}finally{g(!1)}},_=async e=>{swal({title:`Are you sure to Delete ${e.name}'s Ledger?`,icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{await f.delete(`/api/ledger/${e._id}`,{headers:u}),l.success("Ledger deleted"),v()}catch(s){console.log(s),l.error("Failed to delete ledger")}})},k=e=>{if(e){let a=`./${e._id}?name=${encodeURIComponent(e.name)}`;return e.profileImage&&(a+=`&profileimage=${encodeURIComponent(e.profileImage)}`),P(a)}},$=r.useRef(null);return t.jsxs("div",{className:"w-full bg-white rounded",children:[t.jsxs("div",{className:"p-1 md:p-4 py-4 mb-4",children:[t.jsxs("div",{className:"flex mb-4 gap-2 flex-wrap justify-between",children:[t.jsx(A,{size:"small",label:"Search Ledger",className:"w-full md:w-[200px]",value:c,onChange:e=>O(e.target.value),InputProps:{startAdornment:t.jsx(te,{position:"start",children:t.jsx(H,{className:"text-gray-500"})})}}),t.jsx(y,{className:"w-full md:w-[200px]",variant:"contained",onClick:()=>M(),children:"Add Ledger"})]}),I?t.jsx(ee,{}):t.jsx("div",{className:"w-full p-1 md:p-3",children:t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4",children:[d.map((e,a)=>{var s;return t.jsxs("div",{onClick:()=>k(e),className:"relative cursor-pointer overflow-hidden rounded-xl shadow-lg hover:shadow-xl transition-all pl-3 pr-1 py-3 bg-gray-50",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex gap-1 items-center",children:[t.jsx(z,{sx:{width:35,height:35},alt:e.name,src:e.profileImage}),t.jsx("div",{className:"text-[14px] md:text-[16px] font-semibold text-gray-800 mb-2 capitalize",children:e.name})]}),t.jsx(ae,{onClick:T,size:"small",children:t.jsx(Y,{className:"text-gray-700"})}),t.jsxs(se,{anchorEl:S,open:U,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{elevation:1},children:[t.jsxs(b,{onClick:n=>{n.stopPropagation(),h(),k(e)},children:[t.jsx(K,{className:"text-teal-600 mr-2"})," See"]}),t.jsxs(b,{onClick:n=>{n.stopPropagation(),h(),M(e)},children:[t.jsx(q,{className:"text-blue-600 mr-2"})," Edit"]}),t.jsxs(b,{onClick:n=>{n.stopPropagation(),h(),_(e)},children:[t.jsx(G,{className:"text-red-600 mr-2"})," Delete"]})]})]}),t.jsxs("p",{className:`text-[16px] md:text-lg mr-1 text-end font-medium ${e.netBalance>=0?"text-green-600":"text-red-600"}`,children:["â‚¹ ",(s=e==null?void 0:e.netBalance)==null?void 0:s.toLocaleString()]}),t.jsx("span",{className:"w-[4px] h-full absolute left-0 top-0 bg-teal-700"})]},a)}),(d==null?void 0:d.length)<1&&t.jsx("div",{className:"w-full text-center ",children:"No Ledger found"})]})})]}),t.jsx(Z,{open:D,onClose:()=>{p(!1)},children:t.jsx("div",{className:"membermodal w-[300px]",children:t.jsxs("div",{className:"whole",children:[t.jsx("div",{className:"modalhead",children:m?"Edit Ledger":"Add Ledger"}),t.jsxs("span",{className:"modalcontent ",children:[t.jsx(A,{autoFocus:!0,size:"small",fullWidth:!0,margin:"dense",label:"Ledger Name",value:w,onChange:e=>L(e.target.value)}),t.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[t.jsx("input",{style:{display:"none"},type:"file",onChange:e=>N(e.target.files[0]),ref:$,accept:"image/*",id:"fileInput"}),t.jsx(z,{sx:{width:80,height:80},alt:w,src:o?o instanceof File?URL.createObjectURL(o):o:""}),t.jsx("span",{onClick:()=>$.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:t.jsx(J,{size:18})})]})]}),t.jsxs("div",{className:"modalfooter",children:[t.jsx(y,{variant:"outlined",onClick:()=>p(!1),children:"Cancel"}),t.jsx(y,{disabled:I,variant:"contained",onClick:V,children:m?"Update":"Create"})]})]})})})]})};export{Le as default};
