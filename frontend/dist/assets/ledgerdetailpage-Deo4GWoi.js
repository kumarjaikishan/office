import{g as b,j as e,V as oe,W as ie,ao as de,av as ce,a as me,r as i,b as E,y as m,A as ue,C as O,aw as pe}from"./index-BnPnHAWO.js";import{b as xe}from"./index-lZ454AWK.js";import{X as he}from"./index.es-D0Cu--to.js";import{M as ge}from"./Modalbox-C6mxA1ov.js";import{u as be}from"./attandencehelper-DbcSdLjK.js";import{L as fe}from"./loader-BxMJDeY2.js";import{B as g}from"./Button-Bcz6Kzi9.js";import{F as $,I as T,S as U,O as V}from"./Select-B4fkvyty.js";import{M as k}from"./MenuItem-BwsEWOD5.js";import{I as _}from"./InputAdornment-CqRqdav4.js";import{T as v}from"./TextField-DicE64Wz.js";import"./createSimplePaletteValueFilter-CV2aCUyM.js";import"./ButtonBase-lQW-ETfK.js";import"./useSlotProps-BT0rsFT6.js";import"./Typography-BZIt85P4.js";const je=(u,p)=>[{name:"S.No",selector:(r,I)=>I+1,width:"60px"},{name:"Date",selector:r=>b(r.date).format("DD MMM, YYYY"),sortable:!0},{name:"Particular",selector:r=>r.particular},{name:"Debit",selector:r=>parseFloat(r.debit)===0?"":r.debit,width:"90px"},{name:"Credit",selector:r=>parseFloat(r.credit)===0?"":r.credit,width:"90px"},{name:"Balance",selector:r=>r.balance},{name:"Actions",cell:r=>e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit Entry",onClick:()=>u(r),style:{cursor:"pointer",marginRight:10}}),e.jsx(ie,{className:"delete text-[18px] text-red-500 cursor-pointer",title:"Delete Entry",onClick:()=>p(r._id),style:{cursor:"pointer"}})]}),width:"120px"}],A=({label:u,value:p})=>{const r=parseFloat(p)<0;return e.jsxs("div",{className:"bg-teal-50 border border-teal-300 border-dashed rounded-md px-4 py-2 min-w-[150px] text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:u}),e.jsx("hr",{className:"my-2 border-teal-200"}),e.jsxs("p",{className:`text-lg font-semibold ${r?"text-red-600":"text-black"}`,children:[p," â‚¹"]})]})},Re=()=>{const{id:u}=de(),[p]=ce(),r=me(),[I,L]=i.useState(!1),P=p.get("name"),W=decodeURIComponent(p.get("profileimage")),[w,X]=i.useState([]),[y,H]=i.useState([]),[C,R]=i.useState("all"),[N,z]=i.useState("all"),[S,B]=i.useState(""),[q,G]=i.useState(0),[J,K]=i.useState(0),[Q,Z]=i.useState(0),F={date:b().format("YYYY-MM-DD"),particular:"",debit:"",credit:""},[n,x]=i.useState(F),[ee,f]=i.useState(!1),[D,j]=i.useState(null),M={Authorization:`Bearer ${localStorage.getItem("emstoken")}`};i.useEffect(()=>{Y()},[u]),i.useEffect(()=>{if(!w)return;const t=w.filter(a=>{const o=b(a.date),l=C!=="all"?o.year()===Number(C):!0,h=N!=="all"?o.month()+1===Number(N):!0,ne=S?o.isSame(S,"day"):!0;return l&&h&&ne});H(t);const s=t.reduce((a,o)=>a+(o.debit||0),0),d=t.reduce((a,o)=>a+(o.credit||0),0),c=s-d;G(s),K(d),Z(c)},[w,C,N,S]);const Y=async()=>{var t;L(!0);try{const s=await E.get(`/api/entries/${u}`,{headers:M});X((t=s.data)==null?void 0:t.entries)}catch(s){console.log(s),m.error(s.response.data.message)}finally{L(!1)}},te=()=>{R("all"),z("all"),B("")},ae=async t=>{swal({title:"Are you sure to Delete this entry?",text:"Once deleted, you will not be able to recover this",icon:"warning",buttons:!0,dangerMode:!0}).then(async s=>{var d,c;if(s)try{let a=await E.delete(`/api/ledgerentry/${t}`,{headers:M});m.success(a.data.message),Y()}catch(a){console.log(a),m.warning(((c=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:c.message)||(a==null?void 0:a.message)||"Error deleting entry")}})},se=()=>{const t=["S.No","Date","Particular","Debit","Credit","Balance"],s=y.map((l,h)=>[h+1,b(l.date).format("YYYY-MM-DD"),l.particular,l.debit,l.credit,l.balance]),d=[t,...s].map(l=>l.join(",")).join(`
`),c=new Blob([d],{type:"text/csv"}),a=URL.createObjectURL(c),o=document.createElement("a");o.href=a,o.download=`${P}_ledger.csv`,o.click(),URL.revokeObjectURL(a)},re=async()=>{var a,o;if(!n.particular||n.particular.trim()===""){m.warn("Particular field can't be blank");return}const t=(a=n.debit)==null?void 0:a.toString().trim(),s=(o=n.credit)==null?void 0:o.toString().trim();if(t===""&&s===""){m.warn("At least one value needed: Debit or Credit");return}const d=parseFloat(t||0),c=parseFloat(s||0);if(d&&c){m.warn("Only one of Debit or Credit is allowed");return}try{const l={...n,date:new Date(n.date),ledgerId:u,debit:d||0,credit:c||0};let h;D!==null?(h=await E.put(`/api/ledgerentry/${D}`,l,{headers:M}),j(null)):h=await E.post("/api/ledgerentry",l,{headers:M}),m.success(h.data.message),f(!1),x(F),Y()}catch(l){console.log(l),m.warning(l.response.data.message)}},le=t=>{var d,c;const s=new Date(t.date).toISOString().split("T")[0];x({date:s,particular:t.particular,debit:((d=t.debit)==null?void 0:d.toString())||"",credit:((c=t.credit)==null?void 0:c.toString())||""}),j(t._id),f(!0)};return e.jsxs("div",{className:"bg-white rounded shadow-md p-1 md:p-5 relative ",children:[e.jsxs("div",{className:"border border-teal-600 border-dashed rounded-md p-3 md:p-5 mb-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-start md:items-center",children:[e.jsxs("div",{className:"flex items-start md:items-center  gap-3",children:[e.jsx(ue,{sx:{width:55,height:55},alt:P,src:W}),e.jsx("h2",{className:"text-2xl font-semibold text-teal-700 capitalize",children:P})]}),e.jsx(g,{className:" w-full md:w-auto",onClick:()=>r(-1),variant:"contained",children:"Ledger Page"})]}),I?e.jsx(fe,{}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(A,{label:"Total Debit",value:q}),e.jsx(A,{label:"Total Credit",value:J}),e.jsx(A,{label:"Net Balance",value:Q.toFixed(2)})]})]}),e.jsxs("div",{className:"flex  flex-wrap items-center gap-3 mb-4",children:[e.jsxs("div",{className:"p-1 md:p-2 rounded shadow mb-4 md:mb-0 grid grid-cols-2 md:grid-cols-none md:flex gap-3 md:gap-2 mt-1 w-full  md:w-fit",children:[e.jsxs($,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx(T,{children:"Year"}),e.jsxs(U,{value:C,input:e.jsx(V,{startAdornment:e.jsx(_,{position:"start",children:e.jsx(O,{fontSize:"small"})}),label:"Year"}),onChange:t=>R(t.target.value),children:[e.jsx(k,{value:"all",children:"All"}),[...new Set(w.map(t=>b(t.date).year()))].map(t=>e.jsx(k,{value:t,children:t},t))]})]}),e.jsxs($,{size:"small",className:"col-span-1 md:w-[120px]",children:[e.jsx(T,{children:"Month"}),e.jsxs(U,{value:N,input:e.jsx(V,{startAdornment:e.jsx(_,{position:"start",children:e.jsx(O,{fontSize:"small"})}),label:"Month"}),onChange:t=>z(t.target.value),children:[e.jsx(k,{value:"all",children:"All"}),Array.from({length:12},(t,s)=>e.jsx(k,{value:s+1,children:b().month(s).format("MMMM")},s))]})]}),e.jsx(v,{size:"small",type:"date",className:"col-span-1  md:w-[160px]",value:S,onChange:t=>B(t.target.value),label:"Date",InputLabelProps:{shrink:!0}}),e.jsx(g,{className:"col-span-1  md:w-[120px]",variant:"outlined",color:"secondary",title:"Reset",startIcon:e.jsx(pe,{}),onClick:te,children:"Reset"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 ml-auto",children:[e.jsx(g,{variant:"contained",onClick:()=>{f(!0),j(null)},children:"Add Entry"}),e.jsx(g,{variant:"outlined",onClick:se,startIcon:e.jsx(xe,{}),children:"Export CSV"})]})]}),e.jsx("div",{className:" overflow-x-auto",children:e.jsx(he,{columns:je(le,ae),data:y||[],pagination:!0,customStyles:be(),highlightOnHover:!0,noDataComponent:"No entries found",paginationPerPage:10,paginationRowsPerPageOptions:[10,25,50,100,y.length>100?y.length:null].filter(Boolean),paginationComponentOptions:{rowsPerPageText:"Rows per page:"}})}),e.jsx(ge,{open:ee,onClose:()=>{f(!1),j(null)},children:e.jsx("div",{className:"membermodal w-[310px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:D!==null?"Edit Entry":"Add Entry"}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"flex  w-full flex-col gap-3",children:[e.jsx(v,{fullWidth:!0,type:"date",label:"Date",size:"small",InputLabelProps:{shrink:!0},value:n.date||"",onChange:t=>x({...n,date:t.target.value})}),e.jsx(v,{multiline:!0,minRows:2,label:"Particular",size:"small",value:n.particular||"",onChange:t=>x({...n,particular:t.target.value})}),e.jsx(v,{type:"number",label:"Debit",size:"small",value:n.debit||"",onChange:t=>x({...n,debit:t.target.value,credit:""})}),e.jsx(v,{type:"number",label:"Credit",size:"small",value:n.credit||"",onChange:t=>x({...n,credit:t.target.value,debit:""})})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(g,{variant:"outlined",onClick:()=>{f(!1),x(F),j(null)},children:"Cancel"}),e.jsx(g,{variant:"contained",onClick:re,children:D!==null?"Update":"Add"})]})]})})})]})};export{Re as default};
