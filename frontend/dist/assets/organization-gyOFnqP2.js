import{r as f,a7 as je,a8 as ve,a9 as ee,aa as we,ab as Ne,T as V,j as e,ac as Ce,ad as ke,ae as H,af as me,u as ie,g as xe,b as u,F as ae,I as te,S as le,M as Z,ag as J,A as G,k as fe,O as re,ah as Te,X as ne,B as I,c as z,y as b,l as _,ai as Me,V as Se,aj as Ae,a4 as R,a5 as U,a3 as oe,U as ge,a1 as Ee,ak as Ie,a0 as De,W as Oe}from"./index-DaRzpKky.js";import Pe from"./Department-Dm3lsAzQ.js";import{u as ye}from"./imageresizer-D4I-KFLq.js";import"./index-B097wrR_.js";const Be=d=>{const{classes:v,inset:k,primary:c,secondary:x,dense:g}=d;return Ce({root:["root",k&&"inset",g&&"dense",c&&x&&"multiline"],primary:["primary"],secondary:["secondary"]},ke,v)},Le=we("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(d,v)=>{const{ownerState:k}=d;return[{[`& .${H.primary}`]:v.primary},{[`& .${H.secondary}`]:v.secondary},v.root,k.inset&&v.inset,k.primary&&k.secondary&&v.multiline,k.dense&&v.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${me.root}:where(& .${H.primary})`]:{display:"block"},[`.${me.root}:where(& .${H.secondary})`]:{display:"block"},variants:[{props:({ownerState:d})=>d.primary&&d.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:d})=>d.inset,style:{paddingLeft:56}}]}),Q=f.forwardRef(function(v,k){const c=je({props:v,name:"MuiListItemText"}),{children:x,className:g,disableTypography:i=!1,inset:j=!1,primary:L,primaryTypographyProps:T,secondary:A,secondaryTypographyProps:r,slots:w={},slotProps:D={},...O}=c,{dense:N}=f.useContext(ve);let S=L??x,h=A;const s={...c,disableTypography:i,inset:j,primary:!!S,secondary:!!h,dense:N},n=Be(s),o={slots:w,slotProps:{primary:T,secondary:r,...D}},[C,E]=ee("root",{className:Ne(n.root,g),elementType:Le,externalForwardedProps:{...o,...O},ownerState:s,ref:k}),[P,a]=ee("primary",{className:n.primary,elementType:V,externalForwardedProps:o,ownerState:s}),[y,p]=ee("secondary",{className:n.secondary,elementType:V,externalForwardedProps:o,ownerState:s});return S!=null&&S.type!==V&&!i&&(S=e.jsx(P,{variant:N?"body2":"body1",component:a!=null&&a.variant?void 0:"span",...a,children:S})),h!=null&&h.type!==V&&!i&&(h=e.jsx(y,{variant:"body2",color:"textSecondary",...p,children:h})),e.jsxs(C,{...E,children:[S,h]})}),ue=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],We=({setopenviewmodal:d,employee:v,company:k,editbranch:c,editbranchdata:x})=>{const g={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[i,j]=f.useState(g),L=ie(),{adminManager:T}=xe(s=>s.user),[A,r]=f.useState([]),w=localStorage.getItem("emstoken");f.useEffect(()=>{j(s=>({...s,companyId:k._id})),c&&j(s=>({...s,...x}))},[k,c]),f.useEffect(()=>{(T==null?void 0:T.length)>0&&r(T.filter(s=>s.role==="manager"))},[T]);const D=()=>{d(!1),j(g)},O=(s,n)=>{j(o=>({...o,[s]:n}))},N=(s,n,o)=>{j(C=>({...C,setting:{...C.setting,[s]:{...C.setting[s],[n]:o}}}))},S=async()=>{var s,n;try{const o=await z.post("/api/addBranch",i,{headers:{Authorization:`Bearer ${w}`}});b.success(o.data.message),d(!1),L(_()),D()}catch(o){console.error(o),b.error(((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)||"Error adding branch")}},h=async()=>{var s,n;try{const o=await z.post("/api/editBranch",i,{headers:{Authorization:`Bearer ${w}`}});b.success(o.data.message),L(_()),d(!1),D()}catch(o){console.error(o),b.error(((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:c?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(u,{label:"Branch Name",fullWidth:!0,size:"small",value:i.name,onChange:s=>O("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(u,{label:"Location",fullWidth:!0,size:"small",value:i.location,onChange:s=>O("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(ae,{size:"small",fullWidth:!0,children:[e.jsx(te,{children:"Managers"}),e.jsx(le,{multiple:!0,value:(i==null?void 0:i.managerIds)||[],onChange:s=>O("managerIds",s.target.value),input:e.jsx(re,{label:"Managers"}),renderValue:s=>s.map(n=>{var o;return((o=A.find(C=>C._id===n))==null?void 0:o.name)||"Unknown"}).join(", "),children:A&&A.length>0?A.map(s=>{var n;return e.jsxs(Z,{value:s._id,children:[e.jsx(J,{checked:(n=i==null?void 0:i.managerIds)==null?void 0:n.includes(s._id)}),e.jsx(G,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!(s!=null&&s.profileImage)&&e.jsx(fe,{})}),e.jsx(Q,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)}):e.jsx(Z,{disabled:!0,value:"",children:e.jsx(Q,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(Te,{control:e.jsx(J,{checked:!i.defaultsetting,onChange:s=>j(n=>({...n,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!i.defaultsetting&&e.jsx("div",{className:"border-primary border-2 border-dashed rounded mt-3 py-3 px-1",children:e.jsxs(ne,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(u,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:i.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>N("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(u,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:i.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>N("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(u,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.officeTime.breakMinutes,onChange:s=>N("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(u,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.fullDay,onChange:s=>N("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(u,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.halfDay,onChange:s=>N("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(u,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.shortDayThreshold,onChange:s=>N("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(u,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:i.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>N("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(ae,{size:"small",fullWidth:!0,children:[e.jsx(te,{children:"Weekly Offs"}),e.jsx(le,{multiple:!0,value:i.setting.weeklyOffs,onChange:s=>j(n=>({...n,setting:{...n.setting,weeklyOffs:s.target.value}})),input:e.jsx(re,{label:"Weekly Offs"}),renderValue:s=>s.map(n=>{var o;return(o=ue.find(C=>C.value===n))==null?void 0:o.label}).join(", "),children:ue.map(s=>e.jsxs(Z,{value:s.value,children:[e.jsx(J,{checked:i.setting.weeklyOffs.includes(s.value)}),e.jsx(Q,{primary:s.label})]},s.value))})]}),Object.entries(i.setting.attendanceRules).map(([s,n])=>{const o=s.replace(/([A-Z])/g," $1").replace(/^./,E=>E.toUpperCase()),C={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(u,{fullWidth:!0,size:"small",label:o,type:"time",value:n,onChange:E=>j(P=>({...P,setting:{...P.setting,attendanceRules:{...P.setting.attendanceRules,[s]:E.target.value}}})),helperText:C[s]},s)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:D,children:"Cancel"}),c?e.jsx(I,{variant:"contained",onClick:h,children:"Save"}):e.jsx(I,{variant:"contained",onClick:S,children:"Add Branch"})]})]})},$e=async({companyinp:d,setisload:v})=>{const k=localStorage.getItem("emstoken");v(!0);try{const c=await z.post("/api/addcompany",{name:d.name,industry:d.industry},{headers:{Authorization:`Bearer ${k}`}});console.log("Query:",c),b.success(c.data.message,{autoClose:1200})}catch(c){console.log(c),c.response?b.warn(c.response.data.message,{autoClose:1200}):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{v(!1)}},X={1:"Read",2:"Create",3:"Update",4:"Delete"},he=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],se={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},ze={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function Fe(){const[d,v]=f.useState([]),[k,c]=f.useState([]),[x,g]=f.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...se}}),i=ie();f.useEffect(()=>{a()},[]);const j=f.useRef(null),{handleImage:L}=ye(),[T,A]=f.useState(null),[r,w]=f.useState(!1),[D,O]=f.useState(""),[N,S]=f.useState(!1),[h,s]=f.useState(null),n=t=>{s(l=>l===t?null:t)},o=()=>{g({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...se}}),O(""),A(null),w(!1)},[C,E]=f.useState({userid:"",pass:""}),P=async()=>{const t={...x},l=new FormData;c(!0);try{const m=t.profileImage?await L(300,t.profileImage):null;m&&l.append("photo",m),l.append("name",t.name),l.append("email",t.email),l.append("role",t.role),l.append("password",t.password),l.append("permissions",JSON.stringify(t.permissions));const B=localStorage.getItem("emstoken");c(!0);const $=T!==null?`/api/editAdmin/${d[T]._id}`:"/api/addAdmin",q=await z["post"]($,l,{headers:{Authorization:`Bearer ${B}`,"Content-Type":"multipart/form-data"}});b.success(q.data.message,{autoClose:1200}),o(),a(),i(_())}catch(m){console.error(m),m.response?b.warn(m.response.data.message,{autoClose:1200}):b.error("Something went wrong",{autoClose:1200})}finally{c(!1)}},a=async()=>{try{const t=localStorage.getItem("emstoken");c(!0);const l=await z.get("/api/getAdmin",{headers:{Authorization:`Bearer ${t}`}});v(l.data)}catch(t){console.error(t),t.response?b.warn(t.response.data.message,{autoClose:1200}):b.error("Something went wrong",{autoClose:1200})}finally{c(!1)}},y=t=>{const l=d[t];console.log(l),g({...l,profilePreview:l.profileImage||"",profileImage:null}),A(t),w(!0)},p=async t=>{t.preventDefault();try{const l=localStorage.getItem("emstoken"),m=await z.post("/api/updatepassword",{pass:C},{headers:{Authorization:`Bearer ${l}`}});E({userid:"",pass:""}),S(!1),b.success(m.data.message,{autoClose:1200})}catch(l){console.log(l),l.response?b.warn(l.response.data.message,{autoClose:1200}):l.request?console.error("No response from server:",l.request):console.error("Error:",l.message)}},M=async t=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async l=>{var m,B;if(l){let $;try{const F=localStorage.getItem("emstoken");c(!0),$=b.loading("Deleting...");const q=await z.delete(`/api/deleteAdmin/${t}`,{headers:{Authorization:`Bearer ${F}`}});b.update($,{render:q.data.message,type:"success",isLoading:!1,autoClose:1800}),a(),i(_())}catch(F){console.error(F),b.update($,{render:((B=(m=F.response)==null?void 0:m.data)==null?void 0:B.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{c(!1)}}})},W=(t,l)=>{g(m=>{const B=m.permissions[t]||[],F=B.includes(l)?B.filter(q=>q!==l):[...B,l].sort();return{...m,permissions:{...m.permissions,[t]:F}}})},de=t=>{const l=t==="admin"?{...se}:{...ze};g({...x,role:t,permissions:l})},Y=t=>{const l=t.target.files[0];l&&g(m=>({...m,profileImage:l,profilePreview:URL.createObjectURL(l)}))},K=()=>{D&&(g(t=>({...t,permissions:{...t.permissions,[D]:[]}})),O(""))},ce=Array.from(new Set([...x.role==="admin"?he:Object.keys(x.permissions),...Object.keys(x.permissions)])),be=he.filter(t=>!ce.includes(t));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:" shadow-md rounded-lg",children:[e.jsx("div",{className:"flex justify-between flex-wrap items-center mb-4",children:e.jsx(I,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{o(),w(!0)},children:"Add Admin/ Manager"})}),d.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:d.map((t,l)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{sx:{width:60,height:60},alt:t.name,src:t==null?void 0:t.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[t.name," (",t.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:t.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{title:"Edit",className:"p-2 border rounded hover:bg-gray-100",onClick:()=>y(l),children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx("button",{title:"Password Reset",className:"p-2 border rounded hover:bg-gray-100 text-green-500",onClick:()=>{E({...C,userid:t._id}),S(!0)},children:e.jsx(Se,{className:"h-4 w-4 "})}),e.jsx("button",{title:"Delete",className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>M(t._id),children:e.jsx(Ae,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>n(l),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",h===l?"Hide Permissions":"View Permissions "]}),h===l?e.jsx(R,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),h===l&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(X).map(m=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:m},m))]})}),e.jsx("tbody",{children:Object.entries(t.permissions).map(([m,B])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:m}),Object.keys(X).map($=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:B.includes(Number($))?"✅":"-"},$))]},m))})]})]})]})]},l))})]}),e.jsx(oe,{open:r,onClose:()=>w(!1),children:e.jsx("div",{className:"membermodal w-[660px]",children:e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"modalhead",children:[" ",T!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-full",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:Y,ref:j,accept:"image/*",name:"",id:"fileInput"}),e.jsx(G,{sx:{width:70,height:70},alt:x.name,src:x.profilePreview}),e.jsx("span",{onClick:()=>j.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(ge,{size:18})})]}),e.jsx(u,{fullWidth:!0,required:!0,value:x.name,onChange:t=>g({...x,name:t.target.value}),label:"Name",size:"small"}),e.jsx(u,{fullWidth:!0,required:!0,value:x.email,onChange:t=>g({...x,email:t.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),T==null&&e.jsxs(e.Fragment,{children:[e.jsx(u,{fullWidth:!0,required:!0,value:x.password,type:"password",onChange:t=>g({...x,password:t.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:x.role,onChange:t=>de(t.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]})]}),x.role==="manager"&&e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border p-2 flex-3 rounded ",value:D,onChange:t=>O(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),be.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(I,{variant:"contained",onClick:K,className:"flex-1",children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(X).map(([t,l])=>e.jsx("th",{className:"border p-2 text-center",children:l},t))]})}),e.jsx("tbody",{children:ce.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:t}),Object.keys(X).map(l=>{var m;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((m=x.permissions[t])==null?void 0:m.includes(Number(l)))||!1,onChange:()=>W(t,Number(l))})},l)})]},t))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(I,{variant:"outlined",onClick:o,children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:P,loading:k,children:T!==null?"Update":"Create"})]})]})})}),e.jsx(oe,{open:N,onClose:()=>{S(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:p,children:[e.jsx("h2",{children:"Reset Passowrd"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(u,{fullWidth:!0,inputProps:{minLength:3,maxLength:10},required:!0,value:C.pass,onChange:t=>E({...C,pass:t.target.value}),label:"Passowrd",size:"small"}),e.jsx(I,{variant:"contained",sx:{mr:2},type:"submit",children:"Reset Password"})]})]})})})]})}const pe=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function Ve(){const[d,v]=f.useState(null),[k,c]=f.useState(!1),[x,g]=f.useState(!1),[i,j]=f.useState(!1),{handleImage:L}=ye(),[T,A]=f.useState(null),[r,w]=f.useState({name:"",address:"",contact:"",fullname:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),D=ie(),{employee:O,company:N,branch:S,profile:h}=xe(a=>a.user),s=a=>{v(y=>y===a?null:a)};f.useEffect(()=>{N&&w(N)},[N]);const n=(a,y,p)=>{w(M=>({...M,[a]:{...M[a],[y]:p}}))},o=async()=>{try{j(!0);const a=localStorage.getItem("emstoken"),y=await z.post("/api/updateCompany",{...r},{headers:{Authorization:`Bearer ${a}`}});D(_()),b.success(y.data.message,{autoClose:1800})}catch(a){console.log(a),a.response?b.warn(a.response.data.message,{autoClose:2700}):a.request?console.error("No response from server:",a.request):console.error("Error:",a.message)}finally{j(!1)}},C=()=>{},E=a=>{var p;c(!0);const y={...a,managerIds:(p=a==null?void 0:a.managerIds)==null?void 0:p.map(M=>M._id)};A(y),g(!0)},P=Ee();return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(h==null?void 0:h.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),d==="company"?e.jsx(R,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsx("div",{className:` 
                          rounded overflow-hidden transition-all duration-300 
                          ${d==="company"?"max-h-fit p-0 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsxs("div",{className:"p-1 md:p-4 rounded  flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[r!=null&&r.logo?e.jsx("img",{src:r.logo,alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Ie,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async a=>{const y=a.target.files[0];if(!y)return;const p=await L(200,y),M=new FormData;M.append("_id",r._id),M.append("logo",p);try{console.log("api calling"),j(!0);const W=localStorage.getItem("emstoken"),Y=(await z.post("/api/updateCompany",M,{headers:{Authorization:`Bearer ${W}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;w(K=>({...K,logo:Y})),b.success("Logo uploaded successfully!")}catch(W){console.error(W),b.error("Failed to upload logo.")}finally{j(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(u,{label:"Company Name",variant:"outlined",fullWidth:!0,value:(r==null?void 0:r.name)||"",onChange:a=>w({...r,name:a.target.value})})}),e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(u,{label:"Contact",type:"tel",variant:"outlined",fullWidth:!0,value:(r==null?void 0:r.contact)||"",inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},onChange:a=>w({...r,contact:a.target.value.replace(/\D/g,"")})})})]}),e.jsx("div",{children:e.jsx(u,{label:"Company Full Name",variant:"outlined",fullWidth:!0,value:(r==null?void 0:r.fullname)||"",onChange:a=>w({...r,fullname:a.target.value})})}),e.jsx("div",{children:e.jsx(u,{label:"Address",variant:"outlined",fullWidth:!0,multiline:!0,minRows:2,value:(r==null?void 0:r.address)||"",onChange:a=>w({...r,address:a.target.value})})}),N?e.jsx(I,{variant:"contained",loading:i,onClick:o,children:"Save Changes"}):e.jsx(I,{loading:i,variant:"contained",onClick:()=>$e({companyinp:r,setisload:j}),children:"+ Create Company"})]})]})})]}),((h==null?void 0:h.role)=="superadmin"||(h==null?void 0:h.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),d==="branches"?e.jsx(R,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded space-y-1 overflow-hidden transition-all duration-300
                          ${d==="branches"?"max-h-fit p-1 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(I,{variant:"contained",onClick:()=>g(!0),children:"+ Add Branch"})}),e.jsx(De,{customStyles:P,columns:[{name:"Name",selector:a=>a.name,sortable:!0},{name:"Location",selector:a=>a.location,sortable:!0},{name:"Manager(s)",cell:a=>{var y;return e.jsx("div",{className:"flex flex-col gap-2",children:(y=a==null?void 0:a.managerIds)==null?void 0:y.map((p,M)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>C(p.userid),children:[e.jsx(G,{src:p==null?void 0:p.profileImage,alt:p.name,children:!(p!=null&&p.profileImage)&&e.jsx(fe,{})}),e.jsx("span",{children:p.name})]},M))})}},{name:"Actions",width:"120px",cell:a=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>E(a),children:e.jsx(ge,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>E(a),children:e.jsx(Oe,{})})]})}],data:S||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),d==="department"?e.jsx(R,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${d==="department"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(Pe,{})})]}),(h==null?void 0:h.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),d==="admin"?e.jsx(R,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${d==="admin"?"max-h-fit md:p-2 p-1 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(Fe,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),d==="attendance"?e.jsx(R,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${d==="attendance"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs(ne,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(u,{label:"Office Time In",fullWidth:!0,type:"time",value:r.officeTime.in,onChange:a=>n("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(u,{label:"Office Time Out",fullWidth:!0,type:"time",value:r.officeTime.out,onChange:a=>n("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(u,{label:"Break Minutes",fullWidth:!0,type:"number",value:r.officeTime.breakMinutes,onChange:a=>n("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(u,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:r.workingMinutes.fullDay,onChange:a=>n("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(u,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:r.workingMinutes.halfDay,onChange:a=>n("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(u,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:r.workingMinutes.shortDayThreshold,onChange:a=>n("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(u,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:r.workingMinutes.overtimeAfterMinutes,onChange:a=>n("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(ae,{fullWidth:!0,children:[e.jsx(te,{children:"Weekly Offs"}),e.jsx(le,{multiple:!0,value:r.weeklyOffs,onChange:a=>w({...r,weeklyOffs:a.target.value}),input:e.jsx(re,{label:"Weekly Offs"}),renderValue:a=>a.map(y=>{var p;return(p=pe.find(M=>M.value===y))==null?void 0:p.label}).join(", "),children:pe.map(a=>e.jsxs(Z,{value:a.value,children:[e.jsx(J,{checked:r.weeklyOffs.includes(a.value)}),e.jsx(Q,{primary:a.label})]},a.value))})]}),Object.entries(r.attendanceRules).map(([a,y])=>{const p=a.replace(/([A-Z])/g," $1").replace(/^./,W=>W.toUpperCase()),M={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(u,{fullWidth:!0,label:p,type:"time",value:y,onChange:W=>n("attendanceRules",a,W.target.value),helperText:M[a]},a)})]}),e.jsx(ne,{sx:{mt:4,textAlign:"right"},children:e.jsx(I,{variant:"contained",onClick:o,children:"Update Settings"})})]})]}),e.jsx(oe,{open:x,onClose:()=>{g(!1),A(null),c(!1)},children:e.jsx("div",{className:"membermodal w-[680px]",children:e.jsx(We,{setopenviewmodal:g,editbranchdata:T,editbranch:k,company:N,employee:O})})})]})}export{Ve as default};
