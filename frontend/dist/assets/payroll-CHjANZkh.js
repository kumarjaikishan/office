import{r as x,ah as O,j as s,a9 as w,b3 as $,b4 as T,b5 as L,b6 as U,b7 as _,aa as Y,aj as G,ak as q,b8 as D,a8 as H,a5 as X,h as Z,A as J,k as K,V as Q,T as W,B as I,aT as ee,a as se,g as ae,c as V,y as E,b as te,i as z,Z as ne,F as re,I as le,S as oe,M as R,O as ie,C as ce,a0 as de}from"./index-CPUqwxcV.js";import{u as ue}from"./attandencehelper-dG5TxgUT.js";import{c as me,d as pe,e as he,a as ye}from"./index-DrtDAS_g.js";import{s as fe}from"./styled-BoMwOeOS.js";import{u as xe}from"./useThemeProps-TYRm9UFN.js";import"./index-B3Id5rY6.js";const ge=q(),je=fe("div",{name:"MuiStack",slot:"Root"});function ve(t){return xe({props:t,name:"MuiStack",defaultTheme:ge})}function be(t,d){const r=x.Children.toArray(t).filter(Boolean);return r.reduce((e,i,o)=>(e.push(i),o<r.length-1&&e.push(x.cloneElement(d,{key:`separator-${o}`})),e),[])}const ke=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Ce=({ownerState:t,theme:d})=>{let r={display:"flex",flexDirection:"column",...$({theme:d},T({values:t.direction,breakpoints:d.breakpoints.values}),e=>({flexDirection:e}))};if(t.spacing){const e=L(d),i=Object.keys(d.breakpoints.values).reduce((l,n)=>((typeof t.spacing=="object"&&t.spacing[n]!=null||typeof t.direction=="object"&&t.direction[n]!=null)&&(l[n]=!0),l),{}),o=T({values:t.direction,base:i}),u=T({values:t.spacing,base:i});typeof o=="object"&&Object.keys(o).forEach((l,n,y)=>{if(!o[l]){const b=n>0?o[y[n-1]]:"column";o[l]=b}}),r=U(r,$({theme:d},u,(l,n)=>t.useFlexGap?{gap:D(e,l)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${ke(n?o[n]:t.direction)}`]:D(e,l)}}))}return r=_(d.breakpoints,r),r};function Se(t={}){const{createStyledComponent:d=je,useThemeProps:r=ve,componentName:e="MuiStack"}=t,i=()=>Y({root:["root"]},l=>G(e,l),{}),o=d(Ce);return x.forwardRef(function(l,n){const y=r(l),v=O(y),{component:b="div",direction:g="column",spacing:M=0,divider:j,children:k,className:P,useFlexGap:C=!1,...N}=v,B={direction:g,spacing:M,useFlexGap:C},a=i();return s.jsx(o,{as:b,ownerState:B,ref:n,className:w(a.root,P),...N,children:j?be(k,j):k})})}const Ie=Se({createStyledComponent:H("div",{name:"MuiStack",slot:"Root"}),useThemeProps:t=>X({props:t,name:"MuiStack"})}),Pe=(t,d,r)=>[{name:"S.no",selector:(e,i)=>i+1,width:"60px"},{name:"Employee",selector:e=>{var i,o,u,p,l,n,y;return s.jsxs("div",{className:"flex items-center capitalize gap-3 ",children:[s.jsx(J,{src:K((i=e==null?void 0:e.employeeId)==null?void 0:i.profileimage,{format:"webp",width:100,height:100})||employepic,alt:(u=(o=e==null?void 0:e.employeeId)==null?void 0:o.userid)==null?void 0:u.name,children:!((p=e==null?void 0:e.employeeId)!=null&&p.profileimage)&&employepic}),s.jsxs(Q,{children:[s.jsx(W,{variant:"body2",children:(n=(l=e==null?void 0:e.employeeId)==null?void 0:l.userid)==null?void 0:n.name}),s.jsxs("p",{className:"t text-[10px] text-gray-600",children:["(",(y=e==null?void 0:e.employeeId)==null?void 0:y.designation,")"]})]})]})},sortable:!0},{name:"Month",selector:e=>Z(`${e.year}-${e.month}-01`).format("MM-YYYY")},{name:"Department",selector:e=>e.department,width:"120px"},{name:"Status",selector:e=>e.status,width:"120px"},{name:"Actions",cell:e=>s.jsxs(Ie,{direction:"row",spacing:1,children:[s.jsx(I,{size:"small",variant:"outlined",startIcon:s.jsx(me,{}),onClick:()=>t(e),children:"View"}),s.jsx(I,{size:"small",variant:"outlined",color:"primary",startIcon:s.jsx(pe,{}),onClick:()=>d(e),children:"Edit"}),s.jsx(I,{size:"small",variant:"outlined",color:"error",startIcon:s.jsx(he,{}),onClick:()=>r(e._id),children:"Delete"})]}),width:"300px"}];function Fe(){const{employeeId:t}=ee(),[d,r]=x.useState(!0),[e,i]=x.useState(null),[o,u]=x.useState(null);let p=se();const l=ue(),[n,y]=x.useState({searchText:"",branch:"all",department:"all"}),{employee:v,leaveBalance:b,branch:g,department:M}=ae(a=>a.user);x.useEffect(()=>{j()},[]);const j=async()=>{var a,f,h;try{r(!0),u(null);const c=localStorage.getItem("emstoken"),m=await V.get("/api/payroll",{headers:{Authorization:`Bearer ${c}`}});i((a=m==null?void 0:m.data)==null?void 0:a.payrolls)}catch(c){console.log(c),c.response?(u(((h=(f=c.response)==null?void 0:f.data)==null?void 0:h.message)||"Failed to create payroll"),E.warn(c.response.data.message,{autoClose:1200})):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{r(!1)}},k=a=>{p(`/dashboard/payroll/print/${a._id}`)},P=a=>{p(`/dashboard/payroll/edit/${a._id}`)},C=(a,f)=>{y(h=>({...h,[a]:f}))},N=e==null?void 0:e.filter(a=>{var S,A,F;const f=((F=(A=(S=a.employeeId)==null?void 0:S.userid)==null?void 0:A.name)==null?void 0:F.toLowerCase())||"",h=a.branchId||"",c=n.searchText.trim()===""||f.includes(n.searchText.toLowerCase()),m=n.branch==="all"||h===n.branch;return c&&m}),B=async a=>{swal({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async f=>{var h,c;if(f)try{r(!0),u(null);const m=localStorage.getItem("emstoken"),S=await V.delete(`/api/payroll/${a}`,{headers:{Authorization:`Bearer ${m}`}});E.success(S.data.message||"Successfull deleted"),j()}catch(m){console.error(m),u(((c=(h=m.response)==null?void 0:h.data)==null?void 0:c.message)||"Failed to fetch payroll"),E.warn("Using dummy payroll data for testing",{autoClose:1500}),i(v)}finally{r(!1)}})};return e?s.jsxs("div",{className:"w-full mx-auto p-1 md:p-4",children:[s.jsxs("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[s.jsx(te,{size:"small",className:"w-[100%] md:w-[160px]",value:n.searchText,onChange:a=>C("searchText",a.target.value),InputProps:{startAdornment:s.jsx(z,{position:"start",children:s.jsx(ne,{})})},label:"Search Employee"}),s.jsxs(re,{size:"small",className:"w-[47%] md:w-[160px]",children:[s.jsx(le,{children:"Branch"}),s.jsxs(oe,{label:"Branch",value:n.branch,input:s.jsx(ie,{startAdornment:s.jsx(z,{position:"start",children:s.jsx(ce,{fontSize:"small"})}),label:"Branch"}),onChange:a=>C("branch",a.target.value),children:[s.jsx(R,{value:"all",children:"All"}),g==null?void 0:g.map(a=>s.jsx(R,{value:a._id,children:a.name},a._id))]})]})]}),s.jsx("div",{className:"w-full md:w-fit",children:s.jsx(I,{size:"small",className:"w-full md:w-fit",onClick:()=>{p("/dashboard/payroll/add")},variant:"contained",children:" Add Payroll"})})]}),s.jsx("div",{children:s.jsx(de,{columns:Pe(k,P,B),data:N,pagination:!0,customStyles:l,highlightOnHover:!0,paginationPerPage:20,paginationRowsPerPageOptions:[20,50,100,300],noDataComponent:s.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[s.jsx(ye,{className:"text-xl"})," No Employee records found."]})})})]}):s.jsx("p",{className:"p-4 text-gray-500",children:"No payroll data found"})}export{Fe as default};
