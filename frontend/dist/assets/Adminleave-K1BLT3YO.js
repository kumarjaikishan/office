import{j as e,X as D,b as u,F as L,I as O,S as U,M as z,B as A,c as S,y as x,r as h,g as q,h as b,U as P,W as X,A as H,k as G,T as E,a0 as J,a1 as K,a2 as Q}from"./index-CnbD90_x.js";import{M as V}from"./Modalbox-CU1FHobT.js";import{I as Z}from"./index-BgSkoQv1.js";import{C as B}from"./CheckPermission-Dqkd5Sgt.js";const ee=({firstfetch:o,inp:r,openmodal:w,isload:p,handleChange:f,setopenmodal:g,setInp:j,init:i})=>{const y=async l=>{l.preventDefault();const d=localStorage.getItem("emstoken");try{const c=await S.post("/api/leavehandle",{...r},{headers:{Authorization:`Bearer ${d}`}});o(),g(!1),j(i),x.success(c.data.message,{autoClose:2e3})}catch(c){c.response&&x.warning(c.response.data.message,{autoClose:3e3}),console.error(c)}};return e.jsx(V,{open:w,onClose:()=>{g(!1),j(i)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:y,children:[e.jsx("h2",{children:"Leave Management"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsxs(D,{sx:{width:"100%",gap:2},children:[e.jsx(u,{fullWidth:!0,value:r.branch,label:"Branch",size:"small"}),e.jsx(u,{fullWidth:!0,value:r.employeename,label:"Name",size:"small"})]}),e.jsxs(D,{sx:{width:"100%",gap:2},children:[e.jsx(u,{fullWidth:!0,value:r.showfrom,label:"From",size:"small"}),e.jsx(u,{fullWidth:!0,value:r.showto,label:"To",size:"small"})]}),e.jsx(u,{fullWidth:!0,multiline:!0,minRows:2,value:r.reason,onChange:l=>f(l,"reason"),label:"Reason",size:"small"}),e.jsxs(L,{fullWidth:!0,required:!0,size:"small",children:[e.jsx(O,{children:"Status"}),e.jsxs(U,{value:r.status,label:"Status",onChange:l=>f(l,"status"),children:[e.jsx(z,{value:"approved",children:"Approve"}),e.jsx(z,{value:"rejected",children:"Reject"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(A,{sx:{mr:2},loading:p,loadingPosition:"end",endIcon:e.jsx(Z,{}),variant:"contained",type:"submit",children:"Update"}),e.jsx(A,{size:"small",onClick:()=>{g(!1),j(i)},variant:"outlined",children:"Cancel"})]})]})]})})})},ne=()=>{const[o,r]=h.useState([]),[w,p]=h.useState(!1),[f,g]=h.useState(!1),{department:j,branch:i}=q(s=>s.user),y={leaveid:"",branch:"",employeename:"",from:"",showfrom:"",to:"",showto:"",reason:"",status:""},[l,d]=h.useState(y),c=B("leave",3),R=B("leave",4);h.useEffect(()=>{M()},[]);const $=(s,n)=>{d({...l,[n]:s.target.value})},M=async()=>{var n,m;const s=localStorage.getItem("emstoken");try{const a=await S.get("/api/fetchleave",{headers:{Authorization:`Bearer ${s}`}});let T=1;const _=await a.data.leave.map(t=>{var v,C,I,Y,N,k;return{id:t._id,sno:T++,name:e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx(H,{src:(v=t==null?void 0:t.employeeId)==null?void 0:v.profileimage,alt:(C=t==null?void 0:t.employeeId)==null?void 0:C.employeename,children:!((I=t.employeeId)!=null&&I.profileimage)&&e.jsx(G,{})}),e.jsxs(D,{children:[e.jsx(E,{variant:"body2",children:(Y=t.employeeId)==null?void 0:Y.employeename}),e.jsx(E,{variant:"body2",children:(k=(N=t.employeeId)==null?void 0:N.userid)==null?void 0:k.email})]})]}),from:b(t.fromDate).format("DD MMM, YYYY"),to:b(t.toDate).format("DD MMM, YYYY"),reason:t.reason,status:e.jsx("span",{className:`${t.status=="approved"?"bg-green-100 text-green-800":t.status=="rejected"?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800"} px-3 py-1 rounded capitalize`,children:t.status}),action:e.jsxs("div",{className:"flex gap-2",children:[c&&e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>F(t),children:e.jsx(P,{})}),R&&e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>W(t._id),children:e.jsx(X,{})})]})}});r(_)}catch(a){console.error(a),x.warning(((m=(n=a.response)==null?void 0:n.data)==null?void 0:m.message)||"Error")}},W=async s=>{console.log(s),swal({title:"Are you sure you want to Delete this record?",icon:"warning",buttons:!0,dangerMode:!0}).then(async n=>{if(n){const m=localStorage.getItem("emstoken");try{const a=await S.delete(`/api/leavehandle/${s}`,{headers:{Authorization:`Bearer ${m}`}});M(),x.success(a.data.message,{autoClose:2e3})}catch(a){a.response&&x.warning(a.response.data.message,{autoClose:3e3}),console.error(a)}}})},F=s=>{var n,m;d({leaveid:s._id,branch:i==null?void 0:i.filter(a=>a._id==(s==null?void 0:s.branchId))[0].name,employeename:(m=(n=s==null?void 0:s.employeeId)==null?void 0:n.userid)==null?void 0:m.name,from:s.fromDate,to:s.toDate,showfrom:b(s.fromDate).format("DD MMM, YYYY"),showto:b(s.toDate).format("DD MMM, YYYY"),reason:s==null?void 0:s.reason,status:s==null?void 0:s.status}),p(!0)};return e.jsxs("div",{children:[e.jsx(J,{customStyles:K(),columns:se,data:o,pagination:!0,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(Q,{className:"text-xl"})," No Leave Request found."]})}),e.jsx(ee,{firstfetch:M,handleChange:$,inp:l,isload:f,init:y,setInp:d,openmodal:w,setopenmodal:p})]})},se=[{name:"S.no",selector:o=>o.sno,width:"60px"},{name:"Employee",selector:o=>o.name},{name:"from",selector:o=>o.from,width:"120px"},{name:"to",selector:o=>o.to,width:"120px"},{name:"Reason",selector:o=>o.reason},{name:"Status",selector:o=>o.status,width:"120px"},{name:"Action",selector:o=>o.action,width:"90px"}];export{se as columns,ne as default};
