import{b as A,y as g,r as i,f as L,j as e,I as P,J as Q,C as R}from"./index-D6eprowh.js";import{I as k}from"./index-CdBHEcZD.js";import{X as T}from"./index.es-Dg7gK8mu.js";import{c as X}from"./attandencehelper-Do4mg5EE.js";import{M as H}from"./Modalbox-CdnAaA_p.js";import{A as J}from"./index-CqQliaYZ.js";import{F as z,I as D,S as q,O as U}from"./Select-B9XRi5ke.js";import{M as y}from"./MenuItem-BeSv7JL_.js";import{I as G}from"./InputAdornment-xjMeWW8b.js";import{T as S}from"./TextField-CqHbrCr8.js";import{B as v}from"./Button-D8pdstAJ.js";import"./dayjs.min-DSimJ2vl.js";import"./createSimplePaletteValueFilter-CCWcIbuk.js";import"./useSlotProps-CwI_XqsP.js";import"./ButtonBase-DJxbAmSf.js";import"./Typography-Ckr0zgK-.js";const K=[{name:"S.no",selector:a=>a.sno,width:"40px"},{name:"Branch",selector:a=>a.branch},{name:"Department",selector:a=>a.dep_name},{name:"Action",selector:a=>a.action,width:"80px"}],V=async({inp:a,setisload:n,setInp:d,setopenmodal:r,init:l})=>{console.log(a);const{branchId:h,department:c,description:f}=a;if(!c){alert("Please fill in both fields");return}const j=localStorage.getItem("emstoken");n(!0);try{const s=await A.post("/api/adddepartment",{department:c,branchId:h,description:f},{headers:{Authorization:`Bearer ${j}`}});console.log("Query:",s),g.success(s.data.message,{autoClose:1200}),d(l),r(!1)}catch(s){console.log(s),s.response?g.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{n(!1)}},W=async({inp:a,setisload:n,setInp:d,setopenmodal:r,init:l})=>{const{departmentId:h,department:c,description:f}=a;if(!c||!h){alert("All fileds are Required");return}const j=localStorage.getItem("emstoken");n(!0);try{const s=await A.post("/api/updatedepartment",{departmentId:h,department:c,description:f},{headers:{Authorization:`Bearer ${j}`}});console.log("Query:",s),g.success(s.data.message,{autoClose:1200}),d(l),r(!1)}catch(s){console.log(s),s.response?g.warn(s.response.data.message,{autoClose:1200}):s.request?console.error("No response from server:",s.request):console.error("Error:",s.message)}finally{n(!1)}},Y=async({departmentId:a,setisload:n})=>{if(!a){alert("All fileds are Required");return}const d=localStorage.getItem("emstoken");n(!0);try{const r=await A.post("/api/deletedepartment",{departmentId:a},{headers:{Authorization:`Bearer ${d}`}});console.log("Query:",r),g.success(r.data.message,{autoClose:1200})}catch(r){console.log(r),r.response?g.warn(r.response.data.message,{autoClose:1200}):r.request?console.error("No response from server:",r.request):console.error("Error:",r.message)}finally{n(!1)}},fe=()=>{const[a,n]=i.useState(!1),[d,r]=i.useState(!1),[l,h]=i.useState([]),[c,f]=i.useState(!1),[j,s]=i.useState([]),{branch:x,department:w}=L(t=>t.user),[o,N]=i.useState({branch:"all",department:" "}),B=o.branch!=="all"||o.department.trim()!=="";i.useEffect(()=>{if(!l||l.length===0)return;const t=l.filter(m=>{var _;const u=o.branch==="all"||m.branchid===o.branch,F=o.department.trim()===""||((_=m.dep_name)==null?void 0:_.toLowerCase().includes(o.department.trim().toLowerCase()));return u&&F});s(t)},[o,l]);const I={departmentId:"",branchId:"",department:"",description:""},[p,b]=i.useState(I);i.useEffect(()=>{if(w.length>0){let t=1;const m=w.map(u=>({id:u._id,sno:t++,branchid:u.branchId._id,branch:u.branchId.name,dep_name:u.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>M(u),children:e.jsx(P,{})}),e.jsx("span",{className:"delete",onClick:()=>O(u._id),children:e.jsx(J,{})})]})}));h(m)}},[w]);const C=(t,m)=>{b({...p,[m]:t.target.value})},E=t=>{t.preventDefault(),V({inp:p,setisload:r,setInp:b,setopenmodal:n,init:I})},M=t=>{console.log("edit",t),f(!0),b({branchId:t.branchId._id,departmentId:t._id,department:t.department,description:t.description}),n(!0)},O=t=>{console.log("delete",t),Q({title:"Are you sure?",text:"Once deleted, you will not be able to recover this",icon:"warning",buttons:!0,dangerMode:!0}).then(async m=>{m&&Y({departmentId:t,setisload:r})})},$=()=>{console.log("updateee",p),W({inp:p,setisload:r,setInp:b,setopenmodal:n,init:I})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(z,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(D,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(q,{value:o.branch,onChange:t=>N({...o,branch:t.target.value}),input:e.jsx(U,{startAdornment:e.jsx(G,{position:"start",children:e.jsx(R,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(y,{selected:!0,value:"all",children:"All"}),x==null?void 0:x.map(t=>e.jsx(y,{value:t._id,children:t.name},t._id))]})]}),e.jsx(S,{size:"small",id:"outlined-basic",value:o.department,onChange:t=>N({...o,department:t.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(v,{className:"w-full md:w-auto",variant:"contained",onClick:()=>n(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(T,{customStyles:X,columns:K,data:B?j:l,pagination:!0,highlightOnHover:!0})}),e.jsx(H,{open:a,onClose:()=>n(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:E,children:[e.jsx("h2",{children:"Add Department"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(z,{sx:{width:"98%"},size:"small",children:[e.jsx(D,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(q,{value:p.branchId,label:"branch",onChange:t=>C(t,"branchId"),children:x==null?void 0:x.map(t=>e.jsx(y,{value:t._id,children:t.name},t._id))})]}),e.jsx(S,{sx:{width:"98%"},required:!0,value:p.department,onChange:t=>C(t,"department"),label:"Department",size:"small"}),e.jsx(S,{multiline:!0,rows:4,onChange:t=>C(t,"description"),value:p.description,sx:{width:"98%"},label:"Description",size:"small"}),e.jsxs("div",{children:[!c&&e.jsx(v,{sx:{mr:2},loading:d,loadingPosition:"end",endIcon:e.jsx(k,{}),variant:"contained",type:"submit",children:"Add"}),c&&e.jsx(v,{sx:{mr:2},loading:d,loadingPosition:"end",endIcon:e.jsx(k,{}),variant:"contained",onClick:$,children:"Update"}),e.jsx(v,{size:"small",onClick:()=>{n(!1),f(!1),b(I)},variant:"outlined",children:" cancel"})]})]})]})})})]})};export{fe as default};
