import{r as l,f as q,ak as G,b as A,j as t,I as K,J as Q,y as g}from"./index-CleMBIBn.js";import{d as i}from"./dayjs.min-DSKahEwl.js";import{i as V}from"./isSameOrBefore-BiF2iKPQ.js";import{X as Z}from"./index.es-BzX17GyM.js";import{A as ee}from"./index-CWdIVX8_.js";import{c as te}from"./attandencehelper-Beqd0JoK.js";import{H as ae}from"./holidayCalander-BoSARFpY.js";import{A as se}from"./AdapterDateFns-B7svWd75.js";import{B as T}from"./Box-DxCvFchx.js";import{T as M}from"./TextField-DiABiCHh.js";import{D as I}from"./DatePicker-ro-towT5.js";import{B as b}from"./Button-CoB3H69l.js";import{F,I as S,S as Y}from"./Select-D3hz-9Ri.js";import{M as d}from"./MenuItem-DOZMs1J2.js";import{L as le}from"./dateViewRenderers-0RYz08Yo.js";import"./ButtonBase-CbJsO36x.js";import"./Tooltip-Dz04ysW2.js";import"./useSlotProps-BIGTSc1Y.js";import"./createSimplePaletteValueFilter-BYlBxWKv.js";import"./Popper-B5MW3hMa.js";import"./index-CXJKyJbC.js";import"./useThemeProps-BV0FlUHH.js";import"./InputAdornment-BHx7rmla.js";import"./Typography-CcZCxKTQ.js";import"./IconButton-D4KmSlhp.js";i.extend(V);const Ce=()=>{const[s,c]=l.useState({name:"",type:"Public",fromDate:null,toDate:null,description:""}),[H,E]=l.useState(null),[D,B]=l.useState([]),[m,O]=l.useState([]),[u,j]=l.useState(!1),{company:f}=q(e=>e.user),[P,R]=l.useState([1]),[h,N]=l.useState("All"),[x,k]=l.useState("All"),[y,C]=l.useState("All"),z=G.useRef(null);l.useEffect(()=>{R((f==null?void 0:f.weeklyOffs)||[1])},[f]),l.useEffect(()=>{if(s.fromDate&&!s.toDate){const e=i(s.fromDate).toDate();isNaN(e.getTime())||c(a=>({...a,toDate:e}))}},[s.fromDate]),l.useEffect(()=>{v()},[]);const v=async()=>{try{const e=localStorage.getItem("emstoken"),r=(await A.get("/api/getholidays",{headers:{Authorization:`Bearer ${e}`}})).data.holidays,n=[];r.forEach(o=>{let p=i(o.fromDate);const _=o.toDate?i(o.toDate):p;for(;p.isSameOrBefore(_,"day");)n.push({date:p.format("MM/DD/YYYY"),name:o.name}),p=p.add(1,"day")});const w=r.map(o=>({name:o.name,From:o.fromDate,till:o.toDate,type:o.type,description:o==null?void 0:o.description,action:t.jsxs("div",{className:"action flex gap-2.5",children:[t.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>$(o),children:t.jsx(K,{})}),t.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>W(o._id),children:t.jsx(ee,{})})]})}));l.startTransition(()=>{O(n),B(w)})}catch(e){console.error("Error fetching holidays:",e)}},$=e=>{j(!0),E(e._id),c({name:e.name,type:"Public",fromDate:i(e.fromDate).toDate(),toDate:i(e.toDate).toDate(),description:e.description||""}),setTimeout(()=>{var a;(a=z.current)==null||a.focus()},0)},W=async e=>{Q({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{const r=localStorage.getItem("emstoken"),n=await A.post("/api/deleteholiday",{id:e},{headers:{Authorization:`Bearer ${r}`}});g.success(n.data.message),v()}catch(r){console.error(r),g.warning(r.response.data.message)}})},L=async()=>{try{const e=localStorage.getItem("emstoken"),a=u?"updateholiday":"addholiday",r=u?{...s,holidayId:H}:s,n=await A.post(`/api/${a}`,r,{headers:{Authorization:`Bearer ${e}`}});g.success(n.data.message),c({name:"",type:"Public",fromDate:null,toDate:null,description:""}),j(!1),v()}catch(e){console.error(e.response),g.warning(e.response.data.message)}},J=l.useMemo(()=>D.filter(e=>{const a=i(e.From),r=h==="All"||a.year().toString()===h,n=x==="All"||a.month()===parseInt(x),w=y==="All"||e.type===y;return r&&n&&w}),[D,h,x,y]),U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],X=l.useMemo(()=>{if(!m||m.length===0)return[];const e=i(m[m.length-1].date).year(),a=i(m[0].date).year(),r=[];for(let n=e;n<=a;n++)r.push(n);return r},[m]);return t.jsxs(le,{dateAdapter:se,children:[t.jsxs(T,{className:"flex flex-col md:flex-row gap-4 p-1",children:[t.jsx(ae,{highlightedDates:m.map(e=>({date:i(e.date).toDate(),name:e.name})),weeklyOffs:P}),t.jsxs(T,{className:"flex flex-col gap-4 p-4 bg-white shadow rounded w-full max-w-md",children:[t.jsx(M,{inputRef:z,label:"Holiday Name",size:"small",value:s.name,onChange:e=>c(a=>({...a,name:e.target.value})),fullWidth:!0}),t.jsx(I,{label:"From Date",format:"dd/MM/yyyy",value:s.fromDate,onChange:e=>c(a=>({...a,fromDate:e})),slotProps:{textField:{size:"small",fullWidth:!0}}}),t.jsx(I,{label:"To Date",format:"dd/MM/yyyy",value:s.toDate,onChange:e=>c(a=>({...a,toDate:e})),slotProps:{textField:{size:"small",fullWidth:!0}}}),t.jsx(M,{label:"Type",size:"small",value:s.type,onChange:e=>c(a=>({...a,type:e.target.value})),fullWidth:!0}),t.jsx(M,{label:"Description",multiline:!0,rows:2,size:"small",value:s.description,onChange:e=>c(a=>({...a,description:e.target.value})),fullWidth:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[u&&t.jsx(b,{variant:"outlined",onClick:()=>{j(!1),c({name:"",type:"Public",fromDate:null,toDate:null,description:""})},children:"Cancel"}),t.jsxs(b,{variant:"contained",onClick:L,children:[u?"Update":"Add"," Holiday"]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2  w-full md:w-fit my-4 ",children:[t.jsxs(F,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(S,{children:"Filter by Year"}),t.jsxs(Y,{label:"Filter by Year",value:h,onChange:e=>N(e.target.value),children:[t.jsx(d,{value:"All",children:"All"}),X.map(e=>t.jsx(d,{value:e,children:e},e))]})]}),t.jsxs(F,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(S,{children:"Filter by Month"}),t.jsxs(Y,{label:"Filter by Month",value:x,onChange:e=>k(e.target.value),children:[t.jsx(d,{value:"All",children:"All"}),U.map((e,a)=>t.jsx(d,{value:a,children:e},e))]})]}),t.jsxs(F,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(S,{children:"Filter by Type"}),t.jsxs(Y,{label:"Filter by Type",value:y,onChange:e=>C(e.target.value),children:[t.jsx(d,{value:"All",children:"All"}),[...new Set(D.map(e=>e.type))].map(e=>t.jsx(d,{value:e,children:e},e))]})]}),t.jsx(b,{className:"md:max-w-[150px] col-span-1",variant:"outlined",color:"secondary",onClick:()=>{N("All"),k("All"),C("All")},children:"Reset"})]}),t.jsx("div",{className:"capitalize",children:t.jsx(Z,{columns:re,data:J,pagination:!0,selectableRows:!0,customStyles:te,highlightOnHover:!0})})]})},re=[{name:"S.no",selector:(s,c)=>++c,width:"50px"},{name:"Name",selector:s=>s.name},{name:"From",selector:s=>i(s.From).format("DD MMM, YYYY"),width:"110px"},{name:"Till",selector:s=>i(s.till).format("DD MMM, YYYY"),width:"110px"},{name:"Type",selector:s=>s.type,width:"90px"},{name:"Action",selector:s=>s.action,width:"80px"}];export{Ce as default};
