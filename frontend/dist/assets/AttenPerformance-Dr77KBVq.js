import{r as o,j as e,p as Te,b5 as Ce,b6 as Ye,b7 as Be,b8 as Pe,b9 as ze,ba as He,bb as We,bc as $e,bd as _e,be as Ue,g as Xe,a as qe,h as t,F as S,I as B,S as P,M as f,b as ue,B as Ge,a0 as Je,a1 as Ke,a2 as Qe,c as Ve,y as Ze}from"./index-0qX7FfNS.js";import{i as ea}from"./isSameOrBefore-BvvgxTaL.js";import{P as aa,R as sa}from"./PieChart-D6PHue3w.js";import{a as xe}from"./index-BlvzrJlb.js";import{T as ta}from"./Tooltip-CenLn4mr.js";import"./index-DK2aW40O.js";import"./Popper-CdrSTJoi.js";const ra=({attandence:n,employee:s,hell:a})=>{var u,D,m,z,H,W,$,_,U,k,E,b;o.useEffect(()=>{},[n]);const l="https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",c=(((u=a==null?void 0:a.present)==null?void 0:u.length)||0)+(((D=a==null?void 0:a.absent)==null?void 0:D.length)||0)+(((m=a==null?void 0:a.leave)==null?void 0:m.length)||0),x=o.useMemo(()=>{var R,A,I;return{present:c?Math.floor(((R=a==null?void 0:a.present)==null?void 0:R.length)/c*100):0,absent:c?Math.floor(((A=a==null?void 0:a.absent)==null?void 0:A.length)/c*100):0,leave:c?Math.floor(((I=a==null?void 0:a.leave)==null?void 0:I.length)/c*100):0}},[a,c]),g=c?[{id:0,value:x.present,color:"teal",label:"Present"},{id:1,value:x.leave,color:"orange",label:"Leave"},{id:2,value:x.absent,color:"rgb(156 163 175)",label:"Absent"}]:[{id:0,value:100,color:"rgb(156 163 175)",label:"No record"}],w=window.innerWidth<600?{width:220,height:220}:{width:300,height:300},j=window.innerWidth<600?{innerRadius:95,outerRadius:110}:{innerRadius:130,outerRadius:150};return e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center min-h-[200px] bg-[#e0e4e7] p-1 space-y-1 md:space-y-0 md:space-x-2",children:[e.jsxs("div",{className:"relative  mb-2  w-60 h-60 md:w-80 md:h-80 flex items-center justify-center z-2 rounded-full",children:[e.jsx(aa,{series:[{innerRadius:j.innerRadius,outerRadius:j.outerRadius,data:g,paddingAngle:1,cornerRadius:5}],width:w.width,height:w.height,legend:{hidden:!0}}),e.jsx("div",{className:"absolute w-46 h-46 md:w-63 md:h-63 rounded-full overflow-hidden border-4 border-white",children:e.jsx("img",{src:(s==null?void 0:s.profileimage)||l,alt:(s==null?void 0:s.name)||"Employee",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-full md:w-[550px]",children:[e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Te,{})," Total Days"]}),e.jsx("span",{className:"font-bold text-gray-600",children:c})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ce,{})," Present"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((z=a==null?void 0:a.present)==null?void 0:z.length)||0," Days"," ",x.present?`(${x.present}%)`:""]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ye,{})," Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((H=a==null?void 0:a.leave)==null?void 0:H.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Be,{})," Absent"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((W=a==null?void 0:a.absent)==null?void 0:W.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-12 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsx(ta,{placement:"top",enterDelay:800,arrow:!0,title:(a==null?void 0:a.overtimesalary)!==null?e.jsxs("div",{className:"flex gap-1 flex-col text-white",children:[e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Basic salary"}),e.jsxs("span",{children:[": ",s==null?void 0:s.salary," ₹"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Net Overtime"}),e.jsxs("span",{children:[": ",((a==null?void 0:a.overtimemin)||0)-((a==null?void 0:a.shorttimemin)||0)," min"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Payment"}),e.jsxs("span",{children:[": ",(a==null?void 0:a.overtimesalary)||0," ₹"]})]})]}):"",children:e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow cursor-help",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Pe,{})," Overtime"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[(($=a==null?void 0:a.overtime)==null?void 0:$.length)||0," ",(a==null?void 0:a.overtimemin)>0&&`(${a==null?void 0:a.overtimemin} min)`]})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(ze,{})," Short Time"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((_=a==null?void 0:a.short)==null?void 0:_.length)||0," ",(a==null?void 0:a.shorttimemin)>0&&`(${a==null?void 0:a.shorttimemin} min)`]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(He,{})," Late Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((U=a==null?void 0:a.latearrival)==null?void 0:U.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(We,{})," Early Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((k=a==null?void 0:a.earlyLeave)==null?void 0:k.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx($e,{})," Early Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((E=a==null?void 0:a.earlyarrival)==null?void 0:E.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(_e,{})," Late Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((b=a==null?void 0:a.lateleave)==null?void 0:b.length)||0})]})]})]})]})};t.extend(ea);const pa=()=>{var se;const{userid:n}=Ue(),[s,a]=o.useState(null),[l,c]=o.useState({}),[x,g]=o.useState([]),[w,j]=o.useState(!0),{company:u,holidays:D}=Xe(r=>r.user),[m,z]=o.useState(null),[H,W]=o.useState([]),[$,_]=o.useState([]),U=qe(),[k,E]=o.useState(t().year()),[b,R]=o.useState(t().month()),[A,I]=o.useState("all"),[O,V]=o.useState("all"),[X,Z]=o.useState("all"),[J,ee]=o.useState(null),[K,ae]=o.useState(null),[M,me]=o.useState({present:[],absent:[],leave:[],holiday:[],short:[],overtime:[],latearrival:[],earlyarrival:[],earlyLeave:[],lateleave:[],shorttimemin:0,overtimemin:0,overtimesalary:0}),fe=t().year(),pe=Array.from({length:8},(r,i)=>fe+1-i),he=Array.from({length:12},(r,i)=>({label:t().month(i).format("MMMM"),value:i}));o.useEffect(()=>{var i,p,d,h,F,L,T;if(!u||!l)return;const r=((i=l==null?void 0:l.branchId)==null?void 0:i.defaultsetting)==!1?{attendanceRules:(d=(p=l==null?void 0:l.branchId)==null?void 0:p.setting)==null?void 0:d.attendanceRules,workingMinutes:(F=(h=l==null?void 0:l.branchId)==null?void 0:h.setting)==null?void 0:F.workingMinutes,weeklyOffs:(T=(L=l==null?void 0:l.branchId)==null?void 0:L.setting)==null?void 0:T.weeklyOffs}:{attendanceRules:u==null?void 0:u.attendanceRules,workingMinutes:u==null?void 0:u.workingMinutes,weeklyOffs:u==null?void 0:u.weeklyOffs};z(r)},[u,l]),o.useEffect(()=>{if(!D)return;const r=[];D.forEach(i=>{let p=t(i.fromDate);const d=i.toDate?t(i.toDate):p;for(;p.isSameOrBefore(d,"day");)r.push(p.format("DD/MM/YYYY")),p=p.add(1,"day")}),W(r)},[D]),o.useEffect(()=>{if(!n)return;(async()=>{var p,d;const i=localStorage.getItem("emstoken");try{j(!0);const h=await Ve.get("/api/employeeAttandence",{params:{userid:n},headers:{Authorization:`Bearer ${i}`}});c(h.data.employee),a(h.data.user),g(h.data.attandence)}catch(h){if(console.error("Failed to fetch performance data:",h),h.status==403){swal({title:"Access Denied",text:h.response.data.message||"You are not authorized to manage this tournament.",icon:"warning"}),U("/");return}Ze.warning(((d=(p=h.response)==null?void 0:p.data)==null?void 0:d.message)||"error")}finally{j(!1)}})()},[n]),o.useEffect(()=>{if(!x.length||!m)return;const r=x.filter(v=>{const y=t(v.date);return y.year()===k&&(b==="all"||y.month()===b)}),i=[],p=[],d=[],h=[],F=[],L=[],T=[],te=[],re=[],ne=[];let Q=0,q=0,G=[];r.forEach(v=>{const y=t(v.date).toDate();let je=t(v.date).format("DD/MM/YYYY");const{punchIn:C,punchOut:Y,workingMinutes:N}=v,le=H.includes(je),ge=t(v.date).startOf("day").day(),ie=m==null?void 0:m.weeklyOffs.includes(ge),de=v.status=="leave",oe=v.status=="absent";le&&!de&&!oe&&N?G.push({...v,remarks:"worked on holiday"}):ie&&!de&&!oe&&N?G.push({...v,remarks:"worked on weekly off"}):G.push(v);const ce=v.status;switch(ce){case"present":i.push(y);break;case"absent":p.push(y);break;case"leave":d.push(y);break;case"holiday":h.push(y);break}if(ce!=="present"||!C||!Y||typeof N!="number")return;if(le||ie)L.push(y),q+=N;else{const Ie=N<m.workingMinutes.fullDay,Fe=N>=m.workingMinutes.fullDay;Ie&&(F.push(y),Q+=m.workingMinutes.fullDay-N),Fe&&(L.push(y),q+=N-m.workingMinutes.fullDay)}const[be,we]=m.attendanceRules.considerEarlyEntryBefore.split(":").map(Number),[Ne,ke]=m.attendanceRules.considerLateEntryAfter.split(":").map(Number),Me=t(C).startOf("day").add(be,"hour").add(we,"minute"),Se=t(C).startOf("day").add(Ne,"hour").add(ke,"minute");t(C).isBefore(Me)&&te.push(y),t(C).isAfter(Se)&&T.push(y);const[De,Ae]=m.attendanceRules.considerEarlyExitBefore.split(":").map(Number),[Oe,Le]=m.attendanceRules.considerLateExitAfter.split(":").map(Number),Ee=t(Y).startOf("day").add(De,"hour").add(Ae,"minute"),Re=t(Y).startOf("day").add(Oe,"hour").add(Le,"minute");t(Y).isBefore(Ee)&&re.push(y),t(Y).isAfter(Re)&&ne.push(y)}),_(G),me({present:i,absent:p,leave:d,holiday:h,short:F,overtime:L,shorttimemin:Q,overtimemin:q,latearrival:T,earlyarrival:te,earlyLeave:re,lateleave:ne,overtimesalary:b!=="all"?Math.floor((q-Q)*parseFloat(l.salary/t(new Date(k,b)).daysInMonth()/m.workingMinutes.fullDay)):null})},[x,k,b,m]);const ye=$.filter(r=>{const i=t(r.date).startOf("day");return!(J&&i.isBefore(t(J))||K&&i.isAfter(t(K))||A!=="all"&&r.status!==A||O!=="all"&&!(O==="earlyLeave"&&M.earlyLeave.some(d=>t(d).isSame(i,"day"))||O==="lateleave"&&M.lateleave.some(d=>t(d).isSame(i,"day"))||O==="earlyarrival"&&M.earlyarrival.some(d=>t(d).isSame(i,"day"))||O==="latearrival"&&M.latearrival.some(d=>t(d).isSame(i,"day")))||X!=="all"&&!(X==="short"&&M.short.some(d=>t(d).isSame(i,"day"))||X==="overtime"&&M.overtime.some(d=>t(d).isSame(i,"day"))))}),ve=()=>{E(t().year()),R("all"),I("all"),V("all"),Z("all"),ee(null),ae(null)};return e.jsxs("div",{className:"p-1 md:p-4 capitalize bg-gray-200",children:[w&&e.jsx("p",{children:"Loading performance data..."}),e.jsxs("div",{className:"p-1 py-3 md:p-3 flex flex-wrap gap-1 md:gap-3 items-center justify-between rounded shadow bg-white mb-4",children:[e.jsxs("div",{className:"gap-3 md:gap-3 flex",children:[e.jsxs(S,{className:"w-[90px]   md:w-[120px]",size:"small",children:[e.jsx(B,{children:"Year"}),e.jsx(P,{value:k,label:"Year",onChange:r=>E(r.target.value),children:pe.map(r=>e.jsx(f,{value:r,children:r},r))})]}),e.jsxs(S,{size:"small",className:"w-[130px]  md:w-[160px]",children:[e.jsx(B,{children:"Month"}),e.jsxs(P,{value:b,label:"Month",onChange:r=>R(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),he.map(r=>e.jsx(f,{value:r.value,children:r.label},r.label))]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("p",{className:"font-semibold text-sm md:text-lg",children:s==null?void 0:s.name}),e.jsxs("p",{className:"text-[12px] md:text-sm text-gray-600",children:["(",(se=l==null?void 0:l.branchId)==null?void 0:se.name,")"]})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx(ra,{employee:l,user:s,attandence:x,hell:M}),e.jsxs("div",{className:"p-1 py-4 md:p-4 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 rounded shadow bg-white my-4",children:[e.jsxs(S,{size:"small",sx:{minWidth:120},children:[e.jsx(B,{children:"Type"}),e.jsxs(P,{value:O,label:"Type",onChange:r=>V(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"earlyLeave",children:"Early Leave"}),e.jsx(f,{value:"lateleave",children:"Late Leave"}),e.jsx(f,{value:"earlyarrival",children:"Early Arrival"}),e.jsx(f,{value:"latearrival",children:"Late Arrival"})]})]}),e.jsxs(S,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Status"}),e.jsxs(P,{value:A,label:"Status",onChange:r=>I(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"present",children:"Present"}),e.jsx(f,{value:"leave",children:"Leave"}),e.jsx(f,{value:"absent",children:"Absent"}),e.jsx(f,{value:"weekly off",children:"Weekly off"}),e.jsx(f,{value:"holiday",children:"Holiday"}),e.jsx(f,{value:"half day",children:"Half Day"})]})]}),e.jsxs(S,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Over/Short"}),e.jsxs(P,{value:X,label:"over/short",onChange:r=>Z(r.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"overtime",children:"Overtime"}),e.jsx(f,{value:"short",children:"Short Time"})]})]}),e.jsx(S,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"From Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:J||"",onChange:r=>ee(r.target.value)})}),e.jsx(S,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"To Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:K||"",onChange:r=>ae(r.target.value)})}),e.jsx(Ge,{variant:"outlined",color:"secondary",onClick:ve,sx:{alignSelf:"flex-end",minWidth:100},startIcon:e.jsx(sa,{}),children:"Reset"})]}),e.jsx(Je,{columns:ia(m),data:ye,pagination:!0,customStyles:Ke(),conditionalRowStyles:la,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(Qe,{className:"text-xl"})," No records found matching your criteria."]})})]})]})},na=n=>{const s=Math.floor(n/60),a=n%60;return`${s}h ${a}m`},la=[{when:n=>n.remarks,style:{backgroundColor:"rgba(21, 233, 233, 0.2)"}}],ia=n=>[{name:"Date",selector:s=>t(s.date).format("DD MMM, YYYY"),sortable:!0,width:"120px"},{name:"Punch In",selector:s=>s.punchIn,cell:s=>{var j,u;if(!s.punchIn)return"-";const[a,l]=(j=n==null?void 0:n.attendanceRules)==null?void 0:j.considerEarlyEntryBefore.split(":").map(Number),[c,x]=(u=n==null?void 0:n.attendanceRules)==null?void 0:u.considerLateEntryAfter.split(":").map(Number),g=t(s.punchIn).startOf("day").add(a,"hour").add(l,"minute"),w=t(s.punchIn).startOf("day").add(c,"hour").add(x,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"text-[16px] text-blue-700"}),t(s.punchIn).format("hh:mm A"),!s.remarks&&t(s.punchIn).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchIn).isAfter(w)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Late"})]})}},{name:"Punch Out",selector:s=>s.punchOut,cell:s=>{var j,u;if(!s.punchOut)return"-";const[a,l]=(j=n==null?void 0:n.attendanceRules)==null?void 0:j.considerEarlyExitBefore.split(":").map(Number),[c,x]=(u=n==null?void 0:n.attendanceRules)==null?void 0:u.considerLateExitAfter.split(":").map(Number),g=t(s.punchOut).startOf("day").add(a,"hour").add(l,"minute"),w=t(s.punchOut).startOf("day").add(c,"hour").add(x,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"text-[16px] text-blue-700"}),t(s.punchOut).format("hh:mm A"),!s.remarks&&t(s.punchOut).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchOut).isAfter(w)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Late"})]})}},{name:"Status",selector:s=>s.status,cell:s=>{const{status:a}=s,c={absent:"bg-red-100 text-red-800",leave:"bg-violet-100 text-violet-800",present:"bg-green-100 text-green-800",holiday:"bg-blue-100 text-blue-800"}[a]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`${c} px-2 py-1 rounded text-xs`,children:a})},width:"140px"},{name:"Working Hours",width:"180px",selector:s=>s.workingMinutes,cell:s=>{var l,c,x,g;const a=s.workingMinutes;return a?e.jsxs("span",{className:" flex",children:[e.jsx("span",{className:"block w-[60px] ",children:na(a)}),!s.remarks&&a<((l=n==null?void 0:n.workingMinutes)==null?void 0:l.fullDay)&&e.jsxs("span",{className:" block w-[100px] px-2 py-0.5 rounded bg-amber-100 text-amber-900 text-xs",children:["Short ",((c=n==null?void 0:n.workingMinutes)==null?void 0:c.fullDay)-a," min"]}),!s.remarks&&a>((x=n==null?void 0:n.workingMinutes)==null?void 0:x.fullDay)&&e.jsxs("span",{className:"px-2 block w-[115px] py-0.5  rounded bg-green-100 text-green-900 text-xs",children:["Overtime ",a-((g=n==null?void 0:n.workingMinutes)==null?void 0:g.fullDay)," min"]})]}):"-"}},{name:"Remarks",selector:s=>s.remarks&&`${(s==null?void 0:s.workingMinutes)||0} minutes  ${s.remarks}`}];export{pa as default};
