import{r,a as Q,f as W,b as x,y as l,j as t,at as H,A as $,au as K,V as q,W as G,K as J}from"./index-BPj9wTuW.js";import{u as X}from"./imageresizer-D4I-KFLq.js";import{a as Y}from"./index-C8sHbCN3.js";import{M as Z}from"./Modalbox-YTUWnWAi.js";import{T as z}from"./TextField-CdNAZRjB.js";import{I as ee}from"./InputAdornment-Db_OkZQS.js";import{B as v}from"./Button-BqoRdIAW.js";import{I as te}from"./IconButton-DElgCWbf.js";import{e as ae}from"./Select--6wRfVEk.js";import{M as y}from"./MenuItem-DRLv0Kw_.js";import"./createSimplePaletteValueFilter-LrkThYCc.js";import"./Typography-DEvy-y09.js";import"./ButtonBase-CBKAlCzw.js";import"./useSlotProps-Bh3H3Cgn.js";const je=()=>{const[o,A]=r.useState([]),[d,f]=r.useState([]),[c,F]=r.useState(""),O=Q(),{ledger:P}=W(e=>e.user),[m,b]=r.useState(null),[j,w]=r.useState(""),[B,p]=r.useState(!1),[i,N]=r.useState(null),{handleImage:D}=X(),[R,C]=r.useState(!1),g={Authorization:`Bearer ${localStorage.getItem("emstoken")}`},[I,S]=r.useState(null),U=!!I,T=e=>{e.stopPropagation(),S(e.currentTarget)},u=e=>{e==null||e.stopPropagation(),S(null)};r.useEffect(()=>{L()},[P]),r.useEffect(()=>{if(!(o.length<1))if(c.trim()==="")f(o);else{const e=c.toLowerCase();f(o.filter(a=>a.name.toLowerCase().includes(e)))}},[c,o]);const L=async()=>{var e,a;try{const s=await x.get("/api/ledger",{headers:g});A(s.data.ledgers),f(s.data.ledgers)}catch(s){console.log(s.response),l.warning(((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch ledgers")}},E=(e=null)=>{e?(w(e.name),b(e._id),N(e.profileImage||null)):(w(""),b(null),N(null)),p(!0)},V=async()=>{var s,n;const e=j.trim();if(!e)return l.warn("Ledger name can't be empty");if(e.length<3)return l.warn("Ledger name must be at least 3 characters");const a=new FormData;if(a.append("name",e),i instanceof File){let h=await D(170,i);a.append("image",h)}try{C(!0),m?(await x.put(`/api/ledger/${m}`,a,{headers:{...g,"Content-Type":"multipart/form-data"}}),l.success("Ledger updated")):(await x.post("/api/ledger",a,{headers:{...g,"Content-Type":"multipart/form-data"}}),l.success("Ledger created")),p(!1),L()}catch(h){console.error(h),l.warning(((n=(s=h.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to save ledger")}finally{C(!1)}},_=async e=>{swal({title:`Are you sure to Delete ${e.name}'s Ledger?`,icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{await x.delete(`/api/ledger/${e._id}`,{headers:g}),l.success("Ledger deleted"),L()}catch(s){console.log(s),l.error("Failed to delete ledger")}})},M=e=>{if(e){let a=`./${e._id}?name=${encodeURIComponent(e.name)}`;return e.profileImage&&(a+=`&profileimage=${encodeURIComponent(e.profileImage)}`),O(a)}},k=r.useRef(null);return t.jsxs("div",{className:"w-full bg-white rounded",children:[t.jsxs("div",{className:"p-1 md:p-4 py-4 mb-4",children:[t.jsxs("div",{className:"flex mb-4 gap-2 flex-wrap justify-between",children:[t.jsx(z,{size:"small",label:"Search Ledger",className:"w-full md:w-[200px]",value:c,onChange:e=>F(e.target.value),InputProps:{startAdornment:t.jsx(ee,{position:"start",children:t.jsx(H,{className:"text-gray-500"})})}}),t.jsx(v,{className:"w-full md:w-[200px]",variant:"contained",onClick:()=>E(),children:"Add Ledger"})]}),t.jsx("div",{className:"w-full p-1 md:p-3",children:t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4",children:[d.map((e,a)=>{var s;return t.jsxs("div",{onClick:()=>M(e),className:"relative cursor-pointer overflow-hidden rounded-xl shadow-lg hover:shadow-xl transition-all pl-3 pr-1 py-3 bg-gray-50",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex gap-1 items-center",children:[t.jsx($,{sx:{width:35,height:35},alt:e.name,src:e.profileImage}),t.jsx("div",{className:"text-[14px] md:text-[16px] font-semibold text-gray-800 mb-2 capitalize",children:e.name})]}),t.jsx(te,{onClick:T,size:"small",children:t.jsx(Y,{className:"text-gray-700"})}),t.jsxs(ae,{anchorEl:I,open:U,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{elevation:1},children:[t.jsxs(y,{onClick:n=>{n.stopPropagation(),u(),M(e)},children:[t.jsx(K,{className:"text-teal-600 mr-2"})," See"]}),t.jsxs(y,{onClick:n=>{n.stopPropagation(),u(),E(e)},children:[t.jsx(q,{className:"text-blue-600 mr-2"})," Edit"]}),t.jsxs(y,{onClick:n=>{n.stopPropagation(),u(),_(e)},children:[t.jsx(G,{className:"text-red-600 mr-2"})," Delete"]})]})]}),t.jsxs("p",{className:`text-[16px] md:text-lg mr-1 text-end font-medium ${e.netBalance>=0?"text-green-600":"text-red-600"}`,children:["â‚¹ ",(s=e==null?void 0:e.netBalance)==null?void 0:s.toLocaleString()]}),t.jsx("span",{className:"w-[4px] h-full absolute left-0 top-0 bg-teal-700"})]},a)}),(d==null?void 0:d.length)<1&&t.jsx("div",{className:"w-full text-center ",children:"No Ledger found"})]})})]}),t.jsx(Z,{open:B,onClose:()=>{p(!1)},children:t.jsx("div",{className:"membermodal w-[300px]",children:t.jsxs("div",{className:"whole",children:[t.jsx("div",{className:"modalhead",children:m?"Edit Ledger":"Add Ledger"}),t.jsxs("span",{className:"modalcontent ",children:[t.jsx(z,{autoFocus:!0,size:"small",fullWidth:!0,margin:"dense",label:"Ledger Name",value:j,onChange:e=>w(e.target.value)}),t.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[t.jsx("input",{style:{display:"none"},type:"file",onChange:e=>N(e.target.files[0]),ref:k,accept:"image/*",id:"fileInput"}),t.jsx($,{sx:{width:80,height:80},alt:j,src:i?i instanceof File?URL.createObjectURL(i):i:""}),t.jsx("span",{onClick:()=>k.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:t.jsx(J,{size:18})})]})]}),t.jsxs("div",{className:"modalfooter",children:[t.jsx(v,{variant:"outlined",onClick:()=>p(!1),children:"Cancel"}),t.jsx(v,{disabled:R,variant:"contained",onClick:V,children:m?"Update":"Create"})]})]})})})]})};export{je as default};
