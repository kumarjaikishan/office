import{r as s,a as z,f as O,b as j,y as i,j as t,an as T,A as C,J as M}from"./index-DLNRkSy_.js";import{u as _}from"./imageresizer-D4I-KFLq.js";import{T as I}from"./TextField-BgbQpo2_.js";import{I as P}from"./InputAdornment-CRjNhrV3.js";import{B as L}from"./Button-CkxQ6ySb.js";import{D as Q,a as J,b as W}from"./DialogContent-BFJAOkIe.js";import{D as q}from"./DialogTitle-DUrv3ygw.js";import"./createSimplePaletteValueFilter-dQN5FFuo.js";import"./Select-BBwut-H3.js";import"./useSlotProps-BqpaTknx.js";import"./ButtonBase-C3lvtx1y.js";import"./Typography-CkL-7scN.js";const le=()=>{const[o,S]=s.useState([]),[g,p]=s.useState([]),[l,E]=s.useState(""),A=z(),{ledger:k}=O(e=>e.user),[d,w]=s.useState(null),[u,f]=s.useState(""),[D,c]=s.useState(!1),[n,h]=s.useState(null),{handleImage:$}=_(),[F,v]=s.useState(!1),x={Authorization:`Bearer ${localStorage.getItem("emstoken")}`},[H,K]=s.useState(null);s.useEffect(()=>{y()},[k]),s.useEffect(()=>{if(!(o.length<1))if(l.trim()==="")p(o);else{const e=l.toLowerCase();p(o.filter(a=>a.name.toLowerCase().includes(e)))}},[l,o]);const y=async()=>{var e,a;try{const r=await j.get("/api/ledger",{headers:x});console.log(r.data),S(r.data.ledgers),p(r.data.ledgers)}catch(r){console.log(r.response),i.warning(((a=(e=r.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch ledgers")}},B=(e=null)=>{e?(f(e.name),w(e._id),h(e.profileImage||null)):(f(""),w(null),h(null)),c(!0)},U=async()=>{var r,b;const e=u.trim();if(!e)return i.warn("Ledger name can't be empty");if(e.length<3)return i.warn("Ledger name must be at least 3 characters");const a=new FormData;if(a.append("name",e),n instanceof File){let m=await $(200,n);a.append("image",m)}try{v(!0),d?(await j.put(`/api/ledger/${d}`,a,{headers:{...x,"Content-Type":"multipart/form-data"}}),i.success("Ledger updated")):(await j.post("/api/ledger",a,{headers:{...x,"Content-Type":"multipart/form-data"}}),i.success("Ledger created")),c(!1),y()}catch(m){console.error(m),i.warning(((b=(r=m.response)==null?void 0:r.data)==null?void 0:b.message)||"Failed to save ledger")}finally{v(!1)}},R=e=>{if(e){let a=`./${e._id}?name=${encodeURIComponent(e.name)}`;return e.profileImage&&(a+=`&profileimage=${encodeURIComponent(e.profileImage)}`),A(a)}},N=s.useRef(null);return t.jsxs("div",{className:"w-full bg-white rounded",children:[t.jsxs("div",{className:"p-1 md:p-4 py-4 mb-4",children:[t.jsxs("div",{className:"flex mb-4 gap-2 flex-wrap justify-between",children:[t.jsx(I,{size:"small",label:"Search Ledger",className:"w-full md:w-[200px]",value:l,onChange:e=>E(e.target.value),InputProps:{startAdornment:t.jsx(P,{position:"start",children:t.jsx(T,{className:"text-gray-500"})})}}),t.jsx(L,{className:"w-full md:w-[200px]",variant:"contained",onClick:()=>B(),children:"Add Ledger"})]}),t.jsx("div",{className:"w-full p-1 md:p-3",children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4",children:Array.isArray(g)&&g.length>0?g.map((e,a)=>t.jsxs("div",{onClick:()=>R(e),className:"relative ...",children:[t.jsx("div",{className:"flex justify-between items-start",children:t.jsxs("div",{className:"flex gap-1 items-center",children:[t.jsx(C,{sx:{width:35,height:35},alt:e==null?void 0:e.name,src:e==null?void 0:e.profileImage}),t.jsx("div",{className:"text-[14px] md:text-[16px] font-semibold text-gray-800 mb-2 capitalize",children:(e==null?void 0:e.name)||"Unnamed"})]})}),t.jsxs("p",{className:`text-[16px] md:text-lg mr-1 text-end font-medium ${typeof(e==null?void 0:e.netBalance)=="number"&&e.netBalance>=0?"text-green-600":"text-red-600"}`,children:["â‚¹"," ",typeof(e==null?void 0:e.netBalance)=="number"?e.netBalance.toLocaleString():"0"]})]},e._id||a)):t.jsx("div",{className:"w-full text-center",children:"No Ledger found"})})})]}),t.jsxs(Q,{open:D,onClose:()=>c(!1),children:[t.jsx(q,{children:d?"Edit Ledger":"Add Ledger"}),t.jsxs(J,{children:[t.jsx(I,{autoFocus:!0,fullWidth:!0,margin:"dense",label:"Ledger Name",value:u,onChange:e=>f(e.target.value)}),t.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[t.jsx("input",{style:{display:"none"},type:"file",onChange:e=>h(e.target.files[0]),ref:N,accept:"image/*",id:"fileInput"}),t.jsx(C,{sx:{width:80,height:80},alt:u,src:n?n instanceof File?URL.createObjectURL(n):n:""}),t.jsx("span",{onClick:()=>N.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1 cursor-pointer",children:t.jsx(M,{size:18})})]})]}),t.jsxs(W,{children:[t.jsx(L,{onClick:()=>c(!1),children:"Cancel"}),t.jsx(L,{disabled:F,variant:"contained",onClick:U,children:d?"Update":"Create"})]})]})]})};export{le as default};
