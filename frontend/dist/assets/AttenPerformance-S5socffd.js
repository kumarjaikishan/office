import{r as o,j as e,K as Fe,aD as Ce,aE as Ye,aF as Be,aG as We,aH as Pe,aI as ze,aJ as He,aK as $e,aL as _e,aM as Ke,g as Ge,a as Je,h as t,F as S,I as B,S as W,M as f,b as ue,B as Ue,aa as Xe,c as qe,y as Qe,aN as Ve}from"./index-BeSL47dy.js";import{i as Ze}from"./isSameOrBefore-B4QkV2FQ.js";import{a as ea}from"./index-cGiZ2zB0.js";import{P as aa,R as sa}from"./PieChart-4TbkvGeQ.js";import{u as ta,a as xe}from"./attandencehelper-WNzgIGdX.js";import{T as ra}from"./Tooltip-paUlJKPm.js";import"./index-I1CpH_OK.js";import"./Popper-Ds9D2A49.js";import"./index-D4dx4TtU.js";const na=({attandence:i,employee:s,hell:a})=>{var u,A,m,P,z,H,$,_,K,k,E,b;o.useEffect(()=>{},[i]);const r="https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",x=(((u=a==null?void 0:a.present)==null?void 0:u.length)||0)+(((A=a==null?void 0:a.absent)==null?void 0:A.length)||0)+(((m=a==null?void 0:a.leave)==null?void 0:m.length)||0),c=o.useMemo(()=>{var I,O,R;return{present:x?Math.floor(((I=a==null?void 0:a.present)==null?void 0:I.length)/x*100):0,absent:x?Math.floor(((O=a==null?void 0:a.absent)==null?void 0:O.length)/x*100):0,leave:x?Math.floor(((R=a==null?void 0:a.leave)==null?void 0:R.length)/x*100):0}},[a,x]),g=x?[{id:0,value:c.present,color:"teal",label:"Present"},{id:1,value:c.leave,color:"orange",label:"Leave"},{id:2,value:c.absent,color:"rgb(156 163 175)",label:"Absent"}]:[{id:0,value:100,color:"rgb(156 163 175)",label:"No record"}],w=window.innerWidth<600?{width:220,height:220}:{width:300,height:300},j=window.innerWidth<600?{innerRadius:95,outerRadius:110}:{innerRadius:130,outerRadius:150};return e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center min-h-[200px] bg-[#e0e4e7] p-1 space-y-1 md:space-y-0 md:space-x-2",children:[e.jsxs("div",{className:"relative  mb-2  w-60 h-60 md:w-80 md:h-80 flex items-center justify-center z-2 rounded-full",children:[e.jsx(aa,{series:[{innerRadius:j.innerRadius,outerRadius:j.outerRadius,data:g,paddingAngle:1,cornerRadius:5}],width:w.width,height:w.height,legend:{hidden:!0}}),e.jsx("div",{className:"absolute w-46 h-46 md:w-63 md:h-63 rounded-full overflow-hidden border-4 border-white",children:e.jsx("img",{src:(s==null?void 0:s.profileimage)||r,alt:(s==null?void 0:s.name)||"Employee",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-full md:w-[550px]",children:[e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Fe,{})," Total Days"]}),e.jsx("span",{className:"font-bold text-gray-600",children:x})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ce,{})," Present"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((P=a==null?void 0:a.present)==null?void 0:P.length)||0," Days"," ",c.present?`(${c.present}%)`:""]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ye,{})," Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((z=a==null?void 0:a.leave)==null?void 0:z.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Be,{})," Absent"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((H=a==null?void 0:a.absent)==null?void 0:H.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-12 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsx(ra,{placement:"top",enterDelay:800,arrow:!0,title:(a==null?void 0:a.overtimesalary)!==null?e.jsxs("div",{className:"flex gap-1 flex-col text-white",children:[e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Basic salary"}),e.jsxs("span",{children:[": ",s==null?void 0:s.salary," ₹"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Net Overtime"}),e.jsxs("span",{children:[": ",((a==null?void 0:a.overtimemin)||0)-((a==null?void 0:a.shorttimemin)||0)," min"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Payment"}),e.jsxs("span",{children:[": ",(a==null?void 0:a.overtimesalary)||0," ₹"]})]})]}):"",children:e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow cursor-help",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(We,{})," Overtime"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[(($=a==null?void 0:a.overtime)==null?void 0:$.length)||0," ",(a==null?void 0:a.overtimemin)>0&&`(${a==null?void 0:a.overtimemin} min)`]})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Pe,{})," Short Time"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((_=a==null?void 0:a.short)==null?void 0:_.length)||0," ",(a==null?void 0:a.shorttimemin)>0&&`(${a==null?void 0:a.shorttimemin} min)`]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8 flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(ze,{})," Late Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((K=a==null?void 0:a.latearrival)==null?void 0:K.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(He,{})," Early Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((k=a==null?void 0:a.earlyLeave)==null?void 0:k.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde flex flex-wrap md:flex-none md:flex-nowrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx($e,{})," Early Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((E=a==null?void 0:a.earlyarrival)==null?void 0:E.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(_e,{})," Late Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((b=a==null?void 0:a.lateleave)==null?void 0:b.length)||0})]})]})]})]})};t.extend(Ze);const va=()=>{var se;const{userid:i}=Ke(),[s,a]=o.useState(null),[r,x]=o.useState({}),[c,g]=o.useState([]),[w,j]=o.useState(!0),{company:u,holidays:A}=Ge(n=>n.user),[m,P]=o.useState(null),[z,H]=o.useState([]),[$,_]=o.useState([]),K=Je(),[k,E]=o.useState(t().year()),[b,I]=o.useState(t().month()),[O,R]=o.useState("all"),[D,V]=o.useState("all"),[G,Z]=o.useState("all"),[X,ee]=o.useState(null),[q,ae]=o.useState(null),[M,me]=o.useState({present:[],absent:[],leave:[],holiday:[],short:[],overtime:[],latearrival:[],earlyarrival:[],earlyLeave:[],lateleave:[],shorttimemin:0,overtimemin:0,overtimesalary:0}),fe=t().year(),he=Array.from({length:8},(n,l)=>fe+1-l),pe=Array.from({length:12},(n,l)=>({label:t().month(l).format("MMMM"),value:l}));o.useEffect(()=>{var l,h,d,p,T,L,F;if(!u||!r)return;const n=((l=r==null?void 0:r.branchId)==null?void 0:l.defaultsetting)==!1?{attendanceRules:(d=(h=r==null?void 0:r.branchId)==null?void 0:h.setting)==null?void 0:d.attendanceRules,workingMinutes:(T=(p=r==null?void 0:r.branchId)==null?void 0:p.setting)==null?void 0:T.workingMinutes,weeklyOffs:(F=(L=r==null?void 0:r.branchId)==null?void 0:L.setting)==null?void 0:F.weeklyOffs}:{attendanceRules:u==null?void 0:u.attendanceRules,workingMinutes:u==null?void 0:u.workingMinutes,weeklyOffs:u==null?void 0:u.weeklyOffs};P(n)},[u,r]),o.useEffect(()=>{if(!A)return;const n=[];A.forEach(l=>{let h=t(l.fromDate);const d=l.toDate?t(l.toDate):h;for(;h.isSameOrBefore(d,"day");)n.push(h.format("DD/MM/YYYY")),h=h.add(1,"day")}),H(n)},[A]),o.useEffect(()=>{if(!i)return;(async()=>{var h,d;const l=localStorage.getItem("emstoken");try{j(!0);const p=await qe.get("/api/employeeAttandence",{params:{userid:i},headers:{Authorization:`Bearer ${l}`}});x(p.data.employee),a(p.data.user),g(p.data.attandence)}catch(p){if(console.error("Failed to fetch performance data:",p),p.status==403){swal({title:"Access Denied",text:p.response.data.message||"You are not authorized to manage this tournament.",icon:"warning"}),K("/");return}Qe.warning(((d=(h=p.response)==null?void 0:h.data)==null?void 0:d.message)||"error")}finally{j(!1)}})()},[i]),o.useEffect(()=>{if(!c.length||!m)return;const n=c.filter(v=>{const y=t(v.date);return y.year()===k&&(b==="all"||y.month()===b)}),l=[],h=[],d=[],p=[],T=[],L=[],F=[],te=[],re=[],ne=[];let Q=0,J=0,U=[];n.forEach(v=>{const y=t(v.date).toDate();let je=t(v.date).format("DD/MM/YYYY");const{punchIn:C,punchOut:Y,workingMinutes:N}=v,ie=z.includes(je),ge=t(v.date).startOf("day").day(),le=m==null?void 0:m.weeklyOffs.includes(ge),de=v.status=="leave",oe=v.status=="absent";ie&&!de&&!oe&&N?U.push({...v,remarks:"worked on holiday"}):le&&!de&&!oe&&N?U.push({...v,remarks:"worked on weekly off"}):U.push(v);const ce=v.status;switch(ce){case"present":l.push(y);break;case"absent":h.push(y);break;case"leave":d.push(y);break;case"holiday":p.push(y);break}if(ce!=="present"||!C||!Y||typeof N!="number")return;if(ie||le)L.push(y),J+=N;else{const Re=N<m.workingMinutes.shortDayThreshold,Te=N>m.workingMinutes.overtimeAfterMinutes;Re&&(T.push(y),Q+=m.workingMinutes.shortDayThreshold-N),Te&&(L.push(y),J+=N-m.workingMinutes.overtimeAfterMinutes)}const[be,we]=m.attendanceRules.considerEarlyEntryBefore.split(":").map(Number),[Ne,ke]=m.attendanceRules.considerLateEntryAfter.split(":").map(Number),Me=t(C).startOf("day").add(be,"hour").add(we,"minute"),Se=t(C).startOf("day").add(Ne,"hour").add(ke,"minute");t(C).isBefore(Me)&&te.push(y),t(C).isAfter(Se)&&F.push(y);const[Ae,Oe]=m.attendanceRules.considerEarlyExitBefore.split(":").map(Number),[De,Le]=m.attendanceRules.considerLateExitAfter.split(":").map(Number),Ee=t(Y).startOf("day").add(Ae,"hour").add(Oe,"minute"),Ie=t(Y).startOf("day").add(De,"hour").add(Le,"minute");t(Y).isBefore(Ee)&&re.push(y),t(Y).isAfter(Ie)&&ne.push(y)}),_(U),me({present:l,absent:h,leave:d,holiday:p,short:T,overtime:L,shorttimemin:Q,overtimemin:J,latearrival:F,earlyarrival:te,earlyLeave:re,lateleave:ne,overtimesalary:b!=="all"?Math.floor((J-Q)*parseFloat(r.salary/t(new Date(k,b)).daysInMonth()/m.workingMinutes.overtimeAfterMinutes)):null})},[c,k,b,m]);const ye=$.filter(n=>{const l=t(n.date).startOf("day");return!(X&&l.isBefore(t(X))||q&&l.isAfter(t(q))||O!=="all"&&n.status!==O||D!=="all"&&!(D==="earlyLeave"&&M.earlyLeave.some(d=>t(d).isSame(l,"day"))||D==="lateleave"&&M.lateleave.some(d=>t(d).isSame(l,"day"))||D==="earlyarrival"&&M.earlyarrival.some(d=>t(d).isSame(l,"day"))||D==="latearrival"&&M.latearrival.some(d=>t(d).isSame(l,"day")))||G!=="all"&&!(G==="short"&&M.short.some(d=>t(d).isSame(l,"day"))||G==="overtime"&&M.overtime.some(d=>t(d).isSame(l,"day"))))}),ve=()=>{E(t().year()),I("all"),R("all"),V("all"),Z("all"),ee(null),ae(null)};return e.jsxs("div",{className:"p-1 md:p-4 capitalize bg-gray-200",children:[w&&e.jsx("p",{children:"Loading performance data..."}),e.jsxs("div",{className:"p-1 py-3 md:p-3 flex flex-wrap gap-1 md:gap-3 items-center justify-between rounded shadow bg-white mb-4",children:[e.jsxs("div",{className:"gap-3 md:gap-3 flex",children:[e.jsxs(S,{className:"w-[90px]   md:w-[120px]",size:"small",children:[e.jsx(B,{children:"Year"}),e.jsx(W,{value:k,label:"Year",onChange:n=>E(n.target.value),children:he.map(n=>e.jsx(f,{value:n,children:n},n))})]}),e.jsxs(S,{size:"small",className:"w-[130px]  md:w-[160px]",children:[e.jsx(B,{children:"Month"}),e.jsxs(W,{value:b,label:"Month",onChange:n=>I(n.target.value),children:[e.jsx(f,{value:"all",children:"All"}),pe.map(n=>e.jsx(f,{value:n.value,children:n.label},n.label))]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("p",{className:"font-semibold text-sm md:text-lg",children:s==null?void 0:s.name}),e.jsxs("p",{className:"text-[12px] md:text-sm text-gray-600",children:["(",(se=r==null?void 0:r.branchId)==null?void 0:se.name,")"]})]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx(na,{employee:r,user:s,attandence:c,hell:M}),e.jsxs("div",{className:"p-1 py-4 md:p-4 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 rounded shadow bg-white my-4",children:[e.jsxs(S,{size:"small",sx:{minWidth:120},children:[e.jsx(B,{children:"Type"}),e.jsxs(W,{value:D,label:"Type",onChange:n=>V(n.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"earlyLeave",children:"Early Leave"}),e.jsx(f,{value:"lateleave",children:"Late Leave"}),e.jsx(f,{value:"earlyarrival",children:"Early Arrival"}),e.jsx(f,{value:"latearrival",children:"Late Arrival"})]})]}),e.jsxs(S,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Status"}),e.jsxs(W,{value:O,label:"Status",onChange:n=>R(n.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"present",children:"Present"}),e.jsx(f,{value:"leave",children:"Leave"}),e.jsx(f,{value:"absent",children:"Absent"}),e.jsx(f,{value:"weekly off",children:"Weekly off"}),e.jsx(f,{value:"holiday",children:"Holiday"}),e.jsx(f,{value:"half day",children:"Half Day"})]})]}),e.jsxs(S,{size:"small",sx:{minWidth:150},children:[e.jsx(B,{children:"Over/Short"}),e.jsxs(W,{value:G,label:"over/short",onChange:n=>Z(n.target.value),children:[e.jsx(f,{value:"all",children:"All"}),e.jsx(f,{value:"overtime",children:"Overtime"}),e.jsx(f,{value:"short",children:"Short Time"})]})]}),e.jsx(S,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"From Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:X||"",onChange:n=>ee(n.target.value)})}),e.jsx(S,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"To Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:q||"",onChange:n=>ae(n.target.value)})}),e.jsx(Ue,{variant:"outlined",color:"secondary",onClick:ve,sx:{alignSelf:"flex-end",minWidth:100},startIcon:e.jsx(sa,{}),children:"Reset"})]}),e.jsx(Xe,{columns:da(m),data:ye,pagination:!0,customStyles:ta(),conditionalRowStyles:la,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(ea,{className:"text-xl"})," No records found matching your criteria."]})})]})]})},ia=i=>{const s=Math.floor(i/60),a=i%60;return`${s}h ${a}m`},la=[{when:i=>i.remarks,style:{backgroundColor:"rgba(21, 233, 233, 0.2)"}}],da=i=>[{name:"Date",selector:s=>t(s.date).format("DD MMM, YYYY"),sortable:!0,style:{minWidth:"100px"}},{name:"Punch In",style:{minWidth:"140px"},selector:s=>s.punchIn,cell:s=>{var j,u;if(!s.punchIn)return"-";const[a,r]=(j=i==null?void 0:i.attendanceRules)==null?void 0:j.considerEarlyEntryBefore.split(":").map(Number),[x,c]=(u=i==null?void 0:i.attendanceRules)==null?void 0:u.considerLateEntryAfter.split(":").map(Number),g=t(s.punchIn).startOf("day").add(a,"hour").add(r,"minute"),w=t(s.punchIn).startOf("day").add(x,"hour").add(c,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"text-[16px] text-blue-700"}),t(s.punchIn).format("hh:mm A"),!s.remarks&&t(s.punchIn).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchIn).isAfter(w)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Late"})]})}},{name:"Punch Out",style:{minWidth:"140px"},selector:s=>s.punchOut,cell:s=>{var j,u;if(!s.punchOut)return"-";const[a,r]=(j=i==null?void 0:i.attendanceRules)==null?void 0:j.considerEarlyExitBefore.split(":").map(Number),[x,c]=(u=i==null?void 0:i.attendanceRules)==null?void 0:u.considerLateExitAfter.split(":").map(Number),g=t(s.punchOut).startOf("day").add(a,"hour").add(r,"minute"),w=t(s.punchOut).startOf("day").add(x,"hour").add(c,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"text-[16px] text-blue-700"}),t(s.punchOut).format("hh:mm A"),!s.remarks&&t(s.punchOut).isBefore(g)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchOut).isAfter(w)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Late"})]})}},{name:"Status",selector:s=>s.status,cell:s=>{const{status:a}=s,{leave:r}=s,c={absent:"bg-red-100 text-red-800",leave:"bg-violet-100 text-violet-800",present:"bg-green-100 text-green-800",holiday:"bg-blue-100 text-blue-800"}[a]||"bg-gray-100 text-gray-800";return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`${c} px-2 py-1 rounded text-xs`,children:a}),r&&(r==null?void 0:r.reason)&&e.jsxs("span",{title:r==null?void 0:r.reason,className:"ml-1 text-blue-600 text-lg font-bold",children:[" ",e.jsx(Ve,{})," "]})]})},style:{minWidth:"120px"}},{name:"Working Hours",style:{minWidth:"180px"},selector:s=>s.workingMinutes,cell:s=>{var r,x,c,g;const a=s.workingMinutes;return a?e.jsxs("span",{className:" flex",children:[e.jsx("span",{className:"block w-[60px] ",children:ia(a)}),!s.remarks&&a<((r=i==null?void 0:i.workingMinutes)==null?void 0:r.shortDayThreshold)&&e.jsxs("span",{className:" block w-[100px] px-2 py-0.5 rounded bg-amber-100 text-amber-900 text-xs",children:["Short ",((x=i==null?void 0:i.workingMinutes)==null?void 0:x.shortDayThreshold)-a," min"]}),!s.remarks&&a>((c=i==null?void 0:i.workingMinutes)==null?void 0:c.overtimeAfterMinutes)&&e.jsxs("span",{className:"px-2 block w-[115px] py-0.5  rounded bg-green-100 text-green-900 text-xs",children:["Overtime ",a-((g=i==null?void 0:i.workingMinutes)==null?void 0:g.overtimeAfterMinutes)," min"]})]}):"-"}},{name:"Remarks",selector:s=>s.remarks&&`${(s==null?void 0:s.workingMinutes)||0} minutes  ${s.remarks}`}];export{va as default};
