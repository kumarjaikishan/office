import{r as b,o as ze,af as Pe,p as fe,q as $e,t as Oe,T as ae,j as e,w as Be,ag as Le,ah as te,ai as ve,u as ue,g as be,b as f,F as X,I as K,S as Z,M as G,A as de,l as Me,O as ce,a3 as ne,B as P,c as W,y as w,D as Y,a1 as ye,a4 as We,i as Te,C as Fe,aa as Ae,ab as me,aj as Re,a2 as qe,ak as _e,ac as H,ad as V,k as Ue,h as He,al as Ve,am as Ge,a5 as le,an as we,ao as Ne}from"./index-C35MsjE7.js";import{C as oe}from"./Checkbox-PsqdHKAm.js";import{F as Je}from"./FormControlLabel-Ccu3Cd4z.js";import{u as De,I as Ce}from"./attandencehelper-DQxgSfnb.js";import{A as je,a as Ye}from"./index-zmt7Lw9T.js";import{u as Ee}from"./imageresizer-D4I-KFLq.js";import"./SwitchBase-DFF6S7J3.js";const Ze=o=>{const{classes:y,inset:C,primary:u,secondary:c,dense:N}=o;return Be({root:["root",C&&"inset",N&&"dense",u&&c&&"multiline"],primary:["primary"],secondary:["secondary"]},Le,y)},Qe=$e("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(o,y)=>{const{ownerState:C}=o;return[{[`& .${te.primary}`]:y.primary},{[`& .${te.secondary}`]:y.secondary},y.root,C.inset&&y.inset,C.primary&&C.secondary&&y.multiline,C.dense&&y.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${ve.root}:where(& .${te.primary})`]:{display:"block"},[`.${ve.root}:where(& .${te.secondary})`]:{display:"block"},variants:[{props:({ownerState:o})=>o.primary&&o.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:o})=>o.inset,style:{paddingLeft:56}}]}),ie=b.forwardRef(function(y,C){const u=ze({props:y,name:"MuiListItemText"}),{children:c,className:N,disableTypography:m=!1,inset:v=!1,primary:O,primaryTypographyProps:D,secondary:x,secondaryTypographyProps:q,slots:S={},slotProps:B={},...L}=u,{dense:t}=b.useContext(Pe);let g=O??c,z=x;const a={...u,disableTypography:m,inset:v,primary:!!g,secondary:!!z,dense:t},j=Ze(a),h={slots:S,slotProps:{primary:D,secondary:q,...B}},[I,F]=fe("root",{className:Oe(j.root,N),elementType:Qe,externalForwardedProps:{...h,...L},ownerState:a,ref:C}),[T,i]=fe("primary",{className:j.primary,elementType:ae,externalForwardedProps:h,ownerState:a}),[A,M]=fe("secondary",{className:j.secondary,elementType:ae,externalForwardedProps:h,ownerState:a});return g!=null&&g.type!==ae&&!m&&(g=e.jsx(T,{variant:t?"body2":"body1",component:i!=null&&i.variant?void 0:"span",...i,children:g})),z!=null&&z.type!==ae&&!m&&(z=e.jsx(A,{variant:"body2",color:"textSecondary",...M,children:z})),e.jsxs(I,{...F,children:[g,z]})}),ke=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Xe=({setopenviewmodal:o,employee:y,company:C,editbranch:u,editbranchdata:c})=>{const N={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[m,v]=b.useState(N),O=ue(),{adminManager:D}=be(a=>a.user),[x,q]=b.useState([]),S=localStorage.getItem("emstoken");b.useEffect(()=>{v(a=>({...a,companyId:C._id})),u&&v(a=>({...a,...c}))},[C,u]),b.useEffect(()=>{(D==null?void 0:D.length)>0&&q(D.filter(a=>a.role==="manager"))},[D]);const B=()=>{o(!1),v(N)},L=(a,j)=>{v(h=>({...h,[a]:j}))},t=(a,j,h)=>{v(I=>({...I,setting:{...I.setting,[a]:{...I.setting[a],[j]:h}}}))},g=async()=>{var a,j;try{const h=await W.post("/api/addBranch",m,{headers:{Authorization:`Bearer ${S}`}});w.success(h.data.message),o(!1),O(Y()),B()}catch(h){console.error(h),w.error(((j=(a=h==null?void 0:h.response)==null?void 0:a.data)==null?void 0:j.message)||"Error adding branch")}},z=async()=>{var a,j;try{const h=await W.post("/api/editBranch",m,{headers:{Authorization:`Bearer ${S}`}});w.success(h.data.message),O(Y()),o(!1),B()}catch(h){console.error(h),w.error(((j=(a=h==null?void 0:h.response)==null?void 0:a.data)==null?void 0:j.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:u?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(f,{label:"Branch Name",fullWidth:!0,size:"small",value:m.name,onChange:a=>L("name",a.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(f,{label:"Location",fullWidth:!0,size:"small",value:m.location,onChange:a=>L("location",a.target.value),helperText:"City, State or Address"}),e.jsxs(X,{size:"small",fullWidth:!0,children:[e.jsx(K,{children:"Managers"}),e.jsx(Z,{multiple:!0,value:(m==null?void 0:m.managerIds)||[],onChange:a=>L("managerIds",a.target.value),input:e.jsx(ce,{label:"Managers"}),renderValue:a=>a.map(j=>{var h;return((h=x.find(I=>I._id===j))==null?void 0:h.name)||"Unknown"}).join(", "),children:x&&x.length>0?x.map(a=>{var j;return e.jsxs(G,{value:a._id,children:[e.jsx(oe,{checked:(j=m==null?void 0:m.managerIds)==null?void 0:j.includes(a._id)}),e.jsx(de,{src:a==null?void 0:a.profileImage,alt:a==null?void 0:a.name,children:!(a!=null&&a.profileImage)&&e.jsx(Me,{})}),e.jsx(ie,{className:"ml-2 capitalize",primary:a==null?void 0:a.name})]},a._id)}):e.jsx(G,{disabled:!0,value:"",children:e.jsx(ie,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(Je,{control:e.jsx(oe,{checked:!m.defaultsetting,onChange:a=>v(j=>({...j,defaultsetting:!a.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!m.defaultsetting&&e.jsx("div",{className:"border-primary border-2 border-dashed rounded mt-3 py-3 px-1",children:e.jsxs(ne,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(f,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:m.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:a=>t("officeTime","in",a.target.value),helperText:"Time when office hours begin"}),e.jsx(f,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:m.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:a=>t("officeTime","out",a.target.value),helperText:"Time when office hours end"}),e.jsx(f,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.officeTime.breakMinutes,onChange:a=>t("officeTime","breakMinutes",Number(a.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(f,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.fullDay,onChange:a=>t("workingMinutes","fullDay",Number(a.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(f,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.halfDay,onChange:a=>t("workingMinutes","halfDay",Number(a.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(f,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.shortDayThreshold,onChange:a=>t("workingMinutes","shortDayThreshold",Number(a.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(f,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:m.setting.workingMinutes.overtimeAfterMinutes,onChange:a=>t("workingMinutes","overtimeAfterMinutes",Number(a.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(X,{size:"small",fullWidth:!0,children:[e.jsx(K,{children:"Weekly Offs"}),e.jsx(Z,{multiple:!0,value:m.setting.weeklyOffs,onChange:a=>v(j=>({...j,setting:{...j.setting,weeklyOffs:a.target.value}})),input:e.jsx(ce,{label:"Weekly Offs"}),renderValue:a=>a.map(j=>{var h;return(h=ke.find(I=>I.value===j))==null?void 0:h.label}).join(", "),children:ke.map(a=>e.jsxs(G,{value:a.value,children:[e.jsx(oe,{checked:m.setting.weeklyOffs.includes(a.value)}),e.jsx(ie,{primary:a.label})]},a.value))})]}),Object.entries(m.setting.attendanceRules).map(([a,j])=>{const h=a.replace(/([A-Z])/g," $1").replace(/^./,F=>F.toUpperCase()),I={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(f,{fullWidth:!0,size:"small",label:h,type:"time",value:j,onChange:F=>v(T=>({...T,setting:{...T.setting,attendanceRules:{...T.setting.attendanceRules,[a]:F.target.value}}})),helperText:I[a]},a)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(P,{variant:"outlined",onClick:B,children:"Cancel"}),u?e.jsx(P,{variant:"contained",onClick:z,children:"Save"}):e.jsx(P,{variant:"contained",onClick:g,children:"Add Branch"})]})]})},Ke=async({companyinp:o,setisload:y})=>{const C=localStorage.getItem("emstoken");y(!0);try{const u=await W.post("/api/addcompany",{name:o.name,industry:o.industry},{headers:{Authorization:`Bearer ${C}`}});console.log("Query:",u),w.success(u.data.message,{autoClose:1200})}catch(u){console.log(u),u.response?w.warn(u.response.data.message,{autoClose:1200}):u.request?console.error("No response from server:",u.request):console.error("Error:",u.message)}finally{y(!1)}},es=[{name:"S.no",selector:o=>o.sno,width:"40px"},{name:"Branch",selector:o=>o.branch},{name:"Department",selector:o=>o.dep_name},{name:"Action",selector:o=>o.action,width:"80px"}],ss=async({inp:o,setisload:y,setInp:C,setopenmodal:u,init:c,dispatch:N})=>{console.log(o);const{branchId:m,department:v,description:O}=o;if(!v){alert("Please fill in both fields");return}const D=localStorage.getItem("emstoken");y(!0);try{const x=await W.post("/api/adddepartment",{department:v,branchId:m,description:O},{headers:{Authorization:`Bearer ${D}`}});N(Y()),w.success(x.data.message,{autoClose:1200}),C(c),u(!1)}catch(x){console.log(x),x.response?w.warn(x.response.data.message,{autoClose:1200}):x.request?console.error("No response from server:",x.request):console.error("Error:",x.message)}finally{y(!1)}},as=async({inp:o,setisload:y,setInp:C,setopenmodal:u,init:c,dispatch:N})=>{const{departmentId:m,department:v,description:O}=o;if(!v||!m){alert("All fileds are Required");return}const D=localStorage.getItem("emstoken");y(!0);try{const x=await W.post("/api/updatedepartment",{departmentId:m,department:v,description:O},{headers:{Authorization:`Bearer ${D}`}});N(Y()),w.success(x.data.message,{autoClose:1200}),C(c),u(!1)}catch(x){console.log(x),x.response?w.warn(x.response.data.message,{autoClose:1200}):x.request?console.error("No response from server:",x.request):console.error("Error:",x.message)}finally{y(!1)}},ts=async({departmentId:o,setisload:y,dispatch:C})=>{if(!o){alert("All fileds are Required");return}const u=localStorage.getItem("emstoken");y(!0);try{const c=await W.post("/api/deletedepartment",{departmentId:o},{headers:{Authorization:`Bearer ${u}`}});C(Y()),w.success(c.data.message,{autoClose:1200})}catch(c){console.log(c),c.response?w.warn(c.response.data.message,{autoClose:1200}):c.request?console.error("No response from server:",c.request):console.error("Error:",c.message)}finally{y(!1)}},ls=()=>{const[o,y]=b.useState(!1),[C,u]=b.useState(!1),[c,N]=b.useState([]),[m,v]=b.useState(!1),[O,D]=b.useState([]),{branch:x,department:q}=be(i=>i.user),[S,B]=b.useState({branch:"all",department:" "}),L=S.branch!=="all"||S.department.trim()!=="",t=ue();b.useEffect(()=>{if(!c||c.length===0)return;const i=c.filter(A=>{var _;const M=S.branch==="all"||A.branchid===S.branch,J=S.department.trim()===""||((_=A.dep_name)==null?void 0:_.toLowerCase().includes(S.department.trim().toLowerCase()));return M&&J});D(i)},[S,c]);const g={departmentId:"",branchId:"",department:"",description:""},[z,a]=b.useState(g);b.useEffect(()=>{if(q.length>0){let i=1;const A=q.map(M=>{var J,_;return{id:M._id,sno:i++,branchid:(J=M==null?void 0:M.branchId)==null?void 0:J._id,branch:(_=M==null?void 0:M.branchId)==null?void 0:_.name,dep_name:M==null?void 0:M.department,action:e.jsxs("div",{className:"action",children:[e.jsx("span",{className:"edit",title:"Edit",onClick:()=>I(M),children:e.jsx(ye,{})}),e.jsx("span",{className:"delete",onClick:()=>F(M._id),children:e.jsx(je,{})})]})}});N(A)}},[q]);const j=(i,A)=>{a({...z,[A]:i.target.value})},h=i=>{i.preventDefault(),ss({inp:z,setisload:u,setInp:a,setopenmodal:y,init:g,dispatch:t})},I=i=>{console.log("edit",i),v(!0),a({branchId:i.branchId._id,departmentId:i._id,department:i.department,description:i.description}),y(!0)},F=i=>{console.log("delete",i),We({title:"Are you sure?",text:"Once deleted, All empoyee of this department deleted",icon:"warning",buttons:!0,dangerMode:!0}).then(async A=>{A&&ts({departmentId:i,setisload:u,dispatch:t})})},T=()=>{as({inp:z,setisload:u,setInp:a,setopenmodal:y,init:g,dispatch:t})};return e.jsxs("div",{className:"department pt-3",children:[e.jsxs("div",{className:"head flex flex-wrap gap-1",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-around md:w-auto",children:[e.jsxs(X,{className:"w-[48%] md:w-[150px]",size:"small",children:[e.jsx(K,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsxs(Z,{value:S.branch,onChange:i=>B({...S,branch:i.target.value}),input:e.jsx(ce,{startAdornment:e.jsx(Te,{position:"start",children:e.jsx(Fe,{fontSize:"small"})}),label:"branch"}),children:[e.jsx(G,{selected:!0,value:"all",children:"All"}),x==null?void 0:x.map(i=>e.jsx(G,{value:i._id,children:i.name},i._id))]})]}),e.jsx(f,{size:"small",id:"outlined-basic",value:S.department,onChange:i=>B({...S,department:i.target.value}),variant:"outlined",label:"Search Department"})]}),e.jsx(P,{className:"w-full md:w-auto",variant:"contained",onClick:()=>y(!0),children:"Add Department"})]}),e.jsx("div",{className:"list",children:e.jsx(Ae,{customStyles:De(),columns:es,data:L?O:c,pagination:!0,highlightOnHover:!0})}),e.jsx(me,{open:o,onClose:()=>y(!1),children:e.jsx("div",{className:"membermodal w-[650px]",children:e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:"Add Department"}),e.jsx("form",{onSubmit:h,children:e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs(X,{sx:{width:"98%"},size:"small",children:[e.jsx(K,{id:"demo-simple-select-helper-label",children:"Branch"}),e.jsx(Z,{value:z.branchId,label:"branch",onChange:i=>j(i,"branchId"),children:x==null?void 0:x.map(i=>e.jsx(G,{value:i._id,children:i.name},i._id))})]}),e.jsx(f,{sx:{width:"98%"},required:!0,value:z.department,onChange:i=>j(i,"department"),label:"Department",size:"small"}),e.jsx(f,{multiline:!0,rows:4,onChange:i=>j(i,"description"),value:z.description,sx:{width:"98%"},label:"Description",size:"small"})]})})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(P,{size:"small",onClick:()=>{y(!1),v(!1),a(g)},variant:"outlined",children:" cancel"}),!m&&e.jsx(P,{sx:{mr:2},loading:C,loadingPosition:"end",endIcon:e.jsx(Ce,{}),onClick:h,variant:"contained",type:"submit",children:"Add"}),m&&e.jsx(P,{sx:{mr:2},loading:C,loadingPosition:"end",endIcon:e.jsx(Ce,{}),variant:"contained",onClick:T,children:"Update"})]})]})})})]})},re={1:"Read",2:"Create",3:"Update",4:"Delete"},Se=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],ge={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},rs={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function ns(){const[o,y]=b.useState([]),[C,u]=b.useState([]),[c,N]=b.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ge}}),m=ue();b.useEffect(()=>{i()},[]);const v=b.useRef(null),{handleImage:O}=Ee(),[D,x]=b.useState(null),[q,S]=b.useState(!1),[B,L]=b.useState(""),[t,g]=b.useState(!1),[z,a]=b.useState(null),j=l=>{a(d=>d===l?null:l)},h=()=>{N({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ge}}),L(""),x(null),S(!1)},[I,F]=b.useState({userid:"",pass:""}),T=async()=>{const l={...c},d=new FormData;u(!0);try{const s=l.profileImage?await O(240,l.profileImage):null;s&&d.append("photo",s),d.append("name",l.name),d.append("email",l.email),d.append("role",l.role),d.append("password",l.password),d.append("permissions",JSON.stringify(l.permissions));const r=localStorage.getItem("emstoken");u(!0);const n=D!==null?`/api/editAdmin/${o[D]._id}`:"/api/addAdmin",k=await W["post"](n,d,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}});w.success(k.data.message,{autoClose:1200}),h(),i(),m(Y())}catch(s){console.error(s),s.response?w.warn(s.response.data.message,{autoClose:1200}):w.error("Something went wrong",{autoClose:1200})}finally{u(!1)}},i=async()=>{try{const l=localStorage.getItem("emstoken");u(!0);const d=await W.get("/api/getAdmin",{headers:{Authorization:`Bearer ${l}`}});y(d.data)}catch(l){console.error(l),l.response?w.warn(l.response.data.message,{autoClose:1200}):w.error("Something went wrong",{autoClose:1200})}finally{u(!1)}},A=l=>{const d=o[l];console.log(d),N({...d,profilePreview:d.profileImage||"",profileImage:null}),x(l),S(!0)},M=async l=>{l.preventDefault();try{const d=localStorage.getItem("emstoken"),s=await W.post("/api/updatepassword",{pass:I},{headers:{Authorization:`Bearer ${d}`}});F({userid:"",pass:""}),g(!1),w.success(s.data.message,{autoClose:1200})}catch(d){console.log(d),d.response?w.warn(d.response.data.message,{autoClose:1200}):d.request?console.error("No response from server:",d.request):console.error("Error:",d.message)}},J=async l=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async d=>{var s,r;if(d){let n;try{const p=localStorage.getItem("emstoken");u(!0),n=w.loading("Deleting...");const k=await W.delete(`/api/deleteAdmin/${l}`,{headers:{Authorization:`Bearer ${p}`}});w.update(n,{render:k.data.message,type:"success",isLoading:!1,autoClose:1800}),i(),m(Y())}catch(p){console.error(p),w.update(n,{render:((r=(s=p.response)==null?void 0:s.data)==null?void 0:r.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{u(!1)}}})},_=(l,d)=>{N(s=>{const r=s.permissions[l]||[],p=r.includes(d)?r.filter(k=>k!==d):[...r,d].sort();return{...s,permissions:{...s.permissions,[l]:p}}})},he=l=>{const d=l==="admin"?{...ge}:{...rs};N({...c,role:l,permissions:d})},pe=l=>{const d=l.target.files[0];d&&N(s=>({...s,profileImage:d,profilePreview:URL.createObjectURL(d)}))},xe=()=>{B&&(N(l=>({...l,permissions:{...l.permissions,[B]:[]}})),L(""))},ee=Array.from(new Set([...c.role==="admin"?Se:Object.keys(c.permissions),...Object.keys(c.permissions)])),se=Se.filter(l=>!ee.includes(l));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:" shadow-md rounded-lg",children:[e.jsx("div",{className:"flex justify-between flex-wrap items-center mb-4",children:e.jsx(P,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{h(),S(!0)},children:"Add Admin/ Manager"})}),o.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:o.map((l,d)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(de,{sx:{width:60,height:60},alt:l.name,src:l==null?void 0:l.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[l.name," (",l.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:l.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{title:"Edit",className:"p-2 border rounded hover:bg-gray-100",onClick:()=>A(d),children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx("button",{title:"Password Reset",className:"p-2 border rounded hover:bg-gray-100 text-green-500",onClick:()=>{F({...I,userid:l._id}),g(!0)},children:e.jsx(qe,{className:"h-4 w-4 "})}),e.jsx("button",{title:"Delete",className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>J(l._id),children:e.jsx(_e,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>j(d),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",z===d?"Hide Permissions":"View Permissions "]}),z===d?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),z===d&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(re).map(s=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:s},s))]})}),e.jsx("tbody",{children:Object.entries(l.permissions).map(([s,r])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:s}),Object.keys(re).map(n=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:r.includes(Number(n))?"✅":"-"},n))]},s))})]})]})]})]},d))})]}),e.jsx(me,{open:q,onClose:()=>S(!1),children:e.jsx("div",{className:"membermodal w-[660px]",children:e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"modalhead",children:[" ",D!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-full",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:pe,ref:v,accept:"image/*",name:"",id:"fileInput"}),e.jsx(de,{sx:{width:70,height:70},alt:c.name,src:c.profilePreview}),e.jsx("span",{onClick:()=>v.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(ye,{size:18})})]}),e.jsx(f,{fullWidth:!0,required:!0,value:c.name,onChange:l=>N({...c,name:l.target.value}),label:"Name",size:"small"}),e.jsx(f,{fullWidth:!0,required:!0,value:c.email,onChange:l=>N({...c,email:l.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),D==null&&e.jsxs(e.Fragment,{children:[e.jsx(f,{fullWidth:!0,required:!0,value:c.password,type:"password",onChange:l=>N({...c,password:l.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:c.role,onChange:l=>he(l.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]})]}),c.role==="manager"&&e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border p-2 flex-3 rounded ",value:B,onChange:l=>L(l.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),se.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsx(P,{variant:"contained",onClick:xe,className:"flex-1",children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(re).map(([l,d])=>e.jsx("th",{className:"border p-2 text-center",children:d},l))]})}),e.jsx("tbody",{children:ee.map(l=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:l}),Object.keys(re).map(d=>{var s;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((s=c.permissions[l])==null?void 0:s.includes(Number(d)))||!1,onChange:()=>_(l,Number(d))})},d)})]},l))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(P,{variant:"outlined",onClick:h,children:"Cancel"}),e.jsx(P,{variant:"contained",onClick:T,loading:C,children:D!==null?"Update":"Create"})]})]})})}),e.jsx(me,{open:t,onClose:()=>{g(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:M,children:[e.jsx("h2",{children:"Reset Passowrd"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsx(f,{fullWidth:!0,inputProps:{minLength:3,maxLength:10},required:!0,value:I.pass,onChange:l=>F({...I,pass:l.target.value}),label:"Passowrd",size:"small"}),e.jsx(P,{variant:"contained",sx:{mr:2},type:"submit",children:"Reset Password"})]})]})})})]})}const Ie=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function ps(){var se,l,d;const[o,y]=b.useState(null),[C,u]=b.useState(!1),[c,N]=b.useState(!1),[m,v]=b.useState(!1),{handleImage:O}=Ee(),[D,x]=b.useState(null),[q,S]=b.useState(!1),[B,L]=b.useState(!1),[t,g]=b.useState({name:"",address:"",contact:"",fullname:"",deviceSN:"",devices:[{SN:"BJ2C194460597",name:"Head Branch",online:!1}],telegram:{token:"",groupId:""},telegramNotifcation:!1,officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"},payrollPolicies:{allowances:[],bonuses:[],deductions:[]}}),z=()=>{g({...t,devices:[...t.devices,{SN:"",name:"",online:!1}]})},a=s=>{swal({title:"Delete this device?",icon:"warning",buttons:!0,dangerMode:!0}).then(r=>{if(r){const n=t.devices.filter((p,k)=>k!==s);g({...t,devices:n})}})},j=ue(),{employee:h,company:I,branch:F,profile:T}=be(s=>s.user),i=s=>{y(r=>r===s?null:s)};b.useEffect(()=>{I&&g(I)},[I]);const A=(s,r,n)=>{g(p=>({...p,[s]:{...p[s],[r]:n}}))},M=async s=>{s.preventDefault();try{v(!0);const r=localStorage.getItem("emstoken"),n=await W.post("/api/updateCompany",{...t},{headers:{Authorization:`Bearer ${r}`}});j(Y()),w.success(n.data.message,{autoClose:1800})}catch(r){console.log(r),r.response?w.warn(r.response.data.message,{autoClose:2700}):r.request?console.error("No response from server:",r.request):console.error("Error:",r.message)}finally{v(!1)}},J=()=>{},_=s=>{var n;u(!0);const r={...s,managerIds:(n=s==null?void 0:s.managerIds)==null?void 0:n.map(p=>p._id)};x(r),N(!0)},he=De(),pe=s=>s?Date.now()-new Date(s).getTime()<6e4:!1,xe=async s=>{const r=`/api/refreshDevice/${s}`;try{S(!0);const n=localStorage.getItem("emstoken"),p=await W.get(r,{headers:{Authorization:`Bearer ${n}`}});g(k=>({...k,devices:p.data.devices}))}catch(n){console.log(n),n.response?w.warn(n.response.data.message,{autoClose:2700}):n.request?console.error("No response from server:",n.request):console.error("Error:",n.message)}finally{S(!1)}},ee=async()=>{var s,r;L(!0);try{const n=await W.get(`https://api.telegram.org/bot${t.telegram.token}/getUpdates`);if(n.data.result.length>0){let p={},k={};n.data.result.forEach(E=>{var $,R;if((($=E.message)==null?void 0:$.chat.type)==="group"){let Q=E.message.chat.id;p.hasOwnProperty(Q)||(p[Q]={groupId:Math.abs(E.message.chat.id),groupName:E.message.chat.title||""})}if((R=E.message)!=null&&R.from){let Q=E.message.from.id;k.hasOwnProperty(Q)||(k[Q]={name:E.message.from.first_name,username:E.message.from.username||""})}});let U=Object.values(p).map((E,$)=>`<label style="display:block;margin:5px 0 , texal">
               <input type="radio" name="groupRadio" value="${E.groupId}" ${$===0?"checked":""} />
               ${E.groupName}
               
             </label>`).join("");swal({title:"Select a Group",content:{element:"div",attributes:{innerHTML:U}},buttons:{cancel:"Cancel",confirm:{text:"Select",closeModal:!0}}}).then(E=>{var $;if(E){const R=($=document.querySelector("input[name='groupRadio']:checked"))==null?void 0:$.value;R&&(console.log("Selected groupId:",R),g({...t,telegram:{...t.telegram,groupId:R}}))}})}}catch(n){w.warn((r=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:r.description),console.log(n)}finally{L(!1)}};return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(T==null?void 0:T.role)=="superadmin"&&e.jsxs("div",{className:" shadow-lg border bg-blue-50 border-dashed border-blue-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer  bg-blue-200 px-4 py-2 rounded-md",onClick:()=>i("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),o==="company"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsx("div",{className:` 
                          rounded overflow-hidden transition-all duration-300 
                          ${o==="company"?"max-h-fit p-0 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsxs("div",{className:"p-1 md:p-4 rounded  flex flex-col md:flex-row items-center  mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[t!=null&&t.logo?e.jsx("img",{src:Ue(t.logo,{format:"webp",width:200,height:200}),alt:"Company Logo",className:"w-full h-full object-fill rounded-full border-2 border-dashed border-blue-300"}):e.jsx(Ye,{className:"w-full h-full text-blue-400 rounded-full border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async s=>{const r=s.target.files[0];if(!r)return;const n=await O(300,r),p=new FormData;p.append("_id",t._id),p.append("logo",n);try{v(!0);const k=localStorage.getItem("emstoken"),E=(await W.post("/api/updateCompany",p,{headers:{Authorization:`Bearer ${k}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;g($=>({...$,logo:E})),w.success("Logo uploaded successfully!")}catch(k){console.error(k),w.error("Failed to upload logo.")}finally{v(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(f,{label:"Company Name",size:"small",variant:"standard",fullWidth:!0,value:(t==null?void 0:t.name)||"",onChange:s=>g({...t,name:s.target.value})})}),e.jsx("div",{className:"w-full md:flex-1",children:e.jsx(f,{label:"Contact",type:"tel",variant:"standard",size:"small",fullWidth:!0,value:(t==null?void 0:t.contact)||"",inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},onChange:s=>g({...t,contact:s.target.value.replace(/\D/g,"")})})})]}),e.jsx("div",{children:e.jsx(f,{label:"Company Full Name",variant:"standard",fullWidth:!0,size:"small",value:(t==null?void 0:t.fullname)||"",onChange:s=>g({...t,fullname:s.target.value})})}),e.jsx("div",{children:e.jsx(f,{label:"Address",fullWidth:!0,multiline:!0,size:"small",minRows:2,value:(t==null?void 0:t.address)||"",onChange:s=>g({...t,address:s.target.value})})}),I?e.jsx(P,{variant:"contained",loading:m,onClick:M,children:"Save Changes"}):e.jsx(P,{loading:m,variant:"contained",onClick:()=>Ke({companyinp:t,setisload:v}),children:"+ Create Company"})]})]})})]}),((T==null?void 0:T.role)=="superadmin"||(T==null?void 0:T.role)=="admin")&&e.jsxs("div",{className:"border shadow-lg bg-green-50 border-dashed border-green-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-200 px-4 py-2 rounded-md",onClick:()=>i("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),o==="branches"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded space-y-1 overflow-hidden transition-all duration-300
                          ${o==="branches"?"max-h-fit p-1 md:p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(P,{variant:"contained",onClick:()=>N(!0),children:"+ Add Branch"})}),e.jsx(Ae,{customStyles:he,columns:[{name:"Name",selector:s=>s.name,sortable:!0},{name:"Location",selector:s=>s.location,sortable:!0},{name:"Manager(s)",cell:s=>{var r;return e.jsx("div",{className:"flex flex-col gap-2",children:(r=s==null?void 0:s.managerIds)==null?void 0:r.map((n,p)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>J(n.userid),children:[e.jsx(de,{src:n==null?void 0:n.profileImage,alt:n.name,children:!(n!=null&&n.profileImage)&&e.jsx(Me,{})}),e.jsx("span",{children:n.name})]},p))})}},{name:"Actions",width:"120px",cell:s=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>_(s),children:e.jsx(ye,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>_(s),children:e.jsx(je,{})})]})}],data:F||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-teal-50 border-dashed border-teal-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-200 px-4 py-2 rounded-md",onClick:()=>i("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),o==="department"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${o==="department"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(ls,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-indigo-50 border-dashed border-indigo-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-indigo-200 px-4 py-2 rounded-md",onClick:()=>i("device"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Devices"}),o==="device"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${o==="device"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs("div",{className:"mb-2  ",children:[(se=t==null?void 0:t.devices)==null?void 0:se.map((s,r)=>{const n=pe(s==null?void 0:s.lastHeartbeat);return e.jsxs("div",{className:"flex w-full gap-4 items-center mb-2",children:[e.jsx(f,{label:"S.No",variant:"standard",disabled:!0,size:"small",value:r+1,className:"w-10"}),e.jsx(f,{label:"Device Name",variant:"standard",size:"small",value:s.name,onChange:p=>updateDevice(r,"name",p.target.value)}),e.jsx(f,{label:"Device SN",variant:"standard",size:"small",value:s.SN,onChange:p=>updateDevice(r,"SN",p.target.value)}),e.jsx(f,{label:"Last Sync",variant:"standard",size:"small",value:s!=null&&s.lastHeartbeat?He(s==null?void 0:s.lastHeartbeat).format("DD/MM/YY, hh:mm:ss A"):"N/A"}),n?e.jsx(Ve,{title:"Device Online",style:{color:"green",fontSize:"1.6rem"}}):e.jsx(Ge,{title:"Device Offline",style:{color:"red",fontSize:"1.6rem"}}),e.jsx(le,{color:"primary",onClick:()=>xe(s==null?void 0:s.SN),children:e.jsx(we,{className:q?"animate-spin":""})}),e.jsx(le,{color:"error",onClick:()=>a(r),children:e.jsx(Ne,{})})]},r)}),e.jsx(P,{variant:"contained",onClick:z,children:"Add More Device"})]}),e.jsx(P,{className:"f float-end",variant:"contained",loading:m,onClick:M,children:"Save Changes"})]})]}),e.jsxs("div",{className:"border shadow-lg bg-emerald-50 border-dashed border-emerald-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-emerald-200 px-4 py-2 rounded-md",onClick:()=>i("telegram"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Telegram"}),o==="telegram"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300
                          ${o==="telegram"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsx("div",{className:"mb-2  ",children:e.jsxs("div",{className:"flex w-full gap-4 items-center mb-2",children:[e.jsx(f,{label:"Telegram Bot Token",variant:"standard",size:"small",className:"w-[350px]",value:(l=t==null?void 0:t.telegram)==null?void 0:l.token,onChange:s=>A("telegram","token",s.target.value)}),e.jsx(f,{label:"Group Id",variant:"standard",size:"small",className:"w-[150px]",value:(d=t==null?void 0:t.telegram)==null?void 0:d.groupId,onChange:s=>A("telegram","groupId",s.target.value),InputProps:{endAdornment:e.jsx(Te,{position:"end",children:e.jsx(le,{onClick:ee,edge:"end",children:e.jsx(we,{className:B?"animate-spin":""})})})}}),e.jsx("div",{className:"flex ml-8 items-center gap-2 mt-2",children:e.jsxs("label",{className:"flex items-center cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:t==null?void 0:t.telegramNotifcation,onChange:s=>g(r=>({...r,telegramNotifcation:s.target.checked})),className:"w-5 h-5 text-blue-600 bg-gray-200 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("span",{className:"ml-2 text-gray-700 font-medium",children:"Enable Notifications"})]})}),e.jsx(le,{color:"error",onClick:()=>"kis",children:e.jsx(Ne,{})})]})}),e.jsx(P,{className:"mx-2 float-end",variant:"contained",loading:m,onClick:M,children:"Save Changes"})]})]}),(T==null?void 0:T.role)=="superadmin"&&e.jsxs("div",{className:"border shadow-lg bg-slate-50 border-dashed border-slate-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-slate-200 px-4 py-2 rounded-md",onClick:()=>i("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),o==="admin"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsx("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${o==="admin"?"max-h-fit md:p-2 p-1 my-2":"max-h-0 p-0 my-0"}
                        `,children:e.jsx(ns,{})})]}),e.jsxs("div",{className:"border shadow-lg bg-yellow-50 border-dashed border-yellow-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-200 px-4 py-2 rounded-md",onClick:()=>i("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),o==="attendance"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsxs("div",{className:`
                          rounded overflow-hidden transition-all duration-300 
                          ${o==="attendance"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}
                        `,children:[e.jsxs(ne,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(f,{label:"Office Time In",fullWidth:!0,type:"time",value:t.officeTime.in,onChange:s=>A("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(f,{label:"Office Time Out",fullWidth:!0,type:"time",value:t.officeTime.out,onChange:s=>A("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(f,{label:"Break Minutes",fullWidth:!0,type:"number",value:t.officeTime.breakMinutes,onChange:s=>A("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(f,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:t.workingMinutes.fullDay,onChange:s=>A("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(f,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:t.workingMinutes.halfDay,onChange:s=>A("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(f,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:t.workingMinutes.shortDayThreshold,onChange:s=>A("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(f,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:t.workingMinutes.overtimeAfterMinutes,onChange:s=>A("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(X,{fullWidth:!0,children:[e.jsx(K,{children:"Weekly Offs"}),e.jsx(Z,{multiple:!0,value:t.weeklyOffs,onChange:s=>g({...t,weeklyOffs:s.target.value}),input:e.jsx(ce,{label:"Weekly Offs"}),renderValue:s=>s.map(r=>{var n;return(n=Ie.find(p=>p.value===r))==null?void 0:n.label}).join(", "),children:Ie.map(s=>e.jsxs(G,{value:s.value,children:[e.jsx(oe,{checked:t.weeklyOffs.includes(s.value)}),e.jsx(ie,{primary:s.label})]},s.value))})]}),Object.entries(t.attendanceRules).map(([s,r])=>{const n=s.replace(/([A-Z])/g," $1").replace(/^./,k=>k.toUpperCase()),p={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(f,{fullWidth:!0,label:n,type:"time",value:r,onChange:k=>A("attendanceRules",s,k.target.value),helperText:p[s]},s)})]}),e.jsx(ne,{sx:{mt:4,textAlign:"right"},children:e.jsx(P,{variant:"contained",onClick:M,children:"Update Settings"})})]})]}),e.jsxs("div",{className:"border shadow-lg bg-purple-50 border-dashed border-purple-400 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-purple-200 px-4 py-2 rounded-md",onClick:()=>i("policies"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Default Payroll Policies"}),o==="policies"?e.jsx(H,{className:"text-xl"}):e.jsx(V,{className:"text-xl"})]}),e.jsx("form",{onSubmit:M,children:e.jsxs("div",{className:`rounded overflow-hidden transition-all duration-300 
                     ${o==="policies"?"max-h-fit p-2 my-2":"max-h-0 p-0 my-0"}`,children:[e.jsx("div",{className:"flex flex-col gap-3",children:["allowances","bonuses","deductions"].map(s=>{var n;const r=((n=t==null?void 0:t.payrollPolicies)==null?void 0:n[s])||[];return e.jsxs("div",{className:"flex flex-col shadow-lg gap-2 px-2 pb-2 my-2 border rounded border-dashed relative border-primary",children:[e.jsx("p",{className:"capitalize absolute t-0 -translate-y-1/2 l-2 bg-white px-2",children:s}),e.jsx("div",{className:"mt-6 flex flex-col gap-2",children:r.map((p,k)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{label:"Name",size:"small",required:!0,value:p.name,onChange:U=>{const E=r.map(($,R)=>R===k?{...$,name:U.target.value}:$);g({...t,payrollPolicies:{...t.payrollPolicies,[s]:E}})}}),e.jsxs(Z,{size:"small",className:"w-[120px]",value:p.type,onChange:U=>{const E=r.map(($,R)=>R===k?{...$,type:U.target.value}:$);g({...t,payrollPolicies:{...t.payrollPolicies,[s]:E}})},children:[e.jsx(G,{value:"amount",children:"Amount"}),e.jsx(G,{value:"percentage",children:"%"})]}),e.jsx(f,{label:p.type==="amount"?"₹":"%",type:"number",size:"small",required:!0,className:"w-[90px]",value:p.value,onChange:U=>{const E=r.map(($,R)=>R===k?{...$,value:Number(U.target.value)}:$);g({...t,payrollPolicies:{...t.payrollPolicies,[s]:E}})}}),e.jsx(je,{className:"text-red-500 w-8 h-8 p-1  cursor-pointer text-lg",onClick:()=>{const U=r.filter((E,$)=>$!==k);g({...t,payrollPolicies:{...t.payrollPolicies,[s]:U}})}})]},k))}),e.jsxs(P,{size:"small",variant:"contained",onClick:()=>g({...t,payrollPolicies:{...t.payrollPolicies,[s]:[...r,{name:"",type:"amount",value:0}]}}),children:["+ Add ",s.slice(0,-1)]})]},s)})}),e.jsx(ne,{sx:{mt:2,textAlign:"right"},children:e.jsx(P,{variant:"contained",type:"submit",children:"Save Policies"})})]})})]}),e.jsx(me,{open:c,onClose:()=>{N(!1),x(null),u(!1)},children:e.jsx("div",{className:"membermodal w-[680px]",children:e.jsx(Xe,{setopenviewmodal:N,editbranchdata:D,editbranch:C,company:I,employee:h})})})]})}export{ps as default};
