import{j as e,b as D,y as h,r as u,f as L,g as b,S as O,A as q,F as P}from"./index-Bn9gE8Df.js";import{X as U}from"./index.es-BZecx7uc.js";import{A as X}from"./index-BBNnZ70F.js";import{M as H}from"./Modalbox-BiVmHAUV.js";import{I as G}from"./index-CVUaQvnh.js";import{B as S}from"./Box-CaZPCEDM.js";import{T as p}from"./TextField-DCGrmm5-.js";import{F as J,I as K,S as Q}from"./Select-D5eREMyP.js";import{M as z}from"./MenuItem-BRVOW9ge.js";import{B as k}from"./Button-CxBkVLdW.js";import{u as V}from"./attandencehelper-C1z0bw8z.js";import{C as B}from"./CheckPermission-B8rn8Rm8.js";import{a as Z}from"./index-On5OAOX7.js";import{T as E}from"./Typography-C2AV8jVe.js";import"./useSlotProps-D4oRlUF-.js";import"./createSimplePaletteValueFilter-B5ZCTa1T.js";import"./ButtonBase-CwA52pCW.js";const ee=({firstfetch:o,inp:a,openmodal:w,isload:x,handleChange:f,setopenmodal:g,setInp:j,init:i})=>{const y=async l=>{l.preventDefault();const d=localStorage.getItem("emstoken");try{const m=await D.post("/api/leavehandle",{...a},{headers:{Authorization:`Bearer ${d}`}});o(),g(!1),j(i),h.success(m.data.message,{autoClose:2e3})}catch(m){m.response&&h.warning(m.response.data.message,{autoClose:3e3}),console.error(m)}};return e.jsx(H,{open:w,onClose:()=>{g(!1),j(i)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:y,children:[e.jsx("h2",{children:"Leave Management"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsxs(S,{sx:{width:"100%",gap:2},children:[e.jsx(p,{fullWidth:!0,value:a.branch,label:"Branch",size:"small"}),e.jsx(p,{fullWidth:!0,value:a.employeename,label:"Name",size:"small"})]}),e.jsxs(S,{sx:{width:"100%",gap:2},children:[e.jsx(p,{fullWidth:!0,value:a.showfrom,label:"From",size:"small"}),e.jsx(p,{fullWidth:!0,value:a.showto,label:"To",size:"small"})]}),e.jsx(p,{fullWidth:!0,multiline:!0,minRows:2,value:a.reason,onChange:l=>f(l,"reason"),label:"Reason",size:"small"}),e.jsxs(J,{fullWidth:!0,required:!0,size:"small",children:[e.jsx(K,{children:"Status"}),e.jsxs(Q,{value:a.status,label:"Status",onChange:l=>f(l,"status"),children:[e.jsx(z,{value:"approved",children:"Approve"}),e.jsx(z,{value:"rejected",children:"Reject"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(k,{sx:{mr:2},loading:x,loadingPosition:"end",endIcon:e.jsx(G,{}),variant:"contained",type:"submit",children:"Update"}),e.jsx(k,{size:"small",onClick:()=>{g(!1),j(i)},variant:"outlined",children:"Cancel"})]})]})]})})})},ye=()=>{const[o,a]=u.useState([]),[w,x]=u.useState(!1),[f,g]=u.useState(!1),{department:j,branch:i}=L(s=>s.user),y={leaveid:"",branch:"",employeename:"",from:"",showfrom:"",to:"",showto:"",reason:"",status:""},[l,d]=u.useState(y),m=B("leave",3),R=B("leave",4);u.useEffect(()=>{M()},[]);const $=(s,n)=>{d({...l,[n]:s.target.value})},M=async()=>{var n,c;const s=localStorage.getItem("emstoken");try{const r=await D.get("/api/fetchleave",{headers:{Authorization:`Bearer ${s}`}});let T=1;const _=await r.data.leave.map(t=>{var v,C,I,Y,A,N;return{id:t._id,sno:T++,name:e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx(q,{src:(v=t==null?void 0:t.employeeId)==null?void 0:v.profileimage,alt:(C=t==null?void 0:t.employeeId)==null?void 0:C.employeename,children:!((I=t.employeeId)!=null&&I.profileimage)&&e.jsx(P,{})}),e.jsxs(S,{children:[e.jsx(E,{variant:"body2",children:(Y=t.employeeId)==null?void 0:Y.employeename}),e.jsx(E,{variant:"body2",children:(N=(A=t.employeeId)==null?void 0:A.userid)==null?void 0:N.email})]})]}),from:b(t.fromDate).format("DD MMM, YYYY"),to:b(t.toDate).format("DD MMM, YYYY"),reason:t.reason,status:e.jsx("span",{className:`${t.status=="approved"?"bg-green-100 text-green-800":t.status=="rejected"?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800"} px-3 py-1 rounded capitalize`,children:t.status}),action:e.jsxs("div",{className:"flex gap-2",children:[m&&e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>W(t),children:e.jsx(O,{})}),R&&e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>F(t._id),children:e.jsx(X,{})})]})}});a(_)}catch(r){console.error(r),h.warning(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Error")}},F=async s=>{console.log(s),swal({title:"Are you sure you want to Delete this record?",icon:"warning",buttons:!0,dangerMode:!0}).then(async n=>{if(n){const c=localStorage.getItem("emstoken");try{const r=await D.delete(`/api/leavehandle/${s}`,{headers:{Authorization:`Bearer ${c}`}});M(),h.success(r.data.message,{autoClose:2e3})}catch(r){r.response&&h.warning(r.response.data.message,{autoClose:3e3}),console.error(r)}}})},W=s=>{var n,c;d({leaveid:s._id,branch:i==null?void 0:i.filter(r=>r._id==(s==null?void 0:s.branchId))[0].name,employeename:(c=(n=s==null?void 0:s.employeeId)==null?void 0:n.userid)==null?void 0:c.name,from:s.fromDate,to:s.toDate,showfrom:b(s.fromDate).format("DD MMM, YYYY"),showto:b(s.toDate).format("DD MMM, YYYY"),reason:s==null?void 0:s.reason,status:s==null?void 0:s.status}),x(!0)};return e.jsxs("div",{children:[e.jsx(U,{customStyles:V(),columns:se,data:o,pagination:!0,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(Z,{className:"text-xl"})," No Leave Request found."]})}),e.jsx(ee,{firstfetch:M,handleChange:$,inp:l,isload:f,init:y,setInp:d,openmodal:w,setopenmodal:x})]})},se=[{name:"S.no",selector:o=>o.sno,width:"60px"},{name:"Employee",selector:o=>o.name},{name:"from",selector:o=>o.from,width:"120px"},{name:"to",selector:o=>o.to,width:"120px"},{name:"Reason",selector:o=>o.reason},{name:"Status",selector:o=>o.status,width:"120px"},{name:"Action",selector:o=>o.action,width:"90px"}];export{se as columns,ye as default};
