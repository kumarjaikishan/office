import{r as l,j as e,z as Re,aa as Ie,ab as Ce,ac as Ye,ad as ze,ae as Be,af as Pe,ag as He,ah as We,ai as $e,aj as _e,f as Xe,a as Ue,b as qe}from"./index-CTh4XINP.js";import{d as t}from"./dayjs.min-D-96h9Fd.js";import{a as Ge}from"./index-n91Zg7yz.js";import{X as Je}from"./index.es-DqB4JCGQ.js";import{c as Ke}from"./attandencehelper-B7qcYoQE.js";import{P as Qe,R as Ve}from"./PieChart-B2vest-5.js";import{a as de}from"./index-YZVVm7Xt.js";import{T as Ze}from"./Tooltip-BepFjvoh.js";import{F as k,I as R,S as I}from"./Select-CrBcKFAw.js";import{M as m}from"./MenuItem-Cy-BF1ws.js";import{T as ue}from"./TextField-DZ2WNkho.js";import{B as ea}from"./Button-Gf5sSqIk.js";import"./ButtonBase-DRT54j5u.js";import"./index-B6pf1gWF.js";import"./useThemeProps-H3oaCWNN.js";import"./useSlotProps-DkXkGTp2.js";import"./Typography-22Vbjyg4.js";import"./createSimplePaletteValueFilter-B4rI7VpO.js";import"./Popper-C0rO9w6o.js";import"./IconButton-xdrQIKPO.js";const aa=({attandence:r,employee:s,hell:a})=>{var x,M,f,C,Y,z,B,P,H,w,L,g;l.useEffect(()=>{},[r]);const h="https://res.cloudinary.com/dusxlxlvm/image/upload/v1753113610/ems/assets/employee_fi3g5p.webp",o=(((x=a==null?void 0:a.present)==null?void 0:x.length)||0)+(((M=a==null?void 0:a.absent)==null?void 0:M.length)||0)+(((f=a==null?void 0:a.leave)==null?void 0:f.length)||0),c=l.useMemo(()=>{var O,S,E;return{present:o?Math.floor(((O=a==null?void 0:a.present)==null?void 0:O.length)/o*100):0,absent:o?Math.floor(((S=a==null?void 0:a.absent)==null?void 0:S.length)/o*100):0,leave:o?Math.floor(((E=a==null?void 0:a.leave)==null?void 0:E.length)/o*100):0}},[a,o]),j=o?[{id:0,value:c.present,color:"teal",label:"Present"},{id:1,value:c.leave,color:"orange",label:"Leave"},{id:2,value:c.absent,color:"rgb(156 163 175)",label:"Absent"}]:[{id:0,value:100,color:"rgb(156 163 175)",label:"No record"}],b={width:300,height:300},v={innerRadius:130,outerRadius:150};return e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center min-h-[200px] bg-[#e0e4e7] p-1 space-y-1 md:space-y-0 md:space-x-2",children:[e.jsxs("div",{className:"relative w-80 h-80 flex items-center justify-center z-2 rounded-full",children:[e.jsx(Qe,{series:[{innerRadius:v.innerRadius,outerRadius:v.outerRadius,data:j,paddingAngle:1,cornerRadius:5}],width:b.width,height:b.height,legend:{hidden:!0}}),e.jsx("div",{className:"absolute w-63 h-63 rounded-full overflow-hidden border-4 border-white",children:e.jsx("img",{src:(s==null?void 0:s.profileimage)||h,alt:(s==null?void 0:s.name)||"Employee",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-[550px]",children:[e.jsxs("div",{className:"attandencecarde",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Re,{})," Total Days"]}),e.jsx("span",{className:"font-bold text-gray-600",children:o})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ie,{})," Present"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((C=a==null?void 0:a.present)==null?void 0:C.length)||0," Days"," ",c.present?`(${c.present}%)`:""]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ce,{})," Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((Y=a==null?void 0:a.leave)==null?void 0:Y.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Ye,{})," Absent"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((z=a==null?void 0:a.absent)==null?void 0:z.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-12",children:[e.jsx(Ze,{placement:"top",enterDelay:800,arrow:!0,title:(a==null?void 0:a.overtimesalary)!==null?e.jsxs("div",{className:"flex gap-1 flex-col text-white",children:[e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Basic salary"}),e.jsxs("span",{children:[": ",s==null?void 0:s.salary," ₹"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Net Overtime"}),e.jsxs("span",{children:[": ",((a==null?void 0:a.overtimemin)||0)-((a==null?void 0:a.shorttimemin)||0)," min"]})]}),e.jsxs("span",{className:"flex w-full",children:[e.jsx("span",{className:"block w-[100px]",children:"Payment"}),e.jsxs("span",{children:[": ",(a==null?void 0:a.overtimesalary)||0," ₹"]})]})]}):"",children:e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow cursor-help",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(ze,{})," Overtime"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((B=a==null?void 0:a.overtime)==null?void 0:B.length)||0," ",(a==null?void 0:a.overtimemin)>0&&`(${a==null?void 0:a.overtimemin} min)`]})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Be,{})," Short Time"]}),e.jsxs("span",{className:"font-bold text-gray-600",children:[((P=a==null?void 0:a.short)==null?void 0:P.length)||0," ",(a==null?void 0:a.shorttimemin)>0&&`(${a==null?void 0:a.shorttimemin} min)`]})]})]}),e.jsxs("div",{className:"attandencecarde md:ml-8",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(Pe,{})," Late Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((H=a==null?void 0:a.latearrival)==null?void 0:H.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(He,{})," Early Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((w=a==null?void 0:a.earlyLeave)==null?void 0:w.length)||0})]})]}),e.jsxs("div",{className:"attandencecarde",children:[e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx(We,{})," Early Arrival"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((L=a==null?void 0:a.earlyarrival)==null?void 0:L.length)||0})]}),e.jsxs("div",{className:"flex w-full items-center justify-between neu text-gray-800 rounded-xl px-4 py-2 shadow",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2 text-gray-800",children:[e.jsx($e,{})," Late Leave"]}),e.jsx("span",{className:"font-bold text-gray-600",children:((g=a==null?void 0:a.lateleave)==null?void 0:g.length)||0})]})]})]})]})},Ma=()=>{const{userid:r}=_e(),[s,a]=l.useState({}),[h,o]=l.useState({}),[c,j]=l.useState([]),[b,v]=l.useState(!0),{company:x,holidays:M}=Xe(n=>n.user),[f,C]=l.useState(null),[Y,z]=l.useState([]),[B,P]=l.useState([]),H=Ue(),[w,L]=l.useState(t().year()),[g,O]=l.useState(t().month()),[S,E]=l.useState("all"),[D,J]=l.useState("all"),[W,K]=l.useState("all"),[X,Q]=l.useState(null),[U,V]=l.useState(null),[N,me]=l.useState({present:[],absent:[],leave:[],holiday:[],short:[],overtime:[],latearrival:[],earlyarrival:[],earlyLeave:[],lateleave:[],shorttimemin:0,overtimemin:0,overtimesalary:0}),xe=t().year(),fe=Array.from({length:8},(n,i)=>xe+1-i),pe=Array.from({length:12},(n,i)=>({label:t().month(i).format("MMMM"),value:i}));l.useEffect(()=>{x&&C(x)},[x]),l.useEffect(()=>{if(!M)return;const n=[];M.forEach(i=>{let d=t(i.fromDate);const u=i.toDate?t(i.toDate):d;for(;d.isSameOrBefore(u,"day");)n.push(d.format("DD/MM/YYYY")),d=d.add(1,"day")}),z(n)},[M]),l.useEffect(()=>{if(!r)return;(async()=>{const i=localStorage.getItem("emstoken");try{v(!0);const d=await qe.get("/api/employeeAttandence",{params:{userid:r},headers:{Authorization:`Bearer ${i}`}});o(d.data.employee),a(d.data.user),j(d.data.attandence)}catch(d){if(console.error("Failed to fetch performance data:",d),d.status==403){swal({title:"Access Denied",text:d.response.data.message||"You are not authorized to manage this tournament.",icon:"warning"}),H("/");return}}finally{v(!1)}})()},[r]),l.useEffect(()=>{if(!c.length||!f)return;const n=c.filter(y=>{const p=t(y.date);return p.year()===w&&(g==="all"||p.month()===g)}),i=[],d=[],u=[],Z=[],ee=[],q=[],ae=[],se=[],te=[],re=[];let G=0,$=0,_=[];n.forEach(y=>{const p=t(y.date).toDate();let ve=t(y.date).format("DD/MM/YYYY");const ne=Y.includes(ve),je=t(y.date).startOf("day").day(),ie=x.weeklyOffs.includes(je),le=y.status=="leave",oe=y.status=="absent";ne&&!le&&!oe?_.push({...y,remarks:"worked on holiday"}):ie&&!le&&!oe?_.push({...y,remarks:"worked on weekly off"}):_.push(y);const ce=y.status;switch(ce){case"present":i.push(p);break;case"absent":d.push(p);break;case"leave":u.push(p);break;case"holiday":Z.push(p);break}if(ce!=="present")return;const{punchIn:T,punchOut:F,workingMinutes:A}=y;if(!T||!F||typeof A!="number")return;if(ne||ie)q.push(p),$+=A;else{const Te=A<f.workingMinutes.fullDay,Fe=A>=f.workingMinutes.fullDay;Te&&(ee.push(p),G+=f.workingMinutes.fullDay-A),Fe&&(q.push(p),$+=A-f.workingMinutes.fullDay)}const[ge,be]=f.attendanceRules.considerEarlyEntryBefore.split(":").map(Number),[we,Ne]=f.attendanceRules.considerLateEntryAfter.split(":").map(Number),ke=t(T).startOf("day").add(ge,"hour").add(be,"minute"),Me=t(T).startOf("day").add(we,"hour").add(Ne,"minute");t(T).isBefore(ke)&&se.push(p),t(T).isAfter(Me)&&ae.push(p);const[Se,De]=f.attendanceRules.considerEarlyExitBefore.split(":").map(Number),[Ae,Le]=f.attendanceRules.considerLateExitAfter.split(":").map(Number),Oe=t(F).startOf("day").add(Se,"hour").add(De,"minute"),Ee=t(F).startOf("day").add(Ae,"hour").add(Le,"minute");t(F).isBefore(Oe)&&te.push(p),t(F).isAfter(Ee)&&re.push(p)}),P(_),me({present:i,absent:d,leave:u,holiday:Z,short:ee,overtime:q,shorttimemin:G,overtimemin:$,latearrival:ae,earlyarrival:se,earlyLeave:te,lateleave:re,overtimesalary:g!=="all"?Math.floor(($-G)*parseFloat(h.salary/t(new Date(w,g)).daysInMonth()/x.workingMinutes.fullDay)):null})},[c,w,g,f]);const he=B.filter(n=>{const i=t(n.date).startOf("day");return!(X&&i.isBefore(t(X))||U&&i.isAfter(t(U))||S!=="all"&&n.status!==S||D!=="all"&&!(D==="earlyLeave"&&N.earlyLeave.some(u=>t(u).isSame(i,"day"))||D==="lateleave"&&N.lateleave.some(u=>t(u).isSame(i,"day"))||D==="earlyarrival"&&N.earlyarrival.some(u=>t(u).isSame(i,"day"))||D==="latearrival"&&N.latearrival.some(u=>t(u).isSame(i,"day")))||W!=="all"&&!(W==="short"&&N.short.some(u=>t(u).isSame(i,"day"))||W==="overtime"&&N.overtime.some(u=>t(u).isSame(i,"day"))))}),ye=()=>{L(t().year()),O("all"),E("all"),J("all"),K("all"),Q(null),V(null)};return e.jsxs("div",{className:"p-4 capitalize bg-gray-200",children:[b&&e.jsx("p",{children:"Loading performance data..."}),e.jsxs("div",{className:"p-3 flex gap-3 items-center justify-between rounded shadow bg-white mb-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{size:"small",sx:{minWidth:120},children:[e.jsx(R,{children:"Year"}),e.jsx(I,{value:w,label:"Year",onChange:n=>L(n.target.value),children:fe.map(n=>e.jsx(m,{value:n,children:n},n))})]}),e.jsxs(k,{size:"small",sx:{minWidth:150},children:[e.jsx(R,{children:"Month"}),e.jsxs(I,{value:g,label:"Month",onChange:n=>O(n.target.value),children:[e.jsx(m,{value:"all",children:"All"}),pe.map(n=>e.jsx(m,{value:n.value,children:n.label},n.label))]})]})]}),e.jsxs("div",{className:"font-semibold text-xl",children:[" ",s.name]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx(aa,{employee:h,user:s,attandence:c,hell:N}),e.jsxs("div",{className:"p-4 flex gap-3 rounded shadow bg-white my-4",children:[e.jsxs(k,{size:"small",sx:{minWidth:120},children:[e.jsx(R,{children:"Type"}),e.jsxs(I,{value:D,label:"Type",onChange:n=>J(n.target.value),children:[e.jsx(m,{value:"all",children:"All"}),e.jsx(m,{value:"earlyLeave",children:"Early Leave"}),e.jsx(m,{value:"lateleave",children:"Late Leave"}),e.jsx(m,{value:"earlyarrival",children:"Early Arrival"}),e.jsx(m,{value:"latearrival",children:"Late Arrival"})]})]}),e.jsxs(k,{size:"small",sx:{minWidth:150},children:[e.jsx(R,{children:"Status"}),e.jsxs(I,{value:S,label:"Status",onChange:n=>E(n.target.value),children:[e.jsx(m,{value:"all",children:"All"}),e.jsx(m,{value:"present",children:"Present"}),e.jsx(m,{value:"leave",children:"Leave"}),e.jsx(m,{value:"absent",children:"Absent"}),e.jsx(m,{value:"halfday",children:"Half Day"})]})]}),e.jsxs(k,{size:"small",sx:{minWidth:150},children:[e.jsx(R,{children:"Over/Short"}),e.jsxs(I,{value:W,label:"over/short",onChange:n=>K(n.target.value),children:[e.jsx(m,{value:"all",children:"All"}),e.jsx(m,{value:"overtime",children:"Overtime"}),e.jsx(m,{value:"short",children:"Short Time"})]})]}),e.jsx(k,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"From Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:X||"",onChange:n=>Q(n.target.value)})}),e.jsx(k,{size:"small",sx:{minWidth:150},children:e.jsx(ue,{label:"To Date",type:"date",size:"small",InputLabelProps:{shrink:!0},value:U||"",onChange:n=>V(n.target.value)})}),e.jsx(ea,{variant:"outlined",color:"secondary",onClick:ye,sx:{alignSelf:"flex-end",minWidth:100},startIcon:e.jsx(Ve,{}),children:"Reset"})]}),e.jsx(Je,{columns:ra(f),data:he,pagination:!0,customStyles:Ke,conditionalRowStyles:ta,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(Ge,{className:"text-xl"})," No records found matching your criteria."]})})]})]})},sa=r=>{const s=Math.floor(r/60),a=r%60;return`${s}h ${a}m`},ta=[{when:r=>r.remarks,style:{backgroundColor:"rgba(21, 233, 233, 0.2)"}}],ra=r=>[{name:"Date",selector:s=>t(s.date).format("DD MMM, YYYY"),sortable:!0,width:"120px"},{name:"Punch In",selector:s=>s.punchIn,cell:s=>{var v,x;if(!s.punchIn)return"-";const[a,h]=(v=r==null?void 0:r.attendanceRules)==null?void 0:v.considerEarlyEntryBefore.split(":").map(Number),[o,c]=(x=r==null?void 0:r.attendanceRules)==null?void 0:x.considerLateEntryAfter.split(":").map(Number),j=t(s.punchIn).startOf("day").add(a,"hour").add(h,"minute"),b=t(s.punchIn).startOf("day").add(o,"hour").add(c,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"text-[16px] text-blue-700"}),t(s.punchIn).format("hh:mm A"),!s.remarks&&t(s.punchIn).isBefore(j)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchIn).isAfter(b)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Late"})]})}},{name:"Punch Out",selector:s=>s.punchOut,cell:s=>{var v,x;if(!s.punchOut)return"-";const[a,h]=(v=r==null?void 0:r.attendanceRules)==null?void 0:v.considerEarlyExitBefore.split(":").map(Number),[o,c]=(x=r==null?void 0:r.attendanceRules)==null?void 0:x.considerLateExitAfter.split(":").map(Number),j=t(s.punchOut).startOf("day").add(a,"hour").add(h,"minute"),b=t(s.punchOut).startOf("day").add(o,"hour").add(c,"minute");return e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"text-[16px] text-blue-700"}),t(s.punchOut).format("hh:mm A"),!s.remarks&&t(s.punchOut).isBefore(j)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-amber-100 text-amber-800 text-xs",children:"Early"}),!s.remarks&&t(s.punchOut).isAfter(b)&&e.jsx("span",{className:"px-2 py-0.5 ml-2 rounded bg-sky-100 text-sky-800 text-xs",children:"Late"})]})}},{name:"Status",selector:s=>s.status,cell:s=>{const{status:a}=s,o={absent:"bg-red-100 text-red-800",leave:"bg-violet-100 text-violet-800",present:"bg-green-100 text-green-800",holiday:"bg-blue-100 text-blue-800"}[a]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`${o} px-2 py-1 rounded text-xs`,children:a})},width:"140px"},{name:"Working Hours",width:"180px",selector:s=>s.workingMinutes,cell:s=>{var h,o,c,j;const a=s.workingMinutes;return a?e.jsxs("span",{className:" flex",children:[e.jsx("span",{className:"block w-[60px] ",children:sa(a)}),!s.remarks&&a<((h=r==null?void 0:r.workingMinutes)==null?void 0:h.fullDay)&&e.jsxs("span",{className:" block w-[100px] px-2 py-0.5 rounded bg-amber-100 text-amber-900 text-xs",children:["Short ",((o=r==null?void 0:r.workingMinutes)==null?void 0:o.fullDay)-a," min"]}),!s.remarks&&a>((c=r==null?void 0:r.workingMinutes)==null?void 0:c.fullDay)&&e.jsxs("span",{className:"px-2 block w-[115px] py-0.5  rounded bg-green-100 text-green-900 text-xs",children:["Overtime ",a-((j=r==null?void 0:r.workingMinutes)==null?void 0:j.fullDay)," min"]})]}):"-"}},{name:"Remarks",selector:s=>s.remarks&&`${(s==null?void 0:s.workingMinutes)||0} minutes  ${s.remarks}`}];export{Ma as default};
