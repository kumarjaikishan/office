import{g as S,r as a,a as U,u as $,h as j,j as s,F as E,I as F,S as C,M as h,O as D,i as O,C as k,A as G,k as H,l as J}from"./index-BeSL47dy.js";import{D as K}from"./dashboardCard-B_zmJFva.js";import{T as Q}from"./Tooltip-paUlJKPm.js";import"./Popper-Ds9D2A49.js";const ee=()=>{var _;const{attandence:o,employee:p,branch:u,department:m}=S(e=>e.user),{islogin:z,isadmin:V}=S(e=>e.auth),[b,A]=a.useState([]),[v,P]=a.useState([]),[N,R]=a.useState([]),[y,B]=a.useState([]);let M=U();$();const q=a.useRef(o),[d,L]=a.useState("all"),[f,I]=a.useState("all"),[g,T]=a.useState([]);return a.useEffect(()=>{!z&&M("/login")},[]),a.useEffect(()=>{if(!p||p.length===0)return;const e=p.filter(c=>{const i=d==="all"||c.branchId===d,l=f==="all"||c.department._id===f;return i&&l});T(e)},[d,f,p]),a.useEffect(()=>{I("all")},[d]),a.useEffect(()=>{q.current=o},[o]),a.useEffect(()=>{if(!o)return;let e=o.filter(t=>j(t.date).isSame(j(),"day")),c=e==null?void 0:e.filter(t=>!t.punchOut&&t.status!=="absent"&&t.status!=="leave"),i=e==null?void 0:e.filter(t=>t.status=="present"),l=e==null?void 0:e.filter(t=>t.status=="absent"),r=e==null?void 0:e.filter(t=>t.status=="leave");A(c),P(i),R(l),B(r)},[o]),a.useEffect(()=>()=>{},[]),s.jsxs("div",{className:"p-0 md:p-3 max-w-7xl mx-auto",children:[s.jsx("div",{className:"mb-3 ",children:s.jsx(K,{employee:p,todayleave:y.length+N.length,todaypresent:v.length,currentpresent:b.length})}),s.jsxs("div",{className:"w-full flex-col flex gap-5 shadow  bg-white p-2 rounded",children:[s.jsxs("div",{className:"flex gap-3 pt-3",children:[s.jsxs(E,{sx:{width:"160px"},required:!0,size:"small",children:[s.jsx(F,{id:"demo-simple-select-helper-label",children:"Branch"}),s.jsxs(C,{value:d,input:s.jsx(D,{startAdornment:s.jsx(O,{position:"start",children:s.jsx(k,{fontSize:"small"})}),label:"branch"}),onChange:e=>L(e.target.value),children:[s.jsx(h,{selected:!0,value:"all",children:"All"}),(u==null?void 0:u.length)>1?u==null?void 0:u.map(e=>s.jsx(h,{value:e._id,children:e.name},e._id)):s.jsx(h,{disabled:!0,value:"",children:"No Branch Found"})]})]}),s.jsxs(E,{sx:{width:"160px"},required:!0,size:"small",children:[s.jsx(F,{id:"demo-simple-select-helper-label",children:"Department"}),s.jsxs(C,{disabled:d=="all",value:f,input:s.jsx(D,{startAdornment:s.jsx(O,{position:"start",children:s.jsx(k,{fontSize:"small"})}),label:"Department"}),onChange:e=>I(e.target.value),children:[s.jsx(h,{selected:!0,value:"all",children:"All"}),(m==null?void 0:m.length)>1?(_=m.filter(e=>e.branchId._id==d))==null?void 0:_.map(e=>s.jsx(h,{value:e._id,children:e.department},e._id)):s.jsx(h,{disabled:!0,value:"",children:"No Department Found"})]})]})]}),s.jsx("div",{className:"px-1 md:px-3 grid grid-cols-5 md:grid-cols-10 lg:grid-cols-13 gap-2 md:gap-4",children:g==null?void 0:g.filter(e=>e.status!==!1).map(e=>{var t,w;const c=b.some(x=>{var n;return((n=x.employeeId)==null?void 0:n._id)===(e==null?void 0:e._id)}),i=N.some(x=>{var n;return((n=x.employeeId)==null?void 0:n._id)===(e==null?void 0:e._id)}),l=y.find(x=>{var n;return((n=x.employeeId)==null?void 0:n._id)===(e==null?void 0:e._id)}),r=v.find(x=>{var n;return((n=x.employeeId)==null?void 0:n._id)===(e==null?void 0:e._id)});return s.jsx(Q,{arrow:!0,enterDelay:800,placement:"top",title:s.jsxs("div",{className:"flex flex-col",children:[i&&s.jsx("span",{children:"Absent"}),l&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"on Leave"}),s.jsx("span",{children:(t=l==null?void 0:l.leave)==null?void 0:t.reason})]}),!i&&!l&&s.jsxs(s.Fragment,{children:[s.jsxs("span",{children:["In      "," ",r!=null&&r.punchIn?j(r.punchIn).format("hh:mm A"):" -:-"]}),s.jsxs("span",{children:["Out    ",r!=null&&r.punchOut?j(r.punchOut).format("hh:mm A"):"-:-"]})]})]}),children:s.jsxs("div",{className:"flex flex-col items-center cursor-help ",children:[s.jsx("span",{className:`${i||l?"border-red-500":c?"border-green-500":r?"border-amber-400":"border-gray-300"} p-[2px] border-3 rounded-full`,children:s.jsx(G,{src:H(e==null?void 0:e.profileimage,{format:"webp",width:100,height:100}),alt:e.employeename,children:!e.profileimage&&s.jsx(J,{})})}),s.jsx("p",{className:`${i||l?"text-red-600 text-[14px]":c?"text-green-600 text-[14px]":r?"text-amber-700":"text-gray-500"} text-[12px] text-center transition-all duration-300 capitalize`,children:(w=e==null?void 0:e.userid)==null?void 0:w.name})]})},e._id)})}),s.jsxs("div",{className:"flex gap-5",children:[s.jsxs("span",{className:"flex items-center gap-1 text-green-500 text-[13px] ",children:[s.jsx("span",{className:"block w-[15px] rounded-3xl h-[15px] bg-green-500 "})," Currently In Premise"]}),s.jsxs("span",{className:"flex items-center gap-1 text-amber-700 text-[13px]",children:[s.jsx("span",{className:"block w-[15px] rounded-3xl h-[15px] bg-amber-500 "})," Present"]}),s.jsxs("span",{className:"flex items-center gap-1 text-red-500 text-[13px]",children:[s.jsx("span",{className:"block w-[15px] rounded-3xl h-[15px] bg-red-500  "})," Leave/Absent"]}),s.jsxs("span",{className:"flex items-center gap-1 text-gray-500 text-[13px]",children:[s.jsx("span",{className:"block w-[15px] rounded-3xl h-[15px] bg-gray-500  "})," No status"]})]})]})]})};export{ee as default};
