import{r as v,j as e,o as se,p as fe,h as Ce,S as Ie,i as Pe,k as he,t as K,n as ne,U as ke,q as Se,u as xe,f as ce,A as ae,F as Te,b as G,y as $,v as Q,V as Le,W as Oe,X as q,Q as U,K as Me}from"./index-BibUWqKW.js";import{M as Ae}from"./Modalbox-Ul6gd2uM.js";import{a as Be,e as De,u as ze}from"./useSlotProps-DEnoR5oY.js";import{s as We}from"./styled-BMmJyA6y.js";import{i as Re,a as Fe,f as Ge,L as qe,F as de,I as me,S as ue,O as pe}from"./Select-BTOMxnCG.js";import{u as Ue}from"./useThemeProps-caATqy2O.js";import{T}from"./TextField-B4dnKlow.js";import{g as _e,l as Z,M as Y}from"./MenuItem-BWos4OdY.js";import{C as ee}from"./Checkbox-Dk55qNQt.js";import{T as _,t as ye}from"./Typography-BmLnLqOh.js";import{B as z}from"./Button-CSn301q-.js";import He from"./Department-Dff45Arj.js";import{a as Ve,A as Xe}from"./index-BVWp-cPY.js";import{u as Ee}from"./imageresizer-D4I-KFLq.js";import{X as Qe}from"./index.es-7ifiKTqY.js";import{B as oe}from"./Box-CdyHissX.js";import"./createSimplePaletteValueFilter-fo0FgVSD.js";import"./ButtonBase-CpdL3qg7.js";import"./index-x-YSLZMJ.js";import"./attandencehelper-B_hyRmy2.js";import"./InputAdornment-XtuWsZQQ.js";const Ze=(t,n)=>t.filter(o=>n.includes(o)),V=(t,n,o)=>{const l=t.keys[0];Array.isArray(n)?n.forEach((i,c)=>{o((d,g)=>{c<=t.keys.length-1&&(c===0?Object.assign(d,g):d[t.up(t.keys[c])]=g)},i)}):n&&typeof n=="object"?(Object.keys(n).length>t.keys.length?t.keys:Ze(t.keys,Object.keys(n))).forEach(c=>{if(t.keys.includes(c)){const d=n[c];d!==void 0&&o((g,I)=>{l===c?Object.assign(g,I):g[t.up(c)]=I},d)}}):(typeof n=="number"||typeof n=="string")&&o((i,c)=>{Object.assign(i,c)},n)};function re(t){return`--Grid-${t}Spacing`}function le(t){return`--Grid-parent-${t}Spacing`}const be="--Grid-columns",H="--Grid-parent-columns",Je=({theme:t,ownerState:n})=>{const o={};return V(t.breakpoints,n.size,(l,i)=>{let c={};i==="grow"&&(c={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(c={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / var(${H}) - (var(${H}) - ${i}) * (var(${le("column")}) / var(${H})))`}),l(o,c)}),o},Ke=({theme:t,ownerState:n})=>{const o={};return V(t.breakpoints,n.offset,(l,i)=>{let c={};i==="auto"&&(c={marginLeft:"auto"}),typeof i=="number"&&(c={marginLeft:i===0?"0px":`calc(100% * ${i} / var(${H}) + var(${le("column")}) * ${i} / var(${H}))`}),l(o,c)}),o},Ye=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={[be]:12};return V(t.breakpoints,n.columns,(l,i)=>{const c=i??12;l(o,{[be]:c,"> *":{[H]:c}})}),o},et=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={};return V(t.breakpoints,n.rowSpacing,(l,i)=>{var d;const c=typeof i=="string"?i:(d=t.spacing)==null?void 0:d.call(t,i);l(o,{[re("row")]:c,"> *":{[le("row")]:c}})}),o},tt=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={};return V(t.breakpoints,n.columnSpacing,(l,i)=>{var d;const c=typeof i=="string"?i:(d=t.spacing)==null?void 0:d.call(t,i);l(o,{[re("column")]:c,"> *":{[le("column")]:c}})}),o},st=({theme:t,ownerState:n})=>{if(!n.container)return{};const o={};return V(t.breakpoints,n.direction,(l,i)=>{l(o,{flexDirection:i})}),o},at=({ownerState:t})=>({minWidth:0,boxSizing:"border-box",...t.container&&{display:"flex",flexWrap:"wrap",...t.wrap&&t.wrap!=="wrap"&&{flexWrap:t.wrap},gap:`var(${re("row")}) var(${re("column")})`}}),rt=t=>{const n=[];return Object.entries(t).forEach(([o,l])=>{l!==!1&&l!==void 0&&n.push(`grid-${o}-${String(l)}`)}),n},nt=(t,n="xs")=>{function o(l){return l===void 0?!1:typeof l=="string"&&!Number.isNaN(Number(l))||typeof l=="number"&&l>0}if(o(t))return[`spacing-${n}-${String(t)}`];if(typeof t=="object"&&!Array.isArray(t)){const l=[];return Object.entries(t).forEach(([i,c])=>{o(c)&&l.push(`spacing-${i}-${String(c)}`)}),l}return[]},lt=t=>t===void 0?[]:typeof t=="object"?Object.entries(t).map(([n,o])=>`direction-${n}-${o}`):[`direction-xs-${String(t)}`];function ot(t,n){t.item!==void 0&&delete t.item,t.zeroMinWidth!==void 0&&delete t.zeroMinWidth,n.keys.forEach(o=>{t[o]!==void 0&&delete t[o]})}const it=Ie(),ct=We("div",{name:"MuiGrid",slot:"Root"});function dt(t){return Ue({props:t,name:"MuiGrid",defaultTheme:it})}function mt(t={}){const{createStyledComponent:n=ct,useThemeProps:o=dt,useTheme:l=Be,componentName:i="MuiGrid"}=t,c=(j,w)=>{const{container:f,direction:y,spacing:S,wrap:N,size:C}=j,E={root:["root",f&&"container",N!=="wrap"&&`wrap-xs-${String(N)}`,...lt(y),...rt(C),...f?nt(S,w.breakpoints.keys[0]):[]]};return fe(E,b=>Ce(i,b),{})};function d(j,w,f=()=>!0){const y={};return j===null||(Array.isArray(j)?j.forEach((S,N)=>{S!==null&&f(S)&&w.keys[N]&&(y[w.keys[N]]=S)}):typeof j=="object"?Object.keys(j).forEach(S=>{const N=j[S];N!=null&&f(N)&&(y[S]=N)}):y[w.keys[0]]=j),y}const g=n(Ye,tt,et,Je,st,at,Ke),I=v.forwardRef(function(w,f){const y=l(),S=o(w),N=De(S);ot(N,y.breakpoints);const{className:C,children:E,columns:b=12,container:s=!1,component:u="div",direction:p="row",wrap:M="wrap",size:P={},offset:B={},spacing:L=0,rowSpacing:r=L,columnSpacing:k=L,unstable_level:h=0,...A}=N,a=d(P,y.breakpoints,F=>F!==!1),m=d(B,y.breakpoints),x=w.columns??(h?void 0:b),O=w.spacing??(h?void 0:L),D=w.rowSpacing??w.spacing??(h?void 0:r),W=w.columnSpacing??w.spacing??(h?void 0:k),R={...N,level:h,columns:x,container:s,direction:p,wrap:M,spacing:O,rowSpacing:D,columnSpacing:W,size:a,offset:m},$e=c(R,y);return e.jsx(g,{ref:f,as:u,ownerState:R,className:se($e.root,C),...A,children:v.Children.map(E,F=>{var ge;return v.isValidElement(F)&&Re(F,["Grid"])&&s&&F.props.container?v.cloneElement(F,{unstable_level:((ge=F.props)==null?void 0:ge.unstable_level)??h+1}):F})})});return I.muiName="Grid",I}function ut(t){return Ce("MuiFormControlLabel",t)}const X=Pe("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),pt=t=>{const{classes:n,disabled:o,labelPlacement:l,error:i,required:c}=t,d={root:["root",o&&"disabled",`labelPlacement${ke(l)}`,i&&"error",c&&"required"],label:["label",o&&"disabled"],asterisk:["asterisk",i&&"error"]};return fe(d,ut,n)},ft=ne("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[{[`& .${X.label}`]:n.label},n.root,n[`labelPlacement${ke(o.labelPlacement)}`]]}})(Se(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${X.disabled}`]:{cursor:"default"},[`& .${X.label}`]:{[`&.${X.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:n})=>n==="start"||n==="top"||n==="bottom",style:{marginLeft:16}}]}))),ht=ne("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(Se(({theme:t})=>({[`&.${X.error}`]:{color:(t.vars||t).palette.error.main}}))),xt=v.forwardRef(function(n,o){const l=he({props:n,name:"MuiFormControlLabel"}),{checked:i,className:c,componentsProps:d={},control:g,disabled:I,disableTypography:j,inputRef:w,label:f,labelPlacement:y="end",name:S,onChange:N,required:C,slots:E={},slotProps:b={},value:s,...u}=l,p=Fe(),M=I??g.props.disabled??(p==null?void 0:p.disabled),P=C??g.props.required,B={disabled:M,required:P};["checked","name","onChange","value","inputRef"].forEach(x=>{typeof g.props[x]>"u"&&typeof l[x]<"u"&&(B[x]=l[x])});const L=Ge({props:l,muiFormControl:p,states:["error"]}),r={...l,disabled:M,labelPlacement:y,required:P,error:L.error},k=pt(r),h={slots:E,slotProps:{...d,...b}},[A,a]=K("typography",{elementType:_,externalForwardedProps:h,ownerState:r});let m=f;return m!=null&&m.type!==_&&!j&&(m=e.jsx(A,{component:"span",...a,className:se(k.label,a==null?void 0:a.className),children:m})),e.jsxs(ft,{className:se(k.root,c),ownerState:r,ref:o,...u,children:[v.cloneElement(g,B),P?e.jsxs("div",{children:[m,e.jsxs(ht,{ownerState:r,"aria-hidden":!0,className:k.asterisk,children:[" ","*"]})]}):m]})}),je=mt({createStyledComponent:ne("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[n.root,o.container&&n.container]}}),componentName:"MuiGrid",useThemeProps:t=>he({props:t,name:"MuiGrid"}),useTheme:ze}),gt=t=>{const{classes:n,inset:o,primary:l,secondary:i,dense:c}=t;return fe({root:["root",o&&"inset",c&&"dense",l&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},_e,n)},yt=ne("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[{[`& .${Z.primary}`]:n.primary},{[`& .${Z.secondary}`]:n.secondary},n.root,o.inset&&n.inset,o.primary&&o.secondary&&n.multiline,o.dense&&n.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${ye.root}:where(& .${Z.primary})`]:{display:"block"},[`.${ye.root}:where(& .${Z.secondary})`]:{display:"block"},variants:[{props:({ownerState:t})=>t.primary&&t.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:t})=>t.inset,style:{paddingLeft:56}}]}),te=v.forwardRef(function(n,o){const l=he({props:n,name:"MuiListItemText"}),{children:i,className:c,disableTypography:d=!1,inset:g=!1,primary:I,primaryTypographyProps:j,secondary:w,secondaryTypographyProps:f,slots:y={},slotProps:S={},...N}=l,{dense:C}=v.useContext(qe);let E=I??i,b=w;const s={...l,disableTypography:d,inset:g,primary:!!E,secondary:!!b,dense:C},u=gt(s),p={slots:y,slotProps:{primary:j,secondary:f,...S}},[M,P]=K("root",{className:se(u.root,c),elementType:yt,externalForwardedProps:{...p,...N},ownerState:s,ref:o}),[B,L]=K("primary",{className:u.primary,elementType:_,externalForwardedProps:p,ownerState:s}),[r,k]=K("secondary",{className:u.secondary,elementType:_,externalForwardedProps:p,ownerState:s});return E!=null&&E.type!==_&&!d&&(E=e.jsx(B,{variant:C?"body2":"body1",component:L!=null&&L.variant?void 0:"span",...L,children:E})),b!=null&&b.type!==_&&!d&&(b=e.jsx(r,{variant:"body2",color:"textSecondary",...k,children:b})),e.jsxs(M,{...P,children:[E,b]})}),ve=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],bt=({setopenviewmodal:t,employee:n,company:o,editbranch:l,editbranchdata:i})=>{const c={id:"",name:"",location:"",companyId:"",managerIds:[],defaultsetting:!0,setting:{officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:270,overtimeAfterMinutes:480},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}},[d,g]=v.useState(c),I=xe(),{adminManager:j}=ce(s=>s.user),[w,f]=v.useState([]),y=localStorage.getItem("emstoken");v.useEffect(()=>{g(s=>({...s,companyId:o._id})),l&&g(s=>({...s,...i}))},[o,l]),v.useEffect(()=>{(j==null?void 0:j.length)>0&&f(j.filter(s=>s.role==="manager"))},[j]);const S=()=>{t(!1),g(c)},N=(s,u)=>{g(p=>({...p,[s]:u}))},C=(s,u,p)=>{g(M=>({...M,setting:{...M.setting,[s]:{...M.setting[s],[u]:p}}}))},E=async()=>{var s,u;try{const p=await G.post("/api/addBranch",d,{headers:{Authorization:`Bearer ${y}`}});$.success(p.data.message),t(!1),I(Q()),S()}catch(p){console.error(p),$.error(((u=(s=p==null?void 0:p.response)==null?void 0:s.data)==null?void 0:u.message)||"Error adding branch")}},b=async()=>{var s,u;try{const p=await G.post("/api/editBranch",d,{headers:{Authorization:`Bearer ${y}`}});$.success(p.data.message),I(Q()),t(!1),S()}catch(p){console.error(p),$.error(((u=(s=p==null?void 0:p.response)==null?void 0:s.data)==null?void 0:u.message)||"Error editing branch")}};return e.jsxs("div",{className:"whole",children:[e.jsx("div",{className:"modalhead",children:l?"Edit Branch":"Add New Branch"}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs(je,{container:!0,spacing:2,children:[e.jsx(T,{label:"Branch Name",fullWidth:!0,size:"small",value:d.name,onChange:s=>N("name",s.target.value),required:!0,helperText:"Enter the official branch name"}),e.jsx(T,{label:"Location",fullWidth:!0,size:"small",value:d.location,onChange:s=>N("location",s.target.value),helperText:"City, State or Address"}),e.jsxs(de,{size:"small",fullWidth:!0,children:[e.jsx(me,{children:"Managers"}),e.jsx(ue,{multiple:!0,value:(d==null?void 0:d.managerIds)||[],onChange:s=>N("managerIds",s.target.value),input:e.jsx(pe,{label:"Managers"}),renderValue:s=>s.map(u=>{var p;return((p=w.find(M=>M._id===u))==null?void 0:p.name)||"Unknown"}).join(", "),children:w&&w.length>0?w.map(s=>{var u;return e.jsxs(Y,{value:s._id,children:[e.jsx(ee,{checked:(u=d==null?void 0:d.managerIds)==null?void 0:u.includes(s._id)}),e.jsx(ae,{src:s==null?void 0:s.profileImage,alt:s==null?void 0:s.name,children:!(s!=null&&s.profileImage)&&e.jsx(Te,{})}),e.jsx(te,{className:"ml-2 capitalize",primary:s==null?void 0:s.name})]},s._id)}):e.jsx(Y,{disabled:!0,value:"",children:e.jsx(te,{className:"ml-2 capitalize",primary:"No Manager Found"})})})]})]}),e.jsx(xt,{control:e.jsx(ee,{checked:!d.defaultsetting,onChange:s=>g(u=>({...u,defaultsetting:!s.target.checked}))}),label:"Override company default attendance settings",sx:{mt:2}}),!d.defaultsetting&&e.jsx("div",{className:"border-yellow-300 border-2 grid grid-cols-2 gap-3 border-dashed rounded mt-3 p-3",children:e.jsxs(je,{container:!0,spacing:2,children:[e.jsx(T,{label:"Office Time In",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.in,InputLabelProps:{shrink:!0},onChange:s=>C("officeTime","in",s.target.value),helperText:"Time when office hours begin"}),e.jsx(T,{label:"Office Time Out",type:"time",fullWidth:!0,size:"small",value:d.setting.officeTime.out,InputLabelProps:{shrink:!0},onChange:s=>C("officeTime","out",s.target.value),helperText:"Time when office hours end"}),e.jsx(T,{label:"Break Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.officeTime.breakMinutes,onChange:s=>C("officeTime","breakMinutes",Number(s.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(T,{label:"Full Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.fullDay,onChange:s=>C("workingMinutes","fullDay",Number(s.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(T,{label:"Half Day Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.halfDay,onChange:s=>C("workingMinutes","halfDay",Number(s.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(T,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.shortDayThreshold,onChange:s=>C("workingMinutes","shortDayThreshold",Number(s.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(T,{label:"Overtime After Minutes",fullWidth:!0,type:"number",size:"small",value:d.setting.workingMinutes.overtimeAfterMinutes,onChange:s=>C("workingMinutes","overtimeAfterMinutes",Number(s.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(de,{size:"small",fullWidth:!0,children:[e.jsx(me,{children:"Weekly Offs"}),e.jsx(ue,{multiple:!0,value:d.setting.weeklyOffs,onChange:s=>g(u=>({...u,setting:{...u.setting,weeklyOffs:s.target.value}})),input:e.jsx(pe,{label:"Weekly Offs"}),renderValue:s=>s.map(u=>{var p;return(p=ve.find(M=>M.value===u))==null?void 0:p.label}).join(", "),children:ve.map(s=>e.jsxs(Y,{value:s.value,children:[e.jsx(ee,{checked:d.setting.weeklyOffs.includes(s.value)}),e.jsx(te,{primary:s.label})]},s.value))})]}),Object.entries(d.setting.attendanceRules).map(([s,u])=>{const p=s.replace(/([A-Z])/g," $1").replace(/^./,P=>P.toUpperCase()),M={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(T,{fullWidth:!0,size:"small",label:p,type:"time",value:u,onChange:P=>g(B=>({...B,setting:{...B.setting,attendanceRules:{...B.setting.attendanceRules,[s]:P.target.value}}})),helperText:M[s]},s)})]})})]}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(z,{variant:"outlined",onClick:S,children:"Cancel"}),l?e.jsx(z,{variant:"contained",onClick:b,children:"Save"}):e.jsx(z,{variant:"contained",onClick:E,children:"Add Branch"})]})]})},jt=async({companyinp:t,setisload:n})=>{const o=localStorage.getItem("emstoken");n(!0);try{const l=await G.post("/api/addcompany",{name:t.name,industry:t.industry},{headers:{Authorization:`Bearer ${o}`}});console.log("Query:",l),$.success(l.data.message,{autoClose:1200})}catch(l){console.log(l),l.response?$.warn(l.response.data.message,{autoClose:1200}):l.request?console.error("No response from server:",l.request):console.error("Error:",l.message)}finally{n(!1)}},J={1:"Read",2:"Create",3:"Update",4:"Delete"},we=["branch","department","employee","attandence","ledger","ledger_entry","holiday","leave","notification","salary"],ie={branch:[1,2,3,4],department:[1,2,3,4],employee:[1,2,3,4],attandence:[1,2,3,4],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2,3,4],leave:[1,3,4],notification:[1,2,3,4],salary:[1,2,3]},vt={department:[1,2,3],employee:[1,2,3],attandence:[1,2,3],ledger:[1,2,3,4],ledger_entry:[1,2,3,4],holiday:[1,2],leave:[1,3],notification:[1,2],salary:[1]};function wt(){const[t,n]=v.useState([]),[o,l]=v.useState([]),[i,c]=v.useState({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ie}}),d=xe();v.useEffect(()=>{p()},[]);const g=v.useRef(null),{handleImage:I}=Ee(),[j,w]=v.useState(null),[f,y]=v.useState(!1),[S,N]=v.useState(""),[C,E]=v.useState(null),b=a=>{E(m=>m===a?null:a)},s=()=>{c({name:"",email:"",password:"",role:"admin",profileImage:null,profilePreview:"",permissions:{...ie}}),N(""),w(null),y(!1)},u=async()=>{const a={...i},m=new FormData;l(!0);try{const x=a.profileImage?await I(300,a.profileImage):null;x&&m.append("photo",x),m.append("name",a.name),m.append("email",a.email),m.append("role",a.role),m.append("password",a.password),m.append("permissions",JSON.stringify(a.permissions));const O=localStorage.getItem("emstoken");l(!0);const D=j!==null?`/api/editAdmin/${t[j]._id}`:"/api/addAdmin",R=await G["post"](D,m,{headers:{Authorization:`Bearer ${O}`,"Content-Type":"multipart/form-data"}});$.success(R.data.message,{autoClose:1200}),s(),p(),d(Q())}catch(x){console.error(x),x.response?$.warn(x.response.data.message,{autoClose:1200}):$.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},p=async()=>{try{const a=localStorage.getItem("emstoken");l(!0);const m=await G.get("/api/getAdmin",{headers:{Authorization:`Bearer ${a}`}});n(m.data)}catch(a){console.error(a),a.response?$.warn(a.response.data.message,{autoClose:1200}):$.error("Something went wrong",{autoClose:1200})}finally{l(!1)}},M=a=>{const m=t[a];c({...m,profilePreview:m.profileImage||"",profileImage:null}),w(a),y(!0)},P=async a=>{swal({title:"Are you sure to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async m=>{var x,O;if(m){let D;try{const W=localStorage.getItem("emstoken");l(!0),D=$.loading("Deleting...");const R=await G.delete(`/api/deleteAdmin/${a}`,{headers:{Authorization:`Bearer ${W}`}});$.update(D,{render:R.data.message,type:"success",isLoading:!1,autoClose:1800}),p(),d(Q())}catch(W){console.error(W),$.update(D,{render:((O=(x=W.response)==null?void 0:x.data)==null?void 0:O.message)||"Error",type:"warning",isLoading:!1,autoClose:2500})}finally{l(!1)}}})},B=(a,m)=>{c(x=>{const O=x.permissions[a]||[],W=O.includes(m)?O.filter(R=>R!==m):[...O,m].sort();return{...x,permissions:{...x.permissions,[a]:W}}})},L=a=>{const m=a==="admin"?{...ie}:{...vt};c({...i,role:a,permissions:m})},r=a=>{const m=a.target.files[0];m&&c(x=>({...x,profileImage:m,profilePreview:URL.createObjectURL(m)}))},k=()=>{S&&(c(a=>({...a,permissions:{...a.permissions,[S]:[]}})),N(""))},h=Array.from(new Set([...i.role==="admin"?we:Object.keys(i.permissions),...Object.keys(i.permissions)])),A=we.filter(a=>!h.includes(a));return e.jsxs("div",{className:"p-1 w-full",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-2",children:[e.jsxs("div",{className:"flex justify-between flex-wrap items-center mb-4",children:[e.jsx("h2",{className:"text-[16px] mb-2 md:mb-0 md:text-xl font-semibold",children:"Admin/Manager Management"}),e.jsx(z,{variant:"contained",className:"mr-2 w-full md:w-fit",onClick:()=>{s(),y(!0)},children:"Add Admin/ Manager"})]}),t.length===0?e.jsx("p",{className:"text-gray-500",children:"No admins added yet."}):e.jsx("div",{className:"space-y-3",children:t.map((a,m)=>e.jsxs("div",{className:"flex flex-col justify-between items-start border border-dashed p-2 rounded-md overflow-x-auto ",children:[e.jsxs("div",{className:"flex justify-between w-full  items-center  gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{sx:{width:60,height:60},alt:a.name,src:a==null?void 0:a.profileImage}),e.jsxs("div",{children:[e.jsxs("p",{className:" capitalize text-[14px] md:text-[18px] font-medium",children:[a.name," (",a.role,")"]}),e.jsx("p",{className:"text-[12px] md:text-sm text-gray-500",children:a.email})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"p-2 border rounded hover:bg-gray-100",onClick:()=>M(m),children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-2 border rounded text-red-600 hover:bg-red-50",onClick:()=>P(a._id),children:e.jsx(Oe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex mt-2 justify-between items-center cursor-pointer bg-teal-100 px-4 py-1 rounded-md",onClick:()=>b(m),children:[e.jsxs("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:[" ",C===m?"Hide Permissions":"View Permissions "]}),C===m?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),C===m&&e.jsxs("div",{className:"text-sm w-full  mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Permissions:"}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(J).map(x=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:x},x))]})}),e.jsx("tbody",{children:Object.entries(a.permissions).map(([x,O])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:x}),Object.keys(J).map(D=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:O.includes(Number(D))?"✅":"-"},D))]},x))})]})]})]})]},m))})]}),e.jsx(Ae,{open:f,onClose:()=>y(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"modalhead",children:[" ",j!==null?"Edit Admin":"Add Admin"]}),e.jsx("span",{className:"modalcontent",children:e.jsxs("div",{className:"space-y-3 pt-1 flex items-center gap-4 flex-col w-[100%] md:w-[500px]",children:[e.jsxs("div",{className:"mt-1 items-center  w-fit relative",children:[e.jsx("input",{style:{display:"none"},type:"file",onChange:r,ref:g,accept:"image/*",name:"",id:"fileInput"}),e.jsx(ae,{sx:{width:70,height:70},alt:i.name,src:i.profilePreview}),e.jsx("span",{onClick:()=>g.current.click(),className:"absolute -bottom-1 -right-1 rounded-full bg-teal-900 text-white p-1",children:e.jsx(Me,{size:18})})]}),e.jsx(T,{fullWidth:!0,required:!0,value:i.name,onChange:a=>c({...i,name:a.target.value}),label:"Name",size:"small"}),e.jsx(T,{fullWidth:!0,required:!0,value:i.email,onChange:a=>c({...i,email:a.target.value}),label:"Email",size:"small",helperText:"*Note - you can also use companyname as mail handler, e.g. xyz@companyname.com"}),e.jsx(T,{fullWidth:!0,required:!0,value:i.password,type:"password",onChange:a=>c({...i,password:a.target.value}),label:"Password",size:"small"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"font-semibold block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:i.role,onChange:a=>L(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),i.role==="manager"&&e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"border p-2 rounded w-full",value:S,onChange:a=>N(a.target.value),children:[e.jsx("option",{value:"",children:"-- Select Module to Add --"}),A.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx(z,{variant:"contained",onClick:k,children:"Add Module"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Permissions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(J).map(([a,m])=>e.jsx("th",{className:"border p-2 text-center",children:m},a))]})}),e.jsx("tbody",{children:h.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:a}),Object.keys(J).map(m=>{var x;return e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:` h-3 w-3 md:h-5 md:w-5 cursor-pointer rounded-md border-2 border-gray-400 \r
                                                                       focus:ring-2 focus:ring-red-400 focus:outline-none \r
                                                                       transition duration-200 ease-in-out`,type:"checkbox",checked:((x=i.permissions[a])==null?void 0:x.includes(Number(m)))||!1,onChange:()=>B(a,Number(m))})},m)})]},a))})]})})]})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(z,{variant:"outlined",onClick:s,children:"Cancel"}),e.jsx(z,{variant:"contained",onClick:u,loading:o,children:j!==null?"Update":"Create"})]})]})})})]})}const Ne=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function Ut(){const[t,n]=v.useState(null),[o,l]=v.useState(!1),[i,c]=v.useState(!1),[d,g]=v.useState(!1),{handleImage:I}=Ee(),[j,w]=v.useState(null),[f,y]=v.useState({name:"",industry:"",officeTime:{in:"10:00",out:"18:00",breakMinutes:30},gracePeriod:{lateEntryMinutes:10,earlyExitMinutes:10},workingMinutes:{fullDay:480,halfDay:240,shortDayThreshold:360,overtimeAfterMinutes:490},weeklyOffs:[0],attendanceRules:{considerEarlyEntryBefore:"09:50",considerLateEntryAfter:"10:10",considerEarlyExitBefore:"17:50",considerLateExitAfter:"18:15"}}),S=xe(),{employee:N,company:C,branch:E,profile:b}=ce(r=>r.user),s=r=>{n(k=>k===r?null:r)};v.useEffect(()=>{C&&y(C)},[C]);const u=(r,k,h)=>{y(A=>({...A,[r]:{...A[r],[k]:h}}))},p=async()=>{try{g(!0);const r=localStorage.getItem("emstoken"),k=await G.post("/api/updateCompany",{...f},{headers:{Authorization:`Bearer ${r}`}});S(Q()),$.success(k.data.message,{autoClose:1800})}catch(r){console.log(r),r.response?$.warn(r.response.data.message,{autoClose:2700}):r.request?console.error("No response from server:",r.request):console.error("Error:",r.message)}finally{g(!1)}},M=()=>{},P=r=>{var h;l(!0);const k={...r,managerIds:(h=r==null?void 0:r.managerIds)==null?void 0:h.map(A=>A._id)};w(k),c(!0)},L={headCells:{style:{backgroundColor:ce(r=>r.user.primaryColor)||"teal",fontWeight:"bold",fontSize:"14px",color:"white",justifyContent:"flex-start",paddingLeft:"4px",paddingRight:"4px"}},headRow:{style:{borderBottom:"2px solid #ccc"}},rows:{style:{minHeight:"48px",borderBottom:"1px solid #eee"}},cells:{style:{justifyContent:"flex-start",paddingLeft:"4px",paddingRight:"4px"}}};return e.jsxs("div",{className:"w-full mx-auto mt-1 p-1 py-2 md:p-6 bg-white rounded-xl shadow-md space-y-3 md:space-y-6",children:[(b==null?void 0:b.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-blue-100 px-4 py-2 rounded-md",onClick:()=>s("company"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Company Info"}),t==="company"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="company"&&e.jsxs("div",{className:"p-4 rounded flex flex-col md:flex-row items-center border-blue-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsx("div",{className:"relative flex items-center mx-auto",children:e.jsxs("div",{className:"relative w-30 h-30 mx-auto",children:[e.jsx("img",{src:(f==null?void 0:f.logo)||e.jsx(Ve,{}),alt:"Company Logo",className:"w-full h-full object-fill rounded-2xl border-2 border-dashed border-blue-300"}),e.jsx("input",{type:"file",id:"logo-upload",accept:"image/*",onChange:async r=>{const k=r.target.files[0];if(!k)return;const h=await I(200,k),A=new FormData;A.append("_id",f._id),A.append("logo",h);try{console.log("api calling"),g(!0);const a=localStorage.getItem("emstoken"),x=(await G.post("/api/updateCompany",A,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"multipart/form-data"}})).data.logoUrl;y(O=>({...O,logo:x})),$.success("Logo uploaded successfully!")}catch(a){console.error(a),$.error("Failed to upload logo.")}finally{g(!1)}},className:"hidden"}),e.jsx("label",{htmlFor:"logo-upload",className:"absolute w-8 h-8 text-center bottom-0 right-0 bg-white border border-gray-300 rounded-full p-1 cursor-pointer shadow-md",children:"✎"})]})}),e.jsxs("div",{className:"w-full md:w-[70%] flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Company Name"}),e.jsx("input",{type:"text",onChange:r=>y({...f,name:r.target.value}),value:f.name,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Industry"}),e.jsx("input",{type:"text",onChange:r=>y({...f,industry:r.target.value}),value:f.industry,className:"w-full border rounded px-3 py-2"})]}),C?e.jsx(z,{variant:"contained",loading:d,onClick:p,children:"Save Changes"}):e.jsx(z,{loading:d,variant:"contained",onClick:()=>jt({companyinp:f,setisload:g}),children:"+ Create Company"})]})]})]}),((b==null?void 0:b.role)=="superadmin"||(b==null?void 0:b.role)=="admin")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-green-100 px-4 py-2 rounded-md",onClick:()=>s("branches"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Branches"}),t==="branches"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="branches"&&e.jsxs("div",{className:"p-1 md:p-4 rounded overflow-auto border-green-300 border-2 border-dashed mt-2 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-md font-medium",children:"Branch List"}),e.jsx(z,{variant:"contained",onClick:()=>c(!0),children:"+ Add Branch"})]}),e.jsx(Qe,{customStyles:L,columns:[{name:"Name",selector:r=>r.name,sortable:!0},{name:"Location",selector:r=>r.location,sortable:!0},{name:"Manager(s)",cell:r=>{var k;return e.jsx("div",{className:"flex flex-col gap-2",children:(k=r==null?void 0:r.managerIds)==null?void 0:k.map((h,A)=>e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>M(h.userid),children:[e.jsx(ae,{src:h==null?void 0:h.profileImage,alt:h.name,children:!(h!=null&&h.profileImage)&&e.jsx(Te,{})}),e.jsx("span",{children:h.name})]},A))})}},{name:"Actions",width:"120px",cell:r=>e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>P(r),children:e.jsx(Me,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>P(r),children:e.jsx(Xe,{})})]})}],data:E||[],pagination:!0,highlightOnHover:!0,noDataComponent:"No branches found"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("department"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Department"}),t==="department"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="department"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 space-y-4",children:e.jsx(He,{})})]}),(b==null?void 0:b.role)=="superadmin"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-teal-100 px-4 py-2 rounded-md",onClick:()=>s("admin"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:"Admin/Manager"}),t==="admin"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="admin"&&e.jsx("div",{className:"p-1 rounded  border-teal-300 border-2 border-dashed mt-2 ",children:e.jsx(wt,{})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer bg-yellow-100 px-4 py-2 rounded-md",onClick:()=>s("attendance"),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:" Attendance Rules"}),t==="attendance"?e.jsx(q,{className:"text-xl"}):e.jsx(U,{className:"text-xl"})]}),t==="attendance"&&C&&e.jsxs(oe,{className:" border-yellow-300  border-2 border-dashed rounded mt-1 p-2 ",children:[e.jsxs(oe,{className:"mt-1 p-2 grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx(T,{label:"Office Time In",fullWidth:!0,type:"time",value:f.officeTime.in,onChange:r=>u("officeTime","in",r.target.value),helperText:"Time when office hours begin"}),e.jsx(T,{label:"Office Time Out",fullWidth:!0,type:"time",value:f.officeTime.out,onChange:r=>u("officeTime","out",r.target.value),helperText:"Time when office hours end"}),e.jsx(T,{label:"Break Minutes",fullWidth:!0,type:"number",value:f.officeTime.breakMinutes,onChange:r=>u("officeTime","breakMinutes",Number(r.target.value)),helperText:"Total break time allowed during the day"}),e.jsx(T,{label:"Full Day Minutes",fullWidth:!0,type:"number",value:f.workingMinutes.fullDay,onChange:r=>u("workingMinutes","fullDay",Number(r.target.value)),helperText:"Total working minutes required for a full day"}),e.jsx(T,{label:"Half Day Minutes",fullWidth:!0,type:"number",value:f.workingMinutes.halfDay,onChange:r=>u("workingMinutes","halfDay",Number(r.target.value)),helperText:"Minimum minutes required for marking a half-day"}),e.jsx(T,{label:"Short Day Threshold (min)",fullWidth:!0,type:"number",value:f.workingMinutes.shortDayThreshold,onChange:r=>u("workingMinutes","shortDayThreshold",Number(r.target.value)),helperText:"Below this time is considered a short day"}),e.jsx(T,{label:"Overtime After Minutes",fullWidth:!0,type:"number",value:f.workingMinutes.overtimeAfterMinutes,onChange:r=>u("workingMinutes","overtimeAfterMinutes",Number(r.target.value)),helperText:"Time after which overtime calculation begins"}),e.jsxs(de,{fullWidth:!0,children:[e.jsx(me,{children:"Weekly Offs"}),e.jsx(ue,{multiple:!0,value:f.weeklyOffs,onChange:r=>y({...f,weeklyOffs:r.target.value}),input:e.jsx(pe,{label:"Weekly Offs"}),renderValue:r=>r.map(k=>{var h;return(h=Ne.find(A=>A.value===k))==null?void 0:h.label}).join(", "),children:Ne.map(r=>e.jsxs(Y,{value:r.value,children:[e.jsx(ee,{checked:f.weeklyOffs.includes(r.value)}),e.jsx(te,{primary:r.label})]},r.value))})]}),Object.entries(f.attendanceRules).map(([r,k])=>{const h=r.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()),A={considerEarlyEntryBefore:"Considered early if punched before this time",considerLateEntryAfter:"Considered late if punched after this time",considerEarlyExitBefore:"Considered early exit if leaving before this time",considerLateExitAfter:"Considered late exit if leaving after this time"};return e.jsx(T,{fullWidth:!0,label:h,type:"time",value:k,onChange:a=>u("attendanceRules",r,a.target.value),helperText:A[r]},r)})]}),e.jsx(oe,{sx:{mt:4,textAlign:"right"},children:e.jsx(z,{variant:"contained",onClick:p,children:"Update Settings"})})]})]}),e.jsx(Ae,{open:i,onClose:()=>{c(!1),w(null),l(!1)},children:e.jsx("div",{className:"membermodal",children:e.jsx(bt,{setopenviewmodal:c,editbranchdata:j,editbranch:o,company:C,employee:N})})})]})}export{Ut as default};
