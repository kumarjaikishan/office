import{j as e,b as B,y as S,r as u,f as O,g as y,K as P,A as L,F as U}from"./index-Be_QPdDA.js";import{X}from"./index.es-Bwtc4Ut-.js";import{A as q}from"./index-BHXjLmTF.js";import{M as H}from"./Modalbox-Cd-_oGWY.js";import{I as K}from"./index-BvCueg8_.js";import{B as v}from"./Box-CNe63EOf.js";import{T as p}from"./TextField-Bwsdogxn.js";import{F as G,I as J,S as Q}from"./Select-wtP9BYgZ.js";import{M}from"./MenuItem-BJd3KrCW.js";import{B as N}from"./Button-BIzmkch7.js";import{u as V}from"./attandencehelper-DfRGmELq.js";import{C as k}from"./CheckPermission-CMn1LX41.js";import{T as E}from"./Typography-BKet93uY.js";import"./useSlotProps-CjQPci2g.js";import"./createSimplePaletteValueFilter-DkxTn1m9.js";import"./ButtonBase-BuAZY-7T.js";const Z=({firstfetch:o,inp:r,openmodal:b,isload:x,handleChange:h,setopenmodal:f,setInp:j,init:n})=>{const g=async a=>{a.preventDefault();const c=localStorage.getItem("emstoken");try{const l=await B.post("/api/leavehandle",{...r},{headers:{Authorization:`Bearer ${c}`}});o(),f(!1),j(n),S.success(l.data.message,{autoClose:2e3})}catch(l){l.response&&S.warning(l.response.data.message,{autoClose:3e3}),console.error(l)}};return e.jsx(H,{open:b,onClose:()=>{f(!1),j(n)},children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{onSubmit:g,children:[e.jsx("h2",{children:"Leave Management"}),e.jsxs("span",{className:"modalcontent ",children:[e.jsxs(v,{sx:{width:"100%",gap:2},children:[e.jsx(p,{fullWidth:!0,value:r.branch,label:"Branch",size:"small"}),e.jsx(p,{fullWidth:!0,value:r.employeename,label:"Name",size:"small"})]}),e.jsxs(v,{sx:{width:"100%",gap:2},children:[e.jsx(p,{fullWidth:!0,value:r.from,label:"From",size:"small"}),e.jsx(p,{fullWidth:!0,value:r.to,label:"To",size:"small"})]}),e.jsx(p,{fullWidth:!0,multiline:!0,minRows:2,value:r.reason,onChange:a=>h(a,"reason"),label:"Reason",size:"small"}),e.jsxs(G,{fullWidth:!0,required:!0,size:"small",children:[e.jsx(J,{children:"Status"}),e.jsxs(Q,{value:r.status,label:"Status",onChange:a=>h(a,"status"),children:[e.jsx(M,{value:"pending",children:"Pending"}),e.jsx(M,{value:"approved",children:"Approve"}),e.jsx(M,{value:"rejected",children:"Reject"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(N,{sx:{mr:2},loading:x,loadingPosition:"end",endIcon:e.jsx(K,{}),variant:"contained",type:"submit",children:"Update"}),e.jsx(N,{size:"small",onClick:()=>{f(!1),j(n)},variant:"outlined",children:"Cancel"})]})]})]})})})},je=()=>{const[o,r]=u.useState([]),[b,x]=u.useState(!1),[h,f]=u.useState(!1),{department:j,branch:n}=O(s=>s.user),g={leaveid:"",branch:"",employeename:"",from:"",to:"",reason:"",status:""},[a,c]=u.useState(g),l=k("leave",3),F=k("leave",4);u.useEffect(()=>{Y()},[]);const R=(s,i)=>{c({...a,[i]:s.target.value})},Y=async()=>{var i,d;const s=localStorage.getItem("emstoken");try{const m=await B.get("/api/fetchleave",{headers:{Authorization:`Bearer ${s}`}});let $=1;const _=await m.data.leave.map(t=>{var D,I,w,C,z,A;return{id:t._id,sno:$++,name:e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx(L,{src:(D=t==null?void 0:t.employeeId)==null?void 0:D.profileimage,alt:(I=t==null?void 0:t.employeeId)==null?void 0:I.employeename,children:!((w=t.employeeId)!=null&&w.profileimage)&&e.jsx(U,{})}),e.jsxs(v,{children:[e.jsx(E,{variant:"body2",children:(C=t.employeeId)==null?void 0:C.employeename}),e.jsx(E,{variant:"body2",children:(A=(z=t.employeeId)==null?void 0:z.userid)==null?void 0:A.email})]})]}),from:y(t.fromDate).format("DD MMM, YYYY"),to:y(t.toDate).format("DD MMM, YYYY"),reason:t.reason,status:e.jsx("span",{className:`${t.status=="approved"?"bg-green-100 text-green-800":t.status=="rejected"?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800"} px-3 py-1 rounded capitalize`,children:t.status}),action:e.jsxs("div",{className:"flex gap-2",children:[l&&e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>T(t),children:e.jsx(P,{})}),F&&e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>W(t._id),children:e.jsx(q,{})})]})}});r(_)}catch(m){console.error(m),S.warning(((d=(i=m.response)==null?void 0:i.data)==null?void 0:d.message)||"Error")}},W=()=>{},T=s=>{var i,d;c({leaveid:s._id,branch:n==null?void 0:n.filter(m=>m._id==(s==null?void 0:s.branchId))[0].name,employeename:(d=(i=s==null?void 0:s.employeeId)==null?void 0:i.userid)==null?void 0:d.name,from:y(s.fromDate).format("DD MMM, YYYY"),to:y(s.toDate).format("DD MMM, YYYY"),reason:s==null?void 0:s.reason,status:s==null?void 0:s.status}),x(!0)};return e.jsxs("div",{children:[e.jsx(X,{customStyles:V(),columns:ee,data:o,pagination:!0,highlightOnHover:!0}),e.jsx(Z,{firstfetch:Y,handleChange:R,inp:a,isload:h,init:g,setInp:c,openmodal:b,setopenmodal:x})]})},ee=[{name:"S.no",selector:o=>o.sno,width:"60px"},{name:"Employee",selector:o=>o.name},{name:"from",selector:o=>o.from,width:"120px"},{name:"to",selector:o=>o.to,width:"120px"},{name:"Reason",selector:o=>o.reason},{name:"Status",selector:o=>o.status,width:"120px"},{name:"Action",selector:o=>o.action,width:"90px"}];export{ee as columns,je as default};
