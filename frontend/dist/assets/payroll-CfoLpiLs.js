import{b5 as H,r as b,b6 as X,j as s,t as J,b7 as R,b8 as A,b9 as K,ba as Q,bb as W,w as Z,n as ee,bc as se,bd as _,q as ae,o as te,h as ne,A as le,k as re,a3 as oe,T as ie,B as N,aU as ce,a as de,u as ue,g as me,c as w,be as pe,y as D,b as he,i as O,a7 as ye,F as xe,I as fe,S as ge,M as F,O as je,C as be,aa as ve}from"./index-CkPQ_61E.js";import{u as Ce}from"./attandencehelper-BGjMvklU.js";import{c as Se,d as ke,e as Ie,a as Pe}from"./index-DxlFTlWZ.js";import{u as Ne}from"./useThemeProps-CPR1OH08.js";import{C as P}from"./CheckPermission-DTl1Uikj.js";import"./index-DmdMCNiS.js";const Be=H(),Ee=se(),Te=Be("div",{name:"MuiStack",slot:"Root"});function Me(t){return Ne({props:t,name:"MuiStack",defaultTheme:Ee})}function Ae(t,d){const n=b.Children.toArray(t).filter(Boolean);return n.reduce((l,m,c)=>(l.push(m),c<n.length-1&&l.push(b.cloneElement(d,{key:`separator-${c}`})),l),[])}const De=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Fe=({ownerState:t,theme:d})=>{let n={display:"flex",flexDirection:"column",...R({theme:d},A({values:t.direction,breakpoints:d.breakpoints.values}),l=>({flexDirection:l}))};if(t.spacing){const l=K(d),m=Object.keys(d.breakpoints.values).reduce((r,o)=>((typeof t.spacing=="object"&&t.spacing[o]!=null||typeof t.direction=="object"&&t.direction[o]!=null)&&(r[o]=!0),r),{}),c=A({values:t.direction,base:m}),e=A({values:t.spacing,base:m});typeof c=="object"&&Object.keys(c).forEach((r,o,u)=>{if(!c[r]){const g=o>0?c[u[o-1]]:"column";c[r]=g}}),n=Q(n,R({theme:d},e,(r,o)=>t.useFlexGap?{gap:_(l,r)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${De(o?c[o]:t.direction)}`]:_(l,r)}}))}return n=W(d.breakpoints,n),n};function $e(t={}){const{createStyledComponent:d=Te,useThemeProps:n=Me,componentName:l="MuiStack"}=t,m=()=>Z({root:["root"]},r=>ee(l,r),{}),c=d(Fe);return b.forwardRef(function(r,o){const u=n(r),v=X(u),{component:g="div",direction:S="column",spacing:j=0,divider:B,children:x,className:k,useFlexGap:E=!1,...T}=v,I={direction:S,spacing:j,useFlexGap:E},M=m();return s.jsx(c,{as:g,ownerState:I,ref:o,className:J(M.root,k),...T,children:B?Ae(x,B):x})})}const Ve=$e({createStyledComponent:ae("div",{name:"MuiStack",slot:"Root"}),useThemeProps:t=>te({props:t,name:"MuiStack"})}),ze=(t,d,n,l,m,c)=>[{name:"S.no",selector:(e,p)=>p+1,width:"60px"},{name:"Employee",selector:e=>{var p,r,o,u,v,g,S;return s.jsxs("div",{className:"flex items-center capitalize gap-3 ",children:[s.jsx(le,{src:re((p=e==null?void 0:e.employeeId)==null?void 0:p.profileimage,{format:"webp",width:100,height:100})||employepic,alt:(o=(r=e==null?void 0:e.employeeId)==null?void 0:r.userid)==null?void 0:o.name,children:!((u=e==null?void 0:e.employeeId)!=null&&u.profileimage)&&employepic}),s.jsxs(oe,{children:[s.jsx(ie,{variant:"body2",children:(g=(v=e==null?void 0:e.employeeId)==null?void 0:v.userid)==null?void 0:g.name}),s.jsxs("p",{className:"t text-[10px] text-gray-600",children:["(",(S=e==null?void 0:e.employeeId)==null?void 0:S.designation,")"]})]})]})},sortable:!0},{name:"Month",selector:e=>ne(`${e.year}-${e.month}-01`).format("MM-YYYY")},{name:"Department",selector:e=>e.department,width:"120px"},{name:"Status",selector:e=>e.status,width:"120px"},{name:"Actions",cell:e=>s.jsxs(Ve,{direction:"row",spacing:1,children:[s.jsx(N,{size:"small",variant:"outlined",disabled:!l,startIcon:s.jsx(Se,{}),onClick:()=>t(e),children:"View"}),s.jsx(N,{size:"small",variant:"outlined",color:"primary",disabled:!m,startIcon:s.jsx(ke,{}),onClick:()=>d(e),children:"Edit"}),s.jsx(N,{size:"small",variant:"outlined",color:"error",disabled:!c,startIcon:s.jsx(Ie,{}),onClick:()=>n(e._id),children:"Delete"})]}),width:"300px"}];function Ye(){var $;const{employeeId:t}=ce(),[d,n]=b.useState(!0),[l,m]=b.useState(null),[c,e]=b.useState(null);let p=de();const r=Ce(),o=ue(),[u,v]=b.useState({searchText:"",branch:"all",department:"all"}),{employee:g,leaveBalance:S,branch:j,departmen:B,profile:x}=me(a=>a.user);b.useEffect(()=>{k()},[]);const k=async()=>{var a,h,f,C;try{n(!0),e(null);const i=localStorage.getItem("emstoken"),y=await w.get("/api/payroll",{headers:{Authorization:`Bearer ${i}`}});m((a=y==null?void 0:y.data)==null?void 0:a.payrolls),o(pe((h=y==null?void 0:y.data)==null?void 0:h.payrolls))}catch(i){console.log(i),i.response?(e(((C=(f=i.response)==null?void 0:f.data)==null?void 0:C.message)||"Failed to create payroll"),D.warn(i.response.data.message,{autoClose:1200})):i.request?console.error("No response from server:",i.request):console.error("Error:",i.message)}finally{n(!1)}},E=a=>{p(`/dashboard/payroll/print/${a._id}`)},T=a=>{p(`/dashboard/payroll/edit/${a._id}`)},I=(a,h)=>{v(f=>({...f,[a]:h}))},M=l==null?void 0:l.filter(a=>{var y,V,z;const h=((z=(V=(y=a.employeeId)==null?void 0:y.userid)==null?void 0:V.name)==null?void 0:z.toLowerCase())||"",f=a.branchId||"",C=u.searchText.trim()===""||h.includes(u.searchText.toLowerCase()),i=u.branch==="all"||f===u.branch;return C&&i}),U=async a=>{swal({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async h=>{var f,C;if(h)try{n(!0),e(null);const i=localStorage.getItem("emstoken"),y=await w.delete(`/api/payroll/${a}`,{headers:{Authorization:`Bearer ${i}`}});D.success(y.data.message||"Successfull deleted"),k()}catch(i){console.error(i),e(((C=(f=i.response)==null?void 0:f.data)==null?void 0:C.message)||"Failed to fetch payroll"),D.warn("Using dummy payroll data for testing",{autoClose:1500}),m(g)}finally{n(!1)}})},L=P("salary",2),Y=P("salary",1),q=P("salary",3),G=P("salary",4);return l?s.jsxs("div",{className:"w-full mx-auto p-1 md:p-4",children:[s.jsxs("div",{className:"flex my-3 items-center flex-wrap justify-between gap-2 mt-1 w-full",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 justify-between w-full md:w-fit",children:[s.jsx(he,{size:"small",className:"w-[100%] md:w-[160px]",value:u.searchText,onChange:a=>I("searchText",a.target.value),InputProps:{startAdornment:s.jsx(O,{position:"start",children:s.jsx(ye,{})})},label:"Search Employee"}),s.jsxs(xe,{size:"small",className:"w-[47%] md:w-[160px]",children:[s.jsx(fe,{children:"Branch"}),s.jsxs(ge,{label:"Branch",value:u.branch,input:s.jsx(je,{startAdornment:s.jsx(O,{position:"start",children:s.jsx(be,{fontSize:"small"})}),label:"Branch"}),onChange:a=>I("branch",a.target.value),children:[s.jsx(F,{value:"all",children:"All"}),(x==null?void 0:x.role)==="manager"?($=j==null?void 0:j.filter(a=>{var h;return(h=x==null?void 0:x.branchIds)==null?void 0:h.includes(a._id)}))==null?void 0:$.map(a=>s.jsx(F,{value:a._id,children:a.name},a._id)):j==null?void 0:j.map(a=>s.jsxs(F,{value:a._id,children:[" ",a.name," "]},a._id))]})]})]}),L&&s.jsx("div",{className:"w-full md:w-fit",children:s.jsx(N,{size:"small",className:"w-full md:w-fit",onClick:()=>{p("/dashboard/payroll/add")},variant:"contained",children:" Add Payroll"})})]}),s.jsx("div",{children:s.jsx(ve,{columns:ze(E,T,U,Y,q,G),data:M,pagination:!0,customStyles:r,highlightOnHover:!0,paginationPerPage:20,paginationRowsPerPageOptions:[20,50,100,300],noDataComponent:s.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[s.jsx(Pe,{className:"text-xl"})," No Employee records found."]})})})]}):s.jsx("p",{className:"p-4 text-gray-500",children:"No payroll data found"})}export{Ye as default};
