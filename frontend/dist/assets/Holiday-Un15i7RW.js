import{a5 as G,r,g as Q,al as V,b as F,j as t,K as Z,L as ee,y as v}from"./index-CjW4X5Ur.js";import{d as c}from"./dayjs.min-Dpf_s3do.js";import{X as te}from"./index.es-aywfQkiS.js";import{A as ae}from"./index-CxFPPXBF.js";import{c as se}from"./attandencehelper-Bbr_tBMC.js";import{H as re}from"./holidayCalander-MS1gvT95.js";import{A as oe}from"./AdapterDateFns-C2aO-nqh.js";import{B as E}from"./Box-Bz3CLWhg.js";import{T as Y}from"./TextField-DXhoCG0B.js";import{D as H}from"./DatePicker-CMK4pjcb.js";import{B as C}from"./Button-Tp5yXu1x.js";import{F as N,I as B,S as k}from"./Select-Ac0ty6HW.js";import{M as u}from"./MenuItem-C0OQJkhO.js";import{L as le}from"./dateViewRenderers-CEoA-duZ.js";import"./ButtonBase-ByYBLvss.js";import"./Tooltip-CPjxSs-t.js";import"./useSlotProps-B5VaySyr.js";import"./createSimplePaletteValueFilter-Dr898dzn.js";import"./Popper-DG9yMcSj.js";import"./index-A_-Xssc0.js";import"./useThemeProps-Cu7XFRIu.js";import"./InputAdornment-D8n0xtJw.js";import"./Typography-ASPArm2Z.js";import"./IconButton-C2WeCk4D.js";import"./DialogContent-Cmq4XAwA.js";var w={exports:{}},ne=w.exports,$;function ie(){return $||($=1,function(s,n){(function(S,p){s.exports=p()})(ne,function(){return function(S,p){p.prototype.isSameOrBefore=function(d,x){return this.isSame(d,x)||this.isBefore(d,x)}}})}(w)),w.exports}var ce=ie();const me=G(ce);c.extend(me);const Ee=()=>{const[s,n]=r.useState({name:"",type:"Public",fromDate:null,toDate:null,description:""}),[S,p]=r.useState(null),[d,x]=r.useState([]),[m,P]=r.useState([]),[h,A]=r.useState(!1),{company:y}=Q(e=>e.user),[R,L]=r.useState([1]),[g,O]=r.useState("All"),[D,z]=r.useState("All"),[j,I]=r.useState("All"),T=V.useRef(null);r.useEffect(()=>{L((y==null?void 0:y.weeklyOffs)||[1])},[y]),r.useEffect(()=>{if(s.fromDate&&!s.toDate){const e=c(s.fromDate).toDate();isNaN(e.getTime())||n(a=>({...a,toDate:e}))}},[s.fromDate]),r.useEffect(()=>{M()},[]);const M=async()=>{try{const e=localStorage.getItem("emstoken"),o=(await F.get("/api/getholidays",{headers:{Authorization:`Bearer ${e}`}})).data.holidays,i=[];o.forEach(l=>{let f=c(l.fromDate);const K=l.toDate?c(l.toDate):f;for(;f.isSameOrBefore(K,"day");)i.push({date:f.format("MM/DD/YYYY"),name:l.name}),f=f.add(1,"day")});const b=o.map(l=>({name:l.name,From:l.fromDate,till:l.toDate,type:l.type,description:l==null?void 0:l.description,action:t.jsxs("div",{className:"action flex gap-2.5",children:[t.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>W(l),children:t.jsx(Z,{})}),t.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>J(l._id),children:t.jsx(ae,{})})]})}));r.startTransition(()=>{P(i),x(b)})}catch(e){console.error("Error fetching holidays:",e)}},W=e=>{A(!0),p(e._id),n({name:e.name,type:"Public",fromDate:c(e.fromDate).toDate(),toDate:c(e.toDate).toDate(),description:e.description||""}),setTimeout(()=>{var a;(a=T.current)==null||a.focus()},0)},J=async e=>{ee({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{const o=localStorage.getItem("emstoken"),i=await F.post("/api/deleteholiday",{id:e},{headers:{Authorization:`Bearer ${o}`}});v.success(i.data.message),M()}catch(o){console.error(o),v.warning(o.response.data.message)}})},U=async()=>{try{const e=localStorage.getItem("emstoken"),a=h?"updateholiday":"addholiday",o=h?{...s,holidayId:S}:s,i=await F.post(`/api/${a}`,o,{headers:{Authorization:`Bearer ${e}`}});v.success(i.data.message),n({name:"",type:"Public",fromDate:null,toDate:null,description:""}),A(!1),M()}catch(e){console.error(e.response),v.warning(e.response.data.message)}},q=r.useMemo(()=>d.filter(e=>{const a=c(e.From),o=g==="All"||a.year().toString()===g,i=D==="All"||a.month()===parseInt(D),b=j==="All"||e.type===j;return o&&i&&b}),[d,g,D,j]),X=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_=r.useMemo(()=>{if(!m||m.length===0)return[];const e=c(m[m.length-1].date).year(),a=c(m[0].date).year(),o=[];for(let i=e;i<=a;i++)o.push(i);return o},[m]);return t.jsxs(le,{dateAdapter:oe,children:[t.jsxs(E,{className:"flex flex-col md:flex-row gap-4 p-1",children:[t.jsx(re,{highlightedDates:m.map(e=>({date:c(e.date).toDate(),name:e.name})),weeklyOffs:R}),t.jsxs(E,{className:"flex flex-col gap-4 p-4 bg-white shadow rounded w-full max-w-md",children:[t.jsx(Y,{inputRef:T,label:"Holiday Name",size:"small",value:s.name,onChange:e=>n(a=>({...a,name:e.target.value})),fullWidth:!0}),t.jsx(H,{label:"From Date",format:"dd/MM/yyyy",value:s.fromDate,onChange:e=>n(a=>({...a,fromDate:e})),slotProps:{textField:{size:"small",fullWidth:!0}}}),t.jsx(H,{label:"To Date",format:"dd/MM/yyyy",value:s.toDate,onChange:e=>n(a=>({...a,toDate:e})),slotProps:{textField:{size:"small",fullWidth:!0}}}),t.jsx(Y,{label:"Type",size:"small",value:s.type,onChange:e=>n(a=>({...a,type:e.target.value})),fullWidth:!0}),t.jsx(Y,{label:"Description",multiline:!0,rows:2,size:"small",value:s.description,onChange:e=>n(a=>({...a,description:e.target.value})),fullWidth:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[h&&t.jsx(C,{variant:"outlined",onClick:()=>{A(!1),n({name:"",type:"Public",fromDate:null,toDate:null,description:""})},children:"Cancel"}),t.jsxs(C,{variant:"contained",onClick:U,children:[h?"Update":"Add"," Holiday"]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2  w-full md:w-fit my-4 ",children:[t.jsxs(N,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(B,{children:"Filter by Year"}),t.jsxs(k,{label:"Filter by Year",value:g,onChange:e=>O(e.target.value),children:[t.jsx(u,{value:"All",children:"All"}),_.map(e=>t.jsx(u,{value:e,children:e},e))]})]}),t.jsxs(N,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(B,{children:"Filter by Month"}),t.jsxs(k,{label:"Filter by Month",value:D,onChange:e=>z(e.target.value),children:[t.jsx(u,{value:"All",children:"All"}),X.map((e,a)=>t.jsx(u,{value:a,children:e},e))]})]}),t.jsxs(N,{className:"md:max-w-[150px] col-span-1",size:"small",children:[t.jsx(B,{children:"Filter by Type"}),t.jsxs(k,{label:"Filter by Type",value:j,onChange:e=>I(e.target.value),children:[t.jsx(u,{value:"All",children:"All"}),[...new Set(d.map(e=>e.type))].map(e=>t.jsx(u,{value:e,children:e},e))]})]}),t.jsx(C,{className:"md:max-w-[150px] col-span-1",variant:"outlined",color:"secondary",onClick:()=>{O("All"),z("All"),I("All")},children:"Reset"})]}),t.jsx("div",{className:"capitalize",children:t.jsx(te,{columns:de,data:q,pagination:!0,selectableRows:!0,customStyles:se,highlightOnHover:!0})})]})},de=[{name:"S.no",selector:(s,n)=>++n,width:"50px"},{name:"Name",selector:s=>s.name},{name:"From",selector:s=>c(s.From).format("DD MMM, YYYY"),width:"110px"},{name:"Till",selector:s=>c(s.till).format("DD MMM, YYYY"),width:"110px"},{name:"Type",selector:s=>s.type,width:"90px"},{name:"Action",selector:s=>s.action,width:"80px"}];export{Ee as default};
