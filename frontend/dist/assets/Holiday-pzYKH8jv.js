import{r as l,g as V,b1 as Z,h as i,c as C,j as e,U as ee,W as te,Y as ae,y as v,F as w,I as M,S as b,M as c,B as h,b2 as se,b3 as le,b4 as re,a0 as ne,a1 as oe,a2 as ie,a3 as z,b as H,aS as de}from"./index-CXypEiKM.js";import{H as ce}from"./holidayCalander-DPj11apy.js";import{A as me}from"./AdapterDateFns-CwCNYSZM.js";import{D as E}from"./DatePicker-y5SuEKM7.js";import{L as ue}from"./dateViewRenderers-CI2qlkXV.js";import"./Tooltip-CXMDDoX7.js";import"./Popper-DzPY5B67.js";import"./index-xw61wMfC.js";i.extend(de);const we=()=>{const[s,d]=l.useState({name:"",type:"",fromDate:null,toDate:null,description:""}),[O,R]=l.useState(null),[A,B]=l.useState([]),[m,P]=l.useState([]),[f,S]=l.useState(!1),{company:y}=V(t=>t.user),[W,$]=l.useState([1]),[j,Y]=l.useState("All"),[g,F]=l.useState("All"),[D,k]=l.useState("All"),T=Z.useRef(null),[L,I]=l.useState(!1),[q,u]=l.useState(!1);l.useEffect(()=>{$((y==null?void 0:y.weeklyOffs)||[1])},[y]),l.useEffect(()=>{if(s.fromDate&&!s.toDate){const t=i(s.fromDate).toDate();isNaN(t.getTime())||d(a=>({...a,toDate:t}))}},[s.fromDate]),l.useEffect(()=>{N()},[]);const N=async()=>{try{const t=localStorage.getItem("emstoken"),r=(await C.get("/api/getholidays",{headers:{Authorization:`Bearer ${t}`}})).data.holidays,o=[];r.forEach(n=>{let x=i(n.fromDate);const Q=n.toDate?i(n.toDate):x;for(;x.isSameOrBefore(Q,"day");)o.push({date:x.format("MM/DD/YYYY"),name:n.name}),x=x.add(1,"day")});const p=r.map(n=>({name:n.name,From:n.fromDate,till:n.toDate,type:n.type,description:n==null?void 0:n.description,action:e.jsxs("div",{className:"action flex gap-2.5",children:[e.jsx("span",{className:"edit text-[18px] text-blue-500 cursor-pointer",title:"Edit",onClick:()=>U(n),children:e.jsx(ee,{})}),e.jsx("span",{className:"delete text-[18px] text-red-500 cursor-pointer",onClick:()=>J(n._id),children:e.jsx(te,{})})]})}));l.startTransition(()=>{P(o),B(p)})}catch(t){console.error("Error fetching holidays:",t)}},U=t=>{S(!0),u(!0),R(t._id),d({name:t.name,type:t.type,fromDate:i(t.fromDate).toDate(),toDate:i(t.toDate).toDate(),description:t.description||""}),setTimeout(()=>{var a;(a=T.current)==null||a.focus()},0)},J=async t=>{ae({title:"Are you sure you want to Delete?",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{const r=localStorage.getItem("emstoken"),o=await C.post("/api/deleteholiday",{id:t},{headers:{Authorization:`Bearer ${r}`}});v.success(o.data.message),N()}catch(r){console.error(r),v.warning(r.response.data.message)}})},_=async t=>{t.preventDefault();try{const a=localStorage.getItem("emstoken"),r=f?"updateholiday":"addholiday",o=f?{...s,holidayId:O}:s,p=await C.post(`/api/${r}`,o,{headers:{Authorization:`Bearer ${a}`}});v.success(p.data.message),d({name:"",type:"Public",fromDate:null,toDate:null,description:""}),S(!1),u(!1),N()}catch(a){console.error(a.response),v.warning(a.response.data.message)}},X=l.useMemo(()=>A.filter(t=>{const a=i(t.From),r=j==="All"||a.year().toString()===j,o=g==="All"||a.month()===parseInt(g),p=D==="All"||t.type===D;return r&&o&&p}),[A,j,g,D]),G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],K=l.useMemo(()=>{if(!m||m.length===0)return[];const t=i(m[m.length-1].date).year(),a=i(m[0].date).year(),r=[];for(let o=t;o<=a;o++)r.push(o);return r},[m]);return e.jsxs(ue,{dateAdapter:me,children:[e.jsxs("div",{className:"flex flex-wrap  justify-between items-center gap-3 w-full my-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap justify-between w-full md:w-fit",children:[e.jsxs(w,{size:"small",className:"w-[47%] md:w-[120px]",children:[e.jsx(M,{children:"Year"}),e.jsxs(b,{label:"Year",value:j,onChange:t=>Y(t.target.value),children:[e.jsx(c,{value:"All",children:"All"}),K.map(t=>e.jsx(c,{value:t,children:t},t))]})]}),e.jsxs(w,{size:"small",className:"w-[47%] md:w-[120px]",children:[e.jsx(M,{children:"Month"}),e.jsxs(b,{label:"Month",value:g,onChange:t=>F(t.target.value),children:[e.jsx(c,{value:"All",children:"All"}),G.map((t,a)=>e.jsx(c,{value:a,children:t},t))]})]}),e.jsxs(w,{size:"small",className:"w-[47%] md:w-[150px]",children:[e.jsx(M,{children:"Type"}),e.jsxs(b,{label:"Filter by Type",value:D,onChange:t=>k(t.target.value),children:[e.jsx(c,{value:"All",children:"All"}),[...new Set(A.map(t=>t.type))].map(t=>e.jsx(c,{value:t,children:t},t))]})]}),e.jsx(h,{variant:"outlined",color:"secondary",className:"w-[47%] md:w-fit",startIcon:e.jsx(se,{}),onClick:()=>{Y("All"),F("All"),k("All")},children:"Reset"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-fit",children:[e.jsx(h,{startIcon:e.jsx(le,{}),variant:"contained",onClick:()=>I(!0),children:"Calendar"}),e.jsx(h,{startIcon:e.jsx(re,{}),variant:"contained",onClick:()=>u(!0),children:"Add Holiday"})]})]}),e.jsx("div",{className:"capitalize",children:e.jsx(ne,{columns:pe,data:X,pagination:!0,customStyles:oe(),noDataComponent:e.jsxs("div",{className:"flex items-center gap-2 py-6 text-center text-gray-600 text-sm",children:[e.jsx(ie,{className:"text-xl"})," No records found."]}),highlightOnHover:!0})}),e.jsx(z,{open:L,onClose:()=>I(!1),children:e.jsx("div",{className:"membermodal w-[400px]",children:e.jsx(ce,{highlightedDates:m.map(t=>({date:i(t.date).toDate(),name:t.name})),weeklyOffs:W})})}),e.jsx(z,{open:q,onClose:()=>{u(!1)},children:e.jsx("div",{className:"membermodal w-[600px]",children:e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"modalhead",children:[" ",f?"Edit Holiday":"Add holiday"]}),e.jsx("span",{className:"modalcontent ",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(H,{required:!0,inputRef:T,label:"Holiday Name",size:"small",value:s.name,onChange:t=>d(a=>({...a,name:t.target.value})),fullWidth:!0}),e.jsx(E,{required:!0,label:"From Date",format:"dd/MM/yyyy",value:s.fromDate,onChange:t=>d(a=>({...a,fromDate:t})),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx(E,{required:!0,label:"To Date",format:"dd/MM/yyyy",value:s.toDate,onChange:t=>d(a=>({...a,toDate:t})),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsxs(w,{size:"small",required:!0,fullWidth:!0,children:[e.jsx(M,{children:"Type"}),e.jsxs(b,{value:s.type,label:"Type",onChange:t=>d(a=>({...a,type:t.target.value})),children:[e.jsx(c,{disabled:!0,value:"",children:"Select Type"}),e.jsx(c,{value:"National",children:"National"}),e.jsx(c,{value:"Religious",children:"Religious"}),e.jsx(c,{value:"Public",children:"Public"}),e.jsx(c,{value:"Other",children:"Other"})]})]}),e.jsx(H,{label:"Description (optional)",multiline:!0,rows:2,size:"small",value:s.description,onChange:t=>d(a=>({...a,description:t.target.value})),fullWidth:!0})]})}),e.jsxs("div",{className:"modalfooter",children:[e.jsx(h,{variant:"outlined",onClick:()=>{S(!1),u(!1),d({name:"",type:"Public",fromDate:null,toDate:null,description:""})},children:"Cancel"}),e.jsxs(h,{variant:"contained",type:"submit",children:[f?"Update":"Add"," Holiday"]})]})]})})})]})},pe=[{name:"S.no",selector:(s,d)=>++d,width:"50px"},{name:"Name",selector:s=>s.name},{name:"From",selector:s=>i(s.From).format("DD MMM, YYYY"),width:"110px"},{name:"Till",selector:s=>i(s.till).format("DD MMM, YYYY"),width:"110px"},{name:"Type",selector:s=>s.type,width:"90px"},{name:"Action",selector:s=>s.action,width:"80px"}];export{we as default};
