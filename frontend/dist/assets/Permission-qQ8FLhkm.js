import{r as o,j as e,R,L as T,Q as U,b as S,y as c}from"./index-CTh4XINP.js";import{M as _}from"./Modalbox-CNzqGYqV.js";import{B as p}from"./Button-Gf5sSqIk.js";import{T as D}from"./TextField-DZ2WNkho.js";import{M as O}from"./MenuItem-Cy-BF1ws.js";import{I as F}from"./IconButton-xdrQIKPO.js";import"./Select-CrBcKFAw.js";import"./createSimplePaletteValueFilter-B4rI7VpO.js";import"./useSlotProps-DkXkGTp2.js";import"./ButtonBase-DRT54j5u.js";const K=()=>{const[b,k]=o.useState([]),[C,u]=o.useState(!1),[N,E]=o.useState(null),[f,y]=o.useState(null),[a,h]=o.useState({roleid:"",modules:{}}),[n,g]=o.useState(""),d=["attandence","branch","department","employee","ledgerentry","holiday","leave","ledger","notification","salary"],j={1:"Read",2:"Create",3:"Update",4:"Delete"},v=["teal","blue","yellow","red"],w=async()=>{var s,l;try{const t=localStorage.getItem("emstoken"),r=await S.get("/api/permission",{headers:{Authorization:`Bearer ${t}`}});k(r.data.permission)}catch(t){console.log(t),c.warn(((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Error",{autoClose:3e3})}};o.useEffect(()=>{w()},[]);const A=s=>{E(l=>l===s?null:s)},P=s=>{y(s);const l=Object.fromEntries(Object.entries(s.modules||{}).filter(([t])=>d.includes(t)));h({roleid:s._id,modules:{...l}}),u(!0)},I=(s,l)=>{h(t=>{const r=t.modules[s]||[],m=r.includes(l)?r.filter(x=>x!==l):[...r,l].sort();return{...t,modules:{...t.modules,[s]:m}}})},M=d.filter(s=>!Object.prototype.hasOwnProperty.call(a.modules,s)),$=()=>{if(!n){c.warn("Please select a module to add");return}if(!d.includes(n)){c.warn("Invalid module (not allowed)");return}if(a.modules[n]){c.warn("Module already exists");return}h(s=>({...s,modules:{...s.modules,[n]:[]}})),g("")},z=s=>{const l={...a.modules};delete l[s],h(t=>({...t,modules:l}))},B=async()=>{var s,l;try{const t=Object.fromEntries(Object.entries(a.modules).filter(([m,x])=>d.includes(m)&&x.length>0).map(([m,x])=>[m,[...new Set(x)].sort()])),r=localStorage.getItem("emstoken"),i=await S.put(`/api/permission/${a.roleid}`,{modules:t},{headers:{Authorization:`Bearer ${r}`}});c.success(i.data.message||"Updated successfully",{autoClose:2e3}),u(!1),y(null),w()}catch(t){console.log(t),c.warn(((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Update failed",{autoClose:3e3})}},L=()=>{u(!1),y(null)};return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col",children:b==null?void 0:b.map((s,l)=>e.jsxs("div",{children:[e.jsxs("div",{className:`flex w-full my-2 justify-between items-center cursor-pointer bg-${v[l%v.length]}-100 px-4 py-2 rounded-md`,onClick:()=>A(s.role),children:[e.jsx("span",{className:"font-semibold text-[16px] md:text-lg text-left",children:s.role}),N===`${s.role}`?e.jsx(R,{className:"text-xl"}):e.jsx(T,{className:"text-xl"})]}),N===`${s.role}`&&e.jsxs("div",{className:"p-1 rounded border-teal-300 border-2 border-dashed mt-2",children:[e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(p,{variant:"contained",onClick:()=>P(s),sx:{mr:2},children:"Edit"})}),e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-2 text-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Module"}),Object.values(j).map(t=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:t},t))]})}),e.jsx("tbody",{children:Object.entries(s.modules).map(([t,r])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 font-semibold",children:t}),Object.keys(j).map(i=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:r.includes(Number(i))?"âœ…":"-"},i))]},t))})]})]})]},s._id))}),e.jsx(_,{open:C,onClose:()=>u(!1),children:e.jsx("div",{className:"membermodal",children:e.jsxs("form",{action:"",children:[e.jsxs("h2",{className:"font-bold text-lg mb-3",children:["Edit Permission - ",f==null?void 0:f.role]}),e.jsxs("span",{className:"modalcontent",children:[e.jsxs("div",{className:"flex gap-2 mb-3 items-center",children:[e.jsx(D,{select:!0,size:"small",label:"Add Module",value:n,onChange:s=>g(s.target.value),sx:{minWidth:200},children:M.length===0?e.jsx(O,{disabled:!0,value:"",children:"No modules available"}):M.map(s=>e.jsx(O,{value:s,className:"capitalize",children:s},s))}),e.jsx(p,{variant:"contained",onClick:$,disabled:!n,children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Module"}),Object.entries(j).map(([s,l])=>e.jsx("th",{className:"border p-2 text-center",children:l},s)),e.jsx("th",{className:"border p-2 text-center",children:"Action"})]})}),e.jsx("tbody",{children:Object.keys(a.modules).sort((s,l)=>d.indexOf(s)-d.indexOf(l)).map(s=>{const l=a.modules[s]||[];return e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 capitalize",children:s}),Object.keys(j).map(t=>e.jsx("td",{className:"border text-center",children:e.jsx("input",{className:"h-3 w-3 md:h-5 md:w-5 cursor-pointer",type:"checkbox",checked:l.includes(Number(t)),onChange:()=>I(s,Number(t))})},t)),e.jsx("td",{className:"border text-center",children:e.jsx(F,{color:"error",size:"small",onClick:()=>z(s),children:e.jsx(U,{})})})]},s)})})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(p,{variant:"outlined",onClick:L,children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:B,children:"Save"})]})]})]})})})]})};export{K as default};
